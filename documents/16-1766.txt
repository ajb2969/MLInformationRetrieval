   YaDICs      YaDICs   YaDICs is a program written to perform digital image correlation on 2D and 3D tomographic images. The program was designed to be both modular, by its plugin strategy and efficient, by it multithreading strategy. It incorporates different transformations (Global, Elastic, Local), optimizing strategy (Gauss-Newton, Steepest descent), Global and/or local shape functions (Rigid-body motions, homogeneous dilatations, flexural and Brazilian test models)...  Yadics is free software so that users may contribute back to the project. The program is available for download for Linux .  YaDICs theoretical background  Context  In solid mechanics Digital image correlation is a tool that allows to identify the displacement field to register an reference image (called herein Fixed image) to images during a experiment (Mobile image). For example it is possible to observe the face of an specimen with a painted speckle on it in order to determine its displacement fields during a tensile test . Before the apparition of such methods researcher usually used strain gauge to measure the mechanical state of the material but strain gauges only measure the strain on a point and doesn't allow to understand material with an heterogeneous behavior. One can obtain a full in plane strain tensor by derivation of the displacement fields. A lot of methods are based upon the Optical flow  In fluid mechanics a similar method is used and it is called Particle Image Velocimetry (PIV), the algorithms are similar to those of DIC but it is impossible to ensure that the optical flow is conserved so a vast majority of the softwares used the Normalized Cross Correlation metric.  In mechanics the displacement or velocity fields are the only concern, registering images is just a side effect. There is another process called Image Registration using the same algorithms (on monomodal images) but where the goal is to register images and thereby identifying the displacement field is just a side effect.  YaDICs uses the general principle of Image Registration with a particular attention to the displacement fields basis.  Image Registration Principle  YaDICs can be explained using the classical Image Registration framework: 1  Image registration general scheme  The common idea of Image Registration and Digital Image Correlation is to find the transformation between a fixed image and a moving one for a given metric using an optimization scheme. While there are a lot of methods to achieve such a goal, Yadics focuses on registering images with the same modality. The idea behind the creation of this software is to be able to process data that comes from a ¬µ-tomograph i.e.: data cube over 1000¬≥ voxels. With such a size it is not possible to use naive approach usually used in a 2D- context. In order to get sufficient performances OpenMP parallelism is used and data are not globally stored in memory. As an extensive description of the different algorithms is given in. 2  Sampling  Contrary to Image Registration, Digital Image Correlation targets the transformation, one wants to extracted the most accurate transformation from the two images and not just match the images. Yadics uses the whole image as a sampling grid: it is thus a total sampling.  Interpolator  It is possible to choose between bilinear interpolation and bicubic interpolation for the grey level evaluation at non integer coordinates. The bi-cubic interpolation is the recommended one.  Metrics  Sum of Squared differences (SSD)  The SSD is also known as Mean squared error . The equation below defines the SSD metric :       S  S  D   (  Œº  ,   ‚Ñê  ‚Ñ±   ,   ‚Ñê  ‚Ñ≥   )    =     1   |   Œ©  F   |       ‚àë    x  i   ‚àà   Œ©  F       (     ‚Ñê  ‚Ñ±    (   x  i   )    -    ‚Ñê  ‚Ñ≥    (    T  Œº    (   x  i   )    )     )   2           S  S  D   Œº   subscript  ‚Ñê  ‚Ñ±    subscript  ‚Ñê  ‚Ñ≥         1     subscript  normal-Œ©  F       subscript      subscript  x  i    subscript  normal-Œ©  F      superscript       subscript  ‚Ñê  ‚Ñ±    subscript  x  i       subscript  ‚Ñê  ‚Ñ≥      subscript  T  Œº    subscript  x  i      2       SSD(\mu,\mathcal{I_{F}},\mathcal{I_{M}})=\dfrac{1}{\left|\Omega_{F}\right|}%
 \sum_{x_{i}\in\Omega_{F}}\left(\mathcal{I_{F}}(x_{i})-\mathcal{I_{M}}({T}_{\mu%
 }(x_{i}))\right)^{2}     where    ‚Ñê  ‚Ñ±     subscript  ‚Ñê  ‚Ñ±    \mathcal{I_{F}}   is the fixed image,    ‚Ñê  ‚Ñ≥     subscript  ‚Ñê  ‚Ñ≥    \mathcal{I_{M}}   the moving one,    Œ©  F     subscript  normal-Œ©  F    \Omega_{F}   the integration area    |   Œ©  F   |       subscript  normal-Œ©  F     \left|\Omega_{F}\right|   the number of pi(vo)xels (cardinal) and    T  Œº     subscript  T  Œº    {T}_{\mu}   the transformation parametrized by Œº  The transformation can be written as :        T  Œº    (  x  )    =   x  +     {   Œ¶   (  x  )    }   t    {  Œº  }            subscript  T  Œº   x     x     superscript     normal-Œ¶  x    t    Œº       T_{\mu}(x)=x+\left\{\Phi(x)\right\}^{t}\left\{\mu\right\}     This metric is the main used in the Yadics as it works well with same modality images. One has to find the minimum of this metric  Normalized cross-correlation (NCC)  The NCC is used when one cannot assure the optical flow conservation, it happens in case of change of lighting or if particles disappear from the scene can occur in Particule Images Velocimetry (PIV).  The NCC is defined by :     N  C  C   (  Œº  ,   ‚Ñê  ‚Ñ±   ,   ‚Ñê  ‚Ñ≥   )    =      ‚àë    x  i   ‚àà   Œ©  F       (     ‚Ñê  ‚Ñ±    (   x  i   )    -    ‚Ñê  ‚Ñ±   ¬Ø    )    (     ‚Ñê  ‚Ñ≥    (    T  Œº    (   x  i   )    )    -    ‚Ñê  ‚Ñ≥   ¬Ø    )        ‚àë    x  i   ‚àà   Œ©  F        (     ‚Ñê  ‚Ñ±    (   x  i   )    -    ‚Ñê  ‚Ñ±   ¬Ø    )   2     ‚àë    x  i   ‚àà   Œ©  F       (     ‚Ñê  ‚Ñ≥    (    T  Œº    (   x  i   )    )    -    ‚Ñê  ‚Ñ≥   ¬Ø    )   2               N  C  C   Œº   subscript  ‚Ñê  ‚Ñ±    subscript  ‚Ñê  ‚Ñ≥         subscript      subscript  x  i    subscript  normal-Œ©  F            subscript  ‚Ñê  ‚Ñ±    subscript  x  i     normal-¬Ø   subscript  ‚Ñê  ‚Ñ±          subscript  ‚Ñê  ‚Ñ≥      subscript  T  Œº    subscript  x  i      normal-¬Ø   subscript  ‚Ñê  ‚Ñ≥           subscript      subscript  x  i    subscript  normal-Œ©  F        superscript       subscript  ‚Ñê  ‚Ñ±    subscript  x  i     normal-¬Ø   subscript  ‚Ñê  ‚Ñ±     2     subscript      subscript  x  i    subscript  normal-Œ©  F      superscript       subscript  ‚Ñê  ‚Ñ≥      subscript  T  Œº    subscript  x  i      normal-¬Ø   subscript  ‚Ñê  ‚Ñ≥     2          NCC(\mu,\mathcal{I_{F}},\mathcal{I_{M}})=\dfrac{\sum_{x_{i}\in\Omega_{F}}\left%
 (\mathcal{I_{F}}(x_{i})-\overline{\mathcal{I_{F}}}\right)\left(\mathcal{I_{M}}%
 ({T}_{\mu}(x_{i}))-\overline{\mathcal{I_{M}}}\right)}{\sqrt{\sum_{x_{i}\in%
 \Omega_{F}}\left(\mathcal{I_{F}}(x_{i})-\overline{\mathcal{I_{F}}}\right)^{2}%
 \sum_{x_{i}\in\Omega_{F}}\left(\mathcal{I_{M}}({T}_{\mu}(x_{i}))-\overline{%
 \mathcal{I_{M}}}\right)^{2}}}     where     ‚Ñê  ‚Ñ±   ¬Ø     normal-¬Ø   subscript  ‚Ñê  ‚Ñ±     \overline{\mathcal{I_{F}}}   and     ‚Ñê  ‚Ñ≥   ¬Ø     normal-¬Ø   subscript  ‚Ñê  ‚Ñ≥     \overline{\mathcal{I_{M}}}   are the mean values of the fixed and mobile images  This metric is only used to find local translation in Yadics. This metric with translation transform can be solved using cross-correlation methods, which are non iterative and can be accelerated using Fast Fourier Transform .  Classification of transformations  There are three categories of parametrization, elastic, global and local transformation. The elastic transformations respect the partition of unity, there are no holes created or surfaces counted several times. This is commonly used in Image Registration by the use of B-Spline functions 3 4 and in solid mechanics with finite element basis. 5 6 The global transformations are defined on the whole picture using rigid body or affine transformation (which is equivalent to homogeneous strain transformation). More complex transformations can be defined such as mechanically based one. These transformations have been used for stress intensity factor identification by 7 8 and for rod strain by. 9 The local transformation can be considered as the same global transformation defined on several Zone Of Interest (ZOI) of the fixed image.  Global  Several global transforms have been implemented :   Rigid and homogeneous (Tx,Ty,Rz in 2D ; Tx,Ty,Tz,Rx,Ry,Rz,Exx,Eyy,Ezz,Eyz,Exz,Exy in 3D),  Brazilian 10 (Only in 2D),  Dynamic Flexion,   Elastic  First order quadrangular Finite Elements Q4P1 are used in Yadics Local  Every Global transform can be used on a local mesh.  Optimization  The yadics optimization process follows a gradient descent scheme  The first step is to compute the gradient of the metric regarding the transform parameters          ‚àÇ   S  S  D     (  Œº  ,   ‚Ñê  ‚Ñ±   ,   ‚Ñê  ‚Ñ≥   )     ‚àÇ  Œº       =       2   |   Œ©  F   |       ‚àë    x  i   ‚àà   Œ©  F       (     ‚Ñê  ‚Ñ±    (   x  i   )    -    ‚Ñê  ‚Ñ≥    (    T  Œº    (   x  i   )    )     )      ‚àÇ   ‚Ñê  ‚Ñ≥    (   T  Œº    (   x  i   )      ‚àÇ  Œº             =       2   |   Œ©  F   |       ‚àë    x  i   ‚àà   Œ©  F       (     ‚Ñê  ‚Ñ±    (   x  i   )    -    ‚Ñê  ‚Ñ≥    (    T  Œº    (   x  i   )    )     )     (      ‚àÇ   T  Œº     (   x  i   )     ‚àÇ  Œº     )   t       ‚àÇ   ‚Ñê  ‚Ñ≥     (    T  Œº    (   x  i   )    )     ‚àÇ  x                      S  S  D     Œº   subscript  ‚Ñê  ‚Ñ±    subscript  ‚Ñê  ‚Ñ≥       Œº         2     subscript  normal-Œ©  F       subscript      subscript  x  i    subscript  normal-Œ©  F            subscript  ‚Ñê  ‚Ñ±    subscript  x  i       subscript  ‚Ñê  ‚Ñ≥      subscript  T  Œº    subscript  x  i         fragments    subscript  ‚Ñê  ‚Ñ≥    fragments  normal-(   subscript  T  Œº    fragments  normal-(   subscript  x  i   normal-)       Œº          missing-subexpression        2     subscript  normal-Œ©  F       subscript      subscript  x  i    subscript  normal-Œ©  F            subscript  ‚Ñê  ‚Ñ±    subscript  x  i       subscript  ‚Ñê  ‚Ñ≥      subscript  T  Œº    subscript  x  i       superscript         subscript  T  Œº     subscript  x  i      Œº    t          subscript  ‚Ñê  ‚Ñ≥       subscript  T  Œº    subscript  x  i       x          \begin{array}[]{lcl}\dfrac{\partial SSD(\mu,\mathcal{I_{F}},\mathcal{I_{M}})}{%
 \partial\mu}&=&\dfrac{2}{\left|\Omega_{F}\right|}\sum_{x_{i}\in\Omega_{F}}%
 \left(\mathcal{I_{F}}(x_{i})-\mathcal{I_{M}}({T}_{\mu}(x_{i}))\right)\dfrac{%
 \partial\mathcal{I_{M}}({T}_{\mu}(x_{i})}{\partial\mu}\\
 &=&\dfrac{2}{\left|\Omega_{F}\right|}\sum_{x_{i}\in\Omega_{F}}\left(\mathcal{I%
 _{F}}(x_{i})-\mathcal{I_{M}}({T}_{\mu}(x_{i}))\right)\left(\dfrac{\partial{T}_%
 {\mu}(x_{i})}{\partial\mu}\right)^{t}\dfrac{\partial\mathcal{I_{M}}({T}_{\mu}(%
 x_{i}))}{\partial x}\\
 \end{array}     Gradient method  Once the metric gradient has been computed, one has to find an optimization strategy  The gradient method principle is explained below :       Œº   k  +  1    =    Œº  k   +    Œ±  k    d  k          subscript  Œº    k  1       subscript  Œº  k      subscript  Œ±  k    subscript  d  k       \mu_{k+1}=\mu_{k}+\alpha_{k}d_{k}     The gradient step can be constant or updated at every iteration.     d  k   =   -    Œ≥  k       ‚àÇ  ùíû    (  Œº  ,   ‚Ñê  ‚Ñ±   ,   ‚Ñê  ‚Ñ≥   )     ‚àÇ  Œº            subscript  d  k        subscript  Œ≥  k         ùíû    Œº   subscript  ‚Ñê  ‚Ñ±    subscript  ‚Ñê  ‚Ñ≥       Œº        d_{k}=-\gamma_{k}\dfrac{\partial\mathcal{C}(\mu,\mathcal{I_{F}},\mathcal{I_{M}%
 })}{\partial\mu}   ,    Œ≥  k     subscript  Œ≥  k    \gamma_{k}   allows one to choose between the following methods :       Œ≥  k     subscript  Œ≥  k    \gamma_{k}      ‚üπ   normal-‚üπ   \Longrightarrow   steepest descent,       Œ≥  k   =    [       ‚àÇ  ùíû    (  Œº  ,   ‚Ñê  ‚Ñ±   ,   ‚Ñê  ‚Ñ≥   )     ‚àÇ  Œº          ‚àÇ  ùíû    (  Œº  ,   ‚Ñê  ‚Ñ±   ,   ‚Ñê  ‚Ñ≥   )     ‚àÇ  Œº     t    ]    -  1         subscript  Œ≥  k    superscript   delimited-[]          ùíû    Œº   subscript  ‚Ñê  ‚Ñ±    subscript  ‚Ñê  ‚Ñ≥       Œº     superscript        ùíû    Œº   subscript  ‚Ñê  ‚Ñ±    subscript  ‚Ñê  ‚Ñ≥       Œº    t       1      \gamma_{k}=\left[\dfrac{\partial\mathcal{C}(\mu,\mathcal{I_{F}},\mathcal{I_{M}%
 })}{\partial\mu}\dfrac{\partial\mathcal{C}(\mu,\mathcal{I_{F}},\mathcal{I_{M}}%
 )}{\partial\mu}^{t}\right]^{-1}      ‚üπ   normal-‚üπ   \Longrightarrow   Gauss-Newton.   A lot of different methods exist (BFGS, conjugate gradient, stochastic gradient, ...) but as steepest gradient and Gauss-Newton are the only ones implemented in Yadics these methods are not discussed here.  The Gauss-Newton method is a very efficient method that needs to solve a [M]{U}={F}. On 1000¬≥ voxels ¬µ-tomographic image the number of Degrees of Freedom can reach 1e6 ( i.e: on a 12x12x12 mesh ), dealing with such a problem is more a matter of numerical scientists and required specific development (using libraries like Petsc or MUMPS) so we don't use Gauss-Newton methods to solve such problems. We have developed a specific steepest gradient algorithm with a specific tuning of the Œ±k scalar parameter at each iteration. The Gauss-Newton method can be used in small problems in 2D. Pyramidal Filter  None of these optimization methods can succeed directly if applied at the last scale as the gradient methods are sensitive to the initial guests. In order to find a global optimum one has to evaluate the transformation on a filtered image. The figure below illustrates how to use the pyramidal filter to find the transformation. 11  Pyramidal process used in Yadics (and ITK)  Regularization  The metrics is often called Image energy, people usually add energy that comes from mechanics assumptions as the laplacian of displacement (a special case of tikhonov regularization 12 ) or even Finite Element problems. As we decided not to solve the Gauss-Newton problem for most of cases this solution is far from being CPU efficient. Cachier et al. 13 demonstrated that the problem of minimizing image and mechanical energy can be reformulated in solving the energy image then applying a Gaussian filter at each iteration. We use this strategy in Yadics and we add the median filter as it is massively used in PIV. One notes that the median filter avoids local minima while preserving discontinuities. The filtering process is illustrated in the figure below :  See also   Image registration  Optical flow  Displacement vector  Particle Image Velocimetry   References  External links   http://yadics.univ-lille1.fr/wordpress/   "  Category:Graphics libraries  Category:Free software programmed in C++  Category:Command-line software  Category:Graphics software  Category:Free graphics software  Category:Free raster graphics editors  Category:Image processing  Category:Multidimensional signal processing  Category:Computer vision software  Category:Image segmentation     S. Klein, M. Staring, K. Murphy, M. A. Viergever, and J. P. W. Pluim, "Elastix: a toolbox for intensity-based medical image registration," Medical imaging, ieee transactions on, vol. 29, iss. 1, pp. 196‚Äì205, 2010 ‚Ü©    J. R√©thor√©, T. Elguedj, P. Simon, and M. Correct, "On the use of nurbs functions for displacement derivatives measurement by digital image correlation," Experimental mechanics, vol. 50, iss. 7, pp. 1099‚Äì1116, 2010. ‚Ü©  G. Besnard, F. Hild, and S. Roux, "Finite-element displacement fields analysis from digital images: application to portevin-le ch√¢telier bands," Experimental mechanics, vol. 46, iss. 6, pp. 789‚Äì803, 2006. ‚Ü©  J. R√©thor√©, S. Roux, and F. Hild, "From pictures to extended finite elements: extended digital image correlation (x-dic)," Comptes rendus m√©canique, vol. 335, iss. 3, pp. 131‚Äì137, 2007. ‚Ü©  R. Hamam, F. Hild, and S. Roux, "Stress intensity factor gauging by digital image correlation: application in cyclic fatigue," Strain, vol. 43, iss. 3, pp. 181‚Äì192, 2007. ‚Ü©  F. Hild and S. Roux, "Measuring stress intensity factors with a camera: integrated digital image correlation (i-dic)," Comptes rendus m√©canique, vol. 334, iss. 1, pp. 8‚Äì12, 2006. ‚Ü©  F. Hild, S. Roux, N. Guerrero, M. Marante, and J. Fl√≥rez-Ll√≥pez, "Calibration of constitutive models of steel beams subject to local buckling by using digital image correlation," European journal of mechanics - a/solids, vol. 30, iss. 1, pp. 1‚Äì10, 2011. ‚Ü©  F. Hild and S. Roux, "Digital image correlation: from displacement measurement to identification of elastic properties ? a review," Strain, vol. 42, iss. 2, pp. 69‚Äì80, 2006. ‚Ü©  T. S. Yoo, M. J. Ackerman, W. E. Lorensen, W. Schroeder, V. Chalana, S. Aylward, Dimitris Metaxas, and R. Whitaker, "Engineering and algorithm design for an image processing api: a technical report on itk - the insight toolkit," , pp. 586‚Äì592, 2002. ‚Ü©  A. N. Tikhonov and V. B. Glasko, "Use of the regularization method in non-linear problems," \USSR\ computational mathematics and mathematical physics, vol. 5, iss. 3, pp. 93‚Äì107, 1965. ‚Ü©  P. Cachier, E. Bardinet, D. Dormont, X. Pennec, and N. Ayache, "Iconic feature based nonrigid registration: the \PASHA\ algorithm," Computer vision and image understanding, vol. 89, iss. 2?3, pp. 272‚Äì298, 2003. ‚Ü©     