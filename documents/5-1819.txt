   Conversion between quaternions and Euler angles      Conversion between quaternions and Euler angles   Spatial rotations in three dimensions can be parametrized using both Euler angles and unit quaternions . This article explains how to convert between the two representations. Actually this simple use of "quaternions" was first presented by Euler some seventy years earlier than Hamilton to solve the problem of magic squares . For this reason the dynamics community commonly refers to quaternions in this application as "Euler parameters".  Definition  A unit quaternion can be described as:      𝐪  =    [      q  0      q  1      q  2      q  3      ]   T       𝐪   superscript     subscript  q  0    subscript  q  1    subscript  q  2    subscript  q  3     T     \mathbf{q}=\begin{bmatrix}q_{0}&q_{1}&q_{2}&q_{3}\end{bmatrix}^{T}           |  𝐪  |   2   =    q  0  2   +   q  1  2   +   q  2  2   +   q  3  2    =  1         superscript    𝐪   2      superscript   subscript  q  0   2    superscript   subscript  q  1   2    superscript   subscript  q  2   2    superscript   subscript  q  3   2         1     |\mathbf{q}|^{2}=q_{0}^{2}+q_{1}^{2}+q_{2}^{2}+q_{3}^{2}=1     We can associate a quaternion with a rotation around an axis by the following expression       𝐪  0   =   cos   (   α  /  2   )         subscript  𝐪  0       α  2      \mathbf{q}_{0}=\cos(\alpha/2)          𝐪  1   =    sin   (   α  /  2   )     cos   (   β  x   )          subscript  𝐪  1         α  2       subscript  β  x       \mathbf{q}_{1}=\sin(\alpha/2)\cos(\beta_{x})          𝐪  2   =    sin   (   α  /  2   )     cos   (   β  y   )          subscript  𝐪  2         α  2       subscript  β  y       \mathbf{q}_{2}=\sin(\alpha/2)\cos(\beta_{y})          𝐪  3   =    sin   (   α  /  2   )     cos   (   β  z   )          subscript  𝐪  3         α  2       subscript  β  z       \mathbf{q}_{3}=\sin(\alpha/2)\cos(\beta_{z})   where α is a simple rotation angle (the value in radians of the angle of rotation ) and cos(β x ), cos(β y ) and cos(β z ) are the " direction cosines " locating the axis of rotation (Euler's Theorem).  Rotation matrices  The orthogonal matrix (post-multiplying a column vector) corresponding to a clockwise/ left-handed rotation by the unit quaternion     q  =    q  0   +   i   q  1    +   j   q  2    +   k   q  3         q     subscript  q  0     i   subscript  q  1      j   subscript  q  2      k   subscript  q  3       q=q_{0}+iq_{1}+jq_{2}+kq_{3}   is given by the inhomogeneous expression:      [      1  -   2   (    q  2  2   +   q  3  2    )        2   (     q  1    q  2    -    q  0    q  3     )       2   (     q  0    q  2    +    q  1    q  3     )         2   (     q  1    q  2    +    q  0    q  3     )       1  -   2   (    q  1  2   +   q  3  2    )        2   (     q  2    q  3    -    q  0    q  1     )         2   (     q  1    q  3    -    q  0    q  2     )       2   (     q  0    q  1    +    q  2    q  3     )       1  -   2   (    q  1  2   +   q  2  2    )        ]        1    2     superscript   subscript  q  2   2    superscript   subscript  q  3   2        2       subscript  q  1    subscript  q  2       subscript  q  0    subscript  q  3        2       subscript  q  0    subscript  q  2       subscript  q  1    subscript  q  3          2       subscript  q  1    subscript  q  2       subscript  q  0    subscript  q  3        1    2     superscript   subscript  q  1   2    superscript   subscript  q  3   2        2       subscript  q  2    subscript  q  3       subscript  q  0    subscript  q  1          2       subscript  q  1    subscript  q  3       subscript  q  0    subscript  q  2        2       subscript  q  0    subscript  q  1       subscript  q  2    subscript  q  3        1    2     superscript   subscript  q  1   2    superscript   subscript  q  2   2         \begin{bmatrix}1-2(q_{2}^{2}+q_{3}^{2})&2(q_{1}q_{2}-q_{0}q_{3})&2(q_{0}q_{2}+%
 q_{1}q_{3})\\
 2(q_{1}q_{2}+q_{0}q_{3})&1-2(q_{1}^{2}+q_{3}^{2})&2(q_{2}q_{3}-q_{0}q_{1})\\
 2(q_{1}q_{3}-q_{0}q_{2})&2(q_{0}q_{1}+q_{2}q_{3})&1-2(q_{1}^{2}+q_{2}^{2})\end%
 {bmatrix}     or equivalently, by the homogeneous expression:      [        q  0  2   +   q  1  2    -   q  2  2   -   q  3  2       2   (     q  1    q  2    -    q  0    q  3     )       2   (     q  0    q  2    +    q  1    q  3     )         2   (     q  1    q  2    +    q  0    q  3     )          q  0  2   -   q  1  2    +   q  2  2    -   q  3  2       2   (     q  2    q  3    -    q  0    q  1     )         2   (     q  1    q  3    -    q  0    q  2     )       2   (     q  0    q  1    +    q  2    q  3     )         q  0  2   -   q  1  2   -   q  2  2    +   q  3  2       ]           superscript   subscript  q  0   2    superscript   subscript  q  1   2     superscript   subscript  q  2   2    superscript   subscript  q  3   2      2       subscript  q  1    subscript  q  2       subscript  q  0    subscript  q  3        2       subscript  q  0    subscript  q  2       subscript  q  1    subscript  q  3          2       subscript  q  1    subscript  q  2       subscript  q  0    subscript  q  3             superscript   subscript  q  0   2    superscript   subscript  q  1   2     superscript   subscript  q  2   2     superscript   subscript  q  3   2      2       subscript  q  2    subscript  q  3       subscript  q  0    subscript  q  1          2       subscript  q  1    subscript  q  3       subscript  q  0    subscript  q  2        2       subscript  q  0    subscript  q  1       subscript  q  2    subscript  q  3           superscript   subscript  q  0   2    superscript   subscript  q  1   2    superscript   subscript  q  2   2     superscript   subscript  q  3   2       \begin{bmatrix}q_{0}^{2}+q_{1}^{2}-q_{2}^{2}-q_{3}^{2}&2(q_{1}q_{2}-q_{0}q_{3}%
 )&2(q_{0}q_{2}+q_{1}q_{3})\\
 2(q_{1}q_{2}+q_{0}q_{3})&q_{0}^{2}-q_{1}^{2}+q_{2}^{2}-q_{3}^{2}&2(q_{2}q_{3}-%
 q_{0}q_{1})\\
 2(q_{1}q_{3}-q_{0}q_{2})&2(q_{0}q_{1}+q_{2}q_{3})&q_{0}^{2}-q_{1}^{2}-q_{2}^{2%
 }+q_{3}^{2}\end{bmatrix}     If     q  0   +   i   q  1    +   j   q  2    +   k   q  3         subscript  q  0     i   subscript  q  1      j   subscript  q  2      k   subscript  q  3      q_{0}+iq_{1}+jq_{2}+kq_{3}   is not a unit quaternion then the homogeneous form is still a scalar multiple of a rotation matrix, while the inhomogeneous form is in general no longer an orthogonal matrix. This is why in numerical work the homogeneous form is to be preferred if distortion is to be avoided.  The direction cosine matrix (from the rotated Body XYZ coordinates to the original Lab xyz coordinates) corresponding to a Body 3-2-1 sequence with Euler angles (ψ, θ, φ) is given by: 1      [       cos  θ    cos  ψ        -    cos  ϕ    sin  ψ     +    sin  ϕ    sin  θ    cos  ψ          sin  ϕ    sin  ψ    +    cos  ϕ    sin  θ    cos  ψ           cos  θ    sin  ψ         cos  ϕ    cos  ψ    +    sin  ϕ    sin  θ    sin  ψ         -    sin  ϕ    cos  ψ     +    cos  ϕ    sin  θ    sin  ψ          -   sin  θ        sin  ϕ    cos  θ        cos  ϕ    cos  θ       ]          θ     ψ            ϕ     ψ         ϕ     θ     ψ           ϕ     ψ        ϕ     θ     ψ           θ     ψ          ϕ     ψ        ϕ     θ     ψ             ϕ     ψ         ϕ     θ     ψ           θ        ϕ     θ        ϕ     θ       \begin{bmatrix}\cos\theta\cos\psi&-\cos\phi\sin\psi+\sin\phi\sin\theta\cos\psi%
 &\sin\phi\sin\psi+\cos\phi\sin\theta\cos\psi\\
 \cos\theta\sin\psi&\cos\phi\cos\psi+\sin\phi\sin\theta\sin\psi&-\sin\phi\cos%
 \psi+\cos\phi\sin\theta\sin\psi\\
 -\sin\theta&\sin\phi\cos\theta&\cos\phi\cos\theta\\
 \end{bmatrix}     Conversion  By combining the quaternion representations of the Euler rotations we get for the Body 3-2-1 sequence, where the airplane first does yaw (Body-Z) turn during taxiing on the runway, then pitches (Body-Y) during take-off, and finally rolls (Body-X) in the air. The resulting orientation of Body 3-2-1 sequence (around the capitalized axis in the illustration of Tait–Bryan angles) is equivalent to that of lab 1-2-3 sequence (around the lower-cased axis), where the airplane is rolled first (lab-x axis), and then nosed up around the horizontal lab-y axis, and finally rotated around the vertical lab-z axis ( lB = lab2Body ):       𝐪  𝐥𝐁   =    [      cos   (   ψ  /  2   )        0      0       sin   (   ψ  /  2   )       ]    [      cos   (   θ  /  2   )        0       sin   (   θ  /  2   )        0     ]    [      cos   (   ϕ  /  2   )         sin   (   ϕ  /  2   )        0      0     ]    =   [        cos   (   ϕ  /  2   )     cos   (   θ  /  2   )     cos   (   ψ  /  2   )     +    sin   (   ϕ  /  2   )     sin   (   θ  /  2   )     sin   (   ψ  /  2   )             sin   (   ϕ  /  2   )     cos   (   θ  /  2   )     cos   (   ψ  /  2   )     -    cos   (   ϕ  /  2   )     sin   (   θ  /  2   )     sin   (   ψ  /  2   )             cos   (   ϕ  /  2   )     sin   (   θ  /  2   )     cos   (   ψ  /  2   )     +    sin   (   ϕ  /  2   )     cos   (   θ  /  2   )     sin   (   ψ  /  2   )             cos   (   ϕ  /  2   )     cos   (   θ  /  2   )     sin   (   ψ  /  2   )     -    sin   (   ϕ  /  2   )     sin   (   θ  /  2   )     cos   (   ψ  /  2   )         ]          subscript  𝐪  𝐥𝐁           ψ  2      0    0        ψ  2            θ  2      0        θ  2      0          ϕ  2          ϕ  2      0    0                    ϕ  2        θ  2        ψ  2           ϕ  2        θ  2        ψ  2                ϕ  2        θ  2        ψ  2           ϕ  2        θ  2        ψ  2                ϕ  2        θ  2        ψ  2           ϕ  2        θ  2        ψ  2                ϕ  2        θ  2        ψ  2           ϕ  2        θ  2        ψ  2           \mathbf{q_{lB}}=\begin{bmatrix}\cos(\psi/2)\\
 0\\
 0\\
 \sin(\psi/2)\\
 \end{bmatrix}\begin{bmatrix}\cos(\theta/2)\\
 0\\
 \sin(\theta/2)\\
 0\\
 \end{bmatrix}\begin{bmatrix}\cos(\phi/2)\\
 \sin(\phi/2)\\
 0\\
 0\\
 \end{bmatrix}=\begin{bmatrix}\cos(\phi/2)\cos(\theta/2)\cos(\psi/2)+\sin(\phi/%
 2)\sin(\theta/2)\sin(\psi/2)\\
 \sin(\phi/2)\cos(\theta/2)\cos(\psi/2)-\cos(\phi/2)\sin(\theta/2)\sin(\psi/2)%
 \\
 \cos(\phi/2)\sin(\theta/2)\cos(\psi/2)+\sin(\phi/2)\cos(\theta/2)\sin(\psi/2)%
 \\
 \cos(\phi/2)\cos(\theta/2)\sin(\psi/2)-\sin(\phi/2)\sin(\theta/2)\cos(\psi/2)%
 \\
 \end{bmatrix}     Other rotation sequences use different conventions. 2  For Euler angles we get:       [     ϕ      θ      ψ     ]   =   [      arctan     2   (     q  0    q  1    +    q  2    q  3     )     1  -   2   (    q  1  2   +   q  2  2    )             arcsin   (   2   (     q  0    q  2    -    q  3    q  1     )    )         arctan     2   (     q  0    q  3    +    q  1    q  2     )     1  -   2   (    q  2  2   +   q  3  2    )           ]         ϕ    θ    ψ        arctan      2       subscript  q  0    subscript  q  1       subscript  q  2    subscript  q  3        1    2     superscript   subscript  q  1   2    superscript   subscript  q  2   2            arcsin    2       subscript  q  0    subscript  q  2       subscript  q  3    subscript  q  1           arctan      2       subscript  q  0    subscript  q  3       subscript  q  1    subscript  q  2        1    2     superscript   subscript  q  2   2    superscript   subscript  q  3   2            \begin{bmatrix}\phi\\
 \theta\\
 \psi\end{bmatrix}=\begin{bmatrix}\mbox{arctan}\frac{2(q_{0}q_{1}+q_{2}q_{3})}{%
 1-2(q_{1}^{2}+q_{2}^{2})}\\
 \mbox{arcsin}(2(q_{0}q_{2}-q_{3}q_{1}))\\
 \mbox{arctan}\frac{2(q_{0}q_{3}+q_{1}q_{2})}{1-2(q_{2}^{2}+q_{3}^{2})}\end{bmatrix}     arctan and arcsin have a result between −π/2 and π/2 . With three rotations between −π/2 and π/2 you can't have all possible orientations. We need to replace the arctan by atan2 to generate all the orientations.       [     ϕ      θ      ψ     ]   =   [      atan2   (   2   (     q  0    q  1    +    q  2    q  3     )    ,   1  -   2   (    q  1  2   +   q  2  2    )     )         arcsin   (   2   (     q  0    q  2    -    q  3    q  1     )    )         atan2   (   2   (     q  0    q  3    +    q  1    q  2     )    ,   1  -   2   (    q  2  2   +   q  3  2    )     )       ]         ϕ    θ    ψ        atan2     2       subscript  q  0    subscript  q  1       subscript  q  2    subscript  q  3        1    2     superscript   subscript  q  1   2    superscript   subscript  q  2   2            arcsin    2       subscript  q  0    subscript  q  2       subscript  q  3    subscript  q  1           atan2     2       subscript  q  0    subscript  q  3       subscript  q  1    subscript  q  2        1    2     superscript   subscript  q  2   2    superscript   subscript  q  3   2            \begin{bmatrix}\phi\\
 \theta\\
 \psi\end{bmatrix}=\begin{bmatrix}\mbox{atan2}(2(q_{0}q_{1}+q_{2}q_{3}),1-2(q_{%
 1}^{2}+q_{2}^{2}))\\
 \mbox{arcsin}(2(q_{0}q_{2}-q_{3}q_{1}))\\
 \mbox{atan2}(2(q_{0}q_{3}+q_{1}q_{2}),1-2(q_{2}^{2}+q_{3}^{2}))\end{bmatrix}     Relationship with Tait–Bryan angles  (Figure)  Tait–Bryan angles for an aircraft   Similarly for Euler angles, we use the Tait–Bryan angles (in terms of flight dynamics ):   Roll –   ϕ   ϕ   \phi   : rotation about the X-axis  Pitch –   θ   θ   \theta   : rotation about the Y-axis  Yaw –   ψ   ψ   \psi   : rotation about the Z-axis   where the X-axis points forward, Y-axis to the right and Z-axis downward and in the example to follow the rotation occurs in the order yaw, pitch, roll (about body-fixed axes).  Singularities  One must be aware of singularities in the Euler angle parametrization when the pitch approaches ±90° (north/south pole). These cases must be handled specially. The common name for this situation is gimbal lock .  Code to handle the singularities is derived on this site: www.euclideanspace.com  See also   Rotation operator (vector space)  Quaternions and spatial rotation  Euler Angles  Rotation matrix  Rotation formalisms in three dimensions   References  External links   Q60. How do I convert Euler rotation angles to a quaternion? and related questions at The Matrix and Quaternions FAQ   "  Category:Rotation in three dimensions  Category:Euclidean symmetries  Category:3D computer graphics     ↩      