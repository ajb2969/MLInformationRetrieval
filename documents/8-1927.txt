   Thin plate spline      Thin plate spline   Thin plate splines (TPS) are a spline -based technique for data interpolation and smoothing . They were introduced to geometric design by Duchon. 1  Physical analogy  The name thin plate spline refers to a physical analogy involving the bending of a thin sheet of metal. Just as the metal has rigidity, the TPS fit resists bending also, implying a penalty involving the smoothness of the fitted surface. In the physical setting, the deflection is in the   z   z   z   direction, orthogonal to the plane. In order to apply this idea to the problem of coordinate transformation, one interprets the lifting of the plate as a displacement of the   x   x   x   or   y   y   y   coordinates within the plane. In 2D cases, given a set of   K   K   K   corresponding points, the TPS warp is described by    2   (   K  +  3   )       2    K  3     2(K+3)   parameters which include 6 global affine motion parameters and    2  K      2  K    2K   coefficients for correspondences of the control points. These parameters are computed by solving a linear system, in other words, TPS has closed-form solution .  Smoothness measure  The TPS arises from consideration of the integral of the square of the second derivative -- this forms its smoothness measure. In the case where   x   x   x   is two dimensional, for interpolation, the TPS fits a mapping function    f   (  x  )       f  x    f(x)   between corresponding point-sets    {   y  i   }      subscript  y  i     \{y_{i}\}   and    {   x  i   }      subscript  x  i     \{x_{i}\}   that minimises the following energy function:        E   t  p  s     (  f  )    =    ∑   i  =  1   K     ∥    y  i   -   f   (   x  i   )     ∥   2           subscript  E    t  p  s    f     superscript   subscript     i  1    K    superscript   norm     subscript  y  i     f   subscript  x  i      2      E_{tps}(f)=\sum_{i=1}^{K}\|y_{i}-f(x_{i})\|^{2}     The smoothing variant, correspondingly, uses a tuning parameter   λ   λ   \lambda   to control how non-rigid is allowed for the deformation, balancing the aforementioned criterion with the measure of goodness of fit, thus minimising:        E    t  p  s   ,   s  m  o  o  t  h      (  f  )    =     ∑   i  =  1   K     ∥    y  i   -   f   (   x  i   )     ∥   2    +   λ   ∬    [     (     ∂  2   f    ∂   x  1  2     )   2   +   2    (     ∂  2   f     ∂   x  1     ∂   x  2      )   2    +    (     ∂  2   f    ∂   x  2  2     )   2    ]   d    x  1    d   x  2              subscript  E     t  p  s     s  m  o  o  t  h     f       superscript   subscript     i  1    K    superscript   norm     subscript  y  i     f   subscript  x  i      2      λ   double-integral     delimited-[]     superscript      superscript   2   f      superscript   subscript  x  1   2     2     2   superscript      superscript   2   f        subscript  x  1       subscript  x  2      2     superscript      superscript   2   f      superscript   subscript  x  2   2     2     d   subscript  x  1   d   subscript  x  2         E_{tps,smooth}(f)=\sum_{i=1}^{K}\|y_{i}-f(x_{i})\|^{2}+\lambda\iint\left[\left%
 (\frac{\partial^{2}f}{\partial x_{1}^{2}}\right)^{2}+2\left(\frac{\partial^{2}%
 f}{\partial x_{1}\partial x_{2}}\right)^{2}+\left(\frac{\partial^{2}f}{%
 \partial x_{2}^{2}}\right)^{2}\right]\textrm{d}x_{1}\,\textrm{d}x_{2}     For this variational problem, it can be shown that there exists a unique minimizer   f   f   f   (Wahba,1990).The finite element discretization of this variational problem, the method of elastic maps , is used for data mining and nonlinear dimensionality reduction .  Radial basis function  The Thin Plate Spline has a natural representation in terms of radial basis functions. Given a set of control points    {      w  i   ,  i   =  1   ,   2  ,  …  ,  K    }      formulae-sequence      subscript  w  i   i   1    2  normal-…  K      \{w_{i},i=1,2,\ldots,K\}   , a radial basis function basically defines a spatial mapping which maps any location   x   x   x   in space to a new location    f   (  x  )       f  x    f(x)   , represented by,       f   (  x  )    =    ∑   i  =  1   K     c  i   φ   (   ∥   x  -   w  i    ∥   )           f  x     superscript   subscript     i  1    K      subscript  c  i   φ   norm    x   subscript  w  i         f(x)=\sum_{i=1}^{K}c_{i}\varphi(\left\|x-w_{i}\right\|)   where    ∥  ⋅  ∥     fragments  normal-∥  normal-⋅  normal-∥    \left\|\cdot\right\|   denotes the usual Euclidean norm and    {   c  i   }      subscript  c  i     \{c_{i}\}   is a set of mapping coefficients. The TPS corresponds to the radial basis kernel     φ   (  r  )    =    r  2    log  r          φ  r      superscript  r  2     r      \varphi(r)=r^{2}\log r   .  Spline  Suppose the points are in 2 dimensions (    D  =  2      D  2    D=2   ). One can use homogeneous coordinates for the point-set where a point    y  i     subscript  y  i    y_{i}   is represented as a vector    (  1  ,   y   i  x    ,   y   i  y    )     1   subscript  y    i  x     subscript  y    i  y      (1,y_{ix},y_{iy})   . The unique minimizer   f   f   f   is parameterized by   α   α   \alpha   which comprises two matrices   d   d   d   and   c   c   c   (    α  =   {  d  ,  c  }       α   d  c     \alpha=\{d,c\}   ).        f   t  p  s     (  z  ,  α  )    =    f   t  p  s     (  z  ,  d  ,  c  )    =    z  ⋅  d   +    ∑   i  =  1   K     ϕ   (   ∥   z  -   x  i    ∥   )    ⋅   c  i               subscript  f    t  p  s     z  α       subscript  f    t  p  s     z  d  c            normal-⋅  z  d     superscript   subscript     i  1    K    normal-⋅    ϕ   norm    z   subscript  x  i       subscript  c  i         f_{tps}(z,\alpha)=f_{tps}(z,d,c)=z\cdot d+\sum_{i=1}^{K}\phi(\|z-x_{i}\|)\cdot
 c%
 _{i}   where d is a     (   D  +  1   )   ×   (   D  +  1   )         D  1     D  1     (D+1)\times(D+1)   matrix representing the affine transformation (hence   z   z   z   is a    1  ×   (   D  +  1   )       1    D  1     1\times(D+1)   vector) and c is a    K  ×   (   D  +  1   )       K    D  1     K\times(D+1)   warping coefficient matrix representing the non-affine deformation. The kernel function    ϕ   (  z  )       ϕ  z    \phi(z)   is a    1  ×  K      1  K    1\times K   vector for each point   z   z   z   , where each entry      ϕ  i    (  z  )    =     ∥   z  -   x  i    ∥   2    log   ∥   z  -   x  i    ∥            subscript  ϕ  i   z      superscript   norm    z   subscript  x  i     2      norm    z   subscript  x  i         \phi_{i}(z)=\|z-x_{i}\|^{2}\log\|z-x_{i}\|   for each (   D   D   D   ) dimensions. Note that for TPS, the control points    {   w  i   }      subscript  w  i     \{w_{i}\}   are chosen to be the same as the set of points to be warped    {   x  i   }      subscript  x  i     \{x_{i}\}   , so we already use    {   x  i   }      subscript  x  i     \{x_{i}\}   in the place of the control points.  If one substitutes the solution for   f   f   f   ,    E   t  p  s      subscript  E    t  p  s     E_{tps}   becomes:        E   t  p  s     (  d  ,  c  )    =     ∥   Y  -   X  d   -   Φ  c    ∥   2   +   λ   c  T   Φ  c           subscript  E    t  p  s     d  c       superscript   norm    Y    X  d     normal-Φ  c     2     λ   superscript  c  T   normal-Φ  c      E_{tps}(d,c)=\|Y-Xd-\Phi c\|^{2}+\lambda c^{T}\Phi c   where   Y   Y   Y   and   X   X   X   are just concatenated versions of the point coordinates    y  i     subscript  y  i    y_{i}   and    x  i     subscript  x  i    x_{i}   , and   Φ   normal-Φ   \Phi   is a    (   K  ×  K   )      K  K    (K\times K)   matrix formed from the    ϕ   (   ∥    x  i   -   x  j    ∥   )       ϕ   norm     subscript  x  i    subscript  x  j       \phi(\|x_{i}-x_{j}\|)   . Each row of each newly formed matrix comes from one of the original vectors. The matrix   Φ   normal-Φ   \Phi   represents the TPS kernel. Loosely speaking, the TPS kernel contains the information about the point-set's internal structural relationships. When it is combined with the warping coefficients   c   c   c   , a non-rigid warping is generated.  A nice property of the TPS is that it can always be decomposed into a global affine and a local non-affine component. Consequently, the TPS smoothness term is solely dependent on the non-affine components. This is a desirable property, especially when compared to other splines, since the global pose parameters included in the affine transformation are not penalized.  Solution  The separation of the affine and non-affine warping space is done through a QR decomposition (Wahba,1990).      X  =   [   Q  1   |   Q  2   ]    (     R       0      )      fragments  X    fragments  normal-[   subscript  Q  1   normal-|   subscript  Q  2   normal-]    fragments  normal-(    R   missing-subexpression     0   missing-subexpression     normal-)     X=[Q_{1}|Q_{2}]\left(\begin{array}[]{cc}R\\
 0\end{array}\right)   where Q1 and Q2 are    K  ×   (   D  +  1   )       K    D  1     K\times(D+1)   and    K  ×   (   K  -  D  -  1   )       K    K  D  1     K\times(K-D-1)   orthonormal matrices, respectively. The matrix   R   R   R   is upper triangular. With the QR decomposition in place, we have        E   t  p  s     (  γ  ,  d  )    =     ∥     Q  2  T   Y   -    Q  2  T   Φ   Q  2   γ    ∥   2   +    ∥     Q  1  T   Y   -   R  d   -    Q  1  T   Φ   Q  2   γ    ∥   2   +   λ  trace   (    γ  T    Q  2  T   Φ   Q  2   γ   )            subscript  E    t  p  s     γ  d       superscript   norm       superscript   subscript  Q  2   T   Y      superscript   subscript  Q  2   T   normal-Φ   subscript  Q  2   γ     2    superscript   norm       superscript   subscript  Q  1   T   Y     R  d      superscript   subscript  Q  1   T   normal-Φ   subscript  Q  2   γ     2     λ  trace     superscript  γ  T    superscript   subscript  Q  2   T   normal-Φ   subscript  Q  2   γ       E_{tps}(\gamma,d)=\|Q_{2}^{T}Y-Q_{2}^{T}\Phi Q_{2}\gamma\|^{2}+\|Q_{1}^{T}Y-Rd%
 -Q_{1}^{T}\Phi Q_{2}\gamma\|^{2}+\lambda\textrm{trace}(\gamma^{T}Q_{2}^{T}\Phi
 Q%
 _{2}\gamma)   where   γ   γ   \gamma   is a     (   K  -  D  -  1   )   ×   (   D  +  1   )         K  D  1     D  1     (K-D-1)\times(D+1)   matrix. Setting    c  =    Q  2   γ       c     subscript  Q  2   γ     c=Q_{2}\gamma   (which in turn implies that      X  T   c   =  0         superscript  X  T   c   0    X^{T}c=0   ) enables us to cleanly separate the first term in last third equation into a non-affine term and an affine term (first and second terms last equation respectively).  The least-squares energy function in the last equation can be first minimized w.r.t   γ   γ   \gamma   and then w.r.t.   d   d   d   . By applying Tikhonov regularization we have       c  ^   =    Q  2     (     Q  2  T   Φ   Q  2    +   λ   I   (   k  -  D  -  1   )      )    -  1     Q  2  T   Y        normal-^  c      subscript  Q  2    superscript       superscript   subscript  Q  2   T   normal-Φ   subscript  Q  2      λ   subscript  I    k  D  1        1     superscript   subscript  Q  2   T   Y     \hat{c}=Q_{2}(Q_{2}^{T}\Phi Q_{2}+\lambda I_{(k-D-1)})^{-1}Q_{2}^{T}Y          d  ^   =    R   -  1     Q  1  T    (   Y  -   Φ   c  ^     )         normal-^  d      superscript  R    1     superscript   subscript  Q  1   T     Y    normal-Φ   normal-^  c        \hat{d}=R^{-1}Q_{1}^{T}(Y-\Phi\hat{c})   The minimum value of the TPS energy function obtained at the optimum    (   c  ^   ,   d  ^   )      normal-^  c    normal-^  d     (\hat{c},\hat{d})   is       E   b  e  n  d  i  n  g    =    λ   trace   [    Q  2     (     Q  2  T   Φ   Q  2    +   λ   I   (   k  -  D  -  1   )      )    -  1     Q  2  T   Y   Y  T    ]         subscript  E    b  e  n  d  i  n  g      λ  trace   delimited-[]     subscript  Q  2    superscript       superscript   subscript  Q  2   T   normal-Φ   subscript  Q  2      λ   subscript  I    k  D  1        1     superscript   subscript  Q  2   T   Y   superscript  Y  T        E_{bending}=\lambda\,\textrm{trace}[Q_{2}(Q_{2}^{T}\Phi Q_{2}+\lambda I_{(k-D-%
 1)})^{-1}Q_{2}^{T}YY^{T}]     Application  TPS has been widely used as the non-rigid transformation model in image alignment and shape matching.  The Thin-plate-spline has a number of properties which have contributed to its popularity:   It produces smooth surfaces, which are infinitely differentiable.  There are no free parameters that need manual tuning.  It has closed-form solutions for both warping and parameter estimation.  There is a physical explanation for its energy function.   See also   Inverse distance weighting  Radial basis function  Subdivision surface (emerging alternative to spline-based surfaces)  Elastic map (a discrete version of the thin plate approximation for manifold learning )  Spline  Polyharmonic spline (the thin-plate-spline is a special case of a polyharmonic spline)   References   Haili Chui: Non-Rigid Point Matching: Algorithms, Extensions and Applications. PhD Thesis, Yale University, May 2001.  G. Wahba, 1990, Spline models for observational data. Philadelphia: Society for Industrial and Applied Mathematics.   External links   Explanation for a simplified variation problem  TPS at MathWorld  TPS in C++  TPS in templated C++  TPS interactive morphing demo   "  Category:Splines  Category:Multivariate interpolation     J. Duchon, 1976, Splines minimizing rotation invariant semi-norms in Sobolev spaces. pp 85–100, In: Constructive Theory of Functions of Several Variables, Oberwolfach 1976, W. Schempp and K. Zeller , eds., Lecture Notes in Math., Vol. 571, Springer, Berlin, 1977 ↩     