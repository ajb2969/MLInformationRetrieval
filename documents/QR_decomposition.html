<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title offset="1877">QR decomposition</title>
   <script type="text/javascript"
      src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG.js">
    </script>
</head>
<body>
<h1>QR decomposition</h1>
<hr/>
<p>In <a href="linear_algebra" title="wikilink">linear algebra</a>, a <strong>QR decomposition</strong> (also called a <strong>QR factorization</strong>) of a <a href="matrix_(mathematics)" title="wikilink">matrix</a> is a <a href="matrix_decomposition" title="wikilink">decomposition</a> of a matrix <em>A</em> into a product <em>A</em> = <em>QR</em> of an <a href="orthogonal_matrix" title="wikilink">orthogonal matrix</a> <em>Q</em> and an <a href="upper_triangular_matrix" title="wikilink">upper triangular matrix</a> <em>R</em>. QR decomposition is often used to solve the <a href="linear_least_squares_(mathematics)" title="wikilink">linear least squares</a> problem, and is the basis for a particular <a href="eigenvalue_algorithm" title="wikilink">eigenvalue algorithm</a>, the <a href="QR_algorithm" title="wikilink">QR algorithm</a>.</p>
<p>If <em>A</em> has <em>n</em> <a href="linearly_independent" title="wikilink">linearly independent</a> columns, then the first <em>n</em> columns of <em>Q</em> form an <a href="orthonormal_basis" title="wikilink">orthonormal basis</a> for the <a href="column_space" title="wikilink">column space</a> of <em>A</em>. More specifically, the first <em>k</em> columns of <em>Q</em> form an orthonormal basis for the <a href="linear_span" title="wikilink">span</a> of the first <em>k</em> columns of <em>A</em> for any 1 ≤ <em>k</em> ≤ <em>n</em>.<a class="footnoteRef" href="#fn1" id="fnref1"><sup>1</sup></a> The fact that any column <em>k</em> of <em>A</em> only depends on the first <em>k</em> columns of <em>Q</em> is responsible for the triangular form of <em>R</em>.<a class="footnoteRef" href="#fn2" id="fnref2"><sup>2</sup></a></p>
<h2 id="history">History</h2>
<p>The QR algorithm for the computation of eigenvalues, which is based on the QR-decomposition, is considered to be one of the 10 most important algorithms of the 20th century.<a class="footnoteRef" href="#fn3" id="fnref3"><sup>3</sup></a> It was independently discovered by British computer scientist <a href="John_G.F._Francis" title="wikilink">John G. F. Francis</a> in 1959, and Soviet mathematician <a href="Vera_Kublanovskaya" title="wikilink">Vera Kublanovskaya</a> in 1961.</p>
<h2 id="definitions">Definitions</h2>
<h3 id="square-matrix">Square matrix</h3>
<p>Any real square matrix <em>A</em> may be decomposed as</p>
<p><span class="LaTeX">$$A = QR, \,$$</span> where <em>Q</em> is an <a href="orthogonal_matrix" title="wikilink">orthogonal matrix</a> (its columns are <a class="uri" href="orthogonal" title="wikilink">orthogonal</a> <a href="unit_vector" title="wikilink">unit vectors</a> meaning <em>Q</em><sup>T</sup><em>Q</em> = <em>I</em>) and <em>R</em> is an upper <a href="triangular_matrix" title="wikilink">triangular matrix</a> (also called right triangular matrix). If <em>A</em> is <a href="invertible_matrix" title="wikilink">invertible</a>, then the factorization is unique if we require that the diagonal elements of <em>R</em> be positive.</p>
<p>If instead <em>A</em> is a complex square matrix, then there is a decomposition <em>A</em> = <em>QR</em> where <em>Q</em> is a <a href="unitary_matrix" title="wikilink">unitary matrix</a> (so <em>Q</em><sup>*</sup><em>Q</em> = <em>I</em>).</p>
<h3 id="rectangular-matrix">Rectangular matrix</h3>
<p>More generally, we can factor a complex <em>m</em>×<em>n</em> matrix <em>A</em>, with <em>m</em> ≥ <em>n</em>, as the product of an <em>m</em>×<em>m</em> <a href="unitary_matrix" title="wikilink">unitary matrix</a> <em>Q</em> and an <em>m</em>×<em>n</em> upper triangular matrix <em>R</em>. As the bottom (<em>m</em>−<em>n</em>) rows of an <em>m</em>×<em>n</em> upper triangular matrix consist entirely of zeroes, it is often useful to partition <em>R</em>, or both <em>R</em> and <em>Q</em>:</p>
<p><span class="LaTeX">$$A = QR = Q \begin{bmatrix} R_1 \\ 0 \end{bmatrix}
  =  \begin{bmatrix} Q_1, Q_2 \end{bmatrix} \begin{bmatrix} R_1 \\ 0 \end{bmatrix}
  = Q_1 R_1,$$</span> where <em>R</em><sub>1</sub> is an <em>n</em>×<em>n</em> upper triangular matrix, <em>0</em> is an (<em>m</em> − <em>n</em>)×<em>n</em> zero matrix, <em>Q</em><sub>1</sub> is <em>m</em>×<em>n</em>, <em>Q</em><sub>2</sub> is <em>m</em>×(<em>m</em> − <em>n</em>), and <em>Q</em><sub>1</sub> and <em>Q</em><sub>2</sub> both have orthogonal columns.</p>
<p>call <em>Q</em><sub>1</sub><em>R</em><sub>1</sub> the <em>thin QR factorization</em> of <em>A</em>; Trefethen and Bau call this the <em>reduced QR factorization</em>.<a class="footnoteRef" href="#fn4" id="fnref4"><sup>4</sup></a> If <em>A</em> is of full <a href="matrix_rank" title="wikilink">rank</a> <em>n</em> and we require that the diagonal elements of <em>R</em><sub>1</sub> are positive then <em>R</em><sub>1</sub> and <em>Q</em><sub>1</sub> are unique, but in general <em>Q</em><sub>2</sub> is not. <em>R</em><sub>1</sub> is then equal to the upper triangular factor of the <a href="Cholesky_decomposition" title="wikilink">Cholesky decomposition</a> of <em>A</em> <em>A</em> (= <em>A</em><sup>T</sup><em>A</em> if <em>A</em> is real).</p>
<h3 id="ql-rq-and-lq-decompositions">QL, RQ and LQ decompositions</h3>
<p>Analogously, we can define QL, RQ, and LQ decompositions, with <em>L</em> being a <em>lower</em> triangular matrix.</p>
<h2 id="computing-the-qr-decomposition">Computing the QR decomposition</h2>
<p>There are several methods for actually computing the QR decomposition, such as by means of the <a href="Gram–Schmidt_process" title="wikilink">Gram–Schmidt process</a>, <a href="Householder_transformation" title="wikilink">Householder transformations</a>, or <a href="Givens_rotation" title="wikilink">Givens rotations</a>. Each has a number of advantages and disadvantages.</p>
<h3 id="using-the-gramschmidt-process">Using the Gram–Schmidt process</h3>
<p>Consider the <a href="Gram–Schmidt_process" title="wikilink">Gram–Schmidt process</a> applied to the columns of the full column rank matrix <span class="LaTeX">$A=[\mathbf{a}_1, \cdots, \mathbf{a}_n]$</span>, with <a href="inner_product" title="wikilink">inner product</a> <span class="LaTeX">$\langle\mathbf{v},\mathbf{w}\rangle = \mathbf{v}^\top \mathbf{w}$</span> (or <span class="LaTeX">$\langle\mathbf{v},\mathbf{w}\rangle = \mathbf{v}^* \mathbf{w}$</span> for the complex case).</p>
<p>Define the <a href="Vector_projection" title="wikilink">projection</a>:</p>
<p><span class="LaTeX">$$\mathrm{proj}_{\mathbf{e}}\mathbf{a}
= \frac{\left\langle\mathbf{e},\mathbf{a}\right\rangle}{\left\langle\mathbf{e},\mathbf{e}\right\rangle}\mathbf{e}$$</span> then:</p>
<p><span class="LaTeX">$$\begin{align}
 \mathbf{u}_1 &= \mathbf{a}_1,
  & \mathbf{e}_1 &= {\mathbf{u}_1 \over \|\mathbf{u}_1\|} \\
 \mathbf{u}_2 &= \mathbf{a}_2-\mathrm{proj}_{\mathbf{u}_1}\,\mathbf{a}_2,
  & \mathbf{e}_2 &= {\mathbf{u}_2 \over \|\mathbf{u}_2\|} \\
 \mathbf{u}_3 &= \mathbf{a}_3-\mathrm{proj}_{\mathbf{u}_1}\,\mathbf{a}_3-\mathrm{proj}_{\mathbf{u}_2}\,\mathbf{a}_3,
  & \mathbf{e}_3 &= {\mathbf{u}_3 \over \|\mathbf{u}_3\|} \\
 & \vdots &&\vdots \\
 \mathbf{u}_k &= \mathbf{a}_k-\sum_{j=1}^{k-1}\mathrm{proj}_{\mathbf{u}_j}\,\mathbf{a}_k,
  &\mathbf{e}_k &= {\mathbf{u}_k\over\|\mathbf{u}_k\|}
\end{align}$$</span></p>
<p>We then rearrange the equations above so that the <span class="LaTeX">$\mathbf{a}_i$</span>s are on the left, using the fact that the <span class="LaTeX">$\mathbf{e}_i$</span> are unit vectors:</p>
<p><span class="LaTeX">$$\begin{align}
 \mathbf{a}_1 &= \langle\mathbf{e}_1,\mathbf{a}_1 \rangle \mathbf{e}_1  \\
 \mathbf{a}_2 &= \langle\mathbf{e}_1,\mathbf{a}_2 \rangle \mathbf{e}_1
  + \langle\mathbf{e}_2,\mathbf{a}_2 \rangle \mathbf{e}_2 \\
 \mathbf{a}_3 &= \langle\mathbf{e}_1,\mathbf{a}_3 \rangle \mathbf{e}_1
  + \langle\mathbf{e}_2,\mathbf{a}_3 \rangle \mathbf{e}_2
  + \langle\mathbf{e}_3,\mathbf{a}_3 \rangle \mathbf{e}_3 \\
 &\vdots \\
 \mathbf{a}_k &= \sum_{j=1}^{k} \langle \mathbf{e}_j, \mathbf{a}_k \rangle \mathbf{e}_j
\end{align}$$</span> where <span class="LaTeX">$\langle\mathbf{e}_i,\mathbf{a}_i \rangle = \|\mathbf{u}_i\|$</span>. This can be written in matrix form:</p>
<p><span class="LaTeX">$$A = Q R$$</span> where:</p>
<p><span class="LaTeX">$$Q = \left[ \mathbf{e}_1, \cdots, \mathbf{e}_n\right] \qquad \text{and} \qquad
R = \begin{pmatrix}
\langle\mathbf{e}_1,\mathbf{a}_1\rangle & \langle\mathbf{e}_1,\mathbf{a}_2\rangle &  \langle\mathbf{e}_1,\mathbf{a}_3\rangle  & \ldots \\
0                & \langle\mathbf{e}_2,\mathbf{a}_2\rangle                        &  \langle\mathbf{e}_2,\mathbf{a}_3\rangle  & \ldots \\
0                & 0                                       & \langle\mathbf{e}_3,\mathbf{a}_3\rangle                          & \ldots \\
\vdots           & \vdots                                  & \vdots                                    & \ddots \end{pmatrix}.$$</span></p>
<h4 id="example">Example</h4>
<p>Consider the decomposition of</p>
<p><span class="LaTeX">$$A = 
\begin{pmatrix}
12 & -51 & 4 \\
6 & 167 & -68 \\
-4 & 24 & -41
\end{pmatrix}
.$$</span></p>
<p>Recall that an orthonormal matrix <span class="LaTeX">$Q$</span> has the property</p>
<p><span class="LaTeX">$$\begin{matrix}
 Q^T \,Q = I.
\end{matrix}$$</span></p>
<p>Then, we can calculate <span class="LaTeX">$Q$</span> by means of Gram–Schmidt as follows:</p>
<p><span class="LaTeX">$$U = 
\begin{pmatrix}
\mathbf u_1 & \mathbf u_2 & \mathbf u_3
\end{pmatrix}
=
\begin{pmatrix}
12 & -69 & -58/5 \\
6  & 158 & 6/5 \\
-4 &  30 & -33
\end{pmatrix};$$</span></p>
<p><span class="LaTeX">$$Q = 
\begin{pmatrix}
\frac{\mathbf u_1}{\|\mathbf u_1\|} &
\frac{\mathbf u_2}{\|\mathbf u_2\|} &
\frac{\mathbf u_3}{\|\mathbf u_3\|}
\end{pmatrix}
=
\begin{pmatrix}
     6/7    &    -69/175   &   -58/175   \\
     3/7    &    158/175   &     6/175   \\
    -2/7    &      6/35    &   -33/35
\end{pmatrix}.$$</span></p>
<p>Thus, we have</p>
<p><span class="LaTeX">$$\begin{matrix}
 Q^{T} A = Q^{T}Q\,R = R;
\end{matrix}$$</span></p>
<p><span class="LaTeX">$$\begin{matrix}
 R = Q^{T}A =
\end{matrix}
\begin{pmatrix}
    14  &  21          &            -14 \\
     0  & 175          &           -70 \\
     0  &   0          &          35
\end{pmatrix}.$$</span></p>
<h4 id="relation-to-rq-decomposition">Relation to RQ decomposition</h4>
<p>The RQ decomposition transforms a matrix <em>A</em> into the product of an upper triangular matrix <em>R</em> (also known as right-triangular) and an orthogonal matrix <em>Q</em>. The only difference from QR decomposition is the order of these matrices.</p>
<p>QR decomposition is Gram–Schmidt orthogonalization of columns of <em>A</em>, started from the first column.</p>
<p>RQ decomposition is Gram–Schmidt orthogonalization of rows of <em>A</em>, started from the last row.</p>
<h3 id="using-householder-reflections">Using Householder reflections</h3>
<figure><b>(Figure)</b>
<figcaption>Householder reflection for QR-decomposition: The goal is to find a linear transformation that changes the vector <span class="LaTeX">$x$</span> into a vector of same length which is collinear to <span class="LaTeX">$e_1$</span>. We could use an orthogonal projection (Gram-Schmidt) but this will be numerically unstable if the vectors <span class="LaTeX">$x$</span> and <span class="LaTeX">$e_1$</span> are close to orthogonal. Instead, the Householder reflection reflects through the dotted line (chosen to bisect the angle between <span class="LaTeX">$x$</span> and <span class="LaTeX">$e_1$</span>). The maximum angle with this transform is at most 45 degrees.</figcaption>
</figure>
<p>A <a href="Householder_reflection" title="wikilink">Householder reflection</a> (or <em>Householder transformation</em>) is a transformation that takes a vector and reflects it about some <a href="plane_(mathematics)" title="wikilink">plane</a> or <a class="uri" href="hyperplane" title="wikilink">hyperplane</a>. We can use this operation to calculate the <em>QR</em> factorization of an <em>m</em>-by-<em>n</em> matrix <span class="LaTeX">$A$</span> with <em>m</em> ≥ <em>n</em>.</p>
<p><em>Q</em> can be used to reflect a vector in such a way that all coordinates but one disappear.</p>
<p>Let <span class="LaTeX">$\mathbf{x}$</span> be an arbitrary real <em>m</em>-dimensional column vector of <span class="LaTeX">$A$</span> such that <span class="LaTeX">$\|\mathbf{x}\| = |\alpha|$</span> for a scalar <em>α</em>. If the algorithm is implemented using <a href="floating-point_arithmetic" title="wikilink">floating-point arithmetic</a>, then <em>α</em> should get the opposite sign as the <em>k</em>-th coordinate of <span class="LaTeX">$\mathbf{x}$</span>, where <span class="LaTeX">$x_k$</span> is to be the pivot coordinate after which all entries are 0 in matrix <em>A</em>'s final upper triangular form, to avoid <a href="loss_of_significance" title="wikilink">loss of significance</a>. In the complex case, set</p>
<p><span class="LaTeX">$$\alpha = - \mathrm{e}^{\mathrm{i} \arg x_k} \|\mathbf{x}\|$$</span>  and substitute transposition by conjugate transposition in the construction of <em>Q</em> below.</p>
<p>Then, where <span class="LaTeX">$\mathbf{e}_1$</span> is the vector (1,0,...,0)<sup>T</sup>, ||·|| is the <a href="Euclidean_space#Euclidean_structure" title="wikilink">Euclidean norm</a> and <span class="LaTeX">$I$</span> is an <em>m</em>-by-<em>m</em> identity matrix, set</p>
<p><span class="LaTeX">$$\mathbf{u} = \mathbf{x} - \alpha\mathbf{e}_1,$$</span></p>
<p><span class="LaTeX">$$\mathbf{v} = {\mathbf{u}\over\|\mathbf{u}\|},$$</span></p>
<p><span class="LaTeX">$$Q = I - 2 \mathbf{v}\mathbf{v}^T.$$</span></p>
<p>Or, if <span class="LaTeX">$A$</span> is complex</p>
<p><span class="LaTeX">$$Q = I - (1+w)\mathbf{v}\mathbf{v}^H$$</span>, where <span class="LaTeX">$w = \mathbf{x}^H\mathbf{v}\mathbf{/}\mathbf{v}^H\mathbf{x}$</span></p>
<dl>
<dd>where <span class="LaTeX">$\mathbf{x}^H$</span> is the <a href="conjugate_transpose" title="wikilink">conjugate transpose</a> (transjugate) of <span class="LaTeX">$\mathbf{x}$</span>
</dd>
</dl>
<p><span class="LaTeX">$Q$</span> is an <em>m</em>-by-<em>m</em> Householder matrix and</p>
<p><span class="LaTeX">$$Q\mathbf{x} = (\alpha, 0, \cdots, 0)^T.\,$$</span></p>
<p>This can be used to gradually transform an <em>m</em>-by-<em>n</em> matrix <em>A</em> to upper <a class="uri" href="triangular" title="wikilink">triangular</a> form. First, we multiply <em>A</em> with the Householder matrix <em>Q</em><sub>1</sub> we obtain when we choose the first matrix column for <strong>x</strong>. This results in a matrix <em>Q</em><sub>1</sub><em>A</em> with zeros in the left column (except for the first row).</p>
<p><span class="LaTeX">$$Q_1A = \begin{bmatrix}
                   \alpha_1&\star&\dots&\star\\
                      0    &     &    &    \\
                   \vdots  &     &  A' &    \\
                      0    &     &     & \end{bmatrix}$$</span></p>
<p>This can be repeated for <em>A</em>′ (obtained from <em>Q</em><sub>1</sub><em>A</em> by deleting the first row and first column), resulting in a Householder matrix <em>Q</em>′<sub>2</sub>. Note that <em>Q</em>′<sub>2</sub> is smaller than <em>Q</em><sub>1</sub>. Since we want it really to operate on <em>Q</em><sub>1</sub><em>A</em> instead of <em>A</em>′ we need to expand it to the upper left, filling in a 1, or in general:</p>
<p><span class="LaTeX">$$Q_k = \begin{pmatrix}
                  I_{k-1} & 0\\
                   0  & Q_k'\end{pmatrix}.$$</span></p>
<p>After <span class="LaTeX">$t$</span> iterations of this process, <span class="LaTeX">$t = \min(m-1, n)$</span>,</p>
<p><span class="LaTeX">$$R = Q_t \cdots Q_2Q_1A$$</span> is an upper triangular matrix. So, with</p>
<p><span class="LaTeX">$$Q = Q_1^T Q_2^T \cdots Q_t^T,$$</span> <span class="LaTeX">$A = QR$</span> is a QR decomposition of <span class="LaTeX">$A$</span>.</p>
<p>This method has greater <a href="numerical_stability" title="wikilink">numerical stability</a> than the Gram–Schmidt method above.</p>
<p>The following table gives the number of operations in the <em>k</em>-th step of the QR-decomposition by the Householder transformation, assuming a square matrix with size <em>n</em>.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;"><p>Operation</p></th>
<th style="text-align: left;"><p>Number of operations in the <em>k</em>-th step</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><p>multiplications</p></td>
<td style="text-align: left;"><p><span class="LaTeX">$2(n-k+1)^2$</span></p></td>
</tr>
<tr class="even">
<td style="text-align: left;"><p>additions</p></td>
<td style="text-align: left;"><p><span class="LaTeX">$(n-k+1)^2+(n-k+1)(n-k)+2$</span></p></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><p>division</p></td>
<td style="text-align: left;"><p><span class="LaTeX">$1$</span></p></td>
</tr>
<tr class="even">
<td style="text-align: left;"><p>square root</p></td>
<td style="text-align: left;"><p><span class="LaTeX">$1$</span></p></td>
</tr>
</tbody>
</table>
<p>Summing these numbers over the <em>n</em> − 1 steps (for a square matrix of size <em>n</em>), the complexity of the algorithm (in terms of floating point multiplications) is given by</p>
<p><span class="LaTeX">$$\frac{2}{3}n^3+n^2+\frac{1}{3}n-2=O(n^3).$$</span></p>
<h4 id="example-1">Example</h4>
<p>Let us calculate the decomposition of</p>
<p><span class="LaTeX">$$A = \begin{pmatrix}
12 & -51 & 4 \\
6 & 167 & -68 \\
-4 & 24 & -41 \end{pmatrix}.$$</span></p>
<p>First, we need to find a reflection that transforms the first column of matrix <em>A</em>, vector <span class="LaTeX">$\mathbf{a}_1 = (12, 6, -4)^T$</span>, to <span class="LaTeX">$\|\mathbf{a}_1\| \;\mathrm{e}_1 = (14, 0, 0)^T.$</span></p>
<p>Now,</p>
<p><span class="LaTeX">$$\mathbf{u} = \mathbf{x} + \alpha\mathbf{e}_1,$$</span> and</p>
<p><span class="LaTeX">$$\mathbf{v} = {\mathbf{u}\over\|\mathbf{u}\|}.$$</span> Here,</p>
<p><span class="LaTeX">$$\alpha = -14$$</span> and <span class="LaTeX">$\mathbf{x} = \mathbf{a}_1 = (12, 6, -4)^T$</span></p>
<p>Therefore</p>
<p><span class="LaTeX">$$\mathbf{u} = (-2, 6, -4)^T=({2})(-1, 3, -2)^T$$</span> and <span class="LaTeX">$\mathbf{v} = {1 \over \sqrt{14}}(-1, 3, -2)^T$</span>, and then</p>
<p><span class="LaTeX">$$Q_1 = I - {2 \over \sqrt{14} \sqrt{14}} \begin{pmatrix} -1 \\ 3 \\ -2 \end{pmatrix}\begin{pmatrix} -1 & 3 & -2 \end{pmatrix}$$</span></p>
<p><span class="LaTeX">$$= I - {1 \over 7}\begin{pmatrix}
1 & -3  & 2 \\
-3 & 9 & -6 \\
2  & -6  & 4
\end{pmatrix}$$</span></p>
<p><span class="LaTeX">$$= \begin{pmatrix}
6/7 & 3/7   &  -2/7 \\
3/7  &-2/7  &  6/7 \\
-2/7 & 6/7  &   3/7 \\
\end{pmatrix}.$$</span></p>
<p>Now observe:</p>
<p><span class="LaTeX">$$Q_1A = \begin{pmatrix}
14 & 21 & -14 \\
0 & -49 & -14 \\
0 & 168 & -77 \end{pmatrix},$$</span> so we already have almost a triangular matrix. We only need to zero the (3, 2) entry.</p>
<p>Take the (1, 1) <a href="minor_(linear_algebra)" title="wikilink">minor</a>, and then apply the process again to</p>
<p><span class="LaTeX">$$A' = M_{11} = \begin{pmatrix}
-49 & -14 \\
168 & -77 \end{pmatrix}.$$</span> By the same method as above, we obtain the matrix of the Householder transformation</p>
<p><span class="LaTeX">$$Q_2 = \begin{pmatrix}
1 & 0 & 0 \\
0 & -7/25 & 24/25 \\
0 & 24/25 & 7/25 \end{pmatrix}$$</span> after performing a direct sum with 1 to make sure the next step in the process works properly.</p>
<p>Now, we find</p>
<p><span class="LaTeX">$$Q=Q_1^T Q_2^T=\begin{pmatrix}
6/7 & -69/175 & 58/175 \\
3/7 & 158/175 & -6/175 \\
-2/7 & 6/35 & 33/35 \end{pmatrix}$$</span> Then</p>
<p><span class="LaTeX">$$Q=Q_1^T Q_2^T=\begin{pmatrix}
0.8571 & -0.3943 & 0.3314 \\
0.4286 &  0.9029 & -0.0343 \\
-0.2857 & 0.1714 & 0.9429 \end{pmatrix}$$</span></p>
<p><span class="LaTeX">$$R=Q_2Q_1A=Q^T A=\begin{pmatrix}
14 & 21 & -14 \\
0 & 175 & -70 \\
0 & 0 & -35 \end{pmatrix}.$$</span> The matrix <em>Q</em> is orthogonal and <em>R</em> is upper triangular, so <em>A</em> = <em>QR</em> is the required QR-decomposition.</p>
<h3 id="using-givens-rotations">Using Givens rotations</h3>
<p><em>QR</em> decompositions can also be computed with a series of <a href="Givens_rotation" title="wikilink">Givens rotations</a>. Each rotation zeros an element in the subdiagonal of the matrix, forming the <em>R</em> matrix. The concatenation of all the Givens rotations forms the orthogonal <em>Q</em> matrix.</p>
<p>In practice, Givens rotations are not actually performed by building a whole matrix and doing a matrix multiplication. A Givens rotation procedure is used instead which does the equivalent of the sparse Givens matrix multiplication, without the extra work of handling the sparse elements. The Givens rotation procedure is useful in situations where only a relatively few off diagonal elements need to be zeroed, and is more easily parallelized than <a href="Householder_transformation" title="wikilink">Householder transformations</a>.</p>
<h4 id="example-2">Example</h4>
<p>Let us calculate the decomposition of</p>
<p><span class="LaTeX">$$A = \begin{pmatrix}
12 & -51 & 4 \\
6 & 167 & -68 \\
-4 & 24 & -41 \end{pmatrix}.$$</span></p>
<p>First, we need to form a rotation matrix that will zero the lowermost left element, <span class="LaTeX">$\mathbf{a}_{31} = -4$</span>. We form this matrix using the Givens rotation method, and call the matrix <span class="LaTeX">$G_1$</span>. We will first rotate the vector <span class="LaTeX">$(6,-4)$</span>, to point along the <em>X</em> axis. This vector has an angle <span class="LaTeX">$\theta = \arctan\left({-(-4) \over 6}\right)$</span>. We create the orthogonal Givens rotation matrix, <span class="LaTeX">$G_1$</span>:</p>
<p><span class="LaTeX">$$G_1 = \begin{pmatrix}
1 & 0 & 0 \\
0 & \cos(\theta) & -\sin(\theta) \\
0 & \sin(\theta) & \cos(\theta)
\end{pmatrix}$$</span></p>
<p><span class="LaTeX">$$\approx \begin{pmatrix}
1 & 0 & 0 \\
0 & 0.83205 & -0.55470 \\
0 & 0.55470 & 0.83205
\end{pmatrix}$$</span></p>
<p>And the result of <span class="LaTeX">$G_1A$</span> now has a zero in the <span class="LaTeX">$\mathbf{a}_{31}$</span> element.</p>
<p><span class="LaTeX">$$G_1A \approx \begin{pmatrix}
12 & -51 & 4 \\
7.21110 & 125.6396 & -33.83671 \\
0 & 112.6041 & -71.83368
\end{pmatrix}$$</span></p>
<p>We can similarly form Givens matrices <span class="LaTeX">$G_2$</span> and <span class="LaTeX">$G_3$</span>, which will zero the sub-diagonal elements <span class="LaTeX">$a_{21}$</span> and <span class="LaTeX">$a_{32}$</span>, forming a triangular matrix <span class="LaTeX">$R$</span>. The orthogonal matrix <span class="LaTeX">$Q^T$</span> is formed from the concatenation of all the Givens matrices <span class="LaTeX">$Q^T = G_3G_2G_1$</span>. Thus, we have <span class="LaTeX">$G_3G_2G_1A= Q^TA = R$</span>, and the <em>QR</em> decomposition is <span class="LaTeX">$A = QR$</span>.</p>
<h2 id="connection-to-a-determinant-or-a-product-of-eigenvalues">Connection to a determinant or a product of eigenvalues</h2>
<p>We can use QR decomposition to find the absolute value of the <a class="uri" href="determinant" title="wikilink">determinant</a> of a square matrix. Suppose a matrix is decomposed as <span class="LaTeX">$A=QR$</span>. Then we have</p>
<p><span class="LaTeX">$$\det(A)=\det(Q)\cdot\det(R).$$</span> Since <em>Q</em> is unitary, <span class="LaTeX">$|\det(Q)|=1$</span>. Thus,</p>
<p><span class="LaTeX">$$|\det(A)|=|\det(R)|=\Big|\prod_{i} r_{ii}\Big|,$$</span> where <span class="LaTeX">$r_{ii}$</span> are the entries on the diagonal of <em>R</em>.</p>
<p>Furthermore, because the determinant equals the product of the eigenvalues, we have</p>
<p><span class="LaTeX">$$\Big|\prod_{i} r_{ii}\Big|=\Big|\prod_{i} \lambda_{i}\Big|,$$</span> where <span class="LaTeX">$\lambda_{i}$</span> are eigenvalues of <span class="LaTeX">$A$</span>.</p>
<p>We can extend the above properties to non-square complex matrix <span class="LaTeX">$A$</span> by introducing the definition of QR-decomposition for non-square complex matrix and replacing eigenvalues with singular values.</p>
<p>Suppose a QR decomposition for a non-square matrix <em>A</em>:</p>
<p><span class="LaTeX">$$A = Q \begin{pmatrix}R\\O\end{pmatrix}, \qquad Q^*Q = I,$$</span> where <span class="LaTeX">$O$</span> is a zero matrix and <span class="LaTeX">$Q$</span> is a unitary matrix.</p>
<p>From the properties of <a href="Singular_value_decomposition" title="wikilink">SVD</a> and determinant of matrix, we have</p>
<p><span class="LaTeX">$$\Big|\prod_{i} r_{ii}\Big| = \prod_{i} \sigma_{i},$$</span> where <span class="LaTeX">$\sigma_{i}$</span> are singular values of <span class="LaTeX">$A$</span>.</p>
<p>Note that the singular values of <span class="LaTeX">$A$</span> and <span class="LaTeX">$R$</span> are identical, although their complex eigenvalues may be different. However, if <em>A</em> is square, the following is true:</p>
<p><span class="LaTeX">$${\prod_{i} \sigma_{i}} = \Big|{\prod_{i} \lambda_{i}}\Big|.$$</span></p>
<p>In conclusion, QR decomposition can be used efficiently to calculate the product of the eigenvalues or singular values of a matrix.</p>
<h2 id="column-pivoting">Column pivoting</h2>
<p>QR decomposition with column pivoting introduces a <a href="permutation_matrix" title="wikilink">permutation matrix</a> <em>P</em>:</p>
<p><span class="LaTeX">$$A P = Q R \quad \iff A = Q R P^T$$</span> Column pivoting is useful when <em>A</em> is (nearly) <a href="rank_deficient" title="wikilink">rank deficient</a>, or is suspected of being so. It can also improve numerical accuracy. <em>P</em> is usually chosen so that the diagonal elements of <em>R</em> are non-increasing: <span class="LaTeX">$|r_{11}| \ge |r_{22}| \ge \ldots \ge |r_{nn}|$</span>. This can be used to find the (numerical) rank of <em>A</em> at lower computational cost than a <a href="singular_value_decomposition" title="wikilink">singular value decomposition</a>, forming the basis of so-called <a href="rank-revealing_QR_algorithm" title="wikilink">rank-revealing QR algorithms</a>.</p>
<h2 id="using-for-solution-to-linear-inverse-problems">Using for solution to linear inverse problems</h2>
<p>Compared to the direct matrix inverse, inverse solutions using QR decomposition are more numerically stable as evidenced by their reduced <a href="condition_number" title="wikilink">condition numbers</a> [Parker, Geophysical Inverse Theory, Ch1.13].</p>
<p>To solve the underdetermined (<span class="LaTeX">$m < n$</span>) linear problem <span class="LaTeX">$Ax=b$</span> where the matrix A has dimensions <span class="LaTeX">$m \times n$</span> and rank <span class="LaTeX">$m$</span>, first find the QR factorization of the transpose of A<span class="LaTeX">$$A^T=QR$$</span>, where Q is an orthogonal matrix (i.e. <span class="LaTeX">$Q^T=Q^{-1}$</span>), and R has a special form<span class="LaTeX">$$R=\begin{bmatrix} R_1 \\ 0\end{bmatrix}$$</span>. Here <span class="LaTeX">$R_1$</span> is a square <span class="LaTeX">$m \times m$</span> right triangular matrix, and the zero matrix has dimension <span class="LaTeX">$(n-m) \times m$</span>. After some algebra, it can be shown that a solution to the inverse problem can be expressed as<span class="LaTeX">$$x = Q
\begin{bmatrix}
   (R_1^T)^{-1}b \\
   0
  \end{bmatrix}$$</span> where one may either find <span class="LaTeX">$R_1^{-1}$</span> by Gaussian elimination or compute <span class="LaTeX">$(R_1^T)^{-1} b$</span> directly by <a href="Triangular_matrix#Forward_and_back_substitution" title="wikilink">forward substitution</a>. The latter technique enjoys greater numerical accuracy and lower computations.</p>
<p>To find a solution, <span class="LaTeX">$\hat x$</span>, to the overdetermined (<span class="LaTeX">$m \geq n$</span>) problem <span class="LaTeX">$Ax=b$</span> which minimizes the norm <span class="LaTeX">$\|A \hat x-b\|$</span>, first find the QR factorization of A<span class="LaTeX">$$A=QR$$</span>. The solution can then be expressed as <span class="LaTeX">$\hat x = R_1^{-1} (Q_1^T b)$</span>, where <span class="LaTeX">$Q_1$</span> is an <span class="LaTeX">$m \times n$</span> matrix containing the first <span class="LaTeX">$n$</span> columns of the full orthonormal basis <span class="LaTeX">$Q$</span> and where <span class="LaTeX">$R_1$</span> is as before. Equivalent to the underdetermined case, <a href="Triangular_matrix#Forward_and_back_substitution" title="wikilink">back substitution</a> can be used to quickly and accurately find this <span class="LaTeX">$\hat x$</span> without explicitly inverting <span class="LaTeX">$R_1$</span>. (<span class="LaTeX">$Q_1$</span> and <span class="LaTeX">$R_1$</span> are often provided by numerical libraries as an "economic" QR decomposition.)</p>
<h2 id="see-also">See also</h2>
<ul>
<li><a href="Polar_decomposition" title="wikilink">Polar decomposition</a></li>
<li><a href="Eigenvalue_decomposition" title="wikilink">Eigenvalue decomposition</a></li>
<li><a href="Spectral_decomposition" title="wikilink">Spectral decomposition</a></li>
<li><a href="Matrix_decomposition" title="wikilink">Matrix decomposition</a></li>
<li><a href="Zappa–Szép_product#Examples" title="wikilink">Zappa–Szép product</a></li>
<li><a href="Iwasawa_decomposition" title="wikilink">Iwasawa decomposition</a></li>
</ul>
<h2 id="references">References</h2>
<references>
</references>
<ul>
<li>
<p>.</p></li>
<li>
<p>. Section 2.8.</p></li>
<li></li>
<li>
<p>.</p></li>
</ul>
<h2 id="external-links">External links</h2>
<ul>
<li><a href="http://www.bluebit.gr/matrix-calculator/">Online Matrix Calculator</a> Performs QR decomposition of matrices.</li>
<li><a href="http://netlib.org/lapack/lug/node39.html">LAPACK users manual</a> gives details of subroutines to calculate the QR decomposition</li>
<li><a href="http://documents.wolfram.com/mathematica/functions/QRDecomposition">Mathematica users manual</a> gives details and examples of routines to calculate QR decomposition</li>
<li><a href="http://www.alglib.net/">ALGLIB</a> includes a partial port of the LAPACK to C++, C#, Delphi, etc.</li>
<li><a href="http://eigen.tuxfamily.org/dox-devel/group__QR__Module.html">Eigen::QR</a> Includes C++ implementation of QR decomposition.</li>
<li><a href="https://github.com/topiolli/into">Into</a> contains an open source implementation of QR decomposition in C++.</li>
</ul>
<p>"</p>
<p><a href="Category:Matrix_decompositions" title="wikilink">Category:Matrix decompositions</a> <a href="Category:Numerical_linear_algebra" title="wikilink">Category:Numerical linear algebra</a></p>
<section class="footnotes">
<hr/>
<ol>
<li id="fn1">L. N. Trefethen and D. Bau, <em>Numerical Linear Algebra</em> (SIAM, 1997).<a href="#fnref1">↩</a></li>
<li id="fn2"></li>
<li id="fn3"><a href="#fnref3">↩</a></li>
<li id="fn4"></li>
</ol>
</section>
</body>
</html>
