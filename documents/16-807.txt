   Behrend's trace formula      Behrend's trace formula   In algebraic geometry , Behrend's formula is a generalization of the Grothendieckâ€“Lefschetz trace formula to a smooth  algebraic stack over a finite field, conjectured in 1993 1 and proven in 2003 2 by Kai Behrend . Unlike the classical one, the formula counts points in the " stacky way "; it takes into account the presence of nontrivial automorphisms.  The desire for the formula comes from the fact that it applies to the moduli stack of principal bundles on a curve over a finite field (in some instances indirectly, via the Harderâ€“Narasimhan stratification , as the moduli stack is not of finite type. 3 4 ) See the moduli stack of principal bundles and references therein for the precise formulation in this case.  Deligne found an example 5 that shows the formula may be interpreted as a sort of the Selberg trace formula .  A proof of the formula in the context of the six operations formalism developed by Laszlo and Olsson 6 is given by Shenghao Sun. 7  Formulation  By definition, if C is a category in which each object has finitely many automorphisms, the number of points in   C   C   C   is denoted by        #  C   =    âˆ‘  p    1   #   Aut   (  p  )        ,        normal-#  C     subscript   p     1    normal-#   Aut  p        \#C=\sum_{p}{1\over\#\operatorname{Aut}(p)},   with the sum running over representatives p of all isomorphism classes in C . (The series may diverge in general.) The formula states: for a smooth algebraic stack X of finite type over a finite field    ğ…  q     subscript  ğ…  q    \mathbf{F}_{q}   and the "arithmetic" Frobenius      Ï•   -  1    :   X  â†’  X      normal-:   superscript  Ï•    1     normal-â†’  X  X     \phi^{-1}:X\to X   , i.e., the inverse of the usual geometric Frobenius   Ï•   Ï•   \phi   in Grothendieck's formula, 8 9        #  X   (   ğ…  q   )    =    q   dim  X      âˆ‘   i  =  0   âˆ      (   -  1   )   i    tr   (   Ï•   -  1    ;    H  i    (  X  ,   â„š  l   )    )        .        normal-#  X   subscript  ğ…  q       superscript  q   dim  X      superscript   subscript     i  0         superscript    1   i    tr   superscript  Ï•    1       superscript  H  i    X   subscript  â„š  l           \#X(\mathbf{F}_{q})=q^{\operatorname{dim}X}\sum_{i=0}^{\infty}(-1)^{i}%
 \operatorname{tr}(\phi^{-1};H^{i}(X,\mathbb{Q}_{l})).     Here, it is crucial that the cohomology of a stack is with respect to the smooth topology (not etale).  When X is a variety, the smooth cohomology is the same as etale one and, via the PoincarÃ© duality , this is equivalent to Grothendieck's trace formula. (But the proof relies on Grothendieck's formula, so this does not subsume Grothendieck's.)  Simple example  Consider     B   ğ”¾  m    =   [   Spec    ğ…  q   /   ğ”¾  m     ]         B   subscript  ğ”¾  m     delimited-[]   Spec     subscript  ğ…  q    subscript  ğ”¾  m        B\mathbb{G}_{m}=[\operatorname{Spec}\mathbf{F}_{q}/\mathbb{G}_{m}]   , the classifying stack of the multiplicative group scheme (that is,      ğ”¾  m    (  R  )    =   R  Ã—          subscript  ğ”¾  m   R    superscript  R      \mathbb{G}_{m}(R)=R^{\times}   ). By definition,    B   ğ”¾  m    (   ğ…  q   )       B   subscript  ğ”¾  m    subscript  ğ…  q     B\mathbb{G}_{m}(\mathbf{F}_{q})   is the category of principal     ğ”¾  m     subscript  ğ”¾  m    \mathbb{G}_{m}   -bundles over    Spec   ğ…  q      Spec   subscript  ğ…  q     \operatorname{Spec}\mathbf{F}_{q}   , which has only one isomorphism class (since all such bundles are trivial by Lang's theorem ). Its group of automorphisms is    ğ”¾  m     subscript  ğ”¾  m    \mathbb{G}_{m}   , which means that the number of    ğ…  q     subscript  ğ…  q    \mathbf{F}_{q}   -isomorphisms is     #   ğ”¾  m    (   ğ…  q   )    =   ğ…  q  Ã—   =   q  -  1           normal-#   subscript  ğ”¾  m    subscript  ğ…  q     superscript   subscript  ğ…  q            q  1      \#\mathbb{G}_{m}(\mathbf{F}_{q})=\mathbf{F}_{q}^{\times}=q-1   .  On the other hand, we may compute the l -adic cohomology of    B   ğ”¾  m       B   subscript  ğ”¾  m     B\mathbb{G}_{m}   directly. We remark that in the topological setting, we have     B   â„‚  Ã—    â‰…   â„‚   â„™  âˆ          B   superscript  â„‚       â„‚   superscript  â„™       B\mathbb{C}^{\times}\cong\mathbb{CP}^{\infty}   (where    B   â„‚  Ã—       B   superscript  â„‚      B\mathbb{C}^{\times}   now denotes the usual classifying space of a topological group), whose rational cohomology ring is a polynomial ring in one generator ( Borel's theorem ), but we shall not use this directly. If we wish to stay in the world of algebraic geometry, we may instead "approximate"    B   ğ”¾  m       B   subscript  ğ”¾  m     B\mathbb{G}_{m}   by projective spaces of larger and larger dimension. Thus we consider the map     B   ğ”¾  m    â†’   â„™  N      normal-â†’    B   subscript  ğ”¾  m     superscript  â„™  N     B\mathbb{G}_{m}\to\mathbb{P}^{N}   induced by the    ğ”¾  m     subscript  ğ”¾  m    \mathbb{G}_{m}   -bundle corresponding to    ğ’ª   (  1  )       ğ’ª  1    \mathcal{O}(1)   . This map induces an isomorphism in cohomology in degrees up to 2N . Thus the even (resp. odd) Betti numbers of    B   ğ”¾  m       B   subscript  ğ”¾  m     B\mathbb{G}_{m}   are 1 (resp. 0), and the l -adic Galois representation on the (2n) th cohomology group is the n th power of the cyclotomic character. The second part is a consequence of the fact that the cohomology of    â„™  N     superscript  â„™  N    \mathbb{P}^{N}   is generated by algebraic cycle classes. This shows that         âˆ‘   i  â‰¥  0       (   -  1   )   i    tr   (   Ï•   -  1    ;    H  i    (   B   ğ”¾  m    ,   â„š  l   )    )      =   1  +   1  /  q   +   1  /   q  2    +  â‹¯   =   q   q  -  1     .          subscript     i  0       superscript    1   i    tr   superscript  Ï•    1       superscript  H  i      B   subscript  ğ”¾  m     subscript  â„š  l          1    1  q     1   superscript  q  2    normal-â‹¯          q    q  1       \sum_{i\geq 0}(-1)^{i}\operatorname{tr}(\phi^{-1};H^{i}(B\mathbb{G}_{m},%
 \mathbb{Q}_{l}))=1+1/q+1/q^{2}+\cdots={q\over{q-1}}.   Note that     dim   B   ğ”¾  m     =    dim   Spec   ğ…  q     -   dim   ğ”¾  m     =   -  1          dimension    B   subscript  ğ”¾  m        dimension   Spec   subscript  ğ…  q      dimension   subscript  ğ”¾  m            1      \dim B\mathbb{G}_{m}=\dim\operatorname{Spec}\mathbf{F}_{q}-\dim\mathbb{G}_{m}=-1   . Multiplying by    q   -  1      superscript  q    1     q^{-1}   , one obtains the predicted equality.  Notes  References     "  Category:Theorems in algebraic geometry     Behrend, K. The Lefschetz Trace Formula for the Moduli Stack of Principal Bundles. PhD dissertation. â†©  Behrend, K. Derived l-adic categories for algebraic stacks. Memoirs of the American Mathematical Society Vol. 163, 2003 â†©  K. Behrend, A. Dhillon, Connected components of moduli stacks of torsors via Tamagawa numbers â†©  http://www.math.harvard.edu/~lurie/282ynotes/LectureIII-Cohomology.pdf â†©  â†©  * â†©  â†©  To define Frobenius   Ï•   Ï•   \phi   on a stack X , let    Ï•  :      ğ…  q   Â¯   â†’    ğ…  q   Â¯    ,   x  â†¦   x  q        normal-:  Ï•   formulae-sequence   normal-â†’   normal-Â¯   subscript  ğ…  q     normal-Â¯   subscript  ğ…  q      maps-to  x   superscript  x  q       \phi:\overline{\mathbf{F}_{q}}\to\overline{\mathbf{F}_{q}},x\mapsto x^{q}   . Then we have      i  d   Ã—  Ï•   :    X   Ã—   ğ…  q      ğ…  q   Â¯    â†’   X   Ã—   ğ…  q      ğ…  q   Â¯        normal-:      i  d   Ï•    normal-â†’    subscript    subscript  ğ…  q    X   normal-Â¯   subscript  ğ…  q       subscript    subscript  ğ…  q    X   normal-Â¯   subscript  ğ…  q        id\times\phi:X\times_{\mathbf{F}_{q}}\overline{\mathbf{F}_{q}}\to X\times_{%
 \mathbf{F}_{q}}\overline{\mathbf{F}_{q}}   , which is the Frobenius on X , also denoted by   Ï•   Ï•   \phi   . â†©  â†©     