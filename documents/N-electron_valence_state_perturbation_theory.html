<html lang="en">
<head>
<meta charset="utf-8"/>
<title offset="1004">N-electron valence state perturbation theory</title>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG.js" type="text/javascript">
</script>
</head>
<body>
<h1>N-electron valence state perturbation theory</h1>
<hr/>

<p>In <a href="quantum_chemistry" title="wikilink">quantum chemistry</a>, <strong><em>n</em>-electron valence state perturbation theory (NEVPT)</strong> is a <a href="perturbation_theory_(quantum_mechanics)" title="wikilink">perturbative treatment</a> applicable to <a href="Multireference_configuration_interaction" title="wikilink">multireference</a> <a href="Complete_active_space" title="wikilink">CASCI-type</a> <a href="wavefunction" title="wikilink">wavefunctions</a>. It can be considered as a generalization of the well-known second-order <a href="M√∏ller‚ÄìPlesset_perturbation_theory" title="wikilink">M√∏ller‚ÄìPlesset perturbation theory</a> to multireference Complete Active Space cases. The theory is directly integrated into the quantum chemistry packages <a class="uri" href="DALTON" title="wikilink">DALTON</a> and <a href="ORCA_(Quantum_Chemistry_Program)" title="wikilink">ORCA</a>.</p>

<p>The research performed into the development of this theory led to various implementations. The theory here presented refers to the deployment for the Single-State NEVPT, where the perturbative correction is applied to a single electronic state. Research implementations has been also developed for Quasi-Degenerate cases, where a set of electronic states undergo the perturbative correction at the same time, allowing interaction among themselves. The theory development makes use of the quasi-degenerate formalism by Lindgren and the Hamiltonian multipartitioning technique from Zaitsevskii and Malrieu.</p>
<h2 id="theory">Theory</h2>

<p>Let 

<math display="inline" id="N-electron_valence_state_perturbation_theory:0">
 <semantics>
  <msubsup>
   <mi mathvariant="normal">Œ®</mi>
   <mi>m</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mn>0</mn>
    <mo stretchy="false">)</mo>
   </mrow>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>normal-Œ®</ci>
     <ci>m</ci>
    </apply>
    <cn type="integer">0</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Psi_{m}^{(0)}
  </annotation>
 </semantics>
</math>

 be a zero-order CASCI wavefunction, defined as a linear combination of <a href="Slater_determinant" title="wikilink">Slater determinants</a></p>

<p>

<math display="block" id="N-electron_valence_state_perturbation_theory:1">
 <semantics>
  <mrow>
   <msubsup>
    <mi mathvariant="normal">Œ®</mi>
    <mi>m</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mn>0</mn>
     <mo stretchy="false">)</mo>
    </mrow>
   </msubsup>
   <mo>=</mo>
   <mrow>
    <munder>
     <mo largeop="true" movablelimits="false" symmetric="true">‚àë</mo>
     <mrow>
      <mi>I</mi>
      <mo>‚àà</mo>
      <mi>CAS</mi>
     </mrow>
    </munder>
    <mrow>
     <msub>
      <mi>C</mi>
      <mrow>
       <mi>I</mi>
       <mo>,</mo>
       <mi>m</mi>
      </mrow>
     </msub>
     <mrow>
      <mo fence="true">|</mo>
      <mi>I</mi>
      <mo>‚ü©</mo>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>normal-Œ®</ci>
      <ci>m</ci>
     </apply>
     <cn type="integer">0</cn>
    </apply>
    <apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <sum></sum>
      <apply>
       <in></in>
       <ci>I</ci>
       <ci>CAS</ci>
      </apply>
     </apply>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>C</ci>
       <list>
        <ci>I</ci>
        <ci>m</ci>
       </list>
      </apply>
      <apply>
       <csymbol cd="latexml">ket</csymbol>
       <ci>I</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Psi_{m}^{(0)}=\sum_{I\in{\rm CAS}}C_{I,m}\left|I\right\rangle
  </annotation>
 </semantics>
</math>

</p>

<p>obtained diagonalizing the true Hamiltonian 

<math display="inline" id="N-electron_valence_state_perturbation_theory:2">
 <semantics>
  <mover accent="true">
   <mi class="ltx_font_mathcaligraphic">‚Ñã</mi>
   <mo stretchy="false">^</mo>
  </mover>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-^</ci>
    <ci>‚Ñã</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \hat{\mathcal{H}}
  </annotation>
 </semantics>
</math>

 inside the CASCI space</p>

<p>

<math display="block" id="N-electron_valence_state_perturbation_theory:3">
 <semantics>
  <mrow>
   <mrow>
    <msub>
     <mover accent="true">
      <mi class="ltx_font_mathcaligraphic">ùí´</mi>
      <mo stretchy="false">^</mo>
     </mover>
     <mi>CAS</mi>
    </msub>
    <mover accent="true">
     <mi class="ltx_font_mathcaligraphic">‚Ñã</mi>
     <mo stretchy="false">^</mo>
    </mover>
    <msub>
     <mover accent="true">
      <mi class="ltx_font_mathcaligraphic">ùí´</mi>
      <mo stretchy="false">^</mo>
     </mover>
     <mi>CAS</mi>
    </msub>
    <mrow>
     <mo fence="true">|</mo>
     <msubsup>
      <mi mathvariant="normal">Œ®</mi>
      <mi>m</mi>
      <mrow>
       <mo stretchy="false">(</mo>
       <mn>0</mn>
       <mo stretchy="false">)</mo>
      </mrow>
     </msubsup>
     <mo>‚ü©</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <msubsup>
     <mi>E</mi>
     <mi>m</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mn>0</mn>
      <mo stretchy="false">)</mo>
     </mrow>
    </msubsup>
    <mrow>
     <mo fence="true">|</mo>
     <msubsup>
      <mi mathvariant="normal">Œ®</mi>
      <mi>m</mi>
      <mrow>
       <mo stretchy="false">(</mo>
       <mn>0</mn>
       <mo stretchy="false">)</mo>
      </mrow>
     </msubsup>
     <mo>‚ü©</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <apply>
       <ci>normal-^</ci>
       <ci>ùí´</ci>
      </apply>
      <ci>CAS</ci>
     </apply>
     <apply>
      <ci>normal-^</ci>
      <ci>‚Ñã</ci>
     </apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <apply>
       <ci>normal-^</ci>
       <ci>ùí´</ci>
      </apply>
      <ci>CAS</ci>
     </apply>
     <apply>
      <csymbol cd="latexml">ket</csymbol>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>normal-Œ®</ci>
        <ci>m</ci>
       </apply>
       <cn type="integer">0</cn>
      </apply>
     </apply>
    </apply>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>E</ci>
       <ci>m</ci>
      </apply>
      <cn type="integer">0</cn>
     </apply>
     <apply>
      <csymbol cd="latexml">ket</csymbol>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>normal-Œ®</ci>
        <ci>m</ci>
       </apply>
       <cn type="integer">0</cn>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \hat{\mathcal{P}}_{\rm CAS}\hat{\mathcal{H}}\hat{\mathcal{P}}_{\rm CAS}\left|%
\Psi_{m}^{(0)}\right\rangle=E_{m}^{(0)}\left|\Psi_{m}^{(0)}\right\rangle
  </annotation>
 </semantics>
</math>

</p>

<p>where 

<math display="inline" id="N-electron_valence_state_perturbation_theory:4">
 <semantics>
  <msub>
   <mover accent="true">
    <mi class="ltx_font_mathcaligraphic">ùí´</mi>
    <mo stretchy="false">^</mo>
   </mover>
   <mi>CAS</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <apply>
     <ci>normal-^</ci>
     <ci>ùí´</ci>
    </apply>
    <ci>CAS</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \hat{\mathcal{P}}_{\rm CAS}
  </annotation>
 </semantics>
</math>

 is the projector inside the CASCI space. It is possible to define perturber wavefunctions in NEVPT as zero-order wavefunctions of the outer space (external to CAS) where 

<math display="inline" id="N-electron_valence_state_perturbation_theory:5">
 <semantics>
  <mi>k</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>k</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   k
  </annotation>
 </semantics>
</math>

 electrons are removed from the inactive part (core and virtual orbitals) and added to the valence part (active orbitals). At second order of perturbation 

<math display="inline" id="N-electron_valence_state_perturbation_theory:6">
 <semantics>
  <mrow>
   <mrow>
    <mo>-</mo>
    <mn>2</mn>
   </mrow>
   <mo>‚â§</mo>
   <mi>k</mi>
   <mo>‚â§</mo>
   <mn>2</mn>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <and></and>
    <apply>
     <leq></leq>
     <apply>
      <minus></minus>
      <cn type="integer">2</cn>
     </apply>
     <ci>k</ci>
    </apply>
    <apply>
     <leq></leq>
     <share href="#.cmml">
     </share>
     <cn type="integer">2</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   -2\leq k\leq 2
  </annotation>
 </semantics>
</math>

. Decomposing the zero-order CASCI wavefunction as an antisymmetrized product of the inactive part 

<math display="inline" id="N-electron_valence_state_perturbation_theory:7">
 <semantics>
  <msub>
   <mi mathvariant="normal">Œ¶</mi>
   <mi>c</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>normal-Œ¶</ci>
    <ci>c</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Phi_{c}
  </annotation>
 </semantics>
</math>

 and a valence part 

<math display="inline" id="N-electron_valence_state_perturbation_theory:8">
 <semantics>
  <msubsup>
   <mi mathvariant="normal">Œ®</mi>
   <mi>m</mi>
   <mi>v</mi>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>normal-Œ®</ci>
     <ci>m</ci>
    </apply>
    <ci>v</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Psi_{m}^{v}
  </annotation>
 </semantics>
</math>


</p>

<p>

<math display="block" id="N-electron_valence_state_perturbation_theory:9">
 <semantics>
  <mrow>
   <mrow>
    <mo fence="true">|</mo>
    <msubsup>
     <mi mathvariant="normal">Œ®</mi>
     <mi>m</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mn>0</mn>
      <mo stretchy="false">)</mo>
     </mrow>
    </msubsup>
    <mo>‚ü©</mo>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mo fence="true">|</mo>
    <mrow>
     <msub>
      <mi mathvariant="normal">Œ¶</mi>
      <mi>c</mi>
     </msub>
     <msubsup>
      <mi mathvariant="normal">Œ®</mi>
      <mi>m</mi>
      <mi>v</mi>
     </msubsup>
    </mrow>
    <mo>‚ü©</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="latexml">ket</csymbol>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>normal-Œ®</ci>
       <ci>m</ci>
      </apply>
      <cn type="integer">0</cn>
     </apply>
    </apply>
    <apply>
     <csymbol cd="latexml">ket</csymbol>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>normal-Œ¶</ci>
       <ci>c</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>normal-Œ®</ci>
        <ci>m</ci>
       </apply>
       <ci>v</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \left|\Psi_{m}^{(0)}\right\rangle=\left|\Phi_{c}\Psi_{m}^{v}\right\rangle
  </annotation>
 </semantics>
</math>

</p>

<p>then the perturber wavefunctions can be written as</p>

<p>

<math display="block" id="N-electron_valence_state_perturbation_theory:10">
 <semantics>
  <mrow>
   <mrow>
    <mo fence="true">|</mo>
    <msubsup>
     <mi mathvariant="normal">Œ®</mi>
     <mrow>
      <mi>l</mi>
      <mo>,</mo>
      <mi>Œº</mi>
     </mrow>
     <mi>k</mi>
    </msubsup>
    <mo>‚ü©</mo>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mo fence="true">|</mo>
    <mrow>
     <msubsup>
      <mi mathvariant="normal">Œ¶</mi>
      <mi>l</mi>
      <mrow>
       <mo>-</mo>
       <mi>k</mi>
      </mrow>
     </msubsup>
     <msubsup>
      <mi mathvariant="normal">Œ®</mi>
      <mi>Œº</mi>
      <mrow>
       <mi>v</mi>
       <mo>+</mo>
       <mi>k</mi>
      </mrow>
     </msubsup>
    </mrow>
    <mo>‚ü©</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="latexml">ket</csymbol>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>normal-Œ®</ci>
       <list>
        <ci>l</ci>
        <ci>Œº</ci>
       </list>
      </apply>
      <ci>k</ci>
     </apply>
    </apply>
    <apply>
     <csymbol cd="latexml">ket</csymbol>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>normal-Œ¶</ci>
        <ci>l</ci>
       </apply>
       <apply>
        <minus></minus>
        <ci>k</ci>
       </apply>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>normal-Œ®</ci>
        <ci>Œº</ci>
       </apply>
       <apply>
        <plus></plus>
        <ci>v</ci>
        <ci>k</ci>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \left|\Psi_{l,\mu}^{k}\right\rangle=\left|\Phi_{l}^{-k}\Psi_{\mu}^{v+k}\right\rangle
  </annotation>
 </semantics>
</math>

</p>

<p>The pattern of inactive orbitals involved in the procedure can be grouped as a collective index 

<math display="inline" id="N-electron_valence_state_perturbation_theory:11">
 <semantics>
  <mi>l</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>l</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   l
  </annotation>
 </semantics>
</math>

, so to represent the various perturber wavefunctions as 

<math display="inline" id="N-electron_valence_state_perturbation_theory:12">
 <semantics>
  <msubsup>
   <mi mathvariant="normal">Œ®</mi>
   <mrow>
    <mi>l</mi>
    <mo>,</mo>
    <mi>Œº</mi>
   </mrow>
   <mi>k</mi>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>normal-Œ®</ci>
     <list>
      <ci>l</ci>
      <ci>Œº</ci>
     </list>
    </apply>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Psi_{l,\mu}^{k}
  </annotation>
 </semantics>
</math>

, with 

<math display="inline" id="N-electron_valence_state_perturbation_theory:13">
 <semantics>
  <mi>Œº</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>Œº</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mu
  </annotation>
 </semantics>
</math>


 an enumerator index for the different wavefunctions. The number of these functions is relative to the degree of contraction of the resulting perturbative space.</p>

<p>Supposing indexes 

<math display="inline" id="N-electron_valence_state_perturbation_theory:14">
 <semantics>
  <mi>i</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>i</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   i
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="N-electron_valence_state_perturbation_theory:15">
 <semantics>
  <mi>j</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>j</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   j
  </annotation>
 </semantics>
</math>

 referring to core orbitals, 

<math display="inline" id="N-electron_valence_state_perturbation_theory:16">
 <semantics>
  <mi>a</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>a</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   a
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="N-electron_valence_state_perturbation_theory:17">
 <semantics>
  <mi>b</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>b</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   b
  </annotation>
 </semantics>
</math>

 referring to active orbitals and 

<math display="inline" id="N-electron_valence_state_perturbation_theory:18">
 <semantics>
  <mi>r</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>r</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   r
  </annotation>
 </semantics>
</math>


 and 

<math display="inline" id="N-electron_valence_state_perturbation_theory:19">
 <semantics>
  <mi>s</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>s</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   s
  </annotation>
 </semantics>
</math>

 referring to virtual orbitals, the possible excitation schemes are:</p>
<ol>
<li>two electrons from core orbitals to virtual orbitals (the active space is not enriched nor depleted of electrons, therefore 

<math display="inline" id="N-electron_valence_state_perturbation_theory:20">
 <semantics>
  <mrow>
   <mi>k</mi>
   <mo>=</mo>
   <mn>0</mn>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>k</ci>
    <cn type="integer">0</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   k=0
  </annotation>
 </semantics>
</math>

)</li>
<li>one electron from a core orbital to a virtual orbital, and one electron from a core orbital to an active orbital (the active space is enriched with one electron, therefore 

<math display="inline" id="N-electron_valence_state_perturbation_theory:21">
 <semantics>
  <mrow>
   <mi>k</mi>
   <mo>=</mo>
   <mrow>
    <mo>+</mo>
    <mn>1</mn>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>k</ci>
    <apply>
     <plus></plus>
     <cn type="integer">1</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   k=+1
  </annotation>
 </semantics>
</math>

)</li>
<li>one electron from a core orbital to a virtual orbital, and one electron from an active orbital to a virtual orbital (the active space is depleted with one electron, therefore 

<math display="inline" id="N-electron_valence_state_perturbation_theory:22">
 <semantics>
  <mrow>
   <mi>k</mi>
   <mo>=</mo>
   <mrow>
    <mo>-</mo>
    <mn>1</mn>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>k</ci>
    <apply>
     <minus></minus>
     <cn type="integer">1</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   k=-1
  </annotation>
 </semantics>
</math>

)</li>
<li>two electrons from core orbitals to active orbitals (active space enriched with two electrons, 

<math display="inline" id="N-electron_valence_state_perturbation_theory:23">
 <semantics>
  <mrow>
   <mi>k</mi>
   <mo>=</mo>
   <mrow>
    <mo>+</mo>
    <mn>2</mn>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>k</ci>
    <apply>
     <plus></plus>
     <cn type="integer">2</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   k=+2
  </annotation>
 </semantics>
</math>


)</li>
<li>two electrons from active orbitals to virtual orbitals (active space depleted with two electrons, 

<math display="inline" id="N-electron_valence_state_perturbation_theory:24">
 <semantics>
  <mrow>
   <mi>k</mi>
   <mo>=</mo>
   <mrow>
    <mo>-</mo>
    <mn>2</mn>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>k</ci>
    <apply>
     <minus></minus>
     <cn type="integer">2</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   k=-2
  </annotation>
 </semantics>
</math>

)</li>
</ol>

<p>These cases always represent situations where interclass electronic excitations happen. Other three excitation schemes involve a single interclass excitation plus an intraclass excitation internal to the active space:</p>
<ol>
<li>one electron from a core orbital to a virtual orbital, and an internal active-active excitation (

<math display="inline" id="N-electron_valence_state_perturbation_theory:25">
 <semantics>
  <mrow>
   <mi>k</mi>
   <mo>=</mo>
   <mn>0</mn>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>k</ci>
    <cn type="integer">0</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   k=0
  </annotation>
 </semantics>
</math>

)</li>
<li>one electron from a core orbital to an active orbital, and an internal active-active excitation (

<math display="inline" id="N-electron_valence_state_perturbation_theory:26">
 <semantics>
  <mrow>
   <mi>k</mi>
   <mo>=</mo>
   <mrow>
    <mo>+</mo>
    <mn>1</mn>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>k</ci>
    <apply>
     <plus></plus>
     <cn type="integer">1</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   k=+1
  </annotation>
 </semantics>
</math>

)</li>
<li>one electron from an active orbital to a virtual orbital, and an internal active-active excitation (

<math display="inline" id="N-electron_valence_state_perturbation_theory:27">
 <semantics>
  <mrow>
   <mi>k</mi>
   <mo>=</mo>
   <mrow>
    <mo>-</mo>
    <mn>1</mn>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>k</ci>
    <apply>
     <minus></minus>
     <cn type="integer">1</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   k=-1
  </annotation>
 </semantics>
</math>

)</li>
</ol>
<h3 id="totally-uncontracted-approach">Totally Uncontracted Approach</h3>

<p>A possible approach is to define the perturber wavefunctions into Hilbert spaces 

<math display="inline" id="N-electron_valence_state_perturbation_theory:28">
 <semantics>
  <msubsup>
   <mi>S</mi>
   <mi>l</mi>
   <mi>k</mi>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>S</ci>
     <ci>l</ci>
    </apply>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S_{l}^{k}
  </annotation>
 </semantics>
</math>


 defined by those determinants with given k and l labels. It is interesting to note that the determinants characterizing these spaces can be written as a partition comprising the same inactive (core + virtual) part 

<math display="inline" id="N-electron_valence_state_perturbation_theory:29">
 <semantics>
  <msubsup>
   <mi mathvariant="normal">Œ¶</mi>
   <mi>l</mi>
   <mrow>
    <mo>-</mo>
    <mi>k</mi>
   </mrow>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>normal-Œ¶</ci>
     <ci>l</ci>
    </apply>
    <apply>
     <minus></minus>
     <ci>k</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Phi_{l}^{-k}
  </annotation>
 </semantics>
</math>

 and all possible valence (active) parts 

<math display="inline" id="N-electron_valence_state_perturbation_theory:30">
 <semantics>
  <msubsup>
   <mi mathvariant="normal">Œ®</mi>
   <mi>I</mi>
   <mi>k</mi>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>normal-Œ®</ci>
     <ci>I</ci>
    </apply>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Psi_{I}^{k}
  </annotation>
 </semantics>
</math>

</p>

<p>

<math display="block" id="N-electron_valence_state_perturbation_theory:31">
 <semantics>
  <mrow>
   <mpadded width="+5pt">
    <msubsup>
     <mi>S</mi>
     <mi>l</mi>
     <mi>k</mi>
    </msubsup>
   </mpadded>
   <mpadded width="+5pt">
    <mover>
     <mo movablelimits="false">=</mo>
     <mi>def</mi>
    </mover>
   </mpadded>
   <mrow>
    <mo stretchy="false">{</mo>
    <mrow>
     <msubsup>
      <mi mathvariant="normal">Œ¶</mi>
      <mi>l</mi>
      <mrow>
       <mo>-</mo>
       <mi>k</mi>
      </mrow>
     </msubsup>
     <msubsup>
      <mi mathvariant="normal">Œ®</mi>
      <mi>I</mi>
      <mi>k</mi>
     </msubsup>
    </mrow>
    <mo stretchy="false">}</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <eq></eq>
     <ci>def</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>S</ci>
      <ci>l</ci>
     </apply>
     <ci>k</ci>
    </apply>
    <set>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>normal-Œ¶</ci>
        <ci>l</ci>
       </apply>
       <apply>
        <minus></minus>
        <ci>k</ci>
       </apply>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>normal-Œ®</ci>
        <ci>I</ci>
       </apply>
       <ci>k</ci>
      </apply>
     </apply>
    </set>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S_{l}^{k}\ \stackrel{\mathrm{def}}{=}\ \{\Phi_{l}^{-k}\Psi_{I}^{k}\}
  </annotation>
 </semantics>
</math>

</p>

<p>The full dimensionality of these spaces can be exploited to obtain the definition of the perturbers, by diagonalizing the Hamiltonian inside them</p>

<p>

<math display="block" id="N-electron_valence_state_perturbation_theory:32">
 <semantics>
  <mrow>
   <mrow>
    <msub>
     <mover accent="true">
      <mi class="ltx_font_mathcaligraphic">ùí´</mi>
      <mo stretchy="false">^</mo>
     </mover>
     <msubsup>
      <mi>S</mi>
      <mi>l</mi>
      <mi>k</mi>
     </msubsup>
    </msub>
    <mover accent="true">
     <mi class="ltx_font_mathcaligraphic">‚Ñã</mi>
     <mo stretchy="false">^</mo>
    </mover>
    <msub>
     <mover accent="true">
      <mi class="ltx_font_mathcaligraphic">ùí´</mi>
      <mo stretchy="false">^</mo>
     </mover>
     <msubsup>
      <mi>S</mi>
      <mi>l</mi>
      <mi>k</mi>
     </msubsup>
    </msub>
    <mrow>
     <mo fence="true">|</mo>
     <mrow>
      <msubsup>
       <mi mathvariant="normal">Œ¶</mi>
       <mi>l</mi>
       <mrow>
        <mo>-</mo>
        <mi>k</mi>
       </mrow>
      </msubsup>
      <msubsup>
       <mi mathvariant="normal">Œ®</mi>
       <mi>Œº</mi>
       <mrow>
        <mi>v</mi>
        <mo>+</mo>
        <mi>k</mi>
       </mrow>
      </msubsup>
     </mrow>
     <mo>‚ü©</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <msub>
     <mi>E</mi>
     <mrow>
      <mi>l</mi>
      <mo>,</mo>
      <mi>Œº</mi>
     </mrow>
    </msub>
    <mrow>
     <mo fence="true">|</mo>
     <mrow>
      <msubsup>
       <mi mathvariant="normal">Œ¶</mi>
       <mi>l</mi>
       <mrow>
        <mo>-</mo>
        <mi>k</mi>
       </mrow>
      </msubsup>
      <msubsup>
       <mi mathvariant="normal">Œ®</mi>
       <mi>Œº</mi>
       <mrow>
        <mi>v</mi>
        <mo>+</mo>
        <mi>k</mi>
       </mrow>
      </msubsup>
     </mrow>
     <mo>‚ü©</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <apply>
       <ci>normal-^</ci>
       <ci>ùí´</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>S</ci>
        <ci>l</ci>
       </apply>
       <ci>k</ci>
      </apply>
     </apply>
     <apply>
      <ci>normal-^</ci>
      <ci>‚Ñã</ci>
     </apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <apply>
       <ci>normal-^</ci>
       <ci>ùí´</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>S</ci>
        <ci>l</ci>
       </apply>
       <ci>k</ci>
      </apply>
     </apply>
     <apply>
      <csymbol cd="latexml">ket</csymbol>
      <apply>
       <times></times>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>normal-Œ¶</ci>
         <ci>l</ci>
        </apply>
        <apply>
         <minus></minus>
         <ci>k</ci>
        </apply>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>normal-Œ®</ci>
         <ci>Œº</ci>
        </apply>
        <apply>
         <plus></plus>
         <ci>v</ci>
         <ci>k</ci>
        </apply>
       </apply>
      </apply>
     </apply>
    </apply>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>E</ci>
      <list>
       <ci>l</ci>
       <ci>Œº</ci>
      </list>
     </apply>
     <apply>
      <csymbol cd="latexml">ket</csymbol>
      <apply>
       <times></times>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>normal-Œ¶</ci>
         <ci>l</ci>
        </apply>
        <apply>
         <minus></minus>
         <ci>k</ci>
        </apply>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>normal-Œ®</ci>
         <ci>Œº</ci>
        </apply>
        <apply>
         <plus></plus>
         <ci>v</ci>
         <ci>k</ci>
        </apply>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \hat{\mathcal{P}}_{S_{l}^{k}}\hat{\mathcal{H}}\hat{\mathcal{P}}_{S_{l}^{k}}%
\left|\Phi_{l}^{-k}\Psi_{\mu}^{v+k}\right\rangle=E_{l,\mu}\left|\Phi_{l}^{-k}%
\Psi_{\mu}^{v+k}\right\rangle
  </annotation>
 </semantics>
</math>

</p>

<p>This procedure is impractical given its high computational cost: for each 

<math display="inline" id="N-electron_valence_state_perturbation_theory:33">
 <semantics>
  <msubsup>
   <mi>S</mi>
   <mi>l</mi>
   <mi>k</mi>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>S</ci>
     <ci>l</ci>
    </apply>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S_{l}^{k}
  </annotation>
 </semantics>
</math>

 space, a diagonalization of the true Hamiltonian must be performed. Computationally, is preferable to improve the theoretical development making use of the modified <a href="Dyall's_Hamiltonian" title="wikilink">Dyall's Hamiltonian</a> 

<math display="inline" id="N-electron_valence_state_perturbation_theory:34">
 <semantics>
  <msup>
   <mover accent="true">
    <mi class="ltx_font_mathcaligraphic">‚Ñã</mi>
    <mo stretchy="false">^</mo>
   </mover>
   <mi>D</mi>
  </msup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <ci>normal-^</ci>
     <ci>‚Ñã</ci>
    </apply>
    <ci>D</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \hat{\mathcal{H}}^{D}
  </annotation>
 </semantics>
</math>

. This Hamiltonian behaves like the true Hamiltonian inside the CAS space, having the same eigenvalues and eigenvectors of the true Hamiltonian projected onto the CAS space. Also, given the decomposition for the wavefunction defined before, the action of the Dyall's Hamiltonian can be partitioned into</p>

<p>

<math display="block" id="N-electron_valence_state_perturbation_theory:35">
 <semantics>
  <mrow>
   <mrow>
    <msup>
     <mover accent="true">
      <mi class="ltx_font_mathcaligraphic">‚Ñã</mi>
      <mo stretchy="false">^</mo>
     </mover>
     <mi>D</mi>
    </msup>
    <mrow>
     <mo fence="true">|</mo>
     <mrow>
      <msubsup>
       <mi mathvariant="normal">Œ¶</mi>
       <mi>l</mi>
       <mrow>
        <mo>-</mo>
        <mi>k</mi>
       </mrow>
      </msubsup>
      <msubsup>
       <mi mathvariant="normal">Œ®</mi>
       <mi>Œº</mi>
       <mrow>
        <mi>v</mi>
        <mo>+</mo>
        <mi>k</mi>
       </mrow>
      </msubsup>
     </mrow>
     <mo>‚ü©</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <msubsup>
     <mi>E</mi>
     <mrow>
      <mi>l</mi>
      <mo>,</mo>
      <mi>Œº</mi>
     </mrow>
     <mi>k</mi>
    </msubsup>
    <mrow>
     <mo fence="true">|</mo>
     <mrow>
      <msubsup>
       <mi mathvariant="normal">Œ¶</mi>
       <mi>l</mi>
       <mrow>
        <mo>-</mo>
        <mi>k</mi>
       </mrow>
      </msubsup>
      <msubsup>
       <mi mathvariant="normal">Œ®</mi>
       <mi>Œº</mi>
       <mrow>
        <mi>v</mi>
        <mo>+</mo>
        <mi>k</mi>
       </mrow>
      </msubsup>
     </mrow>
     <mo>‚ü©</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <ci>normal-^</ci>
       <ci>‚Ñã</ci>
      </apply>
      <ci>D</ci>
     </apply>
     <apply>
      <csymbol cd="latexml">ket</csymbol>
      <apply>
       <times></times>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>normal-Œ¶</ci>
         <ci>l</ci>
        </apply>
        <apply>
         <minus></minus>
         <ci>k</ci>
        </apply>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>normal-Œ®</ci>
         <ci>Œº</ci>
        </apply>
        <apply>
         <plus></plus>
         <ci>v</ci>
         <ci>k</ci>
        </apply>
       </apply>
      </apply>
     </apply>
    </apply>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>E</ci>
       <list>
        <ci>l</ci>
        <ci>Œº</ci>
       </list>
      </apply>
      <ci>k</ci>
     </apply>
     <apply>
      <csymbol cd="latexml">ket</csymbol>
      <apply>
       <times></times>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>normal-Œ¶</ci>
         <ci>l</ci>
        </apply>
        <apply>
         <minus></minus>
         <ci>k</ci>
        </apply>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>normal-Œ®</ci>
         <ci>Œº</ci>
        </apply>
        <apply>
         <plus></plus>
         <ci>v</ci>
         <ci>k</ci>
        </apply>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \hat{\mathcal{H}}^{D}\left|\Phi_{l}^{-k}\Psi_{\mu}^{v+k}\right\rangle=E_{l,\mu%
}^{k}\left|\Phi_{l}^{-k}\Psi_{\mu}^{v+k}\right\rangle
  </annotation>
 </semantics>
</math>

</p>

<p>stripping out the constant contribution of the inactive part and leaving a subsystem to be solved for the valence part</p>

<p>

<math display="block" id="N-electron_valence_state_perturbation_theory:36">
 <semantics>
  <mrow>
   <mrow>
    <msubsup>
     <mover accent="true">
      <mi class="ltx_font_mathcaligraphic">‚Ñã</mi>
      <mo stretchy="false">^</mo>
     </mover>
     <mi>v</mi>
     <mi>D</mi>
    </msubsup>
    <mrow>
     <mo fence="true">|</mo>
     <msubsup>
      <mi mathvariant="normal">Œ®</mi>
      <mi>Œº</mi>
      <mrow>
       <mi>v</mi>
       <mo>+</mo>
       <mi>k</mi>
      </mrow>
     </msubsup>
     <mo>‚ü©</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <msubsup>
     <mi>E</mi>
     <mi>Œº</mi>
     <mi>k</mi>
    </msubsup>
    <mrow>
     <mo fence="true">|</mo>
     <msubsup>
      <mi mathvariant="normal">Œ®</mi>
      <mi>Œº</mi>
      <mrow>
       <mi>v</mi>
       <mo>+</mo>
       <mi>k</mi>
      </mrow>
     </msubsup>
     <mo>‚ü©</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <ci>normal-^</ci>
        <ci>‚Ñã</ci>
       </apply>
       <ci>D</ci>
      </apply>
      <ci>v</ci>
     </apply>
     <apply>
      <csymbol cd="latexml">ket</csymbol>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>normal-Œ®</ci>
        <ci>Œº</ci>
       </apply>
       <apply>
        <plus></plus>
        <ci>v</ci>
        <ci>k</ci>
       </apply>
      </apply>
     </apply>
    </apply>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>E</ci>
       <ci>Œº</ci>
      </apply>
      <ci>k</ci>
     </apply>
     <apply>
      <csymbol cd="latexml">ket</csymbol>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>normal-Œ®</ci>
        <ci>Œº</ci>
       </apply>
       <apply>
        <plus></plus>
        <ci>v</ci>
        <ci>k</ci>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \hat{\mathcal{H}}^{D}_{v}\left|\Psi_{\mu}^{v+k}\right\rangle=E_{\mu}^{k}\left|%
\Psi_{\mu}^{v+k}\right\rangle
  </annotation>
 </semantics>
</math>

</p>

<p>The total energy 

<math display="inline" id="N-electron_valence_state_perturbation_theory:37">
 <semantics>
  <msubsup>
   <mi>E</mi>
   <mrow>
    <mi>l</mi>
    <mo>,</mo>
    <mi>Œº</mi>
   </mrow>
   <mi>k</mi>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>E</ci>
     <list>
      <ci>l</ci>
      <ci>Œº</ci>
     </list>
    </apply>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   E_{l,\mu}^{k}
  </annotation>
 </semantics>
</math>

 is the sum of 

<math display="inline" id="N-electron_valence_state_perturbation_theory:38">
 <semantics>
  <msubsup>
   <mi>E</mi>
   <mi>Œº</mi>
   <mi>k</mi>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>E</ci>
     <ci>Œº</ci>
    </apply>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   E_{\mu}^{k}
  </annotation>
 </semantics>
</math>

 and the energies of the orbitals involved in the definition of the inactive part 

<math display="inline" id="N-electron_valence_state_perturbation_theory:39">
 <semantics>
  <msubsup>
   <mi mathvariant="normal">Œ¶</mi>
   <mi>l</mi>
   <mrow>
    <mo>-</mo>
    <mi>k</mi>
   </mrow>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>normal-Œ¶</ci>
     <ci>l</ci>
    </apply>
    <apply>
     <minus></minus>
     <ci>k</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Phi_{l}^{-k}
  </annotation>
 </semantics>
</math>

. This introduces the possibility to perform a single diagonalization of the valence Dyall's Hamiltonian on the CASCI zero-order wavefunction and evaluate the perturber energies using the property depicted above.</p>
<h3 id="strongly-contracted-approach">Strongly Contracted Approach</h3>

<p>A different choice in the development of the NEVPT approach is to choose a single function for each space 

<math display="inline" id="N-electron_valence_state_perturbation_theory:40">
 <semantics>
  <msubsup>
   <mi>S</mi>
   <mi>l</mi>
   <mi>k</mi>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>S</ci>
     <ci>l</ci>
    </apply>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S_{l}^{k}
  </annotation>
 </semantics>
</math>

, leading to the Strongly Contracted (SC) scheme. A set of perturbative operators are used to produce a single function for each space, defined as the projection inside each space 

<math display="inline" id="N-electron_valence_state_perturbation_theory:41">
 <semantics>
  <msub>
   <mover accent="true">
    <mi class="ltx_font_mathcaligraphic">ùí´</mi>
    <mo stretchy="false">^</mo>
   </mover>
   <msubsup>
    <mi>S</mi>
    <mi>l</mi>
    <mi>k</mi>
   </msubsup>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <apply>
     <ci>normal-^</ci>
     <ci>ùí´</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>S</ci>
      <ci>l</ci>
     </apply>
     <ci>k</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \hat{\mathcal{P}}_{S_{l}^{k}}
  </annotation>
 </semantics>
</math>

 of the application of the Hamiltonian to the contracted zero order wavefunction. In other words</p>

<p>

<math display="block" id="N-electron_valence_state_perturbation_theory:42">
 <semantics>
  <mrow>
   <msubsup>
    <mi mathvariant="normal">Œ®</mi>
    <mi>l</mi>
    <mi>k</mi>
   </msubsup>
   <mo>=</mo>
   <mrow>
    <msub>
     <mover accent="true">
      <mi class="ltx_font_mathcaligraphic">ùí´</mi>
      <mo stretchy="false">^</mo>
     </mover>
     <msubsup>
      <mi>S</mi>
      <mi>l</mi>
      <mi>k</mi>
     </msubsup>
    </msub>
    <mover accent="true">
     <mi class="ltx_font_mathcaligraphic">‚Ñã</mi>
     <mo stretchy="false">^</mo>
    </mover>
    <msubsup>
     <mi mathvariant="normal">Œ®</mi>
     <mi>m</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mn>0</mn>
      <mo stretchy="false">)</mo>
     </mrow>
    </msubsup>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>normal-Œ®</ci>
      <ci>l</ci>
     </apply>
     <ci>k</ci>
    </apply>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <apply>
       <ci>normal-^</ci>
       <ci>ùí´</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>S</ci>
        <ci>l</ci>
       </apply>
       <ci>k</ci>
      </apply>
     </apply>
     <apply>
      <ci>normal-^</ci>
      <ci>‚Ñã</ci>
     </apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>normal-Œ®</ci>
       <ci>m</ci>
      </apply>
      <cn type="integer">0</cn>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Psi_{l}^{k}=\hat{\mathcal{P}}_{S_{l}^{k}}\hat{\mathcal{H}}\Psi_{m}^{(0)}
  </annotation>
 </semantics>
</math>

</p>

<p>where 

<math display="inline" id="N-electron_valence_state_perturbation_theory:43">
 <semantics>
  <msub>
   <mover accent="true">
    <mi class="ltx_font_mathcaligraphic">ùí´</mi>
    <mo stretchy="false">^</mo>
   </mover>
   <msubsup>
    <mi>S</mi>
    <mi>l</mi>
    <mi>k</mi>
   </msubsup>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <apply>
     <ci>normal-^</ci>
     <ci>ùí´</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>S</ci>
      <ci>l</ci>
     </apply>
     <ci>k</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \hat{\mathcal{P}}_{S_{l}^{k}}
  </annotation>
 </semantics>
</math>

 is the projector onto the subspace. This can be equivalently written as the application of a specific part of the Hamiltonian to the zero-order wavefunction</p>

<p>

<math display="block" id="N-electron_valence_state_perturbation_theory:44">
 <semantics>
  <mrow>
   <msubsup>
    <mi mathvariant="normal">Œ®</mi>
    <mi>l</mi>
    <mi>k</mi>
   </msubsup>
   <mo>=</mo>
   <mrow>
    <msubsup>
     <mi>V</mi>
     <mi>l</mi>
     <mi>k</mi>
    </msubsup>
    <msubsup>
     <mi mathvariant="normal">Œ®</mi>
     <mi>m</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mn>0</mn>
      <mo stretchy="false">)</mo>
     </mrow>
    </msubsup>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>normal-Œ®</ci>
      <ci>l</ci>
     </apply>
     <ci>k</ci>
    </apply>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>V</ci>
       <ci>l</ci>
      </apply>
      <ci>k</ci>
     </apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>normal-Œ®</ci>
       <ci>m</ci>
      </apply>
      <cn type="integer">0</cn>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Psi_{l}^{k}=V_{l}^{k}\Psi_{m}^{(0)}
  </annotation>
 </semantics>
</math>

</p>

<p>For each space, appropriate operators can be devised. We will not present their definition, as it could result overkilling. Suffice to say that the resulting perturbers are not normalized, and their norm</p>

<p>

<math display="block" id="N-electron_valence_state_perturbation_theory:45">
 <semantics>
  <mrow>
   <msubsup>
    <mi>N</mi>
    <mi>l</mi>
    <mi>k</mi>
   </msubsup>
   <mo>=</mo>
   <mrow>
    <mo>‚ü®</mo>
    <msubsup>
     <mi mathvariant="normal">Œ®</mi>
     <mi>l</mi>
     <mi>k</mi>
    </msubsup>
    <mo>|</mo>
    <msubsup>
     <mi mathvariant="normal">Œ®</mi>
     <mi>l</mi>
     <mi>k</mi>
    </msubsup>
    <mo>‚ü©</mo>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mo>‚ü®</mo>
    <msubsup>
     <mi mathvariant="normal">Œ®</mi>
     <mi>m</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mn>0</mn>
      <mo stretchy="false">)</mo>
     </mrow>
    </msubsup>
    <mo fence="true">|</mo>
    <mrow>
     <msup>
      <mrow>
       <mo>(</mo>
       <msubsup>
        <mi>V</mi>
        <mi>l</mi>
        <mi>k</mi>
       </msubsup>
       <mo>)</mo>
      </mrow>
      <mo>+</mo>
     </msup>
     <msubsup>
      <mi>V</mi>
      <mi>l</mi>
      <mi>k</mi>
     </msubsup>
    </mrow>
    <mo fence="true">|</mo>
    <msubsup>
     <mi mathvariant="normal">Œ®</mi>
     <mi>m</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mn>0</mn>
      <mo stretchy="false">)</mo>
     </mrow>
    </msubsup>
    <mo>‚ü©</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <and></and>
    <apply>
     <eq></eq>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>N</ci>
       <ci>l</ci>
      </apply>
      <ci>k</ci>
     </apply>
     <apply>
      <csymbol cd="latexml">inner-product</csymbol>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>normal-Œ®</ci>
        <ci>l</ci>
       </apply>
       <ci>k</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>normal-Œ®</ci>
        <ci>l</ci>
       </apply>
       <ci>k</ci>
      </apply>
     </apply>
    </apply>
    <apply>
     <eq></eq>
     <share href="#.cmml">
     </share>
     <apply>
      <csymbol cd="latexml">quantum-operator-product</csymbol>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>normal-Œ®</ci>
        <ci>m</ci>
       </apply>
       <cn type="integer">0</cn>
      </apply>
      <apply>
       <times></times>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>V</ci>
          <ci>l</ci>
         </apply>
         <ci>k</ci>
        </apply>
        <plus></plus>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>V</ci>
         <ci>l</ci>
        </apply>
        <ci>k</ci>
       </apply>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>normal-Œ®</ci>
        <ci>m</ci>
       </apply>
       <cn type="integer">0</cn>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   N_{l}^{k}=\left\langle\Psi_{l}^{k}\left.\right|\Psi_{l}^{k}\right\rangle=\left%
\langle\Psi_{m}^{(0)}\left|\left(V_{l}^{k}\right)^{+}V_{l}^{k}\right|\Psi_{m}^%
{(0)}\right\rangle
  </annotation>
 </semantics>
</math>

</p>

<p>plays an important role in the Strongly Contracted development. To evaluate these norms, the spinless density matrix of rank not higher than three between the 

<math display="inline" id="N-electron_valence_state_perturbation_theory:46">
 <semantics>
  <msubsup>
   <mi mathvariant="normal">Œ®</mi>
   <mi>m</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mn>0</mn>
    <mo stretchy="false">)</mo>
   </mrow>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>normal-Œ®</ci>
     <ci>m</ci>
    </apply>
    <cn type="integer">0</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Psi_{m}^{(0)}
  </annotation>
 </semantics>
</math>

 functions are needed.</p>

<p>An important property of the 

<math display="inline" id="N-electron_valence_state_perturbation_theory:47">
 <semantics>
  <msubsup>
   <mi mathvariant="normal">Œ®</mi>
   <mi>l</mi>
   <mi>k</mi>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>normal-Œ®</ci>
     <ci>l</ci>
    </apply>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Psi_{l}^{k}
  </annotation>
 </semantics>
</math>

 is that any other function of the space 

<math display="inline" id="N-electron_valence_state_perturbation_theory:48">
 <semantics>
  <msubsup>
   <mi>S</mi>
   <mi>l</mi>
   <mi>k</mi>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>S</ci>
     <ci>l</ci>
    </apply>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S_{l}^{k}
  </annotation>
 </semantics>
</math>

 which is orthogonal to 

<math display="inline" id="N-electron_valence_state_perturbation_theory:49">
 <semantics>
  <msubsup>
   <mi mathvariant="normal">Œ®</mi>
   <mi>l</mi>
   <mi>k</mi>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>normal-Œ®</ci>
     <ci>l</ci>
    </apply>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Psi_{l}^{k}
  </annotation>
 </semantics>
</math>

 do not interact with the zero-order wavefunction through the true Hamiltonian. It is possible to use the 

<math display="inline" id="N-electron_valence_state_perturbation_theory:50">
 <semantics>
  <msubsup>
   <mi mathvariant="normal">Œ®</mi>
   <mi>l</mi>
   <mi>k</mi>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>normal-Œ®</ci>
     <ci>l</ci>
    </apply>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Psi_{l}^{k}
  </annotation>
 </semantics>
</math>

 functions as a basis set for the expansion of the first-order correction to the wavefunction, and also for the expression of the zero-order Hamiltonian by means of a spectral decomposition</p>

<p>

<math display="block" id="N-electron_valence_state_perturbation_theory:51">
 <semantics>
  <mrow>
   <mrow>
    <msub>
     <mover accent="true">
      <mi class="ltx_font_mathcaligraphic">‚Ñã</mi>
      <mo stretchy="false">^</mo>
     </mover>
     <mn>0</mn>
    </msub>
    <mo>=</mo>
    <munder>
     <mo largeop="true" movablelimits="false" symmetric="true">‚àë</mo>
     <mrow>
      <mi>l</mi>
      <mi>k</mi>
     </mrow>
    </munder>
    <mo>|</mo>
    <msubsup>
     <mi mathvariant="normal">Œ®</mi>
     <mi>l</mi>
     <mi>k</mi>
    </msubsup>
    <mmultiscripts>
     <mo>‚ü©</mo>
     <mprescripts></mprescripts>
     <none></none>
     <mo>‚Ä≤</mo>
    </mmultiscripts>
   </mrow>
   <msubsup>
    <mi>E</mi>
    <mi>l</mi>
    <mi>k</mi>
   </msubsup>
   <mrow>
    <mo>‚ü®</mo>
    <msubsup>
     <mi mathvariant="normal">Œ®</mi>
     <mi>l</mi>
     <mi>k</mi>
    </msubsup>
    <mmultiscripts>
     <mo>‚ü©</mo>
     <mprescripts></mprescripts>
     <none></none>
     <mo>‚Ä≤</mo>
    </mmultiscripts>
   </mrow>
   <mo>+</mo>
   <munder>
    <mo largeop="true" movablelimits="false" symmetric="true">‚àë</mo>
    <mi>m</mi>
   </munder>
   <mo>|</mo>
   <msubsup>
    <mi mathvariant="normal">Œ®</mi>
    <mi>m</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mn>0</mn>
     <mo stretchy="false">)</mo>
    </mrow>
   </msubsup>
   <mo>‚ü©</mo>
   <mi>E</mi>
   <msub>
    <mi></mi>
    <mi>m</mi>
   </msub>
   <msup>
    <mi></mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mn>0</mn>
     <mo stretchy="false">)</mo>
    </mrow>
   </msup>
   <mo>‚ü®</mo>
   <msubsup>
    <mi mathvariant="normal">Œ®</mi>
    <mi>m</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mn>0</mn>
     <mo stretchy="false">)</mo>
    </mrow>
   </msubsup>
   <mo>|</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <apply>
       <ci>normal-^</ci>
       <ci>‚Ñã</ci>
      </apply>
      <cn type="integer">0</cn>
     </apply>
     <eq></eq>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <sum></sum>
      <apply>
       <times></times>
       <ci>l</ci>
       <ci>k</ci>
      </apply>
     </apply>
     <ci>normal-|</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>normal-Œ®</ci>
       <ci>l</ci>
      </apply>
      <ci>k</ci>
     </apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>normal-‚ü©</ci>
      <ci>normal-‚Ä≤</ci>
     </apply>
    </cerror>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>E</ci>
      <ci>l</ci>
     </apply>
     <ci>k</ci>
    </apply>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-‚ü®</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>normal-Œ®</ci>
       <ci>l</ci>
      </apply>
      <ci>k</ci>
     </apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>normal-‚ü©</ci>
      <ci>normal-‚Ä≤</ci>
     </apply>
    </cerror>
    <plus></plus>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <sum></sum>
     <ci>m</ci>
    </apply>
    <ci>normal-|</ci>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>normal-Œ®</ci>
      <ci>m</ci>
     </apply>
     <cn type="integer">0</cn>
    </apply>
    <ci>normal-‚ü©</ci>
    <csymbol cd="unknown">E</csymbol>
    <apply>
     <ci>m</ci>
    </apply>
    <apply>
     <cn type="integer">0</cn>
    </apply>
    <ci>normal-‚ü®</ci>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>normal-Œ®</ci>
      <ci>m</ci>
     </apply>
     <cn type="integer">0</cn>
    </apply>
    <ci>normal-|</ci>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \hat{\mathcal{H}}_{0}=\sum_{lk}\left|\Psi_{l}^{k}{}^{\prime}\right\rangle E_{l%
}^{k}\left\langle\Psi_{l}^{k}{}^{\prime}\right\rangle+\sum_{m}\left|\Psi_{m}^{%
(0)}\right\rangle E_{m}^{(0)}\left\langle\Psi_{m}^{(0)}\right|
  </annotation>
 </semantics>
</math>

</p>

<p>where 

<math display="inline" id="N-electron_valence_state_perturbation_theory:52">
 <semantics>
  <mrow>
   <mo>|</mo>
   <msubsup>
    <mi mathvariant="normal">Œ®</mi>
    <mi>l</mi>
    <mi>k</mi>
   </msubsup>
   <mmultiscripts>
    <mo>‚ü©</mo>
    <mprescripts></mprescripts>
    <none></none>
    <mo>‚Ä≤</mo>
   </mmultiscripts>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <ci>normal-|</ci>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>normal-Œ®</ci>
      <ci>l</ci>
     </apply>
     <ci>k</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>normal-‚ü©</ci>
     <ci>normal-‚Ä≤</ci>
    </apply>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \left|\Psi_{l}^{k}{}^{\prime}\right\rangle
  </annotation>
 </semantics>
</math>

 are the normalized 

<math display="inline" id="N-electron_valence_state_perturbation_theory:53">
 <semantics>
  <mrow>
   <mo fence="true">|</mo>
   <msubsup>
    <mi mathvariant="normal">Œ®</mi>
    <mi>l</mi>
    <mi>k</mi>
   </msubsup>
   <mo>‚ü©</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="latexml">ket</csymbol>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>normal-Œ®</ci>
      <ci>l</ci>
     </apply>
     <ci>k</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \left|\Psi_{l}^{k}\right\rangle
  </annotation>
 </semantics>
</math>

.</p>

<p>The expression for the first-order correction to the wavefunction is therefore</p>

<p>

<math display="block" id="N-electron_valence_state_perturbation_theory:54">
 <semantics>
  <mrow>
   <mrow>
    <msubsup>
     <mi mathvariant="normal">Œ®</mi>
     <mi>m</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mn>1</mn>
      <mo stretchy="false">)</mo>
     </mrow>
    </msubsup>
    <mo>=</mo>
    <munder>
     <mo largeop="true" movablelimits="false" symmetric="true">‚àë</mo>
     <mrow>
      <mi>k</mi>
      <mi>l</mi>
     </mrow>
    </munder>
    <mo>|</mo>
    <msubsup>
     <mi mathvariant="normal">Œ®</mi>
     <mi>l</mi>
     <mi>k</mi>
    </msubsup>
    <mmultiscripts>
     <mo>‚ü©</mo>
     <mprescripts></mprescripts>
     <none></none>
     <mo>‚Ä≤</mo>
    </mmultiscripts>
   </mrow>
   <mfrac>
    <mrow>
     <mo>‚ü®</mo>
     <msubsup>
      <mi mathvariant="normal">Œ®</mi>
      <mi>l</mi>
      <mi>k</mi>
     </msubsup>
     <mmultiscripts>
      <mo>|</mo>
      <mprescripts></mprescripts>
      <none></none>
      <mo>‚Ä≤</mo>
     </mmultiscripts>
     <mover accent="true">
      <mi class="ltx_font_mathcaligraphic">‚Ñã</mi>
      <mo stretchy="false">^</mo>
     </mover>
     <mo>|</mo>
     <msubsup>
      <mi mathvariant="normal">Œ®</mi>
      <mi>m</mi>
      <mrow>
       <mo stretchy="false">(</mo>
       <mn>0</mn>
       <mo stretchy="false">)</mo>
      </mrow>
     </msubsup>
     <mo>‚ü©</mo>
    </mrow>
    <mrow>
     <msubsup>
      <mi>E</mi>
      <mi>m</mi>
      <mrow>
       <mo stretchy="false">(</mo>
       <mn>0</mn>
       <mo stretchy="false">)</mo>
      </mrow>
     </msubsup>
     <mo>-</mo>
     <msubsup>
      <mi>E</mi>
      <mi>l</mi>
      <mi>k</mi>
     </msubsup>
    </mrow>
   </mfrac>
   <mo>=</mo>
   <munder>
    <mo largeop="true" movablelimits="false" symmetric="true">‚àë</mo>
    <mrow>
     <mi>k</mi>
     <mi>l</mi>
    </mrow>
   </munder>
   <mo>|</mo>
   <msubsup>
    <mi mathvariant="normal">Œ®</mi>
    <mi>l</mi>
    <mi>k</mi>
   </msubsup>
   <mmultiscripts>
    <mo>‚ü©</mo>
    <mprescripts></mprescripts>
    <none></none>
    <mo>‚Ä≤</mo>
   </mmultiscripts>
   <mfrac>
    <msqrt>
     <msubsup>
      <mi>N</mi>
      <mi>l</mi>
      <mi>k</mi>
     </msubsup>
    </msqrt>
    <mrow>
     <msubsup>
      <mi>E</mi>
      <mi>m</mi>
      <mrow>
       <mo stretchy="false">(</mo>
       <mn>0</mn>
       <mo stretchy="false">)</mo>
      </mrow>
     </msubsup>
     <mo>-</mo>
     <msubsup>
      <mi>E</mi>
      <mi>l</mi>
      <mi>k</mi>
     </msubsup>
    </mrow>
   </mfrac>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>normal-Œ®</ci>
       <ci>m</ci>
      </apply>
      <cn type="integer">1</cn>
     </apply>
     <eq></eq>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <sum></sum>
      <apply>
       <times></times>
       <ci>k</ci>
       <ci>l</ci>
      </apply>
     </apply>
     <ci>normal-|</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>normal-Œ®</ci>
       <ci>l</ci>
      </apply>
      <ci>k</ci>
     </apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>normal-‚ü©</ci>
      <ci>normal-‚Ä≤</ci>
     </apply>
    </cerror>
    <apply>
     <divide></divide>
     <cerror>
      <csymbol cd="ambiguous">fragments</csymbol>
      <ci>normal-‚ü®</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>normal-Œ®</ci>
        <ci>l</ci>
       </apply>
       <ci>k</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>normal-|</ci>
       <ci>normal-‚Ä≤</ci>
      </apply>
      <apply>
       <ci>normal-^</ci>
       <ci>‚Ñã</ci>
      </apply>
      <ci>normal-|</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>normal-Œ®</ci>
        <ci>m</ci>
       </apply>
       <cn type="integer">0</cn>
      </apply>
      <ci>normal-‚ü©</ci>
     </cerror>
     <apply>
      <minus></minus>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>E</ci>
        <ci>m</ci>
       </apply>
       <cn type="integer">0</cn>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>E</ci>
        <ci>l</ci>
       </apply>
       <ci>k</ci>
      </apply>
     </apply>
    </apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <sum></sum>
     <apply>
      <times></times>
      <ci>k</ci>
      <ci>l</ci>
     </apply>
    </apply>
    <ci>normal-|</ci>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>normal-Œ®</ci>
      <ci>l</ci>
     </apply>
     <ci>k</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>normal-‚ü©</ci>
     <ci>normal-‚Ä≤</ci>
    </apply>
    <apply>
     <divide></divide>
     <apply>
      <root></root>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>N</ci>
        <ci>l</ci>
       </apply>
       <ci>k</ci>
      </apply>
     </apply>
     <apply>
      <minus></minus>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>E</ci>
        <ci>m</ci>
       </apply>
       <cn type="integer">0</cn>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>E</ci>
        <ci>l</ci>
       </apply>
       <ci>k</ci>
      </apply>
     </apply>
    </apply>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Psi_{m}^{(1)}=\sum_{kl}\left|\Psi_{l}^{k}{}^{\prime}\right\rangle\frac{\left%
\langle\Psi_{l}^{k}{}^{\prime}\left|\hat{\mathcal{H}}\right|\Psi_{m}^{(0)}%
\right\rangle}{E_{m}^{(0)}-E_{l}^{k}}=\sum_{kl}\left|\Psi_{l}^{k}{}^{\prime}%
\right\rangle\frac{\sqrt{N_{l}^{k}}}{E_{m}^{(0)}-E_{l}^{k}}
  </annotation>
 </semantics>
</math>

</p>

<p>and for the energy is</p>

<p>

<math display="block" id="N-electron_valence_state_perturbation_theory:55">
 <semantics>
  <mrow>
   <msubsup>
    <mi>E</mi>
    <mi>m</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mn>2</mn>
     <mo stretchy="false">)</mo>
    </mrow>
   </msubsup>
   <mo>=</mo>
   <mrow>
    <munder>
     <mo largeop="true" movablelimits="false" symmetric="true">‚àë</mo>
     <mrow>
      <mi>k</mi>
      <mi>l</mi>
     </mrow>
    </munder>
    <mfrac>
     <mrow>
      <mo>|</mo>
      <mrow>
       <mo>‚ü®</mo>
       <msubsup>
        <mi mathvariant="normal">Œ®</mi>
        <mi>l</mi>
        <mi>k</mi>
       </msubsup>
       <mmultiscripts>
        <mo>|</mo>
        <mprescripts></mprescripts>
        <none></none>
        <mo>‚Ä≤</mo>
       </mmultiscripts>
       <mover accent="true">
        <mi class="ltx_font_mathcaligraphic">‚Ñã</mi>
        <mo stretchy="false">^</mo>
       </mover>
       <mo>|</mo>
       <msubsup>
        <mi mathvariant="normal">Œ®</mi>
        <mi>m</mi>
        <mrow>
         <mo stretchy="false">(</mo>
         <mn>0</mn>
         <mo stretchy="false">)</mo>
        </mrow>
       </msubsup>
       <mo>‚ü©</mo>
      </mrow>
      <msup>
       <mo>|</mo>
       <mn>2</mn>
      </msup>
     </mrow>
     <mrow>
      <msubsup>
       <mi>E</mi>
       <mi>m</mi>
       <mrow>
        <mo stretchy="false">(</mo>
        <mn>0</mn>
        <mo stretchy="false">)</mo>
       </mrow>
      </msubsup>
      <mo>-</mo>
      <msubsup>
       <mi>E</mi>
       <mi>l</mi>
       <mi>k</mi>
      </msubsup>
     </mrow>
    </mfrac>
   </mrow>
   <mo>=</mo>
   <mrow>
    <munder>
     <mo largeop="true" movablelimits="false" symmetric="true">‚àë</mo>
     <mrow>
      <mi>k</mi>
      <mi>l</mi>
     </mrow>
    </munder>
    <mfrac>
     <msubsup>
      <mi>N</mi>
      <mi>l</mi>
      <mi>k</mi>
     </msubsup>
     <mrow>
      <msubsup>
       <mi>E</mi>
       <mi>m</mi>
       <mrow>
        <mo stretchy="false">(</mo>
        <mn>0</mn>
        <mo stretchy="false">)</mo>
       </mrow>
      </msubsup>
      <mo>-</mo>
      <msubsup>
       <mi>E</mi>
       <mi>l</mi>
       <mi>k</mi>
      </msubsup>
     </mrow>
    </mfrac>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <and></and>
    <apply>
     <eq></eq>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>E</ci>
       <ci>m</ci>
      </apply>
      <cn type="integer">2</cn>
     </apply>
     <apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <sum></sum>
       <apply>
        <times></times>
        <ci>k</ci>
        <ci>l</ci>
       </apply>
      </apply>
      <apply>
       <divide></divide>
       <cerror>
        <csymbol cd="ambiguous">fragments</csymbol>
        <ci>normal-|</ci>
        <cerror>
         <csymbol cd="ambiguous">fragments</csymbol>
         <ci>normal-‚ü®</ci>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>normal-Œ®</ci>
           <ci>l</ci>
          </apply>
          <ci>k</ci>
         </apply>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <ci>normal-|</ci>
          <ci>normal-‚Ä≤</ci>
         </apply>
         <apply>
          <ci>normal-^</ci>
          <ci>‚Ñã</ci>
         </apply>
         <ci>normal-|</ci>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>normal-Œ®</ci>
           <ci>m</ci>
          </apply>
          <cn type="integer">0</cn>
         </apply>
         <ci>normal-‚ü©</ci>
        </cerror>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>normal-|</ci>
         <cn type="integer">2</cn>
        </apply>
       </cerror>
       <apply>
        <minus></minus>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>E</ci>
          <ci>m</ci>
         </apply>
         <cn type="integer">0</cn>
        </apply>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>E</ci>
          <ci>l</ci>
         </apply>
         <ci>k</ci>
        </apply>
       </apply>
      </apply>
     </apply>
    </apply>
    <apply>
     <eq></eq>
     <share href="#.cmml">
     </share>
     <apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <sum></sum>
       <apply>
        <times></times>
        <ci>k</ci>
        <ci>l</ci>
       </apply>
      </apply>
      <apply>
       <divide></divide>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>N</ci>
         <ci>l</ci>
        </apply>
        <ci>k</ci>
       </apply>
       <apply>
        <minus></minus>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>E</ci>
          <ci>m</ci>
         </apply>
         <cn type="integer">0</cn>
        </apply>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>E</ci>
          <ci>l</ci>
         </apply>
         <ci>k</ci>
        </apply>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   E_{m}^{(2)}=\sum_{kl}\frac{\left|\left\langle\Psi_{l}^{k}{}^{\prime}\left|\hat%
{\mathcal{H}}\right|\Psi_{m}^{(0)}\right\rangle\right|^{2}}{E_{m}^{(0)}-E_{l}^%
{k}}=\sum_{kl}\frac{N_{l}^{k}}{E_{m}^{(0)}-E_{l}^{k}}
  </annotation>
 </semantics>
</math>

</p>

<p>It is important to note that this result still misses a definition of the perturber energies 

<math display="inline" id="N-electron_valence_state_perturbation_theory:56">
 <semantics>
  <msubsup>
   <mi>E</mi>
   <mi>l</mi>
   <mi>k</mi>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>E</ci>
     <ci>l</ci>
    </apply>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   E_{l}^{k}
  </annotation>
 </semantics>
</math>

, which can be defined in a computationally advantageous approach by means of the Dyall's Hamiltonian</p>

<p>

<math display="block" id="N-electron_valence_state_perturbation_theory:57">
 <semantics>
  <mrow>
   <msubsup>
    <mi>E</mi>
    <mi>l</mi>
    <mi>k</mi>
   </msubsup>
   <mo>=</mo>
   <mrow>
    <mfrac>
     <mn>1</mn>
     <msubsup>
      <mi>N</mi>
      <mi>l</mi>
      <mi>k</mi>
     </msubsup>
    </mfrac>
    <mrow>
     <mo>‚ü®</mo>
     <msubsup>
      <mi mathvariant="normal">Œ®</mi>
      <mi>l</mi>
      <mi>k</mi>
     </msubsup>
     <mo fence="true">|</mo>
     <msup>
      <mover accent="true">
       <mi class="ltx_font_mathcaligraphic">‚Ñã</mi>
       <mo stretchy="false">^</mo>
      </mover>
      <mi>D</mi>
     </msup>
     <mo fence="true">|</mo>
     <msubsup>
      <mi mathvariant="normal">Œ®</mi>
      <mi>l</mi>
      <mi>k</mi>
     </msubsup>
     <mo>‚ü©</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>E</ci>
      <ci>l</ci>
     </apply>
     <ci>k</ci>
    </apply>
    <apply>
     <times></times>
     <apply>
      <divide></divide>
      <cn type="integer">1</cn>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>N</ci>
        <ci>l</ci>
       </apply>
       <ci>k</ci>
      </apply>
     </apply>
     <apply>
      <csymbol cd="latexml">quantum-operator-product</csymbol>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>normal-Œ®</ci>
        <ci>l</ci>
       </apply>
       <ci>k</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <ci>normal-^</ci>
        <ci>‚Ñã</ci>
       </apply>
       <ci>D</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>normal-Œ®</ci>
        <ci>l</ci>
       </apply>
       <ci>k</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   E_{l}^{k}=\frac{1}{N_{l}^{k}}\left\langle\Psi_{l}^{k}\left|\hat{\mathcal{H}}^{%
D}\right|\Psi_{l}^{k}\right\rangle
  </annotation>
 </semantics>
</math>

</p>

<p>leading to</p>

<p>

<math display="block" id="N-electron_valence_state_perturbation_theory:58">
 <semantics>
  <mrow>
   <mrow>
    <msubsup>
     <mi>N</mi>
     <mi>l</mi>
     <mi>k</mi>
    </msubsup>
    <msubsup>
     <mi>E</mi>
     <mi>l</mi>
     <mi>k</mi>
    </msubsup>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mo>‚ü®</mo>
    <msubsup>
     <mi mathvariant="normal">Œ®</mi>
     <mi>m</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mn>0</mn>
      <mo stretchy="false">)</mo>
     </mrow>
    </msubsup>
    <mo fence="true">|</mo>
    <mrow>
     <msup>
      <mrow>
       <mo>(</mo>
       <msubsup>
        <mi>V</mi>
        <mi>l</mi>
        <mi>k</mi>
       </msubsup>
       <mo>)</mo>
      </mrow>
      <mo>+</mo>
     </msup>
     <msup>
      <mover accent="true">
       <mi class="ltx_font_mathcaligraphic">‚Ñã</mi>
       <mo stretchy="false">^</mo>
      </mover>
      <mi>D</mi>
     </msup>
     <msubsup>
      <mi>V</mi>
      <mi>l</mi>
      <mi>k</mi>
     </msubsup>
    </mrow>
    <mo fence="true">|</mo>
    <msubsup>
     <mi mathvariant="normal">Œ®</mi>
     <mi>m</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mn>0</mn>
      <mo stretchy="false">)</mo>
     </mrow>
    </msubsup>
    <mo>‚ü©</mo>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mrow>
     <mo>‚ü®</mo>
     <msubsup>
      <mi mathvariant="normal">Œ®</mi>
      <mi>m</mi>
      <mrow>
       <mo stretchy="false">(</mo>
       <mn>0</mn>
       <mo stretchy="false">)</mo>
      </mrow>
     </msubsup>
     <mo fence="true">|</mo>
     <mrow>
      <msup>
       <mrow>
        <mo>(</mo>
        <msubsup>
         <mi>V</mi>
         <mi>l</mi>
         <mi>k</mi>
        </msubsup>
        <mo>)</mo>
       </mrow>
       <mo>+</mo>
      </msup>
      <msubsup>
       <mi>V</mi>
       <mi>l</mi>
       <mi>k</mi>
      </msubsup>
      <msup>
       <mover accent="true">
        <mi class="ltx_font_mathcaligraphic">‚Ñã</mi>
        <mo stretchy="false">^</mo>
       </mover>
       <mi>D</mi>
      </msup>
     </mrow>
     <mo fence="true">|</mo>
     <msubsup>
      <mi mathvariant="normal">Œ®</mi>
      <mi>m</mi>
      <mrow>
       <mo stretchy="false">(</mo>
       <mn>0</mn>
       <mo stretchy="false">)</mo>
      </mrow>
     </msubsup>
     <mo>‚ü©</mo>
    </mrow>
    <mo>+</mo>
    <mrow>
     <mo>‚ü®</mo>
     <msubsup>
      <mi mathvariant="normal">Œ®</mi>
      <mi>m</mi>
      <mrow>
       <mo stretchy="false">(</mo>
       <mn>0</mn>
       <mo stretchy="false">)</mo>
      </mrow>
     </msubsup>
     <mo fence="true">|</mo>
     <mrow>
      <msup>
       <mrow>
        <mo>(</mo>
        <msubsup>
         <mi>V</mi>
         <mi>l</mi>
         <mi>k</mi>
        </msubsup>
        <mo>)</mo>
       </mrow>
       <mo>+</mo>
      </msup>
      <mrow>
       <mo>[</mo>
       <msup>
        <mover accent="true">
         <mi class="ltx_font_mathcaligraphic">‚Ñã</mi>
         <mo stretchy="false">^</mo>
        </mover>
        <mi>D</mi>
       </msup>
       <mo>,</mo>
       <msubsup>
        <mi>V</mi>
        <mi>l</mi>
        <mi>k</mi>
       </msubsup>
       <mo>]</mo>
      </mrow>
     </mrow>
     <mo fence="true">|</mo>
     <msubsup>
      <mi mathvariant="normal">Œ®</mi>
      <mi>m</mi>
      <mrow>
       <mo stretchy="false">(</mo>
       <mn>0</mn>
       <mo stretchy="false">)</mo>
      </mrow>
     </msubsup>
     <mo>‚ü©</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <and></and>
    <apply>
     <eq></eq>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>N</ci>
        <ci>l</ci>
       </apply>
       <ci>k</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>E</ci>
        <ci>l</ci>
       </apply>
       <ci>k</ci>
      </apply>
     </apply>
     <apply>
      <csymbol cd="latexml">quantum-operator-product</csymbol>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>normal-Œ®</ci>
        <ci>m</ci>
       </apply>
       <cn type="integer">0</cn>
      </apply>
      <apply>
       <times></times>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>V</ci>
          <ci>l</ci>
         </apply>
         <ci>k</ci>
        </apply>
        <plus></plus>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <ci>normal-^</ci>
         <ci>‚Ñã</ci>
        </apply>
        <ci>D</ci>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>V</ci>
         <ci>l</ci>
        </apply>
        <ci>k</ci>
       </apply>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>normal-Œ®</ci>
        <ci>m</ci>
       </apply>
       <cn type="integer">0</cn>
      </apply>
     </apply>
    </apply>
    <apply>
     <eq></eq>
     <share href="#.cmml">
     </share>
     <apply>
      <plus></plus>
      <apply>
       <csymbol cd="latexml">quantum-operator-product</csymbol>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>normal-Œ®</ci>
         <ci>m</ci>
        </apply>
        <cn type="integer">0</cn>
       </apply>
       <apply>
        <times></times>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>V</ci>
           <ci>l</ci>
          </apply>
          <ci>k</ci>
         </apply>
         <plus></plus>
        </apply>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>V</ci>
          <ci>l</ci>
         </apply>
         <ci>k</ci>
        </apply>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <ci>normal-^</ci>
          <ci>‚Ñã</ci>
         </apply>
         <ci>D</ci>
        </apply>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>normal-Œ®</ci>
         <ci>m</ci>
        </apply>
        <cn type="integer">0</cn>
       </apply>
      </apply>
      <apply>
       <csymbol cd="latexml">quantum-operator-product</csymbol>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>normal-Œ®</ci>
         <ci>m</ci>
        </apply>
        <cn type="integer">0</cn>
       </apply>
       <apply>
        <times></times>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>V</ci>
           <ci>l</ci>
          </apply>
          <ci>k</ci>
         </apply>
         <plus></plus>
        </apply>
        <interval closure="closed">
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <apply>
           <ci>normal-^</ci>
           <ci>‚Ñã</ci>
          </apply>
          <ci>D</ci>
         </apply>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>V</ci>
           <ci>l</ci>
          </apply>
          <ci>k</ci>
         </apply>
        </interval>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>normal-Œ®</ci>
         <ci>m</ci>
        </apply>
        <cn type="integer">0</cn>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   N_{l}^{k}E_{l}^{k}=\left\langle\Psi_{m}^{(0)}\left|\left(V_{l}^{k}\right)^{+}%
\hat{\mathcal{H}}^{D}V_{l}^{k}\right|\Psi_{m}^{(0)}\right\rangle=\left\langle%
\Psi_{m}^{(0)}\left|\left(V_{l}^{k}\right)^{+}V_{l}^{k}\hat{\mathcal{H}}^{D}%
\right|\Psi_{m}^{(0)}\right\rangle+\left\langle\Psi_{m}^{(0)}\left|\left(V_{l}%
^{k}\right)^{+}\left[\hat{\mathcal{H}}^{D},V_{l}^{k}\right]\right|\Psi_{m}^{(0%
)}\right\rangle
  </annotation>
 </semantics>
</math>

</p>

<p>Developing the first term and extracting the inactive part of the Dyall's Hamiltonian it can be obtained</p>

<p>

<math display="block" id="N-electron_valence_state_perturbation_theory:59">
 <semantics>
  <mrow>
   <msubsup>
    <mi>E</mi>
    <mi>l</mi>
    <mi>k</mi>
   </msubsup>
   <mo>=</mo>
   <mrow>
    <msubsup>
     <mi>E</mi>
     <mi>m</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mn>0</mn>
      <mo stretchy="false">)</mo>
     </mrow>
    </msubsup>
    <mo>+</mo>
    <mrow>
     <mi mathvariant="normal">Œî</mi>
     <msub>
      <mi>œµ</mi>
      <mi>l</mi>
     </msub>
    </mrow>
    <mo>+</mo>
    <mrow>
     <mfrac>
      <mn>1</mn>
      <msubsup>
       <mi>N</mi>
       <mi>l</mi>
       <mi>k</mi>
      </msubsup>
     </mfrac>
     <mrow>
      <mo>‚ü®</mo>
      <msubsup>
       <mi mathvariant="normal">Œ®</mi>
       <mi>m</mi>
       <mrow>
        <mo stretchy="false">(</mo>
        <mn>0</mn>
        <mo stretchy="false">)</mo>
       </mrow>
      </msubsup>
      <mo fence="true">|</mo>
      <mrow>
       <msup>
        <mrow>
         <mo>(</mo>
         <msubsup>
          <mi>V</mi>
          <mi>l</mi>
          <mi>k</mi>
         </msubsup>
         <mo>)</mo>
        </mrow>
        <mo>+</mo>
       </msup>
       <mrow>
        <mo>[</mo>
        <msub>
         <mover accent="true">
          <mi class="ltx_font_mathcaligraphic">‚Ñã</mi>
          <mo stretchy="false">^</mo>
         </mover>
         <mi>v</mi>
        </msub>
        <mo>,</mo>
        <msubsup>
         <mi>V</mi>
         <mi>l</mi>
         <mi>k</mi>
        </msubsup>
        <mo>]</mo>
       </mrow>
      </mrow>
      <mo fence="true">|</mo>
      <msubsup>
       <mi mathvariant="normal">Œ®</mi>
       <mi>m</mi>
       <mrow>
        <mo stretchy="false">(</mo>
        <mn>0</mn>
        <mo stretchy="false">)</mo>
       </mrow>
      </msubsup>
      <mo>‚ü©</mo>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>E</ci>
      <ci>l</ci>
     </apply>
     <ci>k</ci>
    </apply>
    <apply>
     <plus></plus>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>E</ci>
       <ci>m</ci>
      </apply>
      <cn type="integer">0</cn>
     </apply>
     <apply>
      <times></times>
      <ci>normal-Œî</ci>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>œµ</ci>
       <ci>l</ci>
      </apply>
     </apply>
     <apply>
      <times></times>
      <apply>
       <divide></divide>
       <cn type="integer">1</cn>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>N</ci>
         <ci>l</ci>
        </apply>
        <ci>k</ci>
       </apply>
      </apply>
      <apply>
       <csymbol cd="latexml">quantum-operator-product</csymbol>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>normal-Œ®</ci>
         <ci>m</ci>
        </apply>
        <cn type="integer">0</cn>
       </apply>
       <apply>
        <times></times>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>V</ci>
           <ci>l</ci>
          </apply>
          <ci>k</ci>
         </apply>
         <plus></plus>
        </apply>
        <interval closure="closed">
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <apply>
           <ci>normal-^</ci>
           <ci>‚Ñã</ci>
          </apply>
          <ci>v</ci>
         </apply>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>V</ci>
           <ci>l</ci>
          </apply>
          <ci>k</ci>
         </apply>
        </interval>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>normal-Œ®</ci>
         <ci>m</ci>
        </apply>
        <cn type="integer">0</cn>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   E_{l}^{k}=E_{m}^{(0)}+\Delta\epsilon_{l}+\frac{1}{N_{l}^{k}}\left\langle\Psi_{%
m}^{(0)}\left|\left(V_{l}^{k}\right)^{+}\left[\hat{\mathcal{H}}_{v},V_{l}^{k}%
\right]\right|\Psi_{m}^{(0)}\right\rangle
  </annotation>
 </semantics>
</math>

</p>

<p>with 

<math display="inline" id="N-electron_valence_state_perturbation_theory:60">
 <semantics>
  <mrow>
   <mi mathvariant="normal">Œî</mi>
   <msub>
    <mi>œµ</mi>
    <mi>l</mi>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>normal-Œî</ci>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>œµ</ci>
     <ci>l</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Delta\epsilon_{l}
  </annotation>
 </semantics>
</math>

 equal to the sum of the orbital energies of the newly occupied virtual orbitals minus the orbital energies of the unoccupied core orbitals.</p>

<p>The term that still need to be evaluated is the braket involving the commutator. This can be obtained developing each 

<math display="inline" id="N-electron_valence_state_perturbation_theory:61">
 <semantics>
  <mi>V</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>V</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   V
  </annotation>
 </semantics>
</math>

 operator and substituting. To obtain the final result is necessary to evaluate Koopmans matrices and density matrices involving only active indexes. An interesting case is represented by the contribution for the 

<math display="inline" id="N-electron_valence_state_perturbation_theory:62">
 <semantics>
  <msubsup>
   <mi>V</mi>
   <mrow>
    <mi>i</mi>
    <mi>j</mi>
    <mi>r</mi>
    <mi>s</mi>
   </mrow>
   <mrow>
    <mo stretchy="false">(</mo>
    <mn>0</mn>
    <mo stretchy="false">)</mo>
   </mrow>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>V</ci>
     <apply>
      <times></times>
      <ci>i</ci>
      <ci>j</ci>
      <ci>r</ci>
      <ci>s</ci>
     </apply>
    </apply>
    <cn type="integer">0</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   V_{ijrs}^{(0)}
  </annotation>
 </semantics>
</math>

 case, which is trivial and can be demonstrated identical to the M√∏ller‚ÄìPlesset second-order contribution</p>

<p>

<math display="block" id="N-electron_valence_state_perturbation_theory:63">
 <semantics>
  <mrow>
   <mrow>
    <msubsup>
     <mi>E</mi>
     <mi>m</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mn>2</mn>
      <mo stretchy="false">)</mo>
     </mrow>
    </msubsup>
    <mrow>
     <mo>(</mo>
     <msubsup>
      <mi>S</mi>
      <mrow>
       <mi>r</mi>
       <mi>s</mi>
       <mi>i</mi>
       <mi>j</mi>
      </mrow>
      <mn>0</mn>
     </msubsup>
     <mo>)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mo>-</mo>
    <mfrac>
     <msubsup>
      <mi>N</mi>
      <mrow>
       <mi>r</mi>
       <mi>s</mi>
       <mi>i</mi>
       <mi>j</mi>
      </mrow>
      <mn>0</mn>
     </msubsup>
     <mrow>
      <mrow>
       <msub>
        <mi>œµ</mi>
        <mi>r</mi>
       </msub>
       <mo>+</mo>
       <msub>
        <mi>œµ</mi>
        <mi>s</mi>
       </msub>
      </mrow>
      <mo>-</mo>
      <msub>
       <mi>œµ</mi>
       <mi>i</mi>
      </msub>
      <mo>-</mo>
      <msub>
       <mi>œµ</mi>
       <mi>j</mi>
      </msub>
     </mrow>
    </mfrac>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>E</ci>
       <ci>m</ci>
      </apply>
      <cn type="integer">2</cn>
     </apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>S</ci>
       <apply>
        <times></times>
        <ci>r</ci>
        <ci>s</ci>
        <ci>i</ci>
        <ci>j</ci>
       </apply>
      </apply>
      <cn type="integer">0</cn>
     </apply>
    </apply>
    <apply>
     <minus></minus>
     <apply>
      <divide></divide>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>N</ci>
        <apply>
         <times></times>
         <ci>r</ci>
         <ci>s</ci>
         <ci>i</ci>
         <ci>j</ci>
        </apply>
       </apply>
       <cn type="integer">0</cn>
      </apply>
      <apply>
       <minus></minus>
       <apply>
        <plus></plus>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>œµ</ci>
         <ci>r</ci>
        </apply>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>œµ</ci>
         <ci>s</ci>
        </apply>
       </apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>œµ</ci>
        <ci>i</ci>
       </apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>œµ</ci>
        <ci>j</ci>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   E_{m}^{(2)}\left(S_{rsij}^{0}\right)=-\frac{N_{rsij}^{0}}{\epsilon_{r}+%
\epsilon_{s}-\epsilon_{i}-\epsilon_{j}}
  </annotation>
 </semantics>
</math>

</p>

<p>NEVPT2 can therefore be seen as a generalized form of MP2 to multireference wavefunctions.</p>
<h3 id="partially-contracted-approach">Partially Contracted Approach</h3>

<p>An alternative approach, named Partially Contracted (PC) is to define the perturber wavefunctions in a subspace 

<math display="inline" id="N-electron_valence_state_perturbation_theory:64">
 <semantics>
  <msubsup>
   <mover accent="true">
    <mi>S</mi>
    <mo>¬Ø</mo>
   </mover>
   <mi>l</mi>
   <mi>k</mi>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <apply>
      <ci>normal-¬Ø</ci>
      <ci>S</ci>
     </apply>
     <ci>l</ci>
    </apply>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \overline{S}_{l}^{k}
  </annotation>
 </semantics>
</math>

 of 

<math display="inline" id="N-electron_valence_state_perturbation_theory:65">
 <semantics>
  <msubsup>
   <mi>S</mi>
   <mi>l</mi>
   <mi>k</mi>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>S</ci>
     <ci>l</ci>
    </apply>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S_{l}^{k}
  </annotation>
 </semantics>
</math>

 with dimensionality higher than one (like in case of the Strongly Contracted approach). To define this subspace, a set of functions 

<math display="inline" id="N-electron_valence_state_perturbation_theory:66">
 <semantics>
  <mi mathvariant="normal">Œ¶</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>normal-Œ¶</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Phi
  </annotation>
 </semantics>
</math>

 is generated by means of the 

<math display="inline" id="N-electron_valence_state_perturbation_theory:67">
 <semantics>
  <msubsup>
   <mi>V</mi>
   <mi>l</mi>
   <mi>k</mi>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>V</ci>
     <ci>l</ci>
    </apply>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   V_{l}^{k}
  </annotation>
 </semantics>
</math>

 operators, after decontraction of their formulation. For example, in the case of the 

<math display="inline" id="N-electron_valence_state_perturbation_theory:68">
 <semantics>
  <msubsup>
   <mi>V</mi>
   <mrow>
    <mi>r</mi>
    <mi>s</mi>
    <mi>i</mi>
   </mrow>
   <mrow>
    <mo>-</mo>
    <mn>1</mn>
   </mrow>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>V</ci>
     <apply>
      <times></times>
      <ci>r</ci>
      <ci>s</ci>
      <ci>i</ci>
     </apply>
    </apply>
    <apply>
     <minus></minus>
     <cn type="integer">1</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   V_{rsi}^{-1}
  </annotation>
 </semantics>
</math>

 operator</p>

<p>

<math display="block" id="N-electron_valence_state_perturbation_theory:69">
 <semantics>
  <mrow>
   <mrow>
    <msubsup>
     <mi>V</mi>
     <mrow>
      <mi>r</mi>
      <mi>s</mi>
      <mi>i</mi>
     </mrow>
     <mrow>
      <mo>-</mo>
      <mn>1</mn>
     </mrow>
    </msubsup>
    <mo>=</mo>
    <mrow>
     <msub>
      <mi>Œ≥</mi>
      <mrow>
       <mi>r</mi>
       <mi>s</mi>
      </mrow>
     </msub>
     <mrow>
      <munder>
       <mo largeop="true" movablelimits="false" symmetric="true">‚àë</mo>
       <mi>a</mi>
      </munder>
      <mrow>
       <mo>(</mo>
       <mrow>
        <mrow>
         <mrow>
          <mo>‚ü®</mo>
          <mrow>
           <mi>r</mi>
           <mi>s</mi>
          </mrow>
          <mo>|</mo>
          <mrow>
           <mi>i</mi>
           <mi>a</mi>
          </mrow>
          <mo>‚ü©</mo>
         </mrow>
         <msub>
          <mi>E</mi>
          <mrow>
           <mi>r</mi>
           <mi>i</mi>
          </mrow>
         </msub>
         <msub>
          <mi>E</mi>
          <mrow>
           <mi>s</mi>
           <mi>a</mi>
          </mrow>
         </msub>
        </mrow>
        <mo>+</mo>
        <mrow>
         <mrow>
          <mo>‚ü®</mo>
          <mrow>
           <mi>s</mi>
           <mi>r</mi>
          </mrow>
          <mo>|</mo>
          <mrow>
           <mi>i</mi>
           <mi>a</mi>
          </mrow>
          <mo>‚ü©</mo>
         </mrow>
         <msub>
          <mi>E</mi>
          <mrow>
           <mi>s</mi>
           <mi>i</mi>
          </mrow>
         </msub>
         <msub>
          <mi>E</mi>
          <mrow>
           <mi>r</mi>
           <mi>a</mi>
          </mrow>
         </msub>
        </mrow>
       </mrow>
       <mo>)</mo>
      </mrow>
     </mrow>
    </mrow>
   </mrow>
   <mrow>
    <mi>r</mi>
    <mo>‚â§</mo>
    <mi>s</mi>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">formulae-sequence</csymbol>
    <apply>
     <eq></eq>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>V</ci>
       <apply>
        <times></times>
        <ci>r</ci>
        <ci>s</ci>
        <ci>i</ci>
       </apply>
      </apply>
      <apply>
       <minus></minus>
       <cn type="integer">1</cn>
      </apply>
     </apply>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>Œ≥</ci>
       <apply>
        <times></times>
        <ci>r</ci>
        <ci>s</ci>
       </apply>
      </apply>
      <apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <sum></sum>
        <ci>a</ci>
       </apply>
       <apply>
        <plus></plus>
        <apply>
         <times></times>
         <apply>
          <csymbol cd="latexml">inner-product</csymbol>
          <apply>
           <times></times>
           <ci>r</ci>
           <ci>s</ci>
          </apply>
          <apply>
           <times></times>
           <ci>i</ci>
           <ci>a</ci>
          </apply>
         </apply>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>E</ci>
          <apply>
           <times></times>
           <ci>r</ci>
           <ci>i</ci>
          </apply>
         </apply>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>E</ci>
          <apply>
           <times></times>
           <ci>s</ci>
           <ci>a</ci>
          </apply>
         </apply>
        </apply>
        <apply>
         <times></times>
         <apply>
          <csymbol cd="latexml">inner-product</csymbol>
          <apply>
           <times></times>
           <ci>s</ci>
           <ci>r</ci>
          </apply>
          <apply>
           <times></times>
           <ci>i</ci>
           <ci>a</ci>
          </apply>
         </apply>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>E</ci>
          <apply>
           <times></times>
           <ci>s</ci>
           <ci>i</ci>
          </apply>
         </apply>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>E</ci>
          <apply>
           <times></times>
           <ci>r</ci>
           <ci>a</ci>
          </apply>
         </apply>
        </apply>
       </apply>
      </apply>
     </apply>
    </apply>
    <apply>
     <leq></leq>
     <ci>r</ci>
     <ci>s</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   V_{rsi}^{-1}=\gamma_{rs}\sum_{a}\left(\left\langle rs\left.\right|ia\right%
\rangle E_{ri}E_{sa}+\left\langle sr\left.\right|ia\right\rangle E_{si}E_{ra}%
\right)\quad r\leq s
  </annotation>
 </semantics>
</math>

</p>

<p>The Partially Contracted approach makes use of functions 

<math display="inline" id="N-electron_valence_state_perturbation_theory:70">
 <semantics>
  <mrow>
   <msub>
    <mi mathvariant="normal">Œ¶</mi>
    <mrow>
     <mi>r</mi>
     <mi>i</mi>
     <mi>s</mi>
     <mi>a</mi>
    </mrow>
   </msub>
   <mo>=</mo>
   <mrow>
    <msub>
     <mi>E</mi>
     <mrow>
      <mi>r</mi>
      <mi>i</mi>
     </mrow>
    </msub>
    <msub>
     <mi>E</mi>
     <mrow>
      <mi>s</mi>
      <mi>a</mi>
     </mrow>
    </msub>
    <msubsup>
     <mi mathvariant="normal">Œ®</mi>
     <mi>m</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mn>0</mn>
      <mo stretchy="false">)</mo>
     </mrow>
    </msubsup>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>normal-Œ¶</ci>
     <apply>
      <times></times>
      <ci>r</ci>
      <ci>i</ci>
      <ci>s</ci>
      <ci>a</ci>
     </apply>
    </apply>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>E</ci>
      <apply>
       <times></times>
       <ci>r</ci>
       <ci>i</ci>
      </apply>
     </apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>E</ci>
      <apply>
       <times></times>
       <ci>s</ci>
       <ci>a</ci>
      </apply>
     </apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>normal-Œ®</ci>
       <ci>m</ci>
      </apply>
      <cn type="integer">0</cn>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Phi_{risa}=E_{ri}E_{sa}\Psi_{m}^{(0)}
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="N-electron_valence_state_perturbation_theory:71">
 <semantics>
  <mrow>
   <msub>
    <mi mathvariant="normal">Œ¶</mi>
    <mrow>
     <mi>r</mi>
     <mi>i</mi>
     <mi>s</mi>
     <mi>a</mi>
    </mrow>
   </msub>
   <mo>=</mo>
   <mrow>
    <msub>
     <mi>E</mi>
     <mrow>
      <mi>s</mi>
      <mi>i</mi>
     </mrow>
    </msub>
    <msub>
     <mi>E</mi>
     <mrow>
      <mi>r</mi>
      <mi>a</mi>
     </mrow>
    </msub>
    <msubsup>
     <mi mathvariant="normal">Œ®</mi>
     <mi>m</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mn>0</mn>
      <mo stretchy="false">)</mo>
     </mrow>
    </msubsup>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>normal-Œ¶</ci>
     <apply>
      <times></times>
      <ci>r</ci>
      <ci>i</ci>
      <ci>s</ci>
      <ci>a</ci>
     </apply>
    </apply>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>E</ci>
      <apply>
       <times></times>
       <ci>s</ci>
       <ci>i</ci>
      </apply>
     </apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>E</ci>
      <apply>
       <times></times>
       <ci>r</ci>
       <ci>a</ci>
      </apply>
     </apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>normal-Œ®</ci>
       <ci>m</ci>
      </apply>
      <cn type="integer">0</cn>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Phi_{risa}=E_{si}E_{ra}\Psi_{m}^{(0)}
  </annotation>
 </semantics>
</math>

. These functions must be orthonormalized and purged of linear dependencies which may arise. The resulting set spans the 

<math display="inline" id="N-electron_valence_state_perturbation_theory:72">
 <semantics>
  <msubsup>
   <mover accent="true">
    <mi>S</mi>
    <mo>¬Ø</mo>
   </mover>
   <mrow>
    <mi>r</mi>
    <mi>s</mi>
    <mi>i</mi>
   </mrow>
   <mrow>
    <mo>-</mo>
    <mn>1</mn>
   </mrow>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <apply>
      <ci>normal-¬Ø</ci>
      <ci>S</ci>
     </apply>
     <apply>
      <times></times>
      <ci>r</ci>
      <ci>s</ci>
      <ci>i</ci>
     </apply>
    </apply>
    <apply>
     <minus></minus>
     <cn type="integer">1</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \overline{S}_{rsi}^{-1}
  </annotation>
 </semantics>
</math>

 space.</p>

<p>Once all the 

<math display="inline" id="N-electron_valence_state_perturbation_theory:73">
 <semantics>
  <msubsup>
   <mover accent="true">
    <mi>S</mi>
    <mo>¬Ø</mo>
   </mover>
   <mi>l</mi>
   <mi>k</mi>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <apply>
      <ci>normal-¬Ø</ci>
      <ci>S</ci>
     </apply>
     <ci>l</ci>
    </apply>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \overline{S}_{l}^{k}
  </annotation>
 </semantics>
</math>

 spaces have been defined, we can obtain as usual a set of perturbers from the diagonalization of the Hamiltonian (true or Dyall) inside this space</p>

<p>

<math display="block" id="N-electron_valence_state_perturbation_theory:74">
 <semantics>
  <mrow>
   <mrow>
    <msub>
     <mover accent="true">
      <mi class="ltx_font_mathcaligraphic">ùí´</mi>
      <mo stretchy="false">^</mo>
     </mover>
     <msubsup>
      <mover accent="true">
       <mi>S</mi>
       <mo>¬Ø</mo>
      </mover>
      <mi>l</mi>
      <mi>k</mi>
     </msubsup>
    </msub>
    <mover accent="true">
     <mi class="ltx_font_mathcaligraphic">‚Ñã</mi>
     <mo stretchy="false">^</mo>
    </mover>
    <msub>
     <mover accent="true">
      <mi class="ltx_font_mathcaligraphic">ùí´</mi>
      <mo stretchy="false">^</mo>
     </mover>
     <msubsup>
      <mover accent="true">
       <mi>S</mi>
       <mo>¬Ø</mo>
      </mover>
      <mi>l</mi>
      <mi>k</mi>
     </msubsup>
    </msub>
    <mrow>
     <mo fence="true">|</mo>
     <msubsup>
      <mi mathvariant="normal">Œ®</mi>
      <mrow>
       <mi>l</mi>
       <mi>Œº</mi>
      </mrow>
      <mi>k</mi>
     </msubsup>
     <mo>‚ü©</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <msubsup>
     <mi>E</mi>
     <mrow>
      <mi>l</mi>
      <mo>,</mo>
      <mi>Œº</mi>
     </mrow>
     <mi>k</mi>
    </msubsup>
    <mrow>
     <mo fence="true">|</mo>
     <msubsup>
      <mi mathvariant="normal">Œ®</mi>
      <mrow>
       <mi>l</mi>
       <mi>Œº</mi>
      </mrow>
      <mi>k</mi>
     </msubsup>
     <mo>‚ü©</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <apply>
       <ci>normal-^</ci>
       <ci>ùí´</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <apply>
         <ci>normal-¬Ø</ci>
         <ci>S</ci>
        </apply>
        <ci>l</ci>
       </apply>
       <ci>k</ci>
      </apply>
     </apply>
     <apply>
      <ci>normal-^</ci>
      <ci>‚Ñã</ci>
     </apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <apply>
       <ci>normal-^</ci>
       <ci>ùí´</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <apply>
         <ci>normal-¬Ø</ci>
         <ci>S</ci>
        </apply>
        <ci>l</ci>
       </apply>
       <ci>k</ci>
      </apply>
     </apply>
     <apply>
      <csymbol cd="latexml">ket</csymbol>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>normal-Œ®</ci>
        <apply>
         <times></times>
         <ci>l</ci>
         <ci>Œº</ci>
        </apply>
       </apply>
       <ci>k</ci>
      </apply>
     </apply>
    </apply>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>E</ci>
       <list>
        <ci>l</ci>
        <ci>Œº</ci>
       </list>
      </apply>
      <ci>k</ci>
     </apply>
     <apply>
      <csymbol cd="latexml">ket</csymbol>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>normal-Œ®</ci>
        <apply>
         <times></times>
         <ci>l</ci>
         <ci>Œº</ci>
        </apply>
       </apply>
       <ci>k</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \hat{\mathcal{P}}_{\overline{S}_{l}^{k}}\hat{\mathcal{H}}\hat{\mathcal{P}}_{%
\overline{S}_{l}^{k}}\left|\Psi_{l\mu}^{k}\right\rangle=E_{l,\mu}^{k}\left|%
\Psi_{l\mu}^{k}\right\rangle
  </annotation>
 </semantics>
</math>

</p>

<p>As usual, the evaluation of the Partially Contracted perturbative correction by means of the Dyall Hamiltonian involves simply manageable entities for nowadays computers.</p>

<p>Although the Strongly Contracted approach makes use of a perturbative space with very low flexibility, in general it provides values in very good agreement with those obtained by the more decontracted space defined for the Partially Contracted approach. This can be probably explained by the fact that the Strongly Contracted perturbers are a good average of the totally decontracted perturbative space.</p>

<p>It should also be noted that the Partially Contracted evaluation has a very little overhead in computational cost with respect to the Strongly Contracted one, therefore they are normally evaluated together.</p>
<h2 id="properties">Properties</h2>

<p>NEVPT is blessed with many important properties, making the approach very solid and reliable. These properties arise both from the theoretical approach used and on the Dyall's Hamiltonian particular structure:</p>
<ul>
<li><strong><a href="Size_consistency" title="wikilink">Size consistency</a></strong>: NEVPT is <a href="size_consistency" title="wikilink">size consistent</a> (<a href="strict_separability" title="wikilink">strict separable</a>). Briefly, if A and B are two non-interacting systems, the energy of the supersystem A-B is equal to the sum of the energy of A plus the energy of B taken by themselves (

<math display="inline" id="N-electron_valence_state_perturbation_theory:75">
 <semantics>
  <mrow>
   <mrow>
    <mi>E</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mrow>
      <mi>A</mi>
      <mo>-</mo>
      <mi>B</mi>
     </mrow>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mrow>
     <mi>E</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mi>A</mi>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
    <mo>+</mo>
    <mrow>
     <mi>E</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mi>B</mi>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <ci>E</ci>
     <apply>
      <minus></minus>
      <ci>A</ci>
      <ci>B</ci>
     </apply>
    </apply>
    <apply>
     <plus></plus>
     <apply>
      <times></times>
      <ci>E</ci>
      <ci>A</ci>
     </apply>
     <apply>
      <times></times>
      <ci>E</ci>
      <ci>B</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   E(A-B)=E(A)+E(B)
  </annotation>
 </semantics>
</math>

). This property is of particular importance to obtain correctly behaving dissociation curves.</li>
</ul>
<ul>
<li><strong>Absence of <a href="intruder_state" title="wikilink">intruder states</a></strong>: in perturbation theory, divergencies can occur if the energy of some perturber happens to be nearly equal to the energy of the zero-order wavefunction. This situation, which is due to the presence of an energy difference at the denominator, can be avoided if the energies associated to the perturbers are guaranteed to be never nearly equal to the zero-order energy. NEVPT satisfies this requirement.</li>
</ul>
<ul>
<li><strong>Invariance under active orbital rotation</strong>: The NEVPT results are stable if an intraclass active-active orbital mixing occurs. This arises both from the structure of the Dyall Hamiltonian and the properties of a CASSCF wavefunction. This property has been also extended to the intraclass core-core and virtual-virtual mixing, thanks to the Non Canonical NEVPT approach, allowing to apply a NEVPT evaluation without performing an orbital canonization (which is required, as we saw previously)</li>
</ul>
<ul>
<li><strong>Spin purity is guaranteed</strong>: The resulting wavefunctions are guaranteed to be spin pure, due to the spin-free formalism.</li>
</ul>
<ul>
<li><strong>Efficiency</strong>: although not a formal theoretical property, computational efficiency is highly important for the evaluation on medium-size molecular systems. The current limit of the NEVPT application is largely dependent on the feasibility of the previous CASSCF evaluation, which scales factorially with respect to the active space size. The NEVPT implementation using the Dyall's Hamiltonian involves the evaluation of Koopmans' matrices and density matrices up to the four-particle density matrix spanning only active orbitals. This is particularly convenient, given the small size of currently used active spaces.</li>
</ul>
<ul>
<li><strong>Partitioning into additive classes</strong>: The perturbative correction to the energy is additive on eight different contributions. Although the evaluation of each contribution has a different computational cost, this fact can be used to improve performance, by parallelizing each contribution to a different processor.</li>
</ul>
<h2 id="see-also">See also</h2>
<ul>
<li><a href="Electron_correlation" title="wikilink">Electron correlation</a></li>
<li><a href="Perturbation_theory_(quantum_mechanics)" title="wikilink">Perturbation theory (quantum mechanics)</a></li>
<li><a class="uri" href="Post-Hartree‚ÄìFock" title="wikilink">Post-Hartree‚ÄìFock</a></li>
</ul>
<h2 id="references">References</h2>
<ul>
<li></li>
<li></li>
<li></li>
</ul>

<p>"</p>

<p><a href="Category:Electron_states" title="wikilink">Category:Electron states</a> <a href="Category:Computational_chemistry" title="wikilink">Category:Computational chemistry</a></p>
</body>
</html>
