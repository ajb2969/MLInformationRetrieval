   Piling-up lemma      Piling-up lemma   In cryptanalysis , the piling-up lemma is a principle used in linear cryptanalysis to construct linear approximation to the action of block ciphers . It was introduced by Mitsuru Matsui (1993) as an analytical tool for linear cryptanalysis.  Theory  The piling-up lemma allows the cryptanalyst to determine the probability that the equality:        X  1   ⊕   X  2   ⊕  ⋯  ⊕   X  n    =  0       direct-sum   subscript  X  1    subscript  X  2   normal-⋯   subscript  X  n    0    X_{1}\oplus X_{2}\oplus\cdots\oplus X_{n}=0     holds, where the X 's are binary variables (that is, bits: either 0 or 1).  Let P (A) denote "the probability that A is true". If it equals one , A is certain to happen, and if it equals zero, A cannot happen. First of all, we consider the piling-up lemma for two binary variables, where    P   (   X  1   =  0  )   =   p  1      fragments  P   fragments  normal-(   subscript  X  1    0  normal-)     subscript  p  1     P(X_{1}=0)=p_{1}   and    P   (   X  2   =  0  )   =   p  2      fragments  P   fragments  normal-(   subscript  X  2    0  normal-)     subscript  p  2     P(X_{2}=0)=p_{2}   .  Now, we consider:      P   (   X  1   ⊕   X  2   =  0  )      fragments  P   fragments  normal-(   subscript  X  1   direct-sum   subscript  X  2    0  normal-)     P(X_{1}\oplus X_{2}=0)     Due to the properties of the xor operation, this is equivalent to      P   (   X  1   =   X  2   )      fragments  P   fragments  normal-(   subscript  X  1     subscript  X  2   normal-)     P(X_{1}=X_{2})     X 1 = X 2 = 0 and X 1 = X 2 = 1 are mutually exclusive events , so we can say      P   (   X  1   =   X  2   )   =  P   (   X  1   =   X  2   =  0  )   +  P   (   X  1   =   X  2   =  1  )   =  P   (   X  1   =  0  ,   X  2   =  0  )   +  P   (   X  1   =  1  ,   X  2   =  1  )      fragments  P   fragments  normal-(   subscript  X  1     subscript  X  2   normal-)    P   fragments  normal-(   subscript  X  1     subscript  X  2    0  normal-)    P   fragments  normal-(   subscript  X  1     subscript  X  2    1  normal-)    P   fragments  normal-(   subscript  X  1    0  normal-,   subscript  X  2    0  normal-)    P   fragments  normal-(   subscript  X  1    1  normal-,   subscript  X  2    1  normal-)     P(X_{1}=X_{2})=P(X_{1}=X_{2}=0)+P(X_{1}=X_{2}=1)=P(X_{1}=0,X_{2}=0)+P(X_{1}=1,%
 X_{2}=1)     Now, we must make the central assumption of the piling-up lemma: the binary variables we are dealing with are independent ; that is, the state of one has no effect on the state of any of the others. Thus we can expand the probability function as follows:          P   (   X  1   ⊕   X  2   =  0  )      fragments  P   fragments  normal-(   subscript  X  1   direct-sum   subscript  X  2    0  normal-)     P(X_{1}\oplus X_{2}=0)          =  P   (   X  1   =  0  )   P   (   X  2   =  0  )   +  P   (   X  1   =  1  )   P   (   X  2   =  1  )      fragments   P   fragments  normal-(   subscript  X  1    0  normal-)   P   fragments  normal-(   subscript  X  2    0  normal-)    P   fragments  normal-(   subscript  X  1    1  normal-)   P   fragments  normal-(   subscript  X  2    1  normal-)     =P(X_{1}=0)P(X_{2}=0)+P(X_{1}=1)P(X_{2}=1)              =     p  1    p  2    +    (   1  -   p  1    )    (   1  -   p  2    )         absent       subscript  p  1    subscript  p  2        1   subscript  p  1      1   subscript  p  2        =p_{1}p_{2}+(1-p_{1})(1-p_{2})              =     p  1    p  2    +   (    1  -   p  1   -   p  2    +    p  1    p  2     )        absent       subscript  p  1    subscript  p  2        1   subscript  p  1    subscript  p  2       subscript  p  1    subscript  p  2        =p_{1}p_{2}+(1-p_{1}-p_{2}+p_{1}p_{2})              =     2   p  1    p  2    -   p  1   -   p  2    +  1       absent        2   subscript  p  1    subscript  p  2     subscript  p  1    subscript  p  2    1     =2p_{1}p_{2}-p_{1}-p_{2}+1        Now we express the probabilities p 1 and p 2 as ½ + ε 1 and ½ + ε 2 , where the ε's are the probability biases — the amount the probability deviates from ½.          P   (   X  1   ⊕   X  2   =  0  )      fragments  P   fragments  normal-(   subscript  X  1   direct-sum   subscript  X  2    0  normal-)     P(X_{1}\oplus X_{2}=0)           =     2   (    1  /  2   +   ϵ  1    )    (    1  /  2   +   ϵ  2    )    -   (    1  /  2   +   ϵ  1    )   -   (    1  /  2   +   ϵ  2    )    +  1       absent        2      1  2    subscript  ϵ  1        1  2    subscript  ϵ  2         1  2    subscript  ϵ  1        1  2    subscript  ϵ  2     1     =2(1/2+\epsilon_{1})(1/2+\epsilon_{2})-(1/2+\epsilon_{1})-(1/2+\epsilon_{2})+1              =      1  /  2   +   ϵ  1   +   ϵ  2   +   2   ϵ  1    ϵ  2     -   1  /  2   -   ϵ  1   -   1  /  2   -   ϵ  2    +  1       absent          1  2    subscript  ϵ  1    subscript  ϵ  2     2   subscript  ϵ  1    subscript  ϵ  2       1  2    subscript  ϵ  1     1  2    subscript  ϵ  2    1     =1/2+\epsilon_{1}+\epsilon_{2}+2\epsilon_{1}\epsilon_{2}-1/2-\epsilon_{1}-1/2-%
 \epsilon_{2}+1              =    1  /  2   +   2   ϵ  1    ϵ  2         absent      1  2     2   subscript  ϵ  1    subscript  ϵ  2       =1/2+2\epsilon_{1}\epsilon_{2}        Thus the probability bias ε 1,2 for the XOR sum above is 2ε 1 ε 2 .  This formula can be extended to more X 's as follows:      P   (   X  1   ⊕   X  2   ⊕  ⋯  ⊕   X  n   =  0  )   =  1  /  2  +   2   n  -  1     ∏   i  =  1   n    ϵ  i      fragments  P   fragments  normal-(   subscript  X  1   direct-sum   subscript  X  2   direct-sum  normal-⋯  direct-sum   subscript  X  n    0  normal-)    1   2    superscript  2    n  1     superscript   subscript  product    i  1    n    subscript  ϵ  i     P(X_{1}\oplus X_{2}\oplus\cdots\oplus X_{n}=0)=1/2+2^{n-1}\prod_{i=1}^{n}%
 \epsilon_{i}     Note that if any of the ε's is zero; that is, one of the binary variables is unbiased, the entire probability function will be unbiased — equal to ½.  A related slightly different definition of the bias is     ϵ  i   =  P   (   X  i   =  1  )   -  P   (   X  i   =  0  )   ,     fragments   subscript  ϵ  i    P   fragments  normal-(   subscript  X  i    1  normal-)    P   fragments  normal-(   subscript  X  i    0  normal-)   normal-,    \epsilon_{i}=P(X_{i}=1)-P(X_{i}=0),   in fact minus two times the previous value. The advantage is that now with       ε   t  o  t  a  l    =  P   (   X  1   ⊕   X  2   ⊕  ⋯  ⊕   X  n   =  1  )   -  P   (   X  1   ⊕   X  2   ⊕  ⋯  ⊕   X  n   =  0  )      fragments   subscript  ε    t  o  t  a  l     P   fragments  normal-(   subscript  X  1   direct-sum   subscript  X  2   direct-sum  normal-⋯  direct-sum   subscript  X  n    1  normal-)    P   fragments  normal-(   subscript  X  1   direct-sum   subscript  X  2   direct-sum  normal-⋯  direct-sum   subscript  X  n    0  normal-)     \varepsilon_{total}=P(X_{1}\oplus X_{2}\oplus\cdots\oplus X_{n}=1)-P(X_{1}%
 \oplus X_{2}\oplus\cdots\oplus X_{n}=0)     we have        ε   t  o  t  a  l    =     (   -  1   )    n  +  1      ∏   i  =  1   n    ε  i      ,       subscript  ε    t  o  t  a  l       superscript    1     n  1      superscript   subscript  product    i  1    n    subscript  ε  i       \varepsilon_{total}=(-1)^{n+1}\prod_{i=1}^{n}\varepsilon_{i},     adding random variables amounts to multiplying their (2nd definition) biases.  Practice  In practice, the X s are approximations to the S-boxes (substitution components) of block ciphers. Typically, X values are inputs to the S-box and Y values are the corresponding outputs. By simply looking at the S-boxes, the cryptanalyst can tell what the probability biases are. The trick is to find combinations of input and output values that have probabilities of zero or one. The closer the approximation is to zero or one, the more helpful the approximation is in linear cryptanalysis.  However, in practice, the binary variables are not independent, as is assumed in the derivation of the piling-up lemma. This consideration has to be kept in mind when applying the lemma; it is not an automatic cryptanalysis formula.  References     "  Category:Cryptographic attacks  Category:Lemmas   