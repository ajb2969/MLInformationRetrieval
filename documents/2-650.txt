   Adaptive filter      Adaptive filter   An adaptive filter is a system with a linear filter that has a transfer function controlled by variable parameters and a means to adjust those parameters according to an optimization algorithm . Because of the complexity of the optimization algorithms, most adaptive filters are digital filters . Adaptive filters are required for some applications because some parameters of the desired processing operation (for instance, the locations of reflective surfaces in a reverberant space) are not known in advance or are changing. The closed loop adaptive filter uses feedback in the form of an error signal to refine its transfer function.  Generally speaking, the closed loop adaptive process involves the use of a cost function , which is a criterion for optimum performance of the filter, to feed an algorithm, which determines how to modify filter transfer function to minimize the cost on the next iteration. The most common cost function is the mean square of the error signal.  As the power of digital signal processors has increased, adaptive filters have become much more common and are now routinely used in devices such as mobile phones and other communication devices, camcorders and digital cameras, and medical monitoring equipment.  Example application  The recording of a heart beat (an ECG ), may be corrupted by noise from the AC mains . The exact frequency of the power and its harmonics may vary from moment to moment.  One way to remove the noise is to filter the signal with a notch filter at the mains frequency and its vicinity, which could excessively degrade the quality of the ECG since the heart beat would also likely have frequency components in the rejected range.  To circumvent this potential loss of information, an adaptive filter could be used. The adaptive filter would take input both from the patient and from the mains and would thus be able to track the actual frequency of the noise as it fluctuates and subtract the noise from the recording. Such an adaptive technique generally allows for a filter with a smaller rejection range, which means, in this case, that the quality of the output signal is more accurate for medical purposes. 1  Block diagram  The idea behind a closed loop adaptive filter is that a variable filter is adjusted until the error (the difference between the filter output and the desired signal) is minimized. The Least Mean Squares (LMS) filter and the Recursive Least Squares (RLS) filter are types of adaptive filter.      (Figure)  Adaptive Filter, compact representation. k = sample number, x = reference input, d = desired input, ε = error output, f = filter impulse response, Σ = summation, box=linear filter and adaption algorithm.   There are two input signals to the adaptive filter: d k and x k which are sometimes called the primary input and the reference input respectively. 2      d  k     subscript  d  k    d_{k}   which includes the desired signal plus undesired interference and      x  k     subscript  x  k    x_{k}   which includes the signals that are correlated to some of the undesired interference in    d  k     subscript  d  k    d_{k}   .   k represents the discrete sample number.   The filter is controlled by a set of L+1 coefficients or weights.       𝐖  k   =    [   w   0  k    ,   w   1  k    ,  …  ,   w   L  k    ]   T        subscript  𝐖  k    superscript    subscript  w    0  k     subscript  w    1  k    normal-…   subscript  w    L  k     T     \mathbf{W}_{k}=\left[w_{0k},\,w_{1k},\,...,\,w_{Lk}\right]^{T}   represents the set or vector of weights, which control the filter at sample time k.    where    w   l  k      subscript  w    l  k     w_{lk}   refers to the   l   l   l   'th weight at k'th time.        𝚫   𝐖  k       𝚫   subscript  𝐖  k     \mathbf{\Delta W}_{k}   represents the change in the weights that occurs as a result of adjustments computed at sample time k.  These changes will be applied after sample time k and before they are used at sample time k+1.     The output is usually    ϵ  k     subscript  ϵ  k    \epsilon_{k}   but it could be    y  k     subscript  y  k    y_{k}   or it could even be the filter coefficients. 3 (Widrow)  The input signals are defined as follows:       d  k   =    g  k   +   u  k   +   v  k         subscript  d  k      subscript  g  k    subscript  u  k    subscript  v  k      d_{k}=g_{k}+u_{k}+v_{k}          x  k   =    g  k    ′    +   u  k    ′    +   v  k    ′          subscript  x  k      superscript   subscript  g  k    normal-′     superscript   subscript  u  k    normal-′     superscript   subscript  v  k    normal-′       x_{k}=g_{k}^{^{\prime}}+u_{k}^{^{\prime}}+v_{k}^{^{\prime}}      where:  g = the desired signal,  g ' = a signal that is correlated with the desired signal ''g '',  u = an undesired signal that is added to ''g '', but not correlated with ''g '' or ''g' ''  ''u' '' = a signal that is correlated with the undesired signal ''u '',but not correlated with ''g '' or ''g' '',  v = an undesired signal (typically random noise) not correlated with ''g '', ''g' '', u , ''u' '' or ''v' '',  v' = an undesired signal (typically random noise) not correlated with ''g '', ''g' '', u , ''u' '' or v .     The output signals are defined as follows:       y  k   =     g  ^   k   +    u  ^   k   +    v  ^   k         subscript  y  k      subscript   normal-^  g   k    subscript   normal-^  u   k    subscript   normal-^  v   k      y_{k}=\hat{g}_{k}+\hat{u}_{k}+\hat{v}_{k}          ϵ  k   =    d  k   -   y  k         subscript  ϵ  k      subscript  d  k    subscript  y  k      \epsilon_{k}=d_{k}-y_{k}   .   where:     g  ^     normal-^  g    \hat{g}   = the output of the filter if the input was only ''g' '',      u  ^     normal-^  u    \hat{u}   = the output of the filter if the input was only ''u' '',      v  ^     normal-^  v    \hat{v}   = the output of the filter if the input was only ''v' ''.    Tapped delay line FIR filter  If the variable filter has a tapped delay line Finite Impulse Response (FIR) structure, then the impulse response is equal to the filter coefficients. The output of the filter is given by       y  k   =    ∑   l  =  0   L      w   l  k      x   (   k  -  l   )      =     g  ^   k   +    u  ^   k   +    v  ^   k           subscript  y  k     superscript   subscript     l  0    L      subscript  w    l  k     subscript  x    k  l              subscript   normal-^  g   k    subscript   normal-^  u   k    subscript   normal-^  v   k       y_{k}=\sum_{l=0}^{L}w_{lk}\ x_{(k-l)}=\hat{g}_{k}+\hat{u}_{k}+\hat{v}_{k}       where    w   l  k      subscript  w    l  k     w_{lk}   refers to the   l   l   l   'th weight at k'th time.     Ideal case  In the ideal case     v  ≡  0   ,     v    ′    ≡  0   ,    g    ′    ≡  0       formulae-sequence    v  0    formulae-sequence     superscript  v   normal-′    0      superscript  g   normal-′    0      v\equiv 0,v^{^{\prime}}\equiv 0,g^{^{\prime}}\equiv 0   . All the undesired signals in    d  k     subscript  d  k    d_{k}   are represented by    u  k     subscript  u  k    u_{k}   .     x   k     subscript  x  k    \ x_{k}   consists entirely of a signal correlated with the undesired signal in    u  k     subscript  u  k    u_{k}   .  The output of the variable filter in the ideal case is       y  k   =    u  ^   k        subscript  y  k    subscript   normal-^  u   k     y_{k}=\hat{u}_{k}   .  The error signal or cost function is the difference between    d  k     subscript  d  k    d_{k}   and    y  k     subscript  y  k    y_{k}          ϵ  k   =    d  k   -   y  k    =     g  k   +   u  k    -    u  ^   k           subscript  ϵ  k      subscript  d  k    subscript  y  k              subscript  g  k    subscript  u  k     subscript   normal-^  u   k       \epsilon_{k}=d_{k}-y_{k}=g_{k}+u_{k}-\hat{u}_{k}   . The desired signal g k passes through without being changed.  The error signal    ϵ  k     subscript  ϵ  k    \epsilon_{k}   is minimized in the mean square sense when    [    u  k   -    u  ^   k    ]     delimited-[]     subscript  u  k    subscript   normal-^  u   k      [u_{k}-\hat{u}_{k}]   is minimized. In other words,     u  ^   k     subscript   normal-^  u   k    \hat{u}_{k}   is the best mean square estimate of    u  k     subscript  u  k    u_{k}   . In the ideal case,     u  k   =    u  ^   k        subscript  u  k    subscript   normal-^  u   k     u_{k}=\hat{u}_{k}   and     ϵ  k   =   g  k        subscript  ϵ  k    subscript  g  k     \epsilon_{k}=g_{k}   , and all that is left after the subtraction is   g   g   g   which is the unchanged desired signal with all undesired signals removed.  Signal components in the reference input  In some situations, the reference input x _k includes components of the desired signal. This means g' ≠ 0.  Perfect cancelation of the undesired interference is not possible in the case, but improvement of the signal to interference ratio is possible. The output will be       ϵ  k   =    d  k   -   y  k    =      g  k   -    g  ^   k    +   u  k    -    u  ^   k           subscript  ϵ  k      subscript  d  k    subscript  y  k                subscript  g  k    subscript   normal-^  g   k     subscript  u  k     subscript   normal-^  u   k       \epsilon_{k}=d_{k}-y_{k}=g_{k}-\hat{g}_{k}+u_{k}-\hat{u}_{k}   . The desired signal will be modified (usually decreased).  The output signal to interference ratio has a simple formula referred to as power inversion .        ρ  𝗈𝗎𝗍    (  z  )    =   1    ρ  𝗋𝖾𝖿    (  z  )            subscript  ρ  𝗈𝗎𝗍   z     1     subscript  ρ  𝗋𝖾𝖿   z      \rho_{\mathsf{out}}(z)=\frac{1}{\rho_{\mathsf{ref}}(z)}   .    where      ρ  𝗈𝗎𝗍    (  z  )        subscript  ρ  𝗈𝗎𝗍   z    \rho_{\mathsf{out}}(z)   = output signal to interference ratio.       ρ  𝗋𝖾𝖿    (  z  )        subscript  ρ  𝗋𝖾𝖿   z    \rho_{\mathsf{ref}}(z)   = reference signal to interference ratio.     z   z   z   = frequency in the z-domain.      This formula means that the output signal to interference ratio at a particular frequency is the reciprocal of the reference signal to interference ratio. 4  Example: A fast food restaurant has a drive-up window. Before getting to the window, customers place their order by speaking into a microphone. The microphone also picks up noise from the engine and the environment. This microphone provides the primary signal. The signal power from the customer’s voice and the noise power from the engine are equal. It is difficult for the employees in the restaurant to understand the customer. To reduce the amount of interference in the primary microphone, a second microphone is located where it is intended to pick up sounds from the engine. It also picks up the customer’s voice. This microphone is the source of the reference signal. In this case, the engine noise is 50 times more powerful than the customer’s voice. Once the canceler has converged, the primary signal to interference ratio will be improved from 1:1 to 50:1.  Adaptive Linear Combiner      The adaptive linear combiner (ALC) resembles the adaptive tapped delay line FIR filter except that there is no assumed relationship between the X values. If the X values were from the outputs of a tapped delay line, then the combination of tapped delay line and ALC would comprise an adaptive filter. However, the X values could be the values of an array of pixels. Or they could be the outputs of multiple tapped delay lines. The ALC finds use as an adaptive beam former for arrays of hydrophones or antennas.       y  k   =    ∑   l  =  0   L      w   l  k      x   l  k           subscript  y  k     superscript   subscript     l  0    L      subscript  w    l  k     subscript  x    l  k        y_{k}=\sum_{l=0}^{L}w_{lk}\ x_{lk}       where    w   l  k      subscript  w    l  k     w_{lk}   refers to the   l   l   l   'th weight at k'th time.     LMS algorithm  If the variable filter has a tapped delay line FIR structure, then the LMS update algorithm is especially simple. Typically, after each sample, the coefficients of the FIR filter are adjusted as follows: 5 (Widrow)   for    l  =   0  …  L       l    0  normal-…  L     l=0\dots L           w   l  ,   k  +  1     =    w   l  k    +   2   μ     ϵ  k     x   k  -  l           subscript  w   l    k  1        subscript  w    l  k      2  μ   subscript  ϵ  k    subscript  x    k  l        w_{l,k+1}=w_{lk}+2\mu\ \epsilon_{k}\ x_{k-l}       μ is called the convergence factor .     The LMS algorithm does not require that the X values have any particular relationship; therefor it can be used to adapt a linear combiner as well as an FIR filter. In this case the update formula is written as:       w   l  ,   k  +  1     =    w   l  k    +   2   μ     ϵ  k     x   l  k           subscript  w   l    k  1        subscript  w    l  k      2  μ   subscript  ϵ  k    subscript  x    l  k        w_{l,k+1}=w_{lk}+2\mu\ \epsilon_{k}\ x_{lk}     The effect of the LMS algorithm is at each time, k, to make a small change in each weight. The direction of the change is such that it would decrease the error if it had been applied at time k. The magnitude of the change in each weight depends on μ, the associated X value and the error at time k. The weights making the largest contribution to the output,    y  k     subscript  y  k    y_{k}   , are changed the most. If the error is zero, then there should be no change in the weights. If the associated value of X is zero, then changing the weight makes no difference, so it is not changed.  Convergence  μ controls how fast and how well the algorithm converges to the optimum filter coefficients. If μ is too large, the algorithm will not converge. If μ is too small the algorithm converges slowly and may not be able to track changing conditions. If μ is large but not too large to prevent convergence, the algorithm reaches steady state rapidly but continuously overshoots the optimum weight vector. Sometimes, μ is made large at first for rapid convergence and then decreased to minimize overshoot.  Widrow and Stearns state in 1985 that they have no knowledge of a proof that the LMS algorithm will converge in all cases. 6  However under certain assumptions about stationarity and independence it can be shown that the algorithm will converge if      0  <  μ  <   1   σ  2          0  μ         1   superscript  σ  2       0<\mu<\frac{1}{\sigma^{2}}       where      σ  2   =    ∑   l  =  0   L    σ  l  2         superscript  σ  2     superscript   subscript     l  0    L    superscript   subscript  σ  l   2      \sigma^{2}=\sum_{l=0}^{L}\sigma_{l}^{2}   = sum of all input power            σ  l     subscript  σ  l    \sigma_{l}   is the RMS value of the   l   l   l   'th input     In the case of the tapped delay line filter, each input has the same RMS value because they are simply the same values delayed. In this case the total power is       σ  2   =    (   L  +  1   )    σ  0  2         superscript  σ  2       L  1    superscript   subscript  σ  0   2      \sigma^{2}=(L+1)\sigma_{0}^{2}       where     σ  0     subscript  σ  0    \sigma_{0}   is the RMS value of    x  k     subscript  x  k    x_{k}   , the input stream. 7      This leads to a normalized LMS algorithm:       w   l  ,   k  +  1     =    w   l  k    +    (    2   μ  σ     σ  2    )     ϵ  k     x   k  -  l           subscript  w   l    k  1        subscript  w    l  k          2   subscript  μ  σ     superscript  σ  2     subscript  ϵ  k    subscript  x    k  l        w_{l,k+1}=w_{lk}+\left(\frac{2\mu_{\sigma}}{\sigma^{2}}\right)\epsilon_{k}\ x_%
 {k-l}   in which case the convergence criteria becomes    0  <   μ  σ   <  1        0   subscript  μ  σ        1     0<\mu_{\sigma}<1   .  Applications of adaptive filters   Noise cancellation  Signal prediction  Adaptive feedback cancellation  Echo cancellation   Filter implementations   Least mean squares filter  Recursive least squares filter  Multidelay block frequency domain adaptive filter   See also   Kalman filter  Wiener filter  Linear prediction  Filter (signal processing)  Kernel adaptive filter  Wiener-Hopf equation  MMSE estimator   Notes  References       "  Category:Digital signal processing  Category:Nonlinear filters     ↩  Widrow p 304 ↩  Widrow p 212 ↩  Widrow p 313 ↩  Widrow p 100 ↩  Widrow p 103 ↩      