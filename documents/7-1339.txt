   Five-point stencil      Five-point stencil   In numerical analysis , given a square grid in one or two dimensions, the five-point stencil of a point in the grid is made up of the point itself together with its four "neighbors". It is used to write finite difference approximations to derivatives at grid points. It is an example for numerical differentiation .  One dimension  In one dimension, if the spacing between points in the grid is h , then the five-point stencil of a point x in the grid is       {   x  -   2  h    ,   x  -  h   ,  x  ,   x  +  h   ,   x  +   2  h    }   .       x    2  h      x  h   x    x  h     x    2  h      \ \{x-2h,x-h,x,x+h,x+2h\}.     First derivative  The first derivative of a function ƒ of a real variable at a point x can be approximated using a five-point stencil as        f  ′    (  x  )    ≈       -   f   (   x  +   2  h    )     +   8  f   (   x  +  h   )     -   8  f   (   x  -  h   )     +   f   (   x  -   2  h    )      12  h           superscript  f  normal-′   x               f    x    2  h        8  f    x  h       8  f    x  h       f    x    2  h        12  h      f^{\prime}(x)\approx\frac{-f(x+2h)+8f(x+h)-8f(x-h)+f(x-2h)}{12h}     Obtaining the formula  This formula can be obtained by writing out the four Taylor series of ƒ( x ± h ) and ƒ( x ± 2 h ) up to terms of h 3 (or up to terms of h 5 to get an error estimation as well) and solving this system of four equations to get ƒ ′ ( x ). Actually, we have at points x + h and x − h :      f   (  x  ±  h  )   =  f   (  x  )   ±  h   f  ′    (  x  )   +    h  2   2    f  ′′    (  x  )   ±    h  3   6    f   (  3  )     (  x  )   +   O   1  ±     (   h  4   )   .   (   E   1  ±    )   .     fragments  f   fragments  normal-(  x  plus-or-minus  h  normal-)    f   fragments  normal-(  x  normal-)   plus-or-minus  h   superscript  f  normal-′    fragments  normal-(  x  normal-)       superscript  h  2   2    superscript  f  ′′    fragments  normal-(  x  normal-)   plus-or-minus     superscript  h  3   6    superscript  f  3    fragments  normal-(  x  normal-)     subscript  O   limit-from  1  plus-or-minus     fragments  normal-(   superscript  h  4   normal-)   normal-.  italic-   fragments  normal-(   subscript  E   limit-from  1  plus-or-minus    normal-)   normal-.    f(x\pm h)=f(x)\pm hf^{\prime}(x)+\frac{h^{2}}{2}f^{\prime\prime}(x)\pm\frac{h^%
 {3}}{6}f^{(3)}(x)+O_{1\pm}(h^{4}).\qquad(E_{1\pm}).     Evaluating ( E 1+ ) − ( E 1− ) gives us      f   (  x  +  h  )   -  f   (  x  -  h  )   =  2  h   f  ′    (  x  )   +    h  3   3    f   (  3  )     (  x  )   +   O  1    (   h  4   )   .   (   E  1   )   .     fragments  f   fragments  normal-(  x   h  normal-)    f   fragments  normal-(  x   h  normal-)    2  h   superscript  f  normal-′    fragments  normal-(  x  normal-)       superscript  h  3   3    superscript  f  3    fragments  normal-(  x  normal-)     subscript  O  1    fragments  normal-(   superscript  h  4   normal-)   normal-.  italic-   fragments  normal-(   subscript  E  1   normal-)   normal-.    f(x+h)-f(x-h)=2hf^{\prime}(x)+\frac{h^{3}}{3}f^{(3)}(x)+O_{1}(h^{4}).\qquad(E_%
 {1}).     Note that the residual term O 1 ( h 4 ) should be of the order of h 5 instead of h 4 because if the terms of h 4 had been written out in ( E 1+ ) and ( E 1− ), it can be seen that they would have canceled each other out by ƒ( x + h ) − ƒ( x − h ). But for this calculation, it is left like that since the order of error estimation is not treated here (cf below).  Similarly, we have      f   (  x  ±  2  h  )   =  f   (  x  )   ±  2  h   f  ′    (  x  )   +  2   h  2    f  ′′    (  x  )   ±    4   h  3    3    f   (  3  )     (  x  )   +   O   2  ±     (   h  4   )   .   (   E   2  ±    )      fragments  f   fragments  normal-(  x  plus-or-minus  2  h  normal-)    f   fragments  normal-(  x  normal-)   plus-or-minus  2  h   superscript  f  normal-′    fragments  normal-(  x  normal-)    2   superscript  h  2    superscript  f  ′′    fragments  normal-(  x  normal-)   plus-or-minus      4   superscript  h  3    3    superscript  f  3    fragments  normal-(  x  normal-)     subscript  O   limit-from  2  plus-or-minus     fragments  normal-(   superscript  h  4   normal-)   normal-.  italic-   fragments  normal-(   subscript  E   limit-from  2  plus-or-minus    normal-)     f(x\pm 2h)=f(x)\pm 2hf^{\prime}(x)+2h^{2}f^{\prime\prime}(x)\pm\frac{4h^{3}}{3%
 }f^{(3)}(x)+O_{2\pm}(h^{4}).\qquad(E_{2\pm})     and     (   E   2  +    )   -   (   E   2  -    )        subscript  E   limit-from  2      subscript  E   limit-from  2       (E_{2+})-(E_{2-})   gives us      f   (  x  +  2  h  )   -  f   (  x  -  2  h  )   =  4  h   f  ′    (  x  )   +    8   h  3    3    f   (  3  )     (  x  )   +   O  2    (   h  4   )   .   (   E  2   )   .     fragments  f   fragments  normal-(  x   2  h  normal-)    f   fragments  normal-(  x   2  h  normal-)    4  h   superscript  f  normal-′    fragments  normal-(  x  normal-)        8   superscript  h  3    3    superscript  f  3    fragments  normal-(  x  normal-)     subscript  O  2    fragments  normal-(   superscript  h  4   normal-)   normal-.  italic-   fragments  normal-(   subscript  E  2   normal-)   normal-.    f(x+2h)-f(x-2h)=4hf^{\prime}(x)+\frac{8h^{3}}{3}f^{(3)}(x)+O_{2}(h^{4}).\qquad%
 (E_{2}).     In order to eliminate the terms of ƒ (3) ( x ), calculate 8 × ( E 1 ) − ( E 2 )         8  f   (   x  +  h   )    -   8  f   (   x  -  h   )    -   f   (   x  +   2  h    )     +   f   (   x  -   2  h    )     =    12  h   f  ′    (  x  )    +   O   (   h  4   )               8  f    x  h      8  f    x  h      f    x    2  h        f    x    2  h          12  h   superscript  f  normal-′   x     O   superscript  h  4       8f(x+h)-8f(x-h)-f(x+2h)+f(x-2h)=12hf^{\prime}(x)+O(h^{4})\,     thus giving the formula as above. Note: the coefficients of f in this formula, (8, -8,-1,1), represent a specific example of the more general Savitzky-Golay filter  Estimated error  The error in this approximation is of order  h 4 . That can be seen from the expansion           -   f   (   x  +   2  h    )     +   8  f   (   x  +  h   )     -   8  f   (   x  -  h   )     +   f   (   x  -   2  h    )      12  h    =      f  ′    (  x  )    -    1  30    f   (  5  )     (  x  )    h  4     +   O   (   h  5   )                     f    x    2  h        8  f    x  h       8  f    x  h       f    x    2  h        12  h           superscript  f  normal-′   x       1  30    superscript  f  5   x   superscript  h  4       O   superscript  h  5       \frac{-f(x+2h)+8f(x+h)-8f(x-h)+f(x-2h)}{12h}=f^{\prime}(x)-\frac{1}{30}f^{(5)}%
 (x)h^{4}+O(h^{5})    1  which can be obtained by expanding the left-hand side in a Taylor series . Alternatively, apply Richardson extrapolation to the central difference approximation to     f  ′    (  x  )        superscript  f  normal-′   x    f^{\prime}(x)   on grids with spacing 2 h and h .  Higher derivatives  The centered difference formulas for five-point stencils approximating second, third, and fourth derivatives are        f  ′′    (  x  )    ≈        -   f   (   x  +   2  h    )     +   16  f   (   x  +  h   )     -   30  f   (  x  )     +   16  f   (   x  -  h   )     -   f   (   x  -   2  h    )      12   h  2            superscript  f  ′′   x                 f    x    2  h        16  f    x  h       30  f  x      16  f    x  h       f    x    2  h        12   superscript  h  2       f^{\prime\prime}(x)\approx\frac{-f(x+2h)+16f(x+h)-30f(x)+16f(x-h)-f(x-2h)}{12h%
 ^{2}}           f   (  3  )     (  x  )    ≈       f   (   x  +   2  h    )    -   2  f   (   x  +  h   )     +   2  f   (   x  -  h   )     -   f   (   x  -   2  h    )      2   h  3            superscript  f  3   x             f    x    2  h       2  f    x  h       2  f    x  h       f    x    2  h        2   superscript  h  3       f^{(3)}(x)\approx\frac{f(x+2h)-2f(x+h)+2f(x-h)-f(x-2h)}{2h^{3}}           f   (  4  )     (  x  )    ≈        f   (   x  +   2  h    )    -   4  f   (   x  +  h   )     +   6  f   (  x  )     -   4  f   (   x  -  h   )     +   f   (   x  -   2  h    )      h  4           superscript  f  4   x               f    x    2  h       4  f    x  h       6  f  x      4  f    x  h       f    x    2  h       superscript  h  4      f^{(4)}(x)\approx\frac{f(x+2h)-4f(x+h)+6f(x)-4f(x-h)+f(x-2h)}{h^{4}}     Estimated errors  The errors in these approximations are O ( h 4 ), O ( h 2 ) and O ( h 2 ) respectively. 2  Relationship to Lagrange interpolating polynomials  As an alternative to deriving the finite difference weights from the Taylor series, they may be obtained by differentiating the Lagrange polynomials         ℓ  j    (  ξ  )    =    ∏    i  =  0   ,   i  ≠  j    k     ξ  -   x  i      x  j   -   x  i       ,         subscript  normal-ℓ  j   ξ     superscript   subscript  product   formulae-sequence    i  0     i  j     k       ξ   subscript  x  i       subscript  x  j    subscript  x  i        \ell_{j}(\xi)=\prod_{i=0,\,i\neq j}^{k}\frac{\xi-x_{i}}{x_{j}-x_{i}},     where the interpolation points are         x  0   =   x  -   2  h     ,     x  1   =   x  -  h    ,     x  2   =  x   ,     x  3   =   x  +  h    ,    x  4   =   x  +   2  h         .     formulae-sequence     subscript  x  0     x    2  h      formulae-sequence     subscript  x  1     x  h     formulae-sequence     subscript  x  2   x    formulae-sequence     subscript  x  3     x  h       subscript  x  4     x    2  h          x_{0}=x-2h,\quad x_{1}=x-h,\quad x_{2}=x,\quad x_{3}=x+h,\quad x_{4}=x+2h.     Then, the quartic polynomial     p  4    (  x  )        subscript  p  4   x    p_{4}(x)   interpolating ƒ( x ) at these five points is        p  4    (  x  )    =    ∑   j  =  0   4    f   (   x  j   )    ℓ  j    (  x  )            subscript  p  4   x     superscript   subscript     j  0    4     f   subscript  x  j    subscript  normal-ℓ  j   x      p_{4}(x)=\sum\limits_{j=0}^{4}f(x_{j})\ell_{j}(x)     and its derivative is         p  4  ′    (  x  )    =    ∑   j  =  0   4    f   (   x  j   )    ℓ  j  ′    (  x  )      .         superscript   subscript  p  4   normal-′   x     superscript   subscript     j  0    4     f   subscript  x  j    subscript   superscript  normal-ℓ  normal-′   j   x      p_{4}^{\prime}(x)=\sum\limits_{j=0}^{4}f(x_{j})\ell^{\prime}_{j}(x).     So, the finite difference approximation of ƒ ′ ( x ) at the middle point x = x 2 is        f  ′    (   x  2   )    =     ℓ  0  ′    (   x  2   )   f   (   x  0   )    +    ℓ  1  ′    (   x  2   )   f   (   x  1   )    +    ℓ  2  ′    (   x  2   )   f   (   x  2   )    +    ℓ  3  ′    (   x  2   )   f   (   x  3   )    +    ℓ  4  ′    (   x  2   )   f   (   x  4   )    +   O   (   h  4   )            superscript  f  normal-′    subscript  x  2         superscript   subscript  normal-ℓ  0   normal-′    subscript  x  2   f   subscript  x  0       superscript   subscript  normal-ℓ  1   normal-′    subscript  x  2   f   subscript  x  1       superscript   subscript  normal-ℓ  2   normal-′    subscript  x  2   f   subscript  x  2       superscript   subscript  normal-ℓ  3   normal-′    subscript  x  2   f   subscript  x  3       superscript   subscript  normal-ℓ  4   normal-′    subscript  x  2   f   subscript  x  4      O   superscript  h  4       f^{\prime}(x_{2})=\ell_{0}^{\prime}(x_{2})f(x_{0})+\ell_{1}^{\prime}(x_{2})f(x%
 _{1})+\ell_{2}^{\prime}(x_{2})f(x_{2})+\ell_{3}^{\prime}(x_{2})f(x_{3})+\ell_{%
 4}^{\prime}(x_{2})f(x_{4})+O(h^{4})     Evaluating the derivatives of the five Lagrange polynomials at x = x 2 gives the same weights as above. This method can be more flexible as the extension to a non-uniform grid is quite straightforward.  Two dimensions  In two dimensions, if for example the size of the squares in the grid is h by h , the five point stencil of a point ( x , y ) in the grid is       {   (   x  -  h   ,  y  )   ,   (  x  ,  y  )   ,   (   x  +  h   ,  y  )   ,   (  x  ,   y  -  h   )   ,   (  x  ,   y  +  h   )   }   ,        x  h   y    x  y      x  h   y    x    y  h     x    y  h      \{(x-h,y),(x,y),(x+h,y),(x,y-h),(x,y+h)\},\,   forming a pattern that is also called a quincunx . This stencil is often used to approximate the Laplacian of a function of two variables:        Δ  f   (  x  ,  y  )    ≈      f   (   x  -  h   ,  y  )    +   f   (   x  +  h   ,  y  )    +   f   (  x  ,   y  -  h   )    +   f   (  x  ,   y  +  h   )     -   4  f   (  x  ,  y  )      h  2     .        normal-Δ  f   x  y            f     x  h   y      f     x  h   y      f   x    y  h       f   x    y  h        4  f   x  y      superscript  h  2      \Delta f(x,y)\approx\frac{f(x-h,y)+f(x+h,y)+f(x,y-h)+f(x,y+h)-4f(x,y)}{h^{2}}.     The error in this approximation is O ( h 2 ), 3 which may be explained as follows:  From the 3 point stencils for the second derivative of a function with respect to x and y:            ∂  2   f    ∂   x  2     =        f   (   x  +   Δ  x    ,  y  )    +   f   (   x  -   Δ  x    ,  y  )     -   2  f   (  x  ,  y  )      Δ   x  2     -   2     f   (  4  )     (  x  ,  y  )     4  !    Δ   x  2     +  ⋯                superscript   2   f      superscript  x  2                 f     x    normal-Δ  x    y      f     x    normal-Δ  x    y       2  f   x  y       normal-Δ   superscript  x  2       2       superscript  f  4    x  y      4    normal-Δ   superscript  x  2     normal-⋯       \begin{array}[]{l}\frac{\partial^{2}f}{\partial x^{2}}=\frac{f\left(x+\Delta x%
 ,y\right)+f\left(x-\Delta x,y\right)-2f(x,y)}{\Delta x^{2}}-2\frac{f^{(4)}(x,y%
 )}{4!}\Delta x^{2}+\cdots\end{array}             ∂  2   f    ∂   y  2     =        f   (  x  ,   y  +   Δ  y    )    +   f   (  x  ,   y  -   Δ  y    )     -   2  f   (  x  ,  y  )      Δ   y  2     -   2     f   (  4  )     (  x  ,  y  )     4  !    Δ   y  2     +  ⋯                superscript   2   f      superscript  y  2                 f   x    y    normal-Δ  y        f   x    y    normal-Δ  y         2  f   x  y       normal-Δ   superscript  y  2       2       superscript  f  4    x  y      4    normal-Δ   superscript  y  2     normal-⋯       \begin{array}[]{l}\frac{\partial^{2}f}{\partial y^{2}}=\frac{f\left(x,y+\Delta
 y%
 \right)+f\left(x,y-\Delta y\right)-2f(x,y)}{\Delta y^{2}}-2\frac{f^{(4)}(x,y)}%
 {4!}\Delta y^{2}+\cdots\end{array}     If we assume     Δ  x   =   Δ  y   =  h          normal-Δ  x     normal-Δ  y        h     \Delta x=\Delta y=h   :          ∇  2   f       =      ∂  2   f    ∂   x  2     +     ∂  2   f    ∂   y  2              =        f   (   x  +  h   ,  y  )    +   f   (   x  -  h   ,  y  )    +   f   (  x  ,   y  +  h   )    +   f   (  x  ,   y  -  h   )     -   4  f   (  x  ,  y  )      h  2    -   4     f   (  4  )     (  x  ,  y  )     4  !     h  2     +  ⋯           =       f   (   x  +  h   ,  y  )    +   f   (   x  -  h   ,  y  )    +   f   (  x  ,   y  +  h   )    +   f   (  x  ,   y  -  h   )     -   4  f   (  x  ,  y  )      h  2    +   O   (   h  2   )              superscript  normal-∇  2   f     absent        superscript   2   f      superscript  x  2         superscript   2   f      superscript  y  2          missing-subexpression     absent              f     x  h   y      f     x  h   y      f   x    y  h       f   x    y  h        4  f   x  y      superscript  h  2      4       superscript  f  4    x  y      4     superscript  h  2     normal-⋯       missing-subexpression     absent            f     x  h   y      f     x  h   y      f   x    y  h       f   x    y  h        4  f   x  y      superscript  h  2      O   superscript  h  2         \begin{array}[]{ll}\nabla^{2}f&=\frac{\partial^{2}f}{\partial x^{2}}+\frac{%
 \partial^{2}f}{\partial y^{2}}\\
 &=\frac{f\left(x+h,y\right)+f\left(x-h,y\right)+f\left(x,y+h\right)+f\left(x,y%
 -h\right)-4f(x,y)}{h^{2}}-4\frac{f^{(4)}(x,y)}{4!}h^{2}+\cdots\\
 &=\frac{f\left(x+h,y\right)+f\left(x-h,y\right)+f\left(x,y+h\right)+f\left(x,y%
 -h\right)-4f(x,y)}{h^{2}}+O\left(h^{2}\right)\\
 \end{array}     See also   Stencil (numerical analysis)  Stencil jumping  Finite difference coefficients   References    . Ninth printing. Table 25.2.   "  Category:Numerical differential equations     Abramowitz & Stegun, Table 25.2 ↩   Abramowitz & Stegun, 25.3.30 ↩     