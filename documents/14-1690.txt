   K q-flats      K q-flats   In data mining and machine learning ,   k   k   k      q   q   q   -flats algorithm 1  2 is an iterative method which aims to partition   m   m   m   observations into   k   k   k   clusters where each cluster is close to a    q   q   q   -flat , where   q   q   q   is a given integer.  It is a generalization of the    k   k   k   -means algorithm . In   k   k   k   -means algorithm, clusters are formed in the way that each cluster is close to one point, which is a   0   0    -flat.   k   k   k      q   q   q   -flats algorithm gives better clustering result than   k   k   k   -means algorithm for some data set.  Description  Problem formulation  Given a set   A   A   A   of   m   m   m   observations    (   a  1   ,   a  2   ,  …  ,   a  m   )      subscript  a  1    subscript  a  2   normal-…   subscript  a  m     (a_{1},a_{2},\dots,a_{m})   where each observation    a  i     subscript  a  i    a_{i}   is an n-dimensional real vector,   k   k   k      q   q   q   -flats algorithm aims to partition   m   m   m   observation points by generating   k   k   k      q   q   q   -flats that minimize the sum of the squares of distances of each observation to a nearest q-flat.  A   q   q   q   -flat is a subset of    R  n     superscript  R  n    R^{n}   that is congruent to    R  q     superscript  R  q    R^{q}   . For example, a   0   0    -flat is a point; a   1   1   1   -flat is a plane; a    n  -  1      n  1    n-1   -flat is a hyperplane .   q   q   q   -flat can be characterized by the solution set of a linear system of equations    F  =   {  x  |    x  ∈   R  n    ,     W  ′   x   =  γ    }       F   conditional-set  x   formulae-sequence    x   superscript  R  n         superscript  W  normal-′   x   γ       F=\{x|x\in R^{n},W^{\prime}x=\gamma\}   , where    W  ∈   R   n  ×   (   n  -  q   )         W   superscript  R    n    n  q       W\in R^{n\times(n-q)}   ,    γ  ∈   R   1  ×   (   n  -  q   )         γ   superscript  R    1    n  q       \gamma\in R^{1\times(n-q)}   .  Denote a partition of    {  1  ,  2  ,  …  ,  n  }     1  2  normal-…  n    \{1,2,\dots,n\}   as    S  =   (   S  1   ,   S  2   ,  …  ,   S  k   )       S    subscript  S  1    subscript  S  2   normal-…   subscript  S  k      S=(S_{1},S_{2},\dots,S_{k})   . The problem can be formulated as        (   P  1   )     min      F  l   ,  l   =  1   ,   …  ,   k  are q-flats       min  S      ∑   l  =  1   k     ∑    a  j   ∈   S  i       ∥    a  j   -    P   F  i     (   a  j   )     ∥   2      ,        P  1     subscript    formulae-sequence      subscript  F  l   l   1    normal-…    k  are q-flats       subscript   S      superscript   subscript     l  1    k     subscript      subscript  a  j    subscript  S  i      superscript   norm     subscript  a  j      subscript  P   subscript  F  i     subscript  a  j      2       (P1)\min_{F_{l},l=1,\dots,k\text{ are q-flats}}\min_{S}\sum_{l=1}^{k}\sum_{a_{%
 j}\in S_{i}}\|a_{j}-P_{F_{i}}(a_{j})\|^{2},     where     P   F  i     (   a  j   )        subscript  P   subscript  F  i     subscript  a  j     P_{F_{i}}(a_{j})   is the projection of    a  j     subscript  a  j    a_{j}   onto    F  i     subscript  F  i    F_{i}   . Note that     ∥    a  j   -    P   F  i     (   a  j   )     ∥   =   d  i  s  t   (   a  j   ,   F  l   )         norm     subscript  a  j      subscript  P   subscript  F  i     subscript  a  j        d  i  s  t    subscript  a  j    subscript  F  l       \|a_{j}-P_{F_{i}}(a_{j})\|=dist(a_{j},F_{l})   is the distance from    a  j     subscript  a  j    a_{j}   to    F  l     subscript  F  l    F_{l}   .  Algorithm  The algorithm is similar to the k-means algorithm (i.e. Lloyd's algorithm) in that it alternates between cluster assignment and cluster update. In specific, the algorithm starts with an initial set of   q   q   q   -flats      F  l   (  0  )    =   {   x  ∈   R  n    |      (   W  l   (  0  )    )   ′   x   =   γ  l   (  0  )     }    ,   l  =   1  ,  …  ,  k       formulae-sequence     superscript   subscript  F  l   0    conditional-set    x   superscript  R  n         superscript   superscript   subscript  W  l   0   normal-′   x    superscript   subscript  γ  l   0        l   1  normal-…  k      F_{l}^{(0)}=\{x\in R^{n}|(W_{l}^{(0)})^{\prime}x=\gamma_{l}^{(0)}\},l=1,\dots,k   , and proceeds by alternating between the following two steps:   Cluster Assignment (given   q   q   q   -flats, assign each point to closest   q   q   q   -flat): the i'th cluster is updated as      S  i   (  t  )    =   {   a  j   |     ∥      (   W  i   (  t  )    )   ′    a  j    -   γ  i   (  t  )     ∥   F   =    min   l  =   1  ,  …  ,  k       ∥      (   W  l   (  t  )    )   ′    a  j    -   γ  l   (  t  )     ∥   F     }    .       superscript   subscript  S  i   t    conditional-set   subscript  a  j      subscript   norm       superscript   superscript   subscript  W  i   t   normal-′    subscript  a  j     superscript   subscript  γ  i   t     F      subscript     l   1  normal-…  k      subscript   norm       superscript   superscript   subscript  W  l   t   normal-′    subscript  a  j     superscript   subscript  γ  l   t     F        S_{i}^{(t)}=\{a_{j}|\|(W_{i}^{(t)})^{\prime}a_{j}-\gamma_{i}^{(t)}\|_{F}=\min_%
 {l=1,\dots,k}\|(W_{l}^{(t)})^{\prime}a_{j}-\gamma_{l}^{(t)}\|_{F}\}.       ' Cluster Update ' (given cluster assignment, update the   q   q   q   -flats): For    l  =   1  ,  …  ,  k       l   1  normal-…  k     l=1,\dots,k   , let     A   (  l  )    ∈   R    m   (  l  )    ×  n          A  l    superscript  R      m  l   n      A(l)\in R^{m(l)\times n}   with rows corresponding to all    a  i     subscript  a  i    a_{i}   assigned to cluster   l   l   l   . Set    W  l   (   t  +  1   )      superscript   subscript  W  l     t  1     W_{l}^{(t+1)}   to be the matrix whose columns are the orthonormal eigenvectors corresponding to the    (   n  -  q   )      n  q    (n-q)   least eigenvalues of    A    (  l  )   ′    (   I  -    e   e  ′    m    )   A   (  l  )       A   superscript  l  normal-′     I      e   superscript  e  normal-′    m    A  l    A(l)^{\prime}(I-\frac{ee^{\prime}}{m})A(l)   and     γ  l   (   t  +  1   )    =     e  ′   A   (  l  )    W  l   (   t  +  1   )     m        superscript   subscript  γ  l     t  1         superscript  e  normal-′   A  l   superscript   subscript  W  l     t  1     m     \gamma_{l}^{(t+1)}=\frac{e^{\prime}A(l)W_{l}^{(t+1)}}{m}   .   Stop whenever the assignments no longer change.  The cluster assignment step uses the following fact: given a q-flat     F  l   =   {  x  |     W  ′   x   =  γ   }        subscript  F  l    conditional-set  x       superscript  W  normal-′   x   γ      F_{l}=\{x|W^{\prime}x=\gamma\}   and a vector   a   a   a   , where      W  ′   W   =  I         superscript  W  normal-′   W   I    W^{\prime}W=I   , the distance from   a   a   a   to the q-flat    F  l     subscript  F  l    F_{l}   is      d  i  s  t   (  a  ,   F  l   )    =   m  i   n   x  :     W  ′   x   =  γ       ∥   x  -  a   ∥   F  2    =    ∥   W    (    W  ′   W   )    -  1     (     W  ′   x   -  γ   )    ∥   F  2   =    ∥     W  ′   x   -  γ   ∥   F  2    .          d  i  s  t   a   subscript  F  l       m  i   subscript  n   normal-:  x       superscript  W  normal-′   x   γ      superscript   subscript   norm    x  a    F   2          superscript   subscript   norm    W   superscript     superscript  W  normal-′   W     1         superscript  W  normal-′   x   γ     F   2         superscript   subscript   norm       superscript  W  normal-′   x   γ    F   2      dist(a,F_{l})=min_{x:W^{\prime}x=\gamma}\|x-a\|_{F}^{2}=\|W(W^{\prime}W)^{-1}(%
 W^{\prime}x-\gamma)\|_{F}^{2}=\|W^{\prime}x-\gamma\|_{F}^{2}.     The key part of this algorithm is how to update the cluster, i.e. given   m   m   m   points, how to find a   q   q   q   -flat that minimizes the sum of squares of distances of each point to the   q   q   q   -flat. Mathematically, this problem is: given     A  ∈   R   m  ×  n     ,      A   superscript  R    m  n      A\in R^{m\times n},   solve the quadratic optimization problem        (   P  2   )    min    W  ∈   R   n  ×   (   n  -  q   )      ,   γ  ∈   R   1  ×   (   n  -  q   )          ∥    A  W   -   e  γ    ∥   F  2    ,        P  2    subscript    formulae-sequence    W   superscript  R    n    n  q        γ   superscript  R    1    n  q         superscript   subscript   norm      A  W     e  γ     F   2     (P2)\min_{W\in R^{n\times(n-q)},\gamma\in R^{1\times(n-q)}}\|AW-e\gamma\|_{F}^%
 {2},   subject to       W  ′   W   =  I   ,         superscript  W  normal-′   W   I    W^{\prime}W=I,     where    A  ∈   R   m  ×  n        A   superscript  R    m  n      A\in R^{m\times n}   is given, and    e  =    (  1  ,  …  ,  1  )   ′   ∈   R   m  ×  1          e   superscript   1  normal-…  1   normal-′         superscript  R    m  1       e=(1,\dots,1)^{\prime}\in R^{m\times 1}   .  The problem can be solved using Lagrangian multiplier method and the solution is as given in the cluster update step.  It can be shown that the algorithm will terminate in a finite number of iterations (no more than the total number of possible assignments, which is bounded by    k  m     superscript  k  m    k^{m}   ). In addition, the algorithm will terminate at a point that the overall objective cannot be decreased either by a different assignment or by defining new cluster planes for these clusters (such point is called "locally optimal" in the references).  This convergence result is a consequence of the fact that problem (P2) can be solved exactly. The same convergence result holds for   k   k   k   -means algorithm because the cluster update problem can be solved exactly.  Relation to other machine learning methods     k   k   k   -means algorithm     k   k   k      q   q   q   -flats algorithm is a generalization of   k   k   k   -means algorithm. In fact,   k   k   k   -means algorithm is   k   k   k   0-flats algorithm since a point is a 0-flat. Despite their connection, they should be used in different scenarios.   k   k   k      q   q   q   -flats algorithm for the case that data lie in a few low-dimensional spaces.   k   k   k   -means algorithm is desirable for the case the clusters are of the ambient dimension, . For example, if all observations lie in two lines,   k   k   k      q   q   q   -flats algorithm with    q  =  1      q  1    q=1   may be used; if the observations are two Gaussian clouds ,   k   k   k   -means algorithm may be used.  Sparse Dictionary Learning  Natural signals lie in a high-dimensional space. For example, the dimension of a 1024 by 1024 image is about 10 6 , which is far too high for most signal processing algorithms. One way to get rid of the high dimensionality is to find a set of basis functions, such that the high-dimensional signal can be represented by only a few basis functions. In other words, the coefficients of the signal representation lies in a low-dimensional space, which is easier to apply signal processing algorithms. In the literature, wavelet transform is usually used in image processing, and fourier transform is usually used in audio processing. The set of basis functions is usually called a dictionary .  However, it is not clear what is the best dictionary to use once given a signal data set. One popular approach is to find a dictionary when given a data set using the idea of Sparse Dictionary Learning. It aims to find a dictionary, such that the signal can be sparsely represented by the dictionary. The optimization problem can be written as follows.       min   B  ,  R      ∥   X  -   B  R    ∥   F  2        subscript    B  R     superscript   subscript   norm    X    B  R     F   2     \min_{B,R}\|X-BR\|_{F}^{2}   subject to      ∥   R  i   ∥   0   ≤  q       subscript   norm   subscript  R  i    0   q    \|R_{i}\|_{0}\leq q     where   X is a d by N matrix. Each columns of X represent a signal, and there are total N signals.  B is a d by l matrix. Each columns of B represent a basis function, and there are total l basis functions in the dictionary.  R is a l by N matrix.    R  i     subscript  R  i    R_{i}   ( i th columns of R) represent the coefficients when we use the dictionary B to represent the i th columns of X.       ∥  v  ∥   0     subscript   norm  v   0    \|v\|_{0}   denotes the zero-norm of the vector v .       ∥  V  ∥   F     subscript   norm  V   F    \|V\|_{F}   denotes the Frobenious norm of matrix V .   The idea of   k   k   k       q  -     limit-from  q     q-   flats algorithm is similar to sparse dictionary learning in nature. If we restrict the q-flat to q-dimensional subspace, then the   k   k   k       q  -     limit-from  q     q-   flats algorithm is simply finding the closed q-dimensional subspace to a given signal. Sparse dictionary learning is also doing the same thing, except for an additional constraints on the sparsity of the representation. Mathematically, it is possible to show that   k   k   k       q  -     limit-from  q     q-   flats algorithm is of the form of sparse dictionary learning with an additional block structure on R .  Let    B  k     subscript  B  k    B_{k}   be a    d  ×  q      d  q    d\times q   matrix, where columns of    B  k     subscript  B  k    B_{k}   are basis of the    k   t  h      superscript  k    t  h     k^{th}   flat. Then the projection of the signal x to the    k   t  h      superscript  k    t  h     k^{th}   flat is     B  k    r  k        subscript  B  k    subscript  r  k     B_{k}r_{k}   , where    r  k     subscript  r  k    r_{k}   is a q-dimensional coefficient. Let    B  =   [   B  1   ,  ⋯  ,   B  K   ]       B    subscript  B  1   normal-⋯   subscript  B  K      B=[B_{1},\cdots,B_{K}]   denote concatenation of basis of K flats, it is easy to show that the k -q-flat algorithm is the same as the following.       min   B  ,  R      ∥   X  -   B  R    ∥   F  2        subscript    B  R     superscript   subscript   norm    X    B  R     F   2     \min_{B,R}\|X-BR\|_{F}^{2}   subject to      ∥   R  i   ∥   0   ≤  q       subscript   norm   subscript  R  i    0   q    \|R_{i}\|_{0}\leq q   and R has a block structure.  The block structure of R refers the fact that each signal is labeled to only one flat. Comparing the two formulations, k q-flat is the same as sparse dictionary modeling when    l  =   K  ×  q       l    K  q     l=K\times q   and with an additional block structure on R . Users may refer to Szlam's paper 3 for more discussion about the relationship between the two concept.  Applications and Variations  Classification  Classification is a procedure that classifies an input signal into different classes. One example is to classify an email into spam or non-spam classes. Classification algorithms usually require a supervised learning stage. In the supervised learning stage, training data for each class is used for the algorithm to learn the characteristics of the class. In the classification stage, a new observation is classified into a class by using the characteristics that were already trained.  k q-flat algorithm can be used for classification. Suppose there are total of m classes. For each class, k flats are trained a priori via training data set. When a new data comes, find the flat that is closest to the new data. Then the new data is associate to class of the closest flat.  However, the classification performance can be further improved if we impose some structure on the flats. One possible choice is to require different flats from different class be sufficiently far apart. Some researchers 4 use this idea and develop a discriminative k q-flat algorithm.  K-metrics 5  In   k   k   k      q   q   q   -flats algorithm,     ∥   x  -    P  F    (  x  )     ∥   2     superscript   norm    x     subscript  P  F   x     2    \|x-P_{F}(x)\|^{2}   is used to measure the representation error.     P  F    (  x  )        subscript  P  F   x    P_{F}(x)   denotes the projection of x to the flat F . If data lies in a q-dimension flat, then a single q-flat can represent the data very well. On the contrary, if data lies in a very high dimension space but near a common center, then k-means algorithm is a better way than k q-flat algorithm to represent the data. It is because   k   k   k   -means algorithm use     ∥   x  -   x  c    ∥   2     superscript   norm    x   subscript  x  c     2    \|x-x_{c}\|^{2}   to measure the error, where    x  c     subscript  x  c    x_{c}   denotes the center. K-metrics is a generalization that use both the idea of flat and mean. In k-metrics, error is measured by the following Mahalanobis metric.        ∥   x  -  y   ∥   A  2   =     (   x  -  y   )   T   A   (   x  -  y   )         superscript   subscript   norm    x  y    A   2      superscript    x  y   T   A    x  y      \|x-y\|_{A}^{2}=(x-y)^{T}A(x-y)     where A is a positive semi-definite matrix.  If A is the identity matrix, then the Mahalanobis metric is exactly the same as the error measure used in k-means. If A is not the identity matrix, then     ∥   x  -  y   ∥   A  2     superscript   subscript   norm    x  y    A   2    \|x-y\|_{A}^{2}   will favor certain directions as the k q-flat error measure.  References    "  Category:Data clustering algorithms     Bradley, P S, and O L Mangasarian. 2000. k-Plane Clustering. Journal of Global Optimization 16, no. 1: 23-32. http://www.springerlink.com/index/H51L607707062TN7.pdf . ↩  Tseng, P. 2000. Nearest q-flat to m points. Journal of Optimization Theory and Applications 105, no. 1: 249–252. ↩  Szlam, A, and G Sapiro. 2009. “Discriminative k-metrics.” Ed. Léon Bottou and Michael Littman. Processing (1) 744615-744615-10 ↩  Szlam, A, and G Sapiro. "Supervised Learning via Discriminative k q-Flats" 1 ↩      