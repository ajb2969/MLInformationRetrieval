   Feynman–Kac formula      Feynman–Kac formula   The Feynman–Kac formula named after Richard Feynman and Mark Kac , establishes a link between parabolic partial differential equations (PDEs) and stochastic processes . It offers a method of solving certain PDEs by simulating random paths of a stochastic process. Conversely, an important class of expectations of random processes can be computed by deterministic methods. Consider the PDE             ∂  u    ∂  t     (  x  ,  t  )    +   μ   (  x  ,  t  )     ∂  u    ∂  x     (  x  ,  t  )    +     1  2     σ  2    (  x  ,  t  )      ∂  2   u    ∂   x  2      (  x  ,  t  )     -   V   (  x  ,  t  )   u   (  x  ,  t  )     +   f   (  x  ,  t  )     =  0   ,                  u     t     x  t      μ   x  t       u     x     x  t        1  2    superscript  σ  2    x  t       superscript   2   u      superscript  x  2      x  t       V   x  t   u   x  t       f   x  t     0    \frac{\partial u}{\partial t}(x,t)+\mu(x,t)\frac{\partial u}{\partial x}(x,t)+%
 \tfrac{1}{2}\sigma^{2}(x,t)\frac{\partial^{2}u}{\partial x^{2}}(x,t)-V(x,t)u(x%
 ,t)+f(x,t)=0,     defined for all x in R and t in [0, T ], subject to the terminal condition        u   (  x  ,  T  )    =   ψ   (  x  )     ,        u   x  T      ψ  x     u(x,T)=\psi(x),     where μ, σ, ψ, V , f are known functions, T is a parameter and    u  :    ℝ  ×   [  0  ,  T  ]    →  ℝ      normal-:  u   normal-→    ℝ   0  T    ℝ     u:\mathbb{R}\times[0,T]\to\mathbb{R}   is the unknown. Then the Feynman–Kac formula tells us that the solution can be written as a conditional expectation      u   (  x  ,  t  )   =   E  Q    [   ∫  t  T    e   -     ∫  t  r     V   (   X  τ   ,  τ  )   d  τ      f   (   X  r   ,  r  )   d  r  +   e   -     ∫  t  T     V   (   X  τ   ,  τ  )   d  τ      ψ   (   X  T   )   |   X  t   =  x  ]      fragments  u   fragments  normal-(  x  normal-,  t  normal-)     superscript  E  Q    fragments  normal-[   superscript   subscript   t   T    superscript  e      superscript   subscript   t   r     V    subscript  X  τ   τ   d  τ      f   fragments  normal-(   subscript  X  r   normal-,  r  normal-)   d  r    superscript  e      superscript   subscript   t   T     V    subscript  X  τ   τ   d  τ      ψ   fragments  normal-(   subscript  X  T   normal-)   normal-|   subscript  X  t    x  normal-]     u(x,t)=E^{Q}\left[\int_{t}^{T}e^{-\int_{t}^{r}V(X_{\tau},\tau)\,d\tau}f(X_{r},%
 r)dr+e^{-\int_{t}^{T}V(X_{\tau},\tau)\,d\tau}\psi(X_{T})\Bigg|X_{t}=x\right]     under the probability measure Q such that X is an Itō process driven by the equation        d  X   =    μ   (  X  ,  t  )   d  t   +   σ   (  X  ,  t  )   d   W  Q      ,        d  X       μ   X  t   d  t     σ   X  t   d   superscript  W  Q       dX=\mu(X,t)\,dt+\sigma(X,t)\,dW^{Q},     with W Q ( t ) is a Wiener process (also called Brownian motion ) under Q , and the initial condition for X ( t ) is X (t) = x .  Proof  Let u ( x , t ) be the solution to above PDE. Applying Itō's lemma to the process       Y   (  s  )    =     e   -     ∫  t  s     V   (   X  τ   ,  τ  )   d  τ      u   (   X  s   ,  s  )    +    ∫  t  s     e   -     ∫  t  r     V   (   X  τ   ,  τ  )   d  τ      f   (   X  r   ,  r  )   d  r           Y  s        superscript  e      superscript   subscript   t   s     V    subscript  X  τ   τ   d  τ      u    subscript  X  s   s      superscript   subscript   t   s      superscript  e      superscript   subscript   t   r     V    subscript  X  τ   τ   d  τ      f    subscript  X  r   r   d  r       Y(s)=e^{-\int_{t}^{s}V(X_{\tau},\tau)\,d\tau}u(X_{s},s)+\int_{t}^{s}e^{-\int_{%
 t}^{r}V(X_{\tau},\tau)\,d\tau}f(X_{r},r)\,dr     one gets       d  Y   =         d  Y   absent    \displaystyle dY=     Since        d   (   e   -     ∫  t  s     V   (   X  τ   ,  τ  )   d  τ      )    =   -   V   (   X  s   ,  s  )     e   -     ∫  t  s     V   (   X  τ   ,  τ  )   d  τ       d  s     ,        d   superscript  e      superscript   subscript   t   s     V    subscript  X  τ   τ   d  τ           V    subscript  X  s   s    superscript  e      superscript   subscript   t   s     V    subscript  X  τ   τ   d  τ      d  s      d\left(e^{-\int_{t}^{s}V(X_{\tau},\tau)\,d\tau}\right)=-V(X_{s},s)e^{-\int_{t}%
 ^{s}V(X_{\tau},\tau)\,d\tau}\,ds,   the third term is    O   (   d   t   d  u   )       O    d  t  d  u     O(dt\,du)   and can be dropped. We also have that        d   (    ∫  t  s     e   -     ∫  t  r     V   (   X  τ   ,  τ  )   d  τ      f   (   X  r   ,  r  )   d  r    )    =    e   -     ∫  t  s     V   (   X  τ   ,  τ  )   d  τ      f   (   X  s   ,  s  )   d  s    .        d    superscript   subscript   t   s      superscript  e      superscript   subscript   t   r     V    subscript  X  τ   τ   d  τ      f    subscript  X  r   r   d  r        superscript  e      superscript   subscript   t   s     V    subscript  X  τ   τ   d  τ      f    subscript  X  s   s   d  s     d\left(\int_{t}^{s}e^{-\int_{t}^{r}V(X_{\tau},\tau)\,d\tau}f(X_{r},r)dr\right)%
 =e^{-\int_{t}^{s}V(X_{\tau},\tau)\,d\tau}f(X_{s},s)ds.     Applying Itō's lemma once again to    d  u   (   X  s   ,  s  )       d  u    subscript  X  s   s     du(X_{s},s)   , it follows that       d  Y   =         d  Y   absent    \displaystyle dY=     The first term contains, in parentheses, the above PDE and is therefore zero. What remains is        d  Y   =    e   -     ∫  t  s     V   (   X  τ   ,  τ  )   d  τ      σ   (  X  ,  s  )      ∂  u    ∂  X     d  W    .        d  Y      superscript  e      superscript   subscript   t   s     V    subscript  X  τ   τ   d  τ      σ   X  s       u     X    d  W     dY=e^{-\int_{t}^{s}V(X_{\tau},\tau)\,d\tau}\sigma(X,s)\frac{\partial u}{%
 \partial X}\,dW.     Integrating this equation from t to T , one concludes that         Y   (  T  )    -   Y   (  t  )     =    ∫  t  T     e   -     ∫  t  s     V   (   X  τ   ,  τ  )   d  τ      σ   (  X  ,  s  )      ∂  u    ∂  X     d  W     .          Y  T     Y  t      superscript   subscript   t   T      superscript  e      superscript   subscript   t   s     V    subscript  X  τ   τ   d  τ      σ   X  s       u     X    d  W      Y(T)-Y(t)=\int_{t}^{T}e^{-\int_{t}^{s}V(X_{\tau},\tau)\,d\tau}\sigma(X,s)\frac%
 {\partial u}{\partial X}\,dW.     Upon taking expectations, conditioned on X t = x , and observing that the right side is an Itō integral , which has expectation zero, it follows that      E   [  Y   (  T  )   ∣   X  t   =  x  ]   =  E   [  Y   (  t  )   ∣   X  t   =  x  ]   =  u   (  x  ,  t  )   .     fragments  E   fragments  normal-[  Y   fragments  normal-(  T  normal-)   normal-∣   subscript  X  t    x  normal-]    E   fragments  normal-[  Y   fragments  normal-(  t  normal-)   normal-∣   subscript  X  t    x  normal-]    u   fragments  normal-(  x  normal-,  t  normal-)   normal-.    E[Y(T)\mid X_{t}=x]=E[Y(t)\mid X_{t}=x]=u(x,t).     The desired result is obtained by observing that      E   [  Y   (  T  )   ∣   X  t   =  x  ]   =  E   [   e   -     ∫  t  T     V   (   X  τ   ,  τ  )   d  τ      u   (   X  T   ,  T  )   +   ∫  t  T    e   -     ∫  t  r     V   (   X  τ   ,  τ  )   d  τ      f   (   X  r   ,  r  )   d   r   |   X  t   =  x  ]      fragments  E   fragments  normal-[  Y   fragments  normal-(  T  normal-)   normal-∣   subscript  X  t    x  normal-]    E   fragments  normal-[   superscript  e      superscript   subscript   t   T     V    subscript  X  τ   τ   d  τ      u   fragments  normal-(   subscript  X  T   normal-,  T  normal-)     superscript   subscript   t   T    superscript  e      superscript   subscript   t   r     V    subscript  X  τ   τ   d  τ      f   fragments  normal-(   subscript  X  r   normal-,  r  normal-)   d  r  normal-|   subscript  X  t    x  normal-]     E[Y(T)\mid X_{t}=x]=E\left[e^{-\int_{t}^{T}V(X_{\tau},\tau)\,d\tau}u(X_{T},T)+%
 \int_{t}^{T}e^{-\int_{t}^{r}V(X_{\tau},\tau)\,d\tau}f(X_{r},r)\,dr\,\Bigg|\,X_%
 {t}=x\right]     and finally      u   (  x  ,  t  )   =  E   [   e   -     ∫  t  T     V   (   X  τ   ,  τ  )   d  τ      ψ   (   X  T   )   +   ∫  t  T    e   -     ∫  t  s     V   (   X  τ   ,  τ  )   d  τ      f   (   X  s   ,  s  )   d   s   |   X  t   =  x  ]      fragments  u   fragments  normal-(  x  normal-,  t  normal-)    E   fragments  normal-[   superscript  e      superscript   subscript   t   T     V    subscript  X  τ   τ   d  τ      ψ   fragments  normal-(   subscript  X  T   normal-)     superscript   subscript   t   T    superscript  e      superscript   subscript   t   s     V    subscript  X  τ   τ   d  τ      f   fragments  normal-(   subscript  X  s   normal-,  s  normal-)   d  s  normal-|   subscript  X  t    x  normal-]     u(x,t)=E\left[e^{-\int_{t}^{T}V(X_{\tau},\tau)\,d\tau}\psi(X_{T})+\int_{t}^{T}%
 e^{-\int_{t}^{s}V(X_{\tau},\tau)\,d\tau}f(X_{s},s)\,ds\,\Bigg|\,X_{t}=x\right]     Remarks   The proof above is essentially that of 1 with modifications to account for    f   (  x  ,  t  )       f   x  t     f(x,t)   .    The expectation formula above is also valid for N -dimensional Itô diffusions. The corresponding PDE for    u  :     ℝ  N   ×   [  0  ,  T  ]    →  ℝ      normal-:  u   normal-→     superscript  ℝ  N    0  T    ℝ     u:\mathbb{R}^{N}\times[0,T]\to\mathbb{R}   becomes (see H. Pham book below):              ∂  u    ∂  t    +    ∑   i  =  1   N     μ  i    (  x  ,  t  )     ∂  u    ∂   x  i       +    1  2     ∑   i  =  1   N     ∑   j  =  1   N     γ   i  j     (  x  ,  t  )      ∂  2   u    ∂    x  i    x  j           -   r   (  x  ,  t  )   u    =   f   (  x  ,  t  )     ,              u     t      superscript   subscript     i  1    N      subscript  μ  i    x  t       u      subscript  x  i           1  2     superscript   subscript     i  1    N     superscript   subscript     j  1    N      subscript  γ    i  j     x  t       superscript   2   u        subscript  x  i    subscript  x  j             r   x  t   u      f   x  t      \frac{\partial u}{\partial t}+\sum_{i=1}^{N}\mu_{i}(x,t)\frac{\partial u}{%
 \partial x_{i}}+\frac{1}{2}\sum_{i=1}^{N}\sum_{j=1}^{N}\gamma_{ij}(x,t)\frac{%
 \partial^{2}u}{\partial x_{i}x_{j}}-r(x,t)u=f(x,t),         where,            γ   i  j     (  x  ,  t  )    =    ∑   k  =  1   N     σ   i  k     (  x  ,  t  )    σ   j  k     (  x  ,  t  )      ,         subscript  γ    i  j     x  t      superscript   subscript     k  1    N      subscript  σ    i  k     x  t    subscript  σ    j  k     x  t       \gamma_{ij}(x,t)=\sum_{k=1}^{N}\sigma_{ik}(x,t)\sigma_{jk}(x,t),         i.e. γ = σσ′, where σ′ denotes the transpose matrix of σ).    This expectation can then be approximated using Monte Carlo or quasi-Monte Carlo methods .    When originally published by Kac in 1949, 2 the Feynman–Kac formula was presented as a formula for determining the distribution of certain Wiener functionals. Suppose we wish to find the expected value of the function         e   -     ∫  0  t     V   (   x   (  τ  )    )   d  τ        superscript  e      superscript   subscript   0   t     V    x  τ   d  τ       e^{-\int_{0}^{t}V(x(\tau))\,d\tau}         in the case where x (τ) is some realization of a diffusion process starting at x (0) = 0. The Feynman–Kac formula says that this expectation is equivalent to the integral of a solution to a diffusion equation. Specifically, under the conditions that     u  V   (  x  )    ≥  0        u  V  x   0    uV(x)\geq 0   ,          E   [   e   -   u     ∫  0  t     V   (   x   (  τ  )    )   d  τ       ]    =    ∫   -  ∞   ∞    w   (  x  ,  t  )   d  x          E   delimited-[]   superscript  e      u    superscript   subscript   0   t     V    x  τ   d  τ           superscript   subscript            w   x  t   d  x      E\left[e^{-u\int_{0}^{t}V(x(\tau))\,d\tau}\right]=\int_{-\infty}^{\infty}w(x,t%
 )\,dx         where w ( x , 0) = δ( x ) and            ∂  w    ∂  t    =     1  2      ∂  2   w    ∂   x  2      -   u  V   (  x  )   w     .          w     t          1  2       superscript   2   w      superscript  x  2        u  V  x  w      \frac{\partial w}{\partial t}=\frac{1}{2}\frac{\partial^{2}w}{\partial x^{2}}-%
 uV(x)w.         The Feynman–Kac formula can also be interpreted as a method for evaluating functional integrals of a certain form. If         I  =   ∫   f   (   x   (  0  )    )    e   -   u     ∫  0  t     V   (   x   (  t  )    )   d  t       g   (   x   (  t  )    )   D  x        I      f    x  0    superscript  e      u    superscript   subscript   0   t     V    x  t   d  t       g    x  t   D  x      I=\int f(x(0))e^{-u\int_{0}^{t}V(x(t))\,dt}g(x(t))\,Dx         where the integral is taken over all random walks , then         I  =   ∫   w   (  x  ,  t  )   g   (  x  )   d  x        I      w   x  t   g  x  d  x      I=\int w(x,t)g(x)\,dx         where w ( x , t ) is a solution to the parabolic partial differential equation            ∂  w    ∂  t    =     1  2      ∂  2   w    ∂   x  2      -   u  V   (  x  )   w            w     t          1  2       superscript   2   w      superscript  x  2        u  V  x  w      \frac{\partial w}{\partial t}=\frac{1}{2}\frac{\partial^{2}w}{\partial x^{2}}-%
 uV(x)w         with initial condition w ( x , 0) = f ( x ).   See also   Itō's lemma  Kunita–Watanabe theorem  Girsanov theorem  Kolmogorov forward equation (also known as Fokker–Planck equation)   References       "  Category:Stochastic processes  Category:Parabolic partial differential equations  Category:Articles containing proofs     http://www.math.nyu.edu/faculty/kohn/pde_finance.html ↩  This paper is reprinted in Mark Kac: Probability, Number Theory, and Statistical Physics, Selected Papers , edited by K. Baclawski and M.D. Donsker, The MIT Press, Cambridge, Massachusetts, 1979, pp.268-280 ↩     