   Ewald summation      Ewald summation  '''Ewald summation''', named after [[Paul Peter Ewald]], is a method for computing long-range interactions (e.g., Coulombic interactions) in [[periodic system]]s. It was first developed as the method for calculating electrostatic energies of [[ionic crystal]]s, and is now commonly used for calculating long-range interactions in [[computational chemistry]]. Ewald summation is a special case of the [[Poisson summation formula]], replacing the summation of interaction energies in real space with an equivalent summation in Fourier  space . In this method, the long-range interaction is divided into two parts: a short-range contribution, and a long-range contribution which does not have a singularity . The short-range contribution is calculated in real space, whereas the long-range contribution is calculated using a Fourier  transform . The advantage of this method is the rapid convergence of the energy compared with that of a direct summation. This means that the method has high accuracy and reasonable speed when computing long-range interactions, and it is thus the de facto standard method for calculating long-range interactions in periodic systems. The method requires charge neutrality of the molecular system in order to calculate accurately the total Coulombic interaction. A study of the truncation errors introduced in the energy and force calculations of disordered point-charge systems is provided by Kolafa and Perram. 1  Derivation  Ewald summation rewrites the interaction potential as the sum of two terms,       φ   (  𝐫  )      =  def       φ   s  r     (  𝐫  )    +    φ   ℓ  r     (  𝐫  )         superscript   def     φ  𝐫        subscript  φ    s  r    𝐫      subscript  φ    normal-ℓ  r    𝐫      \varphi(\mathbf{r})\ \stackrel{\mathrm{def}}{=}\ \varphi_{sr}(\mathbf{r})+%
 \varphi_{\ell r}(\mathbf{r})   ,  where     φ   s  r     (  𝐫  )        subscript  φ    s  r    𝐫    \varphi_{sr}(\mathbf{r})   represents the short-range term whose sum quickly converges in real space and     φ   ℓ  r     (  𝐫  )        subscript  φ    normal-ℓ  r    𝐫    \varphi_{\ell r}(\mathbf{r})   represents the long-range term whose sum quickly converges in Fourier (reciprocal) space. The long-ranged part should be finite for all arguments (most notably r = 0) but may have any convenient mathematical form, most typically a Gaussian distribution . The method assumes that the short-range part can be summed easily; hence, the problem becomes the summation of the long-range term. Due to the use of the Fourier sum, the method implicitly assumes that the system under study is infinitely periodic (a sensible assumption for the interiors of crystals). One repeating unit of this hypothetical periodic system is called a unit cell . One such cell is chosen as the "central cell" for reference and the remaining cells are called images .  The long-range interaction energy is the sum of interaction energies between the charges of a central unit cell and all the charges of the lattice. Hence, it can be represented as a double integral over two charge density fields representing the fields of the unit cell and the crystal lattice       E   ℓ  r    =   ∬   d   𝐫   d    𝐫  ′     ρ  TOT    (  𝐫  )    ρ   u  c     (   𝐫  ′   )    φ   ℓ  r     (   𝐫  -   𝐫  ′    )          subscript  E    normal-ℓ  r     double-integral    d  𝐫  d   superscript  𝐫  normal-′    subscript  ρ  TOT   𝐫   subscript  ρ    u  c     superscript  𝐫  normal-′    subscript  φ    normal-ℓ  r      𝐫   superscript  𝐫  normal-′        E_{\ell r}=\iint d\mathbf{r}\,d\mathbf{r}^{\prime}\,\rho_{\text{TOT}}(\mathbf{%
 r})\rho_{uc}(\mathbf{r}^{\prime})\ \varphi_{\ell r}(\mathbf{r}-\mathbf{r}^{%
 \prime})     where the unit-cell charge density field     ρ   u  c     (  𝐫  )        subscript  ρ    u  c    𝐫    \rho_{uc}(\mathbf{r})   is a sum over the positions    𝐫  k     subscript  𝐫  k    \mathbf{r}_{k}   of the charges    q  k     subscript  q  k    q_{k}   in the central unit cell        ρ   u  c     (  𝐫  )      =  def      ∑    charges   k      q  k   δ   (   𝐫  -   𝐫  k    )         superscript   def      subscript  ρ    u  c    𝐫     subscript     charges  k       subscript  q  k   δ    𝐫   subscript  𝐫  k        \rho_{uc}(\mathbf{r})\ \stackrel{\mathrm{def}}{=}\ \sum_{\mathrm{charges}\ k}q%
 _{k}\delta(\mathbf{r}-\mathbf{r}_{k})     and the total charge density field     ρ  TOT    (  𝐫  )        subscript  ρ  TOT   𝐫    \rho_{\text{TOT}}(\mathbf{r})   is the same sum over the unit-cell charges    q  k     subscript  q  k    q_{k}   and their periodic images        ρ  TOT    (  𝐫  )      =  def      ∑    n  1   ,   n  2   ,   n  3       ∑    charges   k      q  k   δ   (   𝐫  -   𝐫  k   -    n  1    𝐚  1    -    n  2    𝐚  2    -    n  3    𝐚  3     )          superscript   def      subscript  ρ  TOT   𝐫     subscript     subscript  n  1    subscript  n  2    subscript  n  3       subscript     charges  k       subscript  q  k   δ    𝐫   subscript  𝐫  k      subscript  n  1    subscript  𝐚  1       subscript  n  2    subscript  𝐚  2       subscript  n  3    subscript  𝐚  3          \rho_{\text{TOT}}(\mathbf{r})\ \stackrel{\mathrm{def}}{=}\ \sum_{n_{1},n_{2},n%
 _{3}}\sum_{\mathrm{charges}\ k}q_{k}\delta(\mathbf{r}-\mathbf{r}_{k}-n_{1}%
 \mathbf{a}_{1}-n_{2}\mathbf{a}_{2}-n_{3}\mathbf{a}_{3})     Here,    δ   (  𝐱  )       δ  𝐱    \delta(\mathbf{x})   is the Dirac delta function ,    𝐚  1     subscript  𝐚  1    \mathbf{a}_{1}   ,    𝐚  2     subscript  𝐚  2    \mathbf{a}_{2}   and    𝐚  3     subscript  𝐚  3    \mathbf{a}_{3}   are the lattice vectors and    n  1     subscript  n  1    n_{1}   ,    n  2     subscript  n  2    n_{2}   and    n  3     subscript  n  3    n_{3}   range over all integers. The total field     ρ  TOT    (  𝐫  )        subscript  ρ  TOT   𝐫    \rho_{\text{TOT}}(\mathbf{r})   can be represented as a convolution of     ρ   u  c     (  𝐫  )        subscript  ρ    u  c    𝐫    \rho_{uc}(\mathbf{r})   with a lattice function     L   (  𝐫  )       L  𝐫    L(\mathbf{r})          L   (  𝐫  )      =  def      ∑    n  1   ,   n  2   ,   n  3      δ   (   𝐫  -    n  1    𝐚  1    -    n  2    𝐚  2    -    n  3    𝐚  3     )         superscript   def     L  𝐫     subscript     subscript  n  1    subscript  n  2    subscript  n  3       δ    𝐫     subscript  n  1    subscript  𝐚  1       subscript  n  2    subscript  𝐚  2       subscript  n  3    subscript  𝐚  3         L(\mathbf{r})\ \stackrel{\mathrm{def}}{=}\ \sum_{n_{1},n_{2},n_{3}}\delta(%
 \mathbf{r}-n_{1}\mathbf{a}_{1}-n_{2}\mathbf{a}_{2}-n_{3}\mathbf{a}_{3})     Since this is a convolution , the Fourier transformation of     ρ  TOT    (  𝐫  )        subscript  ρ  TOT   𝐫    \rho_{\text{TOT}}(\mathbf{r})   is a product         ρ  ~   TOT    (  𝐤  )    =    L  ~    (  𝐤  )     ρ  ~    u  c     (  𝐤  )           subscript   normal-~  ρ   TOT   𝐤      normal-~  L   𝐤   subscript   normal-~  ρ     u  c    𝐤     \tilde{\rho}_{\text{TOT}}(\mathbf{k})=\tilde{L}(\mathbf{k})\tilde{\rho}_{uc}(%
 \mathbf{k})     where the Fourier transform of the lattice function is another sum over delta functions        L  ~    (  𝐤  )    =      (   2  π   )   3   Ω     ∑    m  1   ,   m  2   ,   m  3      δ   (   𝐤  -    m  1    𝐛  1    -    m  2    𝐛  2    -    m  3    𝐛  3     )             normal-~  L   𝐤        superscript    2  π   3   normal-Ω     subscript     subscript  m  1    subscript  m  2    subscript  m  3       δ    𝐤     subscript  m  1    subscript  𝐛  1       subscript  m  2    subscript  𝐛  2       subscript  m  3    subscript  𝐛  3          \tilde{L}(\mathbf{k})=\frac{\left(2\pi\right)^{3}}{\Omega}\sum_{m_{1},m_{2},m_%
 {3}}\delta(\mathbf{k}-m_{1}\mathbf{b}_{1}-m_{2}\mathbf{b}_{2}-m_{3}\mathbf{b}_%
 {3})     where the reciprocal space vectors are defined      𝐛  1      =  def       𝐚  2   ×   𝐚  3    Ω       superscript   def    subscript  𝐛  1        subscript  𝐚  2    subscript  𝐚  3    normal-Ω     \mathbf{b}_{1}\ \stackrel{\mathrm{def}}{=}\ \frac{\mathbf{a}_{2}\times\mathbf{%
 a}_{3}}{\Omega}   (and cyclic permutations) where     Ω     =  def      𝐚  1   ⋅   (    𝐚  2   ×   𝐚  3    )        superscript   def   normal-Ω   normal-⋅   subscript  𝐚  1      subscript  𝐚  2    subscript  𝐚  3       \Omega\ \stackrel{\mathrm{def}}{=}\ \mathbf{a}_{1}\cdot\left(\mathbf{a}_{2}%
 \times\mathbf{a}_{3}\right)   is the volume of the central unit cell (if it is geometrically a parallelepiped , which is often but not necessarily the case). Note that both    L   (  𝐫  )       L  𝐫    L(\mathbf{r})   and     L  ~    (  𝐤  )        normal-~  L   𝐤    \tilde{L}(\mathbf{k})   are real, even functions.  For brevity, define an effective single-particle potential       v   (  𝐫  )      =  def     ∫   d    𝐫  ′     ρ   u  c     (   𝐫  ′   )    φ   ℓ  r     (   𝐫  -   𝐫  ′    )         superscript   def     v  𝐫       d   superscript  𝐫  normal-′    subscript  ρ    u  c     superscript  𝐫  normal-′    subscript  φ    normal-ℓ  r      𝐫   superscript  𝐫  normal-′        v(\mathbf{r})\ \stackrel{\mathrm{def}}{=}\ \int d\mathbf{r}^{\prime}\,\rho_{uc%
 }(\mathbf{r}^{\prime})\ \varphi_{\ell r}(\mathbf{r}-\mathbf{r}^{\prime})     Since this is also a convolution, the Fourier transformation of the same equation is a product        V  ~    (  𝐤  )      =  def       ρ  ~    u  c     (  𝐤  )    Φ  ~    (  𝐤  )        superscript   def      normal-~  V   𝐤      subscript   normal-~  ρ     u  c    𝐤   normal-~  normal-Φ   𝐤     \tilde{V}(\mathbf{k})\ \stackrel{\mathrm{def}}{=}\ \tilde{\rho}_{uc}(\mathbf{k%
 })\tilde{\Phi}(\mathbf{k})     where the Fourier transform is defined        V  ~    (  𝐤  )    =   ∫   d   𝐫   v   (  𝐫  )    e   -    i  𝐤   ⋅  𝐫              normal-~  V   𝐤       d  𝐫  v  𝐫   superscript  e     normal-⋅    i  𝐤   𝐫         \tilde{V}(\mathbf{k})=\int d\mathbf{r}\ v(\mathbf{r})\ e^{-i\mathbf{k}\cdot%
 \mathbf{r}}     The energy can now be written as a single field integral       E   ℓ  r    =   ∫   d   𝐫    ρ  TOT    (  𝐫  )   v   (  𝐫  )          subscript  E    normal-ℓ  r        d  𝐫   subscript  ρ  TOT   𝐫  v  𝐫      E_{\ell r}=\int d\mathbf{r}\ \rho_{\text{TOT}}(\mathbf{r})\ v(\mathbf{r})     Using Parseval's theorem , the energy can also be summed in Fourier space       E   ℓ  r    =   ∫      d  𝐤     (   2  π   )   3       ρ  ~   TOT  *    (  𝐤  )    V  ~    (  𝐤  )     =   ∫     d  𝐤     (   2  π   )   3      L  ~   *    (  𝐤  )     |     ρ  ~    u  c     (  𝐤  )    |   2    Φ  ~    (  𝐤  )     =    1  Ω     ∑    m  1   ,   m  2   ,   m  3        |     ρ  ~    u  c     (  𝐤  )    |   2    Φ  ~    (  𝐤  )             subscript  E    normal-ℓ  r            d  𝐤    superscript    2  π   3     superscript   subscript   normal-~  ρ   TOT     𝐤   normal-~  V   𝐤                 d  𝐤    superscript    2  π   3     superscript   normal-~  L     𝐤   superscript       subscript   normal-~  ρ     u  c    𝐤    2    normal-~  normal-Φ   𝐤             1  normal-Ω     subscript     subscript  m  1    subscript  m  2    subscript  m  3        superscript       subscript   normal-~  ρ     u  c    𝐤    2    normal-~  normal-Φ   𝐤        E_{\ell r}=\int\frac{d\mathbf{k}}{\left(2\pi\right)^{3}}\ \tilde{\rho}_{\text{%
 TOT}}^{*}(\mathbf{k})\tilde{V}(\mathbf{k})=\int\frac{d\mathbf{k}}{\left(2\pi%
 \right)^{3}}\tilde{L}^{*}(\mathbf{k})\left|\tilde{\rho}_{uc}(\mathbf{k})\right%
 |^{2}\tilde{\Phi}(\mathbf{k})=\frac{1}{\Omega}\sum_{m_{1},m_{2},m_{3}}\left|%
 \tilde{\rho}_{uc}(\mathbf{k})\right|^{2}\tilde{\Phi}(\mathbf{k})     where    𝐤  =     m  1    𝐛  1    +    m  2    𝐛  2    +    m  3    𝐛  3         𝐤       subscript  m  1    subscript  𝐛  1       subscript  m  2    subscript  𝐛  2       subscript  m  3    subscript  𝐛  3       \mathbf{k}=m_{1}\mathbf{b}_{1}+m_{2}\mathbf{b}_{2}+m_{3}\mathbf{b}_{3}   in the final summation.  This is the essential result. Once      ρ  ~    u  c     (  𝐤  )        subscript   normal-~  ρ     u  c    𝐤    \tilde{\rho}_{uc}(\mathbf{k})   is calculated, the summation/integration over   𝐤   𝐤   \mathbf{k}   is straightforward and should converge quickly. The most common reason for lack of convergence is a poorly defined unit cell, which must be charge neutral to avoid infinite sums.  Particle mesh Ewald (PME) method  Ewald summation was developed as a method in theoretical physics , long before the advent of computers . However, the Ewald method has enjoyed widespread use since the 1970s in computer simulations of particle systems, especially those whose particles interact via an inverse square  force law such as gravity or electrostatics . Applications include simulations of plasmas , galaxies and molecules .  In the particle mesh method, just as in standard Ewald summation, the generic interaction potential is separated into two terms     φ   (  𝐫  )      =  def       φ   s  r     (  𝐫  )    +    φ   ℓ  r     (  𝐫  )         superscript   def     φ  𝐫        subscript  φ    s  r    𝐫      subscript  φ    normal-ℓ  r    𝐫      \varphi(\mathbf{r})\ \stackrel{\mathrm{def}}{=}\ \varphi_{sr}(\mathbf{r})+%
 \varphi_{\ell r}(\mathbf{r})   . The basic idea of particle mesh Ewald summation is to replace the direct summation of interaction energies between point particles       E  TOT   =    ∑   i  ,  j     φ   (    𝐫  j   -   𝐫  i    )     =    E   s  r    +   E   ℓ  r            subscript  E  TOT     subscript    i  j      φ     subscript  𝐫  j    subscript  𝐫  i              subscript  E    s  r     subscript  E    normal-ℓ  r        E_{\text{TOT}}=\sum_{i,j}\varphi(\mathbf{r}_{j}-\mathbf{r}_{i})=E_{sr}+E_{\ell
 r}     with two summations, a direct sum    E   s  r      subscript  E    s  r     E_{sr}   of the short-ranged potential in real space       E   s  r    =    ∑   i  ,  j      φ   s  r     (    𝐫  j   -   𝐫  i    )          subscript  E    s  r      subscript    i  j       subscript  φ    s  r       subscript  𝐫  j    subscript  𝐫  i        E_{sr}=\sum_{i,j}\varphi_{sr}(\mathbf{r}_{j}-\mathbf{r}_{i})     (that is the particle part of particle mesh Ewald ) and a summation in Fourier space of the long-ranged part       E   ℓ  r    =    ∑  𝐤      Φ  ~    ℓ  r     (  𝐤  )     |    ρ  ~    (  𝐤  )    |   2          subscript  E    normal-ℓ  r      subscript   𝐤      subscript   normal-~  normal-Φ     normal-ℓ  r    𝐤   superscript       normal-~  ρ   𝐤    2       E_{\ell r}=\sum_{\mathbf{k}}\tilde{\Phi}_{\ell r}(\mathbf{k})\left|\tilde{\rho%
 }(\mathbf{k})\right|^{2}     where     Φ  ~    ℓ  r      subscript   normal-~  normal-Φ     normal-ℓ  r     \tilde{\Phi}_{\ell r}   and     ρ  ~    (  𝐤  )        normal-~  ρ   𝐤    \tilde{\rho}(\mathbf{k})   represent the Fourier transforms of the potential and the charge density (that's the Ewald part). Since both summations converge quickly in their respective spaces (real and Fourier), they may be truncated with little loss of accuracy and great improvement in required computational time. To evaluate the Fourier transform     ρ  ~    (  𝐤  )        normal-~  ρ   𝐤    \tilde{\rho}(\mathbf{k})   of the charge density field efficiently, one uses the Fast Fourier transform , which requires that the density field be evaluated on a discrete lattice in space (that's the mesh part).  Due to the periodicity assumption implicit in Ewald summation, applications of the PME method to physical systems require the imposition of periodic symmetry. Thus, the method is best suited to systems that can be simulated as infinite in spatial extent. In molecular dynamics simulations this is normally accomplished by deliberately constructing a charge-neutral unit cell that can be infinitely "tiled" to form images; however, to properly account for the effects of this approximation, these images are reincorporated back into the original simulation cell. The overall effect is called a periodic boundary condition . To visualize this most clearly, think of a unit cube; the upper face is effectively in contact with the lower face, the right with the left face, and the front with the back face. As a result the unit cell size must be carefully chosen to be large enough to avoid improper motion correlations between two faces "in contact", but still small enough to be computationally feasible. The definition of the cutoff between short- and long-range interactions can also introduce artifacts.  The restriction of the density field to a mesh makes the PME method more efficient for systems with "smooth" variations in density, or continuous potential functions. Localized systems or those with large fluctuations in density may be treated more efficiently with the fast multipole method of Greengard and Rokhlin.  Dipole term  The electrostatic energy of a polar crystal (i.e., a crystal with a net dipole    𝐩   u  c      subscript  𝐩    u  c     \mathbf{p}_{uc}   in the unit cell) is conditionally convergent , i.e., depends on the order of the summation. For example, if the dipole-dipole interactions of a central unit cell with unit cells located on an ever-increasing cube, the energy converges to a different value than if the interaction energies had been summed spherically. Roughly speaking, this conditional convergence arises because (1) the number of interacting dipoles on a shell of radius   R   R   R   grows like    R  2     superscript  R  2    R^{2}   ; (2) the strength of a single dipole-dipole interaction falls like    1   R  3       1   superscript  R  3     \frac{1}{R^{3}}   ; and (3) the mathematical summation     ∑   n  =  1   ∞    1  n       superscript   subscript     n  1        1  n     \sum_{n=1}^{\infty}\frac{1}{n}   diverges.  This somewhat surprising result can be reconciled with the finite energy of real crystals because such crystals are not infinite, i.e., have a particular boundary. More specifically, the boundary of a polar crystal has an effective surface charge density on its surface    σ  =   𝐏  ⋅  𝐧       σ   normal-⋅  𝐏  𝐧     \sigma=\mathbf{P}\cdot\mathbf{n}   where   𝐧   𝐧   \mathbf{n}   is the surface normal vector and   𝐏   𝐏   \mathbf{P}   represents the net dipole moment per volume. The interaction energy   U   U   U   of the dipole in a central unit cell with that surface charge density can be written 2      U  =    1   2   V   u  c       ∫     (    𝐩   u  c    ⋅  𝐫   )    (    𝐩   u  c    ⋅  𝐧   )   d  S    r  3          U      1    2   subscript  V    u  c             normal-⋅   subscript  𝐩    u  c    𝐫    normal-⋅   subscript  𝐩    u  c    𝐧   d  S    superscript  r  3        U=\frac{1}{2V_{uc}}\int\frac{\left(\mathbf{p}_{uc}\cdot\mathbf{r}\right)\left(%
 \mathbf{p}_{uc}\cdot\mathbf{n}\right)dS}{r^{3}}     where    𝐩   u  c      subscript  𝐩    u  c     \mathbf{p}_{uc}   and    V   u  c      subscript  V    u  c     V_{uc}   are the net dipole moment and volume of the unit cell,    d  S      d  S    dS   is an infinitesimal area on the crystal surface and   𝐫   𝐫   \mathbf{r}   is the vector from the central unit cell to the infinitesimal area. This formula results from integrating the energy     d  U   =   -    𝐩   u  c    ⋅  𝐝𝐄          d  U      normal-⋅   subscript  𝐩    u  c    𝐝𝐄      dU=-\mathbf{p}_{uc}\cdot\mathbf{dE}   where    d  𝐄      d  𝐄    d\mathbf{E}   represents the infinitesimal electric field generated by an infinitesimal surface charge     d   q      =  def     σ  d  S       superscript   def     d  q     σ  d  S     dq\ \stackrel{\mathrm{def}}{=}\ \sigma dS   ( Coulomb's law )       d   𝐄      =  def      (    -  1    4  π  ϵ    )     d   q   𝐫    r  3     =    (    -  1    4  π  ϵ    )      σ   d   S   𝐫    r  3           superscript   def     d  𝐄         1     4  π  ϵ        d  q  𝐫    superscript  r  3                1     4  π  ϵ        σ  d  S  𝐫    superscript  r  3        d\mathbf{E}\ \stackrel{\mathrm{def}}{=}\ \left(\frac{-1}{4\pi\epsilon}\right)%
 \frac{dq\ \mathbf{r}}{r^{3}}=\left(\frac{-1}{4\pi\epsilon}\right)\frac{\sigma%
 \,dS\ \mathbf{r}}{r^{3}}   The negative sign derives from the definition of   𝐫   𝐫   \mathbf{r}   , which points towards the charge, not away from it.  History  The Ewald summation was developed by Paul Peter Ewald in 1921 (see References below) to determine the electrostatic energy (and, hence, the Madelung constant ) of ionic crystals.  Scaling  Generally different Ewald summation methods give different time complexities . Direct calculation gives    O   (   N  2   )       O   superscript  N  2     O(N^{2})   , where   N   N   N   is the number of atoms in the system. The PME method gives    O   (    N    log  N    )       O    N    N      O(N\,\log N)   . 3  See also   Paul Peter Ewald  Madelung constant  Poisson summation formula  Molecular modeling  Wolf summation   References         Schlick T. (2002). Molecular Modeling and Simulation: An Interdisciplinary Guide  Springer-Verlag Interdisciplinary Applied Mathematics, Mathematical Biology, Vol. 21. New York, NY.   "  Category:Electromagnetism  Category:Potential theory  Category:Fourier analysis  Category:Computational chemistry  Category:Theoretical chemistry     ↩  ↩  J. Chem. Phys. 98, 10089 (1993); ↩     