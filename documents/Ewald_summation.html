<html lang="en">
<head>
<meta charset="utf-8"/>
<title offset="1785">Ewald summation</title>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG.js" type="text/javascript">
</script>
</head>
<body>
<h1>Ewald summation</h1>
<hr>'''Ewald summation''', named after [[Paul Peter Ewald]], is a method for computing long-range interactions (e.g., Coulombic interactions) in [[periodic system]]s. It was first developed as the method for calculating electrostatic energies of [[ionic crystal]]s, and is now commonly used for calculating long-range interactions in [[computational chemistry]]. Ewald summation is a special case of the [[Poisson summation formula]], replacing the summation of interaction energies in real
<p><code>space with an equivalent summation in </code><a href="Fourier_space" title="wikilink"><code>Fourier</code> <code>space</code></a><code>. In this method, the long-range interaction is divided into two parts: a short-range contribution, and a long-range contribution which does not have a </code><a href="singularity_(mathematics)" title="wikilink"><code>singularity</code></a><code>. The short-range contribution is calculated in real space, whereas the long-range contribution is calculated using a </code><a href="Fourier_transform" title="wikilink"><code>Fourier</code> <code>transform</code></a><code>. The advantage of this method is the rapid </code><a href="convergence_(mathematics)" title="wikilink"><code>convergence</code></a><code> of the energy compared with that of a direct summation. This means that the method has high accuracy and reasonable speed when computing long-range interactions, and it is thus the de facto standard method for calculating long-range interactions in periodic systems. The method requires charge neutrality of the molecular system in order to calculate accurately the total Coulombic interaction. A study of the truncation errors introduced in the energy and force calculations of disordered point-charge systems is provided by Kolafa and Perram.</code><a class="footnoteRef" href="#fn1" id="fnref1"><sup>1</sup></a></p>
<h2 id="derivation">Derivation</h2>

<p>Ewald summation rewrites the interaction potential as the sum of two terms,</p>

<p>

<math display="block" id="Ewald_summation:0">
 <semantics>
  <mrow>
   <mrow>
    <mi>φ</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>𝐫</mi>
     <mo rspace="7.5pt" stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mpadded width="+5pt">
    <mover>
     <mo movablelimits="false">=</mo>
     <mi>def</mi>
    </mover>
   </mpadded>
   <mrow>
    <mrow>
     <msub>
      <mi>φ</mi>
      <mrow>
       <mi>s</mi>
       <mi>r</mi>
      </mrow>
     </msub>
     <mrow>
      <mo stretchy="false">(</mo>
      <mi>𝐫</mi>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
    <mo>+</mo>
    <mrow>
     <msub>
      <mi>φ</mi>
      <mrow>
       <mi mathvariant="normal">ℓ</mi>
       <mi>r</mi>
      </mrow>
     </msub>
     <mrow>
      <mo stretchy="false">(</mo>
      <mi>𝐫</mi>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <eq></eq>
     <ci>def</ci>
    </apply>
    <apply>
     <times></times>
     <ci>φ</ci>
     <ci>𝐫</ci>
    </apply>
    <apply>
     <plus></plus>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>φ</ci>
       <apply>
        <times></times>
        <ci>s</ci>
        <ci>r</ci>
       </apply>
      </apply>
      <ci>𝐫</ci>
     </apply>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>φ</ci>
       <apply>
        <times></times>
        <ci>normal-ℓ</ci>
        <ci>r</ci>
       </apply>
      </apply>
      <ci>𝐫</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \varphi(\mathbf{r})\ \stackrel{\mathrm{def}}{=}\ \varphi_{sr}(\mathbf{r})+%
\varphi_{\ell r}(\mathbf{r})
  </annotation>
 </semantics>
</math>

,</p>

<p>where 

<math display="inline" id="Ewald_summation:1">
 <semantics>
  <mrow>
   <msub>
    <mi>φ</mi>
    <mrow>
     <mi>s</mi>
     <mi>r</mi>
    </mrow>
   </msub>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>𝐫</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>φ</ci>
     <apply>
      <times></times>
      <ci>s</ci>
      <ci>r</ci>
     </apply>
    </apply>
    <ci>𝐫</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \varphi_{sr}(\mathbf{r})
  </annotation>
 </semantics>
</math>

 represents the short-range term whose sum quickly converges in real space and 

<math display="inline" id="Ewald_summation:2">
 <semantics>
  <mrow>
   <msub>
    <mi>φ</mi>
    <mrow>
     <mi mathvariant="normal">ℓ</mi>
     <mi>r</mi>
    </mrow>
   </msub>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>𝐫</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>φ</ci>
     <apply>
      <times></times>
      <ci>normal-ℓ</ci>
      <ci>r</ci>
     </apply>
    </apply>
    <ci>𝐫</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \varphi_{\ell r}(\mathbf{r})
  </annotation>
 </semantics>
</math>

 represents the long-range term whose sum quickly converges in Fourier (reciprocal) space. The long-ranged part should be finite for all arguments (most notably <em>r</em> = 0) but may have any convenient mathematical form, most typically a <a href="Gaussian_distribution" title="wikilink">Gaussian distribution</a>. The method assumes that the short-range part can be summed easily; hence, the problem becomes the summation of the long-range term. Due to the use of the Fourier sum, the method implicitly assumes that the system under study is infinitely <a href="Periodic_boundary_conditions" title="wikilink">periodic</a> (a sensible assumption for the interiors of crystals). One repeating unit of this hypothetical periodic system is called a <em>unit cell</em>. One such cell is chosen as the "central cell" for reference and the remaining cells are called <em>images</em>.</p>

<p>The long-range interaction energy is the sum of interaction energies between the charges of a central unit cell and all the charges of the lattice. Hence, it can be represented as a <em>double</em> integral over two charge density fields representing the fields of the unit cell and the crystal lattice</p>

<p>

<math display="block" id="Ewald_summation:3">
 <semantics>
  <mrow>
   <msub>
    <mi>E</mi>
    <mrow>
     <mi mathvariant="normal">ℓ</mi>
     <mi>r</mi>
    </mrow>
   </msub>
   <mo>=</mo>
   <mrow>
    <mo largeop="true" symmetric="true">∬</mo>
    <mrow>
     <mi>d</mi>
     <mpadded width="+1.7pt">
      <mi>𝐫</mi>
     </mpadded>
     <mi>d</mi>
     <mpadded width="+1.7pt">
      <msup>
       <mi>𝐫</mi>
       <mo>′</mo>
      </msup>
     </mpadded>
     <msub>
      <mi>ρ</mi>
      <mtext>TOT</mtext>
     </msub>
     <mrow>
      <mo stretchy="false">(</mo>
      <mi>𝐫</mi>
      <mo stretchy="false">)</mo>
     </mrow>
     <msub>
      <mi>ρ</mi>
      <mrow>
       <mi>u</mi>
       <mi>c</mi>
      </mrow>
     </msub>
     <mrow>
      <mo stretchy="false">(</mo>
      <msup>
       <mi>𝐫</mi>
       <mo>′</mo>
      </msup>
      <mo rspace="7.5pt" stretchy="false">)</mo>
     </mrow>
     <msub>
      <mi>φ</mi>
      <mrow>
       <mi mathvariant="normal">ℓ</mi>
       <mi>r</mi>
      </mrow>
     </msub>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <mi>𝐫</mi>
       <mo>-</mo>
       <msup>
        <mi>𝐫</mi>
        <mo>′</mo>
       </msup>
      </mrow>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>E</ci>
     <apply>
      <times></times>
      <ci>normal-ℓ</ci>
      <ci>r</ci>
     </apply>
    </apply>
    <apply>
     <csymbol cd="latexml">double-integral</csymbol>
     <apply>
      <times></times>
      <ci>d</ci>
      <ci>𝐫</ci>
      <ci>d</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>𝐫</ci>
       <ci>normal-′</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>ρ</ci>
       <mtext>TOT</mtext>
      </apply>
      <ci>𝐫</ci>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>ρ</ci>
       <apply>
        <times></times>
        <ci>u</ci>
        <ci>c</ci>
       </apply>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>𝐫</ci>
       <ci>normal-′</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>φ</ci>
       <apply>
        <times></times>
        <ci>normal-ℓ</ci>
        <ci>r</ci>
       </apply>
      </apply>
      <apply>
       <minus></minus>
       <ci>𝐫</ci>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>𝐫</ci>
        <ci>normal-′</ci>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   E_{\ell r}=\iint d\mathbf{r}\,d\mathbf{r}^{\prime}\,\rho_{\text{TOT}}(\mathbf{%
r})\rho_{uc}(\mathbf{r}^{\prime})\ \varphi_{\ell r}(\mathbf{r}-\mathbf{r}^{%
\prime})
  </annotation>
 </semantics>
</math>

</p>

<p>where the unit-cell charge density field 

<math display="inline" id="Ewald_summation:4">
 <semantics>
  <mrow>
   <msub>
    <mi>ρ</mi>
    <mrow>
     <mi>u</mi>
     <mi>c</mi>
    </mrow>
   </msub>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>𝐫</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>ρ</ci>
     <apply>
      <times></times>
      <ci>u</ci>
      <ci>c</ci>
     </apply>
    </apply>
    <ci>𝐫</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \rho_{uc}(\mathbf{r})
  </annotation>
 </semantics>
</math>

 is a sum over the positions 

<math display="inline" id="Ewald_summation:5">
 <semantics>
  <msub>
   <mi>𝐫</mi>
   <mi>k</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>𝐫</ci>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{r}_{k}
  </annotation>
 </semantics>
</math>

 of the charges 

<math display="inline" id="Ewald_summation:6">
 <semantics>
  <msub>
   <mi>q</mi>
   <mi>k</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>q</ci>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   q_{k}
  </annotation>
 </semantics>
</math>

 in the central unit cell</p>

<p>

<math display="block" id="Ewald_summation:7">
 <semantics>
  <mrow>
   <mrow>
    <msub>
     <mi>ρ</mi>
     <mrow>
      <mi>u</mi>
      <mi>c</mi>
     </mrow>
    </msub>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>𝐫</mi>
     <mo rspace="7.5pt" stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mpadded width="+5pt">
    <mover>
     <mo movablelimits="false">=</mo>
     <mi>def</mi>
    </mover>
   </mpadded>
   <mrow>
    <munder>
     <mo largeop="true" movablelimits="false" symmetric="true">∑</mo>
     <mrow>
      <mpadded width="+5pt">
       <mi>charges</mi>
      </mpadded>
      <mi>k</mi>
     </mrow>
    </munder>
    <mrow>
     <msub>
      <mi>q</mi>
      <mi>k</mi>
     </msub>
     <mi>δ</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <mi>𝐫</mi>
       <mo>-</mo>
       <msub>
        <mi>𝐫</mi>
        <mi>k</mi>
       </msub>
      </mrow>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <eq></eq>
     <ci>def</ci>
    </apply>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>ρ</ci>
      <apply>
       <times></times>
       <ci>u</ci>
       <ci>c</ci>
      </apply>
     </apply>
     <ci>𝐫</ci>
    </apply>
    <apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <sum></sum>
      <apply>
       <times></times>
       <ci>charges</ci>
       <ci>k</ci>
      </apply>
     </apply>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>q</ci>
       <ci>k</ci>
      </apply>
      <ci>δ</ci>
      <apply>
       <minus></minus>
       <ci>𝐫</ci>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>𝐫</ci>
        <ci>k</ci>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \rho_{uc}(\mathbf{r})\ \stackrel{\mathrm{def}}{=}\ \sum_{\mathrm{charges}\ k}q%
_{k}\delta(\mathbf{r}-\mathbf{r}_{k})
  </annotation>
 </semantics>
</math>

</p>

<p>and the <em>total</em> charge density field 

<math display="inline" id="Ewald_summation:8">
 <semantics>
  <mrow>
   <msub>
    <mi>ρ</mi>
    <mtext>TOT</mtext>
   </msub>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>𝐫</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>ρ</ci>
     <mtext>TOT</mtext>
    </apply>
    <ci>𝐫</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \rho_{\text{TOT}}(\mathbf{r})
  </annotation>
 </semantics>
</math>

 is the same sum over the unit-cell charges 

<math display="inline" id="Ewald_summation:9">
 <semantics>
  <msub>
   <mi>q</mi>
   <mi>k</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>q</ci>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   q_{k}
  </annotation>
 </semantics>
</math>

 and their periodic images</p>

<p>

<math display="block" id="Ewald_summation:10">
 <semantics>
  <mrow>
   <mrow>
    <msub>
     <mi>ρ</mi>
     <mtext>TOT</mtext>
    </msub>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>𝐫</mi>
     <mo rspace="7.5pt" stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mpadded width="+5pt">
    <mover>
     <mo movablelimits="false">=</mo>
     <mi>def</mi>
    </mover>
   </mpadded>
   <mrow>
    <munder>
     <mo largeop="true" movablelimits="false" symmetric="true">∑</mo>
     <mrow>
      <msub>
       <mi>n</mi>
       <mn>1</mn>
      </msub>
      <mo>,</mo>
      <msub>
       <mi>n</mi>
       <mn>2</mn>
      </msub>
      <mo>,</mo>
      <msub>
       <mi>n</mi>
       <mn>3</mn>
      </msub>
     </mrow>
    </munder>
    <mrow>
     <munder>
      <mo largeop="true" movablelimits="false" symmetric="true">∑</mo>
      <mrow>
       <mpadded width="+5pt">
        <mi>charges</mi>
       </mpadded>
       <mi>k</mi>
      </mrow>
     </munder>
     <mrow>
      <msub>
       <mi>q</mi>
       <mi>k</mi>
      </msub>
      <mi>δ</mi>
      <mrow>
       <mo stretchy="false">(</mo>
       <mrow>
        <mi>𝐫</mi>
        <mo>-</mo>
        <msub>
         <mi>𝐫</mi>
         <mi>k</mi>
        </msub>
        <mo>-</mo>
        <mrow>
         <msub>
          <mi>n</mi>
          <mn>1</mn>
         </msub>
         <msub>
          <mi>𝐚</mi>
          <mn>1</mn>
         </msub>
        </mrow>
        <mo>-</mo>
        <mrow>
         <msub>
          <mi>n</mi>
          <mn>2</mn>
         </msub>
         <msub>
          <mi>𝐚</mi>
          <mn>2</mn>
         </msub>
        </mrow>
        <mo>-</mo>
        <mrow>
         <msub>
          <mi>n</mi>
          <mn>3</mn>
         </msub>
         <msub>
          <mi>𝐚</mi>
          <mn>3</mn>
         </msub>
        </mrow>
       </mrow>
       <mo stretchy="false">)</mo>
      </mrow>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <eq></eq>
     <ci>def</ci>
    </apply>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>ρ</ci>
      <mtext>TOT</mtext>
     </apply>
     <ci>𝐫</ci>
    </apply>
    <apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <sum></sum>
      <list>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>n</ci>
        <cn type="integer">1</cn>
       </apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>n</ci>
        <cn type="integer">2</cn>
       </apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>n</ci>
        <cn type="integer">3</cn>
       </apply>
      </list>
     </apply>
     <apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <sum></sum>
       <apply>
        <times></times>
        <ci>charges</ci>
        <ci>k</ci>
       </apply>
      </apply>
      <apply>
       <times></times>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>q</ci>
        <ci>k</ci>
       </apply>
       <ci>δ</ci>
       <apply>
        <minus></minus>
        <ci>𝐫</ci>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>𝐫</ci>
         <ci>k</ci>
        </apply>
        <apply>
         <times></times>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>n</ci>
          <cn type="integer">1</cn>
         </apply>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>𝐚</ci>
          <cn type="integer">1</cn>
         </apply>
        </apply>
        <apply>
         <times></times>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>n</ci>
          <cn type="integer">2</cn>
         </apply>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>𝐚</ci>
          <cn type="integer">2</cn>
         </apply>
        </apply>
        <apply>
         <times></times>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>n</ci>
          <cn type="integer">3</cn>
         </apply>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>𝐚</ci>
          <cn type="integer">3</cn>
         </apply>
        </apply>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \rho_{\text{TOT}}(\mathbf{r})\ \stackrel{\mathrm{def}}{=}\ \sum_{n_{1},n_{2},n%
_{3}}\sum_{\mathrm{charges}\ k}q_{k}\delta(\mathbf{r}-\mathbf{r}_{k}-n_{1}%
\mathbf{a}_{1}-n_{2}\mathbf{a}_{2}-n_{3}\mathbf{a}_{3})
  </annotation>
 </semantics>
</math>

</p>

<p>Here, 

<math display="inline" id="Ewald_summation:11">
 <semantics>
  <mrow>
   <mi>δ</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>𝐱</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>δ</ci>
    <ci>𝐱</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \delta(\mathbf{x})
  </annotation>
 </semantics>
</math>

 is the <a href="Dirac_delta_function" title="wikilink">Dirac delta function</a>, 

<math display="inline" id="Ewald_summation:12">
 <semantics>
  <msub>
   <mi>𝐚</mi>
   <mn>1</mn>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>𝐚</ci>
    <cn type="integer">1</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{a}_{1}
  </annotation>
 </semantics>
</math>

, 

<math display="inline" id="Ewald_summation:13">
 <semantics>
  <msub>
   <mi>𝐚</mi>
   <mn>2</mn>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>𝐚</ci>
    <cn type="integer">2</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{a}_{2}
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="Ewald_summation:14">
 <semantics>
  <msub>
   <mi>𝐚</mi>
   <mn>3</mn>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>𝐚</ci>
    <cn type="integer">3</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{a}_{3}
  </annotation>
 </semantics>
</math>

 are the lattice vectors and 

<math display="inline" id="Ewald_summation:15">
 <semantics>
  <msub>
   <mi>n</mi>
   <mn>1</mn>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>n</ci>
    <cn type="integer">1</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   n_{1}
  </annotation>
 </semantics>
</math>

, 

<math display="inline" id="Ewald_summation:16">
 <semantics>
  <msub>
   <mi>n</mi>
   <mn>2</mn>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>n</ci>
    <cn type="integer">2</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   n_{2}
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="Ewald_summation:17">
 <semantics>
  <msub>
   <mi>n</mi>
   <mn>3</mn>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>n</ci>
    <cn type="integer">3</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   n_{3}
  </annotation>
 </semantics>
</math>

 range over all integers. The total field 

<math display="inline" id="Ewald_summation:18">
 <semantics>
  <mrow>
   <msub>
    <mi>ρ</mi>
    <mtext>TOT</mtext>
   </msub>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>𝐫</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>ρ</ci>
     <mtext>TOT</mtext>
    </apply>
    <ci>𝐫</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \rho_{\text{TOT}}(\mathbf{r})
  </annotation>
 </semantics>
</math>

 can be represented as a <a class="uri" href="convolution" title="wikilink">convolution</a> of 

<math display="inline" id="Ewald_summation:19">
 <semantics>
  <mrow>
   <msub>
    <mi>ρ</mi>
    <mrow>
     <mi>u</mi>
     <mi>c</mi>
    </mrow>
   </msub>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>𝐫</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>ρ</ci>
     <apply>
      <times></times>
      <ci>u</ci>
      <ci>c</ci>
     </apply>
    </apply>
    <ci>𝐫</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \rho_{uc}(\mathbf{r})
  </annotation>
 </semantics>
</math>

 with a <em>lattice function</em> 

<math display="inline" id="Ewald_summation:20">
 <semantics>
  <mrow>
   <mi>L</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>𝐫</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>L</ci>
    <ci>𝐫</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   L(\mathbf{r})
  </annotation>
 </semantics>
</math>

</p>

<p>

<math display="block" id="Ewald_summation:21">
 <semantics>
  <mrow>
   <mrow>
    <mi>L</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>𝐫</mi>
     <mo rspace="7.5pt" stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mpadded width="+5pt">
    <mover>
     <mo movablelimits="false">=</mo>
     <mi>def</mi>
    </mover>
   </mpadded>
   <mrow>
    <munder>
     <mo largeop="true" movablelimits="false" symmetric="true">∑</mo>
     <mrow>
      <msub>
       <mi>n</mi>
       <mn>1</mn>
      </msub>
      <mo>,</mo>
      <msub>
       <mi>n</mi>
       <mn>2</mn>
      </msub>
      <mo>,</mo>
      <msub>
       <mi>n</mi>
       <mn>3</mn>
      </msub>
     </mrow>
    </munder>
    <mrow>
     <mi>δ</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <mi>𝐫</mi>
       <mo>-</mo>
       <mrow>
        <msub>
         <mi>n</mi>
         <mn>1</mn>
        </msub>
        <msub>
         <mi>𝐚</mi>
         <mn>1</mn>
        </msub>
       </mrow>
       <mo>-</mo>
       <mrow>
        <msub>
         <mi>n</mi>
         <mn>2</mn>
        </msub>
        <msub>
         <mi>𝐚</mi>
         <mn>2</mn>
        </msub>
       </mrow>
       <mo>-</mo>
       <mrow>
        <msub>
         <mi>n</mi>
         <mn>3</mn>
        </msub>
        <msub>
         <mi>𝐚</mi>
         <mn>3</mn>
        </msub>
       </mrow>
      </mrow>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <eq></eq>
     <ci>def</ci>
    </apply>
    <apply>
     <times></times>
     <ci>L</ci>
     <ci>𝐫</ci>
    </apply>
    <apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <sum></sum>
      <list>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>n</ci>
        <cn type="integer">1</cn>
       </apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>n</ci>
        <cn type="integer">2</cn>
       </apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>n</ci>
        <cn type="integer">3</cn>
       </apply>
      </list>
     </apply>
     <apply>
      <times></times>
      <ci>δ</ci>
      <apply>
       <minus></minus>
       <ci>𝐫</ci>
       <apply>
        <times></times>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>n</ci>
         <cn type="integer">1</cn>
        </apply>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>𝐚</ci>
         <cn type="integer">1</cn>
        </apply>
       </apply>
       <apply>
        <times></times>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>n</ci>
         <cn type="integer">2</cn>
        </apply>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>𝐚</ci>
         <cn type="integer">2</cn>
        </apply>
       </apply>
       <apply>
        <times></times>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>n</ci>
         <cn type="integer">3</cn>
        </apply>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>𝐚</ci>
         <cn type="integer">3</cn>
        </apply>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   L(\mathbf{r})\ \stackrel{\mathrm{def}}{=}\ \sum_{n_{1},n_{2},n_{3}}\delta(%
\mathbf{r}-n_{1}\mathbf{a}_{1}-n_{2}\mathbf{a}_{2}-n_{3}\mathbf{a}_{3})
  </annotation>
 </semantics>
</math>

</p>

<p>Since this is a <a class="uri" href="convolution" title="wikilink">convolution</a>, the <a href="Fourier_transformation" title="wikilink">Fourier transformation</a> of 

<math display="inline" id="Ewald_summation:22">
 <semantics>
  <mrow>
   <msub>
    <mi>ρ</mi>
    <mtext>TOT</mtext>
   </msub>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>𝐫</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>ρ</ci>
     <mtext>TOT</mtext>
    </apply>
    <ci>𝐫</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \rho_{\text{TOT}}(\mathbf{r})
  </annotation>
 </semantics>
</math>

 is a product</p>

<p>

<math display="block" id="Ewald_summation:23">
 <semantics>
  <mrow>
   <mrow>
    <msub>
     <mover accent="true">
      <mi>ρ</mi>
      <mo stretchy="false">~</mo>
     </mover>
     <mtext>TOT</mtext>
    </msub>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>𝐤</mi>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mover accent="true">
     <mi>L</mi>
     <mo stretchy="false">~</mo>
    </mover>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>𝐤</mi>
     <mo stretchy="false">)</mo>
    </mrow>
    <msub>
     <mover accent="true">
      <mi>ρ</mi>
      <mo stretchy="false">~</mo>
     </mover>
     <mrow>
      <mi>u</mi>
      <mi>c</mi>
     </mrow>
    </msub>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>𝐤</mi>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <apply>
       <ci>normal-~</ci>
       <ci>ρ</ci>
      </apply>
      <mtext>TOT</mtext>
     </apply>
     <ci>𝐤</ci>
    </apply>
    <apply>
     <times></times>
     <apply>
      <ci>normal-~</ci>
      <ci>L</ci>
     </apply>
     <ci>𝐤</ci>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <apply>
       <ci>normal-~</ci>
       <ci>ρ</ci>
      </apply>
      <apply>
       <times></times>
       <ci>u</ci>
       <ci>c</ci>
      </apply>
     </apply>
     <ci>𝐤</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \tilde{\rho}_{\text{TOT}}(\mathbf{k})=\tilde{L}(\mathbf{k})\tilde{\rho}_{uc}(%
\mathbf{k})
  </annotation>
 </semantics>
</math>

</p>

<p>where the Fourier transform of the lattice function is another sum over delta functions</p>

<p>

<math display="block" id="Ewald_summation:24">
 <semantics>
  <mrow>
   <mrow>
    <mover accent="true">
     <mi>L</mi>
     <mo stretchy="false">~</mo>
    </mover>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>𝐤</mi>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mfrac>
     <msup>
      <mrow>
       <mo>(</mo>
       <mrow>
        <mn>2</mn>
        <mi>π</mi>
       </mrow>
       <mo>)</mo>
      </mrow>
      <mn>3</mn>
     </msup>
     <mi mathvariant="normal">Ω</mi>
    </mfrac>
    <mrow>
     <munder>
      <mo largeop="true" movablelimits="false" symmetric="true">∑</mo>
      <mrow>
       <msub>
        <mi>m</mi>
        <mn>1</mn>
       </msub>
       <mo>,</mo>
       <msub>
        <mi>m</mi>
        <mn>2</mn>
       </msub>
       <mo>,</mo>
       <msub>
        <mi>m</mi>
        <mn>3</mn>
       </msub>
      </mrow>
     </munder>
     <mrow>
      <mi>δ</mi>
      <mrow>
       <mo stretchy="false">(</mo>
       <mrow>
        <mi>𝐤</mi>
        <mo>-</mo>
        <mrow>
         <msub>
          <mi>m</mi>
          <mn>1</mn>
         </msub>
         <msub>
          <mi>𝐛</mi>
          <mn>1</mn>
         </msub>
        </mrow>
        <mo>-</mo>
        <mrow>
         <msub>
          <mi>m</mi>
          <mn>2</mn>
         </msub>
         <msub>
          <mi>𝐛</mi>
          <mn>2</mn>
         </msub>
        </mrow>
        <mo>-</mo>
        <mrow>
         <msub>
          <mi>m</mi>
          <mn>3</mn>
         </msub>
         <msub>
          <mi>𝐛</mi>
          <mn>3</mn>
         </msub>
        </mrow>
       </mrow>
       <mo stretchy="false">)</mo>
      </mrow>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <apply>
      <ci>normal-~</ci>
      <ci>L</ci>
     </apply>
     <ci>𝐤</ci>
    </apply>
    <apply>
     <times></times>
     <apply>
      <divide></divide>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>π</ci>
       </apply>
       <cn type="integer">3</cn>
      </apply>
      <ci>normal-Ω</ci>
     </apply>
     <apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <sum></sum>
       <list>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>m</ci>
         <cn type="integer">1</cn>
        </apply>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>m</ci>
         <cn type="integer">2</cn>
        </apply>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>m</ci>
         <cn type="integer">3</cn>
        </apply>
       </list>
      </apply>
      <apply>
       <times></times>
       <ci>δ</ci>
       <apply>
        <minus></minus>
        <ci>𝐤</ci>
        <apply>
         <times></times>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>m</ci>
          <cn type="integer">1</cn>
         </apply>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>𝐛</ci>
          <cn type="integer">1</cn>
         </apply>
        </apply>
        <apply>
         <times></times>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>m</ci>
          <cn type="integer">2</cn>
         </apply>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>𝐛</ci>
          <cn type="integer">2</cn>
         </apply>
        </apply>
        <apply>
         <times></times>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>m</ci>
          <cn type="integer">3</cn>
         </apply>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>𝐛</ci>
          <cn type="integer">3</cn>
         </apply>
        </apply>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \tilde{L}(\mathbf{k})=\frac{\left(2\pi\right)^{3}}{\Omega}\sum_{m_{1},m_{2},m_%
{3}}\delta(\mathbf{k}-m_{1}\mathbf{b}_{1}-m_{2}\mathbf{b}_{2}-m_{3}\mathbf{b}_%
{3})
  </annotation>
 </semantics>
</math>

</p>

<p>where the reciprocal space vectors are defined 

<math display="inline" id="Ewald_summation:25">
 <semantics>
  <mrow>
   <mpadded width="+5pt">
    <msub>
     <mi>𝐛</mi>
     <mn>1</mn>
    </msub>
   </mpadded>
   <mpadded width="+5pt">
    <mover>
     <mo movablelimits="false">=</mo>
     <mi>def</mi>
    </mover>
   </mpadded>
   <mfrac>
    <mrow>
     <msub>
      <mi>𝐚</mi>
      <mn>2</mn>
     </msub>
     <mo>×</mo>
     <msub>
      <mi>𝐚</mi>
      <mn>3</mn>
     </msub>
    </mrow>
    <mi mathvariant="normal">Ω</mi>
   </mfrac>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <eq></eq>
     <ci>def</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>𝐛</ci>
     <cn type="integer">1</cn>
    </apply>
    <apply>
     <divide></divide>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>𝐚</ci>
       <cn type="integer">2</cn>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>𝐚</ci>
       <cn type="integer">3</cn>
      </apply>
     </apply>
     <ci>normal-Ω</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{b}_{1}\ \stackrel{\mathrm{def}}{=}\ \frac{\mathbf{a}_{2}\times\mathbf{%
a}_{3}}{\Omega}
  </annotation>
 </semantics>
</math>

 (and cyclic permutations) where 

<math display="inline" id="Ewald_summation:26">
 <semantics>
  <mrow>
   <mpadded width="+5pt">
    <mi mathvariant="normal">Ω</mi>
   </mpadded>
   <mpadded width="+5pt">
    <mover>
     <mo movablelimits="false">=</mo>
     <mi>def</mi>
    </mover>
   </mpadded>
   <mrow>
    <msub>
     <mi>𝐚</mi>
     <mn>1</mn>
    </msub>
    <mo>⋅</mo>
    <mrow>
     <mo>(</mo>
     <mrow>
      <msub>
       <mi>𝐚</mi>
       <mn>2</mn>
      </msub>
      <mo>×</mo>
      <msub>
       <mi>𝐚</mi>
       <mn>3</mn>
      </msub>
     </mrow>
     <mo>)</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <eq></eq>
     <ci>def</ci>
    </apply>
    <ci>normal-Ω</ci>
    <apply>
     <ci>normal-⋅</ci>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>𝐚</ci>
      <cn type="integer">1</cn>
     </apply>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>𝐚</ci>
       <cn type="integer">2</cn>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>𝐚</ci>
       <cn type="integer">3</cn>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Omega\ \stackrel{\mathrm{def}}{=}\ \mathbf{a}_{1}\cdot\left(\mathbf{a}_{2}%
\times\mathbf{a}_{3}\right)
  </annotation>
 </semantics>
</math>

 is the volume of the central unit cell (if it is geometrically a <a class="uri" href="parallelepiped" title="wikilink">parallelepiped</a>, which is often but not necessarily the case). Note that both 

<math display="inline" id="Ewald_summation:27">
 <semantics>
  <mrow>
   <mi>L</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>𝐫</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>L</ci>
    <ci>𝐫</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   L(\mathbf{r})
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="Ewald_summation:28">
 <semantics>
  <mrow>
   <mover accent="true">
    <mi>L</mi>
    <mo stretchy="false">~</mo>
   </mover>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>𝐤</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <ci>normal-~</ci>
     <ci>L</ci>
    </apply>
    <ci>𝐤</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \tilde{L}(\mathbf{k})
  </annotation>
 </semantics>
</math>


 are real, even functions.</p>

<p>For brevity, define an effective single-particle potential</p>

<p>

<math display="block" id="Ewald_summation:29">
 <semantics>
  <mrow>
   <mrow>
    <mi>v</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>𝐫</mi>
     <mo rspace="7.5pt" stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mpadded width="+5pt">
    <mover>
     <mo movablelimits="false">=</mo>
     <mi>def</mi>
    </mover>
   </mpadded>
   <mrow>
    <mo largeop="true" symmetric="true">∫</mo>
    <mrow>
     <mi>d</mi>
     <mpadded width="+1.7pt">
      <msup>
       <mi>𝐫</mi>
       <mo>′</mo>
      </msup>
     </mpadded>
     <msub>
      <mi>ρ</mi>
      <mrow>
       <mi>u</mi>
       <mi>c</mi>
      </mrow>
     </msub>
     <mrow>
      <mo stretchy="false">(</mo>
      <msup>
       <mi>𝐫</mi>
       <mo>′</mo>
      </msup>
      <mo rspace="7.5pt" stretchy="false">)</mo>
     </mrow>
     <msub>
      <mi>φ</mi>
      <mrow>
       <mi mathvariant="normal">ℓ</mi>
       <mi>r</mi>
      </mrow>
     </msub>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <mi>𝐫</mi>
       <mo>-</mo>
       <msup>
        <mi>𝐫</mi>
        <mo>′</mo>
       </msup>
      </mrow>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <eq></eq>
     <ci>def</ci>
    </apply>
    <apply>
     <times></times>
     <ci>v</ci>
     <ci>𝐫</ci>
    </apply>
    <apply>
     <int></int>
     <apply>
      <times></times>
      <ci>d</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>𝐫</ci>
       <ci>normal-′</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>ρ</ci>
       <apply>
        <times></times>
        <ci>u</ci>
        <ci>c</ci>
       </apply>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>𝐫</ci>
       <ci>normal-′</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>φ</ci>
       <apply>
        <times></times>
        <ci>normal-ℓ</ci>
        <ci>r</ci>
       </apply>
      </apply>
      <apply>
       <minus></minus>
       <ci>𝐫</ci>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>𝐫</ci>
        <ci>normal-′</ci>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   v(\mathbf{r})\ \stackrel{\mathrm{def}}{=}\ \int d\mathbf{r}^{\prime}\,\rho_{uc%
}(\mathbf{r}^{\prime})\ \varphi_{\ell r}(\mathbf{r}-\mathbf{r}^{\prime})
  </annotation>
 </semantics>
</math>

</p>

<p>Since this is also a convolution, the Fourier transformation of the same equation is a product</p>

<p>

<math display="block" id="Ewald_summation:30">
 <semantics>
  <mrow>
   <mrow>
    <mover accent="true">
     <mi>V</mi>
     <mo stretchy="false">~</mo>
    </mover>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>𝐤</mi>
     <mo rspace="7.5pt" stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mpadded width="+5pt">
    <mover>
     <mo movablelimits="false">=</mo>
     <mi>def</mi>
    </mover>
   </mpadded>
   <mrow>
    <msub>
     <mover accent="true">
      <mi>ρ</mi>
      <mo stretchy="false">~</mo>
     </mover>
     <mrow>
      <mi>u</mi>
      <mi>c</mi>
     </mrow>
    </msub>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>𝐤</mi>
     <mo stretchy="false">)</mo>
    </mrow>
    <mover accent="true">
     <mi mathvariant="normal">Φ</mi>
     <mo stretchy="false">~</mo>
    </mover>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>𝐤</mi>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <eq></eq>
     <ci>def</ci>
    </apply>
    <apply>
     <times></times>
     <apply>
      <ci>normal-~</ci>
      <ci>V</ci>
     </apply>
     <ci>𝐤</ci>
    </apply>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <apply>
       <ci>normal-~</ci>
       <ci>ρ</ci>
      </apply>
      <apply>
       <times></times>
       <ci>u</ci>
       <ci>c</ci>
      </apply>
     </apply>
     <ci>𝐤</ci>
     <apply>
      <ci>normal-~</ci>
      <ci>normal-Φ</ci>
     </apply>
     <ci>𝐤</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \tilde{V}(\mathbf{k})\ \stackrel{\mathrm{def}}{=}\ \tilde{\rho}_{uc}(\mathbf{k%
})\tilde{\Phi}(\mathbf{k})
  </annotation>
 </semantics>
</math>

</p>

<p>where the Fourier transform is defined</p>

<p>

<math display="block" id="Ewald_summation:31">
 <semantics>
  <mrow>
   <mrow>
    <mover accent="true">
     <mi>V</mi>
     <mo stretchy="false">~</mo>
    </mover>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>𝐤</mi>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mo largeop="true" symmetric="true">∫</mo>
    <mrow>
     <mi>d</mi>
     <mpadded width="+5pt">
      <mi>𝐫</mi>
     </mpadded>
     <mi>v</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mi>𝐫</mi>
      <mo rspace="7.5pt" stretchy="false">)</mo>
     </mrow>
     <msup>
      <mi>e</mi>
      <mrow>
       <mo>-</mo>
       <mrow>
        <mrow>
         <mi>i</mi>
         <mi>𝐤</mi>
        </mrow>
        <mo>⋅</mo>
        <mi>𝐫</mi>
       </mrow>
      </mrow>
     </msup>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <apply>
      <ci>normal-~</ci>
      <ci>V</ci>
     </apply>
     <ci>𝐤</ci>
    </apply>
    <apply>
     <int></int>
     <apply>
      <times></times>
      <ci>d</ci>
      <ci>𝐫</ci>
      <ci>v</ci>
      <ci>𝐫</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>e</ci>
       <apply>
        <minus></minus>
        <apply>
         <ci>normal-⋅</ci>
         <apply>
          <times></times>
          <ci>i</ci>
          <ci>𝐤</ci>
         </apply>
         <ci>𝐫</ci>
        </apply>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \tilde{V}(\mathbf{k})=\int d\mathbf{r}\ v(\mathbf{r})\ e^{-i\mathbf{k}\cdot%
\mathbf{r}}
  </annotation>
 </semantics>
</math>

</p>

<p>The energy can now be written as a <em>single</em> field integral</p>

<p>

<math display="block" id="Ewald_summation:32">
 <semantics>
  <mrow>
   <msub>
    <mi>E</mi>
    <mrow>
     <mi mathvariant="normal">ℓ</mi>
     <mi>r</mi>
    </mrow>
   </msub>
   <mo>=</mo>
   <mrow>
    <mo largeop="true" symmetric="true">∫</mo>
    <mrow>
     <mi>d</mi>
     <mpadded width="+5pt">
      <mi>𝐫</mi>
     </mpadded>
     <msub>
      <mi>ρ</mi>
      <mtext>TOT</mtext>
     </msub>
     <mrow>
      <mo stretchy="false">(</mo>
      <mi>𝐫</mi>
      <mo rspace="7.5pt" stretchy="false">)</mo>
     </mrow>
     <mi>v</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mi>𝐫</mi>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>E</ci>
     <apply>
      <times></times>
      <ci>normal-ℓ</ci>
      <ci>r</ci>
     </apply>
    </apply>
    <apply>
     <int></int>
     <apply>
      <times></times>
      <ci>d</ci>
      <ci>𝐫</ci>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>ρ</ci>
       <mtext>TOT</mtext>
      </apply>
      <ci>𝐫</ci>
      <ci>v</ci>
      <ci>𝐫</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   E_{\ell r}=\int d\mathbf{r}\ \rho_{\text{TOT}}(\mathbf{r})\ v(\mathbf{r})
  </annotation>
 </semantics>
</math>

</p>

<p>Using <a href="Parseval's_theorem" title="wikilink">Parseval's theorem</a>, the energy can also be summed in Fourier space</p>

<p>

<math display="block" id="Ewald_summation:33">
 <semantics>
  <mrow>
   <msub>
    <mi>E</mi>
    <mrow>
     <mi mathvariant="normal">ℓ</mi>
     <mi>r</mi>
    </mrow>
   </msub>
   <mo>=</mo>
   <mrow>
    <mo largeop="true" symmetric="true">∫</mo>
    <mrow>
     <mpadded width="+5pt">
      <mfrac>
       <mrow>
        <mi>d</mi>
        <mi>𝐤</mi>
       </mrow>
       <msup>
        <mrow>
         <mo>(</mo>
         <mrow>
          <mn>2</mn>
          <mi>π</mi>
         </mrow>
         <mo>)</mo>
        </mrow>
        <mn>3</mn>
       </msup>
      </mfrac>
     </mpadded>
     <msubsup>
      <mover accent="true">
       <mi>ρ</mi>
       <mo stretchy="false">~</mo>
      </mover>
      <mtext>TOT</mtext>
      <mo>*</mo>
     </msubsup>
     <mrow>
      <mo stretchy="false">(</mo>
      <mi>𝐤</mi>
      <mo stretchy="false">)</mo>
     </mrow>
     <mover accent="true">
      <mi>V</mi>
      <mo stretchy="false">~</mo>
     </mover>
     <mrow>
      <mo stretchy="false">(</mo>
      <mi>𝐤</mi>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mo largeop="true" symmetric="true">∫</mo>
    <mrow>
     <mfrac>
      <mrow>
       <mi>d</mi>
       <mi>𝐤</mi>
      </mrow>
      <msup>
       <mrow>
        <mo>(</mo>
        <mrow>
         <mn>2</mn>
         <mi>π</mi>
        </mrow>
        <mo>)</mo>
       </mrow>
       <mn>3</mn>
      </msup>
     </mfrac>
     <msup>
      <mover accent="true">
       <mi>L</mi>
       <mo stretchy="false">~</mo>
      </mover>
      <mo>*</mo>
     </msup>
     <mrow>
      <mo stretchy="false">(</mo>
      <mi>𝐤</mi>
      <mo stretchy="false">)</mo>
     </mrow>
     <msup>
      <mrow>
       <mo>|</mo>
       <mrow>
        <msub>
         <mover accent="true">
          <mi>ρ</mi>
          <mo stretchy="false">~</mo>
         </mover>
         <mrow>
          <mi>u</mi>
          <mi>c</mi>
         </mrow>
        </msub>
        <mrow>
         <mo stretchy="false">(</mo>
         <mi>𝐤</mi>
         <mo stretchy="false">)</mo>
        </mrow>
       </mrow>
       <mo>|</mo>
      </mrow>
      <mn>2</mn>
     </msup>
     <mover accent="true">
      <mi mathvariant="normal">Φ</mi>
      <mo stretchy="false">~</mo>
     </mover>
     <mrow>
      <mo stretchy="false">(</mo>
      <mi>𝐤</mi>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mfrac>
     <mn>1</mn>
     <mi mathvariant="normal">Ω</mi>
    </mfrac>
    <mrow>
     <munder>
      <mo largeop="true" movablelimits="false" symmetric="true">∑</mo>
      <mrow>
       <msub>
        <mi>m</mi>
        <mn>1</mn>
       </msub>
       <mo>,</mo>
       <msub>
        <mi>m</mi>
        <mn>2</mn>
       </msub>
       <mo>,</mo>
       <msub>
        <mi>m</mi>
        <mn>3</mn>
       </msub>
      </mrow>
     </munder>
     <mrow>
      <msup>
       <mrow>
        <mo>|</mo>
        <mrow>
         <msub>
          <mover accent="true">
           <mi>ρ</mi>
           <mo stretchy="false">~</mo>
          </mover>
          <mrow>
           <mi>u</mi>
           <mi>c</mi>
          </mrow>
         </msub>
         <mrow>
          <mo stretchy="false">(</mo>
          <mi>𝐤</mi>
          <mo stretchy="false">)</mo>
         </mrow>
        </mrow>
        <mo>|</mo>
       </mrow>
       <mn>2</mn>
      </msup>
      <mover accent="true">
       <mi mathvariant="normal">Φ</mi>
       <mo stretchy="false">~</mo>
      </mover>
      <mrow>
       <mo stretchy="false">(</mo>
       <mi>𝐤</mi>
       <mo stretchy="false">)</mo>
      </mrow>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <and></and>
    <apply>
     <eq></eq>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>E</ci>
      <apply>
       <times></times>
       <ci>normal-ℓ</ci>
       <ci>r</ci>
      </apply>
     </apply>
     <apply>
      <int></int>
      <apply>
       <times></times>
       <apply>
        <divide></divide>
        <apply>
         <times></times>
         <ci>d</ci>
         <ci>𝐤</ci>
        </apply>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <times></times>
          <cn type="integer">2</cn>
          <ci>π</ci>
         </apply>
         <cn type="integer">3</cn>
        </apply>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <apply>
          <ci>normal-~</ci>
          <ci>ρ</ci>
         </apply>
         <mtext>TOT</mtext>
        </apply>
        <times></times>
       </apply>
       <ci>𝐤</ci>
       <apply>
        <ci>normal-~</ci>
        <ci>V</ci>
       </apply>
       <ci>𝐤</ci>
      </apply>
     </apply>
    </apply>
    <apply>
     <eq></eq>
     <share href="#.cmml">
     </share>
     <apply>
      <int></int>
      <apply>
       <times></times>
       <apply>
        <divide></divide>
        <apply>
         <times></times>
         <ci>d</ci>
         <ci>𝐤</ci>
        </apply>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <times></times>
          <cn type="integer">2</cn>
          <ci>π</ci>
         </apply>
         <cn type="integer">3</cn>
        </apply>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <ci>normal-~</ci>
         <ci>L</ci>
        </apply>
        <times></times>
       </apply>
       <ci>𝐤</ci>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <abs></abs>
         <apply>
          <times></times>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <apply>
            <ci>normal-~</ci>
            <ci>ρ</ci>
           </apply>
           <apply>
            <times></times>
            <ci>u</ci>
            <ci>c</ci>
           </apply>
          </apply>
          <ci>𝐤</ci>
         </apply>
        </apply>
        <cn type="integer">2</cn>
       </apply>
       <apply>
        <ci>normal-~</ci>
        <ci>normal-Φ</ci>
       </apply>
       <ci>𝐤</ci>
      </apply>
     </apply>
    </apply>
    <apply>
     <eq></eq>
     <share href="#.cmml">
     </share>
     <apply>
      <times></times>
      <apply>
       <divide></divide>
       <cn type="integer">1</cn>
       <ci>normal-Ω</ci>
      </apply>
      <apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <sum></sum>
        <list>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>m</ci>
          <cn type="integer">1</cn>
         </apply>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>m</ci>
          <cn type="integer">2</cn>
         </apply>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>m</ci>
          <cn type="integer">3</cn>
         </apply>
        </list>
       </apply>
       <apply>
        <times></times>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <abs></abs>
          <apply>
           <times></times>
           <apply>
            <csymbol cd="ambiguous">subscript</csymbol>
            <apply>
             <ci>normal-~</ci>
             <ci>ρ</ci>
            </apply>
            <apply>
             <times></times>
             <ci>u</ci>
             <ci>c</ci>
            </apply>
           </apply>
           <ci>𝐤</ci>
          </apply>
         </apply>
         <cn type="integer">2</cn>
        </apply>
        <apply>
         <ci>normal-~</ci>
         <ci>normal-Φ</ci>
        </apply>
        <ci>𝐤</ci>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   E_{\ell r}=\int\frac{d\mathbf{k}}{\left(2\pi\right)^{3}}\ \tilde{\rho}_{\text{%
TOT}}^{*}(\mathbf{k})\tilde{V}(\mathbf{k})=\int\frac{d\mathbf{k}}{\left(2\pi%
\right)^{3}}\tilde{L}^{*}(\mathbf{k})\left|\tilde{\rho}_{uc}(\mathbf{k})\right%
|^{2}\tilde{\Phi}(\mathbf{k})=\frac{1}{\Omega}\sum_{m_{1},m_{2},m_{3}}\left|%
\tilde{\rho}_{uc}(\mathbf{k})\right|^{2}\tilde{\Phi}(\mathbf{k})
  </annotation>
 </semantics>
</math>

</p>

<p>where 

<math display="inline" id="Ewald_summation:34">
 <semantics>
  <mrow>
   <mi>𝐤</mi>
   <mo>=</mo>
   <mrow>
    <mrow>
     <msub>
      <mi>m</mi>
      <mn>1</mn>
     </msub>
     <msub>
      <mi>𝐛</mi>
      <mn>1</mn>
     </msub>
    </mrow>
    <mo>+</mo>
    <mrow>
     <msub>
      <mi>m</mi>
      <mn>2</mn>
     </msub>
     <msub>
      <mi>𝐛</mi>
      <mn>2</mn>
     </msub>
    </mrow>
    <mo>+</mo>
    <mrow>
     <msub>
      <mi>m</mi>
      <mn>3</mn>
     </msub>
     <msub>
      <mi>𝐛</mi>
      <mn>3</mn>
     </msub>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>𝐤</ci>
    <apply>
     <plus></plus>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>m</ci>
       <cn type="integer">1</cn>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>𝐛</ci>
       <cn type="integer">1</cn>
      </apply>
     </apply>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>m</ci>
       <cn type="integer">2</cn>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>𝐛</ci>
       <cn type="integer">2</cn>
      </apply>
     </apply>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>m</ci>
       <cn type="integer">3</cn>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>𝐛</ci>
       <cn type="integer">3</cn>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{k}=m_{1}\mathbf{b}_{1}+m_{2}\mathbf{b}_{2}+m_{3}\mathbf{b}_{3}
  </annotation>
 </semantics>
</math>

 in the final summation.</p>

<p>This is the essential result. Once 

<math display="inline" id="Ewald_summation:35">
 <semantics>
  <mrow>
   <msub>
    <mover accent="true">
     <mi>ρ</mi>
     <mo stretchy="false">~</mo>
    </mover>
    <mrow>
     <mi>u</mi>
     <mi>c</mi>
    </mrow>
   </msub>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>𝐤</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <apply>
      <ci>normal-~</ci>
      <ci>ρ</ci>
     </apply>
     <apply>
      <times></times>
      <ci>u</ci>
      <ci>c</ci>
     </apply>
    </apply>
    <ci>𝐤</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \tilde{\rho}_{uc}(\mathbf{k})
  </annotation>
 </semantics>
</math>

 is calculated, the summation/integration over 

<math display="inline" id="Ewald_summation:36">
 <semantics>
  <mi>𝐤</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>𝐤</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{k}
  </annotation>
 </semantics>
</math>

 is straightforward and should converge quickly. The most common reason for lack of convergence is a poorly defined unit cell, which must be charge neutral to avoid infinite sums.</p>
<h2 id="particle-mesh-ewald-pme-method">Particle mesh Ewald (PME) method</h2>

<p>Ewald summation was developed as a method in <a href="theoretical_physics" title="wikilink">theoretical physics</a>, long before the advent of <a href="computer" title="wikilink">computers</a>. However, the Ewald method has enjoyed widespread use since the 1970s in <a href="computer_simulation" title="wikilink">computer simulations</a> of particle systems, especially those whose particles interact via an <a href="inverse_square_law" title="wikilink">inverse square</a> <a class="uri" href="force" title="wikilink">force</a> law such as <a class="uri" href="gravity" title="wikilink">gravity</a> or <a class="uri" href="electrostatics" title="wikilink">electrostatics</a>. Applications include simulations of <a href="plasma_(physics)" title="wikilink">plasmas</a>, <a href="galaxy" title="wikilink">galaxies</a> and <a class="uri" href="molecules" title="wikilink">molecules</a>.</p>

<p>In the particle mesh method, just as in standard Ewald summation, the generic interaction potential is separated into two terms 

<math display="inline" id="Ewald_summation:37">
 <semantics>
  <mrow>
   <mrow>
    <mi>φ</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>𝐫</mi>
     <mo rspace="7.5pt" stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mpadded width="+5pt">
    <mover>
     <mo movablelimits="false">=</mo>
     <mi>def</mi>
    </mover>
   </mpadded>
   <mrow>
    <mrow>
     <msub>
      <mi>φ</mi>
      <mrow>
       <mi>s</mi>
       <mi>r</mi>
      </mrow>
     </msub>
     <mrow>
      <mo stretchy="false">(</mo>
      <mi>𝐫</mi>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
    <mo>+</mo>
    <mrow>
     <msub>
      <mi>φ</mi>
      <mrow>
       <mi mathvariant="normal">ℓ</mi>
       <mi>r</mi>
      </mrow>
     </msub>
     <mrow>
      <mo stretchy="false">(</mo>
      <mi>𝐫</mi>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <eq></eq>
     <ci>def</ci>
    </apply>
    <apply>
     <times></times>
     <ci>φ</ci>
     <ci>𝐫</ci>
    </apply>
    <apply>
     <plus></plus>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>φ</ci>
       <apply>
        <times></times>
        <ci>s</ci>
        <ci>r</ci>
       </apply>
      </apply>
      <ci>𝐫</ci>
     </apply>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>φ</ci>
       <apply>
        <times></times>
        <ci>normal-ℓ</ci>
        <ci>r</ci>
       </apply>
      </apply>
      <ci>𝐫</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \varphi(\mathbf{r})\ \stackrel{\mathrm{def}}{=}\ \varphi_{sr}(\mathbf{r})+%
\varphi_{\ell r}(\mathbf{r})
  </annotation>
 </semantics>
</math>

. The basic idea of particle mesh Ewald summation is to replace the direct summation of interaction energies between point particles</p>

<p>

<math display="block" id="Ewald_summation:38">
 <semantics>
  <mrow>
   <msub>
    <mi>E</mi>
    <mtext>TOT</mtext>
   </msub>
   <mo>=</mo>
   <mrow>
    <munder>
     <mo largeop="true" movablelimits="false" symmetric="true">∑</mo>
     <mrow>
      <mi>i</mi>
      <mo>,</mo>
      <mi>j</mi>
     </mrow>
    </munder>
    <mrow>
     <mi>φ</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <msub>
        <mi>𝐫</mi>
        <mi>j</mi>
       </msub>
       <mo>-</mo>
       <msub>
        <mi>𝐫</mi>
        <mi>i</mi>
       </msub>
      </mrow>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <msub>
     <mi>E</mi>
     <mrow>
      <mi>s</mi>
      <mi>r</mi>
     </mrow>
    </msub>
    <mo>+</mo>
    <msub>
     <mi>E</mi>
     <mrow>
      <mi mathvariant="normal">ℓ</mi>
      <mi>r</mi>
     </mrow>
    </msub>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <and></and>
    <apply>
     <eq></eq>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>E</ci>
      <mtext>TOT</mtext>
     </apply>
     <apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <sum></sum>
       <list>
        <ci>i</ci>
        <ci>j</ci>
       </list>
      </apply>
      <apply>
       <times></times>
       <ci>φ</ci>
       <apply>
        <minus></minus>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>𝐫</ci>
         <ci>j</ci>
        </apply>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>𝐫</ci>
         <ci>i</ci>
        </apply>
       </apply>
      </apply>
     </apply>
    </apply>
    <apply>
     <eq></eq>
     <share href="#.cmml">
     </share>
     <apply>
      <plus></plus>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>E</ci>
       <apply>
        <times></times>
        <ci>s</ci>
        <ci>r</ci>
       </apply>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>E</ci>
       <apply>
        <times></times>
        <ci>normal-ℓ</ci>
        <ci>r</ci>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   E_{\text{TOT}}=\sum_{i,j}\varphi(\mathbf{r}_{j}-\mathbf{r}_{i})=E_{sr}+E_{\ell
r}
  </annotation>
 </semantics>
</math>

</p>

<p>with two summations, a direct sum 

<math display="inline" id="Ewald_summation:39">
 <semantics>
  <msub>
   <mi>E</mi>
   <mrow>
    <mi>s</mi>
    <mi>r</mi>
   </mrow>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>E</ci>
    <apply>
     <times></times>
     <ci>s</ci>
     <ci>r</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   E_{sr}
  </annotation>
 </semantics>
</math>

 of the short-ranged potential in real space</p>

<p>

<math display="block" id="Ewald_summation:40">
 <semantics>
  <mrow>
   <msub>
    <mi>E</mi>
    <mrow>
     <mi>s</mi>
     <mi>r</mi>
    </mrow>
   </msub>
   <mo>=</mo>
   <mrow>
    <munder>
     <mo largeop="true" movablelimits="false" symmetric="true">∑</mo>
     <mrow>
      <mi>i</mi>
      <mo>,</mo>
      <mi>j</mi>
     </mrow>
    </munder>
    <mrow>
     <msub>
      <mi>φ</mi>
      <mrow>
       <mi>s</mi>
       <mi>r</mi>
      </mrow>
     </msub>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <msub>
        <mi>𝐫</mi>
        <mi>j</mi>
       </msub>
       <mo>-</mo>
       <msub>
        <mi>𝐫</mi>
        <mi>i</mi>
       </msub>
      </mrow>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>E</ci>
     <apply>
      <times></times>
      <ci>s</ci>
      <ci>r</ci>
     </apply>
    </apply>
    <apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <sum></sum>
      <list>
       <ci>i</ci>
       <ci>j</ci>
      </list>
     </apply>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>φ</ci>
       <apply>
        <times></times>
        <ci>s</ci>
        <ci>r</ci>
       </apply>
      </apply>
      <apply>
       <minus></minus>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>𝐫</ci>
        <ci>j</ci>
       </apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>𝐫</ci>
        <ci>i</ci>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   E_{sr}=\sum_{i,j}\varphi_{sr}(\mathbf{r}_{j}-\mathbf{r}_{i})
  </annotation>
 </semantics>
</math>

</p>

<p>(that is the <strong>particle</strong> part of <strong>particle mesh Ewald</strong>) and a summation in Fourier space of the long-ranged part</p>

<p>

<math display="block" id="Ewald_summation:41">
 <semantics>
  <mrow>
   <msub>
    <mi>E</mi>
    <mrow>
     <mi mathvariant="normal">ℓ</mi>
     <mi>r</mi>
    </mrow>
   </msub>
   <mo>=</mo>
   <mrow>
    <munder>
     <mo largeop="true" movablelimits="false" symmetric="true">∑</mo>
     <mi>𝐤</mi>
    </munder>
    <mrow>
     <msub>
      <mover accent="true">
       <mi mathvariant="normal">Φ</mi>
       <mo stretchy="false">~</mo>
      </mover>
      <mrow>
       <mi mathvariant="normal">ℓ</mi>
       <mi>r</mi>
      </mrow>
     </msub>
     <mrow>
      <mo stretchy="false">(</mo>
      <mi>𝐤</mi>
      <mo stretchy="false">)</mo>
     </mrow>
     <msup>
      <mrow>
       <mo>|</mo>
       <mrow>
        <mover accent="true">
         <mi>ρ</mi>
         <mo stretchy="false">~</mo>
        </mover>
        <mrow>
         <mo stretchy="false">(</mo>
         <mi>𝐤</mi>
         <mo stretchy="false">)</mo>
        </mrow>
       </mrow>
       <mo>|</mo>
      </mrow>
      <mn>2</mn>
     </msup>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>E</ci>
     <apply>
      <times></times>
      <ci>normal-ℓ</ci>
      <ci>r</ci>
     </apply>
    </apply>
    <apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <sum></sum>
      <ci>𝐤</ci>
     </apply>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <apply>
        <ci>normal-~</ci>
        <ci>normal-Φ</ci>
       </apply>
       <apply>
        <times></times>
        <ci>normal-ℓ</ci>
        <ci>r</ci>
       </apply>
      </apply>
      <ci>𝐤</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <abs></abs>
        <apply>
         <times></times>
         <apply>
          <ci>normal-~</ci>
          <ci>ρ</ci>
         </apply>
         <ci>𝐤</ci>
        </apply>
       </apply>
       <cn type="integer">2</cn>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   E_{\ell r}=\sum_{\mathbf{k}}\tilde{\Phi}_{\ell r}(\mathbf{k})\left|\tilde{\rho%
}(\mathbf{k})\right|^{2}
  </annotation>
 </semantics>
</math>

</p>

<p>where 

<math display="inline" id="Ewald_summation:42">
 <semantics>
  <msub>
   <mover accent="true">
    <mi mathvariant="normal">Φ</mi>
    <mo stretchy="false">~</mo>
   </mover>
   <mrow>
    <mi mathvariant="normal">ℓ</mi>
    <mi>r</mi>
   </mrow>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <apply>
     <ci>normal-~</ci>
     <ci>normal-Φ</ci>
    </apply>
    <apply>
     <times></times>
     <ci>normal-ℓ</ci>
     <ci>r</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \tilde{\Phi}_{\ell r}
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="Ewald_summation:43">
 <semantics>
  <mrow>
   <mover accent="true">
    <mi>ρ</mi>
    <mo stretchy="false">~</mo>
   </mover>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>𝐤</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <ci>normal-~</ci>
     <ci>ρ</ci>
    </apply>
    <ci>𝐤</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \tilde{\rho}(\mathbf{k})
  </annotation>
 </semantics>
</math>

 represent the <a href="Fourier_transform" title="wikilink">Fourier transforms</a> of the <a class="uri" href="potential" title="wikilink">potential</a> and the <a href="charge_density" title="wikilink">charge density</a> (that's the <strong>Ewald</strong> part). Since both summations converge quickly in their respective spaces (real and Fourier), they may be truncated with little loss of accuracy and great improvement in required computational time. To evaluate the Fourier transform 

<math display="inline" id="Ewald_summation:44">
 <semantics>
  <mrow>
   <mover accent="true">
    <mi>ρ</mi>
    <mo stretchy="false">~</mo>
   </mover>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>𝐤</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <ci>normal-~</ci>
     <ci>ρ</ci>
    </apply>
    <ci>𝐤</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \tilde{\rho}(\mathbf{k})
  </annotation>
 </semantics>
</math>

 of the charge density field efficiently, one uses the <a href="Fast_Fourier_transform" title="wikilink">Fast Fourier transform</a>, which requires that the density field be evaluated on a discrete lattice in space (that's the <strong>mesh</strong> part).</p>

<p>Due to the periodicity assumption implicit in Ewald summation, applications of the PME method to physical systems require the imposition of periodic symmetry. Thus, the method is best suited to systems that can be simulated as infinite in spatial extent. In <a href="molecular_dynamics" title="wikilink">molecular dynamics</a> simulations this is normally accomplished by deliberately constructing a charge-neutral unit cell that can be infinitely "tiled" to form images; however, to properly account for the effects of this approximation, these images are reincorporated back into the original simulation cell. The overall effect is called a <a href="periodic_boundary_conditions" title="wikilink">periodic boundary condition</a>. To visualize this most clearly, think of a unit cube; the upper face is effectively in contact with the lower face, the right with the left face, and the front with the back face. As a result the unit cell size must be carefully chosen to be large enough to avoid improper motion correlations between two faces "in contact", but still small enough to be computationally feasible. The definition of the cutoff between short- and long-range interactions can also introduce artifacts.</p>

<p>The restriction of the density field to a mesh makes the PME method more efficient for systems with "smooth" variations in density, or continuous potential functions. Localized systems or those with large fluctuations in density may be treated more efficiently with the <a href="fast_multipole_method" title="wikilink">fast multipole method</a> of Greengard and Rokhlin.</p>
<h2 id="dipole-term">Dipole term</h2>

<p>The electrostatic energy of a polar crystal (i.e., a crystal with a net dipole 

<math display="inline" id="Ewald_summation:45">
 <semantics>
  <msub>
   <mi>𝐩</mi>
   <mrow>
    <mi>u</mi>
    <mi>c</mi>
   </mrow>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>𝐩</ci>
    <apply>
     <times></times>
     <ci>u</ci>
     <ci>c</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{p}_{uc}
  </annotation>
 </semantics>
</math>

 in the unit cell) is <a href="conditionally_convergent" title="wikilink">conditionally convergent</a>, i.e., depends on the order of the summation. For example, if the dipole-dipole interactions of a central unit cell with unit cells located on an ever-increasing cube, the energy converges to a different value than if the interaction energies had been summed spherically. Roughly speaking, this conditional convergence arises because (1) the number of interacting dipoles on a shell of radius 

<math display="inline" id="Ewald_summation:46">
 <semantics>
  <mi>R</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>R</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   R
  </annotation>
 </semantics>
</math>

 grows like 

<math display="inline" id="Ewald_summation:47">
 <semantics>
  <msup>
   <mi>R</mi>
   <mn>2</mn>
  </msup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <ci>R</ci>
    <cn type="integer">2</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   R^{2}
  </annotation>
 </semantics>
</math>

; (2) the strength of a single dipole-dipole interaction falls like 

<math display="inline" id="Ewald_summation:48">
 <semantics>
  <mfrac>
   <mn>1</mn>
   <msup>
    <mi>R</mi>
    <mn>3</mn>
   </msup>
  </mfrac>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <divide></divide>
    <cn type="integer">1</cn>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>R</ci>
     <cn type="integer">3</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \frac{1}{R^{3}}
  </annotation>
 </semantics>
</math>

; and (3) the mathematical summation 

<math display="inline" id="Ewald_summation:49">
 <semantics>
  <mrow>
   <msubsup>
    <mo largeop="true" symmetric="true">∑</mo>
    <mrow>
     <mi>n</mi>
     <mo>=</mo>
     <mn>1</mn>
    </mrow>
    <mi mathvariant="normal">∞</mi>
   </msubsup>
   <mfrac>
    <mn>1</mn>
    <mi>n</mi>
   </mfrac>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <sum></sum>
      <apply>
       <eq></eq>
       <ci>n</ci>
       <cn type="integer">1</cn>
      </apply>
     </apply>
     <infinity></infinity>
    </apply>
    <apply>
     <divide></divide>
     <cn type="integer">1</cn>
     <ci>n</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \sum_{n=1}^{\infty}\frac{1}{n}
  </annotation>
 </semantics>
</math>

 diverges.</p>

<p>This somewhat surprising result can be reconciled with the finite energy of real crystals because such crystals are not infinite, i.e., have a particular boundary. More specifically, the boundary of a polar crystal has an effective surface charge density on its surface 

<math display="inline" id="Ewald_summation:50">
 <semantics>
  <mrow>
   <mi>σ</mi>
   <mo>=</mo>
   <mrow>
    <mi>𝐏</mi>
    <mo>⋅</mo>
    <mi>𝐧</mi>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>σ</ci>
    <apply>
     <ci>normal-⋅</ci>
     <ci>𝐏</ci>
     <ci>𝐧</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \sigma=\mathbf{P}\cdot\mathbf{n}
  </annotation>
 </semantics>
</math>

 where 

<math display="inline" id="Ewald_summation:51">
 <semantics>
  <mi>𝐧</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>𝐧</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{n}
  </annotation>
 </semantics>
</math>

 is the surface normal vector and 

<math display="inline" id="Ewald_summation:52">
 <semantics>
  <mi>𝐏</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>𝐏</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{P}
  </annotation>
 </semantics>
</math>

 represents the net dipole moment per volume. The interaction energy 

<math display="inline" id="Ewald_summation:53">
 <semantics>
  <mi>U</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>U</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   U
  </annotation>
 </semantics>
</math>

 of the dipole in a central unit cell with that surface charge density can be written<a class="footnoteRef" href="#fn2" id="fnref2"><sup>2</sup></a></p>

<p>

<math display="block" id="Ewald_summation:54">
 <semantics>
  <mrow>
   <mi>U</mi>
   <mo>=</mo>
   <mrow>
    <mfrac>
     <mn>1</mn>
     <mrow>
      <mn>2</mn>
      <msub>
       <mi>V</mi>
       <mrow>
        <mi>u</mi>
        <mi>c</mi>
       </mrow>
      </msub>
     </mrow>
    </mfrac>
    <mrow>
     <mo largeop="true" symmetric="true">∫</mo>
     <mfrac>
      <mrow>
       <mrow>
        <mo>(</mo>
        <mrow>
         <msub>
          <mi>𝐩</mi>
          <mrow>
           <mi>u</mi>
           <mi>c</mi>
          </mrow>
         </msub>
         <mo>⋅</mo>
         <mi>𝐫</mi>
        </mrow>
        <mo>)</mo>
       </mrow>
       <mrow>
        <mo>(</mo>
        <mrow>
         <msub>
          <mi>𝐩</mi>
          <mrow>
           <mi>u</mi>
           <mi>c</mi>
          </mrow>
         </msub>
         <mo>⋅</mo>
         <mi>𝐧</mi>
        </mrow>
        <mo>)</mo>
       </mrow>
       <mi>d</mi>
       <mi>S</mi>
      </mrow>
      <msup>
       <mi>r</mi>
       <mn>3</mn>
      </msup>
     </mfrac>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>U</ci>
    <apply>
     <times></times>
     <apply>
      <divide></divide>
      <cn type="integer">1</cn>
      <apply>
       <times></times>
       <cn type="integer">2</cn>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>V</ci>
        <apply>
         <times></times>
         <ci>u</ci>
         <ci>c</ci>
        </apply>
       </apply>
      </apply>
     </apply>
     <apply>
      <int></int>
      <apply>
       <divide></divide>
       <apply>
        <times></times>
        <apply>
         <ci>normal-⋅</ci>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>𝐩</ci>
          <apply>
           <times></times>
           <ci>u</ci>
           <ci>c</ci>
          </apply>
         </apply>
         <ci>𝐫</ci>
        </apply>
        <apply>
         <ci>normal-⋅</ci>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>𝐩</ci>
          <apply>
           <times></times>
           <ci>u</ci>
           <ci>c</ci>
          </apply>
         </apply>
         <ci>𝐧</ci>
        </apply>
        <ci>d</ci>
        <ci>S</ci>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>r</ci>
        <cn type="integer">3</cn>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   U=\frac{1}{2V_{uc}}\int\frac{\left(\mathbf{p}_{uc}\cdot\mathbf{r}\right)\left(%
\mathbf{p}_{uc}\cdot\mathbf{n}\right)dS}{r^{3}}
  </annotation>
 </semantics>
</math>

</p>

<p>where 

<math display="inline" id="Ewald_summation:55">
 <semantics>
  <msub>
   <mi>𝐩</mi>
   <mrow>
    <mi>u</mi>
    <mi>c</mi>
   </mrow>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>𝐩</ci>
    <apply>
     <times></times>
     <ci>u</ci>
     <ci>c</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{p}_{uc}
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="Ewald_summation:56">
 <semantics>
  <msub>
   <mi>V</mi>
   <mrow>
    <mi>u</mi>
    <mi>c</mi>
   </mrow>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>V</ci>
    <apply>
     <times></times>
     <ci>u</ci>
     <ci>c</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   V_{uc}
  </annotation>
 </semantics>
</math>

 are the net dipole moment and volume of the unit cell, 

<math display="inline" id="Ewald_summation:57">
 <semantics>
  <mrow>
   <mi>d</mi>
   <mi>S</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>d</ci>
    <ci>S</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   dS
  </annotation>
 </semantics>
</math>


 is an infinitesimal area on the crystal surface and 

<math display="inline" id="Ewald_summation:58">
 <semantics>
  <mi>𝐫</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>𝐫</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{r}
  </annotation>
 </semantics>
</math>

 is the vector from the central unit cell to the infinitesimal area. This formula results from integrating the energy 

<math display="inline" id="Ewald_summation:59">
 <semantics>
  <mrow>
   <mrow>
    <mi>d</mi>
    <mi>U</mi>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mo>-</mo>
    <mrow>
     <msub>
      <mi>𝐩</mi>
      <mrow>
       <mi>u</mi>
       <mi>c</mi>
      </mrow>
     </msub>
     <mo>⋅</mo>
     <mi>𝐝𝐄</mi>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <ci>d</ci>
     <ci>U</ci>
    </apply>
    <apply>
     <minus></minus>
     <apply>
      <ci>normal-⋅</ci>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>𝐩</ci>
       <apply>
        <times></times>
        <ci>u</ci>
        <ci>c</ci>
       </apply>
      </apply>
      <ci>𝐝𝐄</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   dU=-\mathbf{p}_{uc}\cdot\mathbf{dE}
  </annotation>
 </semantics>
</math>

 where 

<math display="inline" id="Ewald_summation:60">
 <semantics>
  <mrow>
   <mi>d</mi>
   <mi>𝐄</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>d</ci>
    <ci>𝐄</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   d\mathbf{E}
  </annotation>
 </semantics>
</math>

 represents the infinitesimal electric field generated by an infinitesimal surface charge 

<math display="inline" id="Ewald_summation:61">
 <semantics>
  <mrow>
   <mrow>
    <mi>d</mi>
    <mpadded width="+5pt">
     <mi>q</mi>
    </mpadded>
   </mrow>
   <mpadded width="+5pt">
    <mover>
     <mo movablelimits="false">=</mo>
     <mi>def</mi>
    </mover>
   </mpadded>
   <mrow>
    <mi>σ</mi>
    <mi>d</mi>
    <mi>S</mi>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <eq></eq>
     <ci>def</ci>
    </apply>
    <apply>
     <times></times>
     <ci>d</ci>
     <ci>q</ci>
    </apply>
    <apply>
     <times></times>
     <ci>σ</ci>
     <ci>d</ci>
     <ci>S</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   dq\ \stackrel{\mathrm{def}}{=}\ \sigma dS
  </annotation>
 </semantics>
</math>

 (<a href="Coulomb's_law" title="wikilink">Coulomb's law</a>)</p>

<p>

<math display="block" id="Ewald_summation:62">
 <semantics>
  <mrow>
   <mrow>
    <mi>d</mi>
    <mpadded width="+5pt">
     <mi>𝐄</mi>
    </mpadded>
   </mrow>
   <mpadded width="+5pt">
    <mover>
     <mo movablelimits="false">=</mo>
     <mi>def</mi>
    </mover>
   </mpadded>
   <mrow>
    <mrow>
     <mo>(</mo>
     <mfrac>
      <mrow>
       <mo>-</mo>
       <mn>1</mn>
      </mrow>
      <mrow>
       <mn>4</mn>
       <mi>π</mi>
       <mi>ϵ</mi>
      </mrow>
     </mfrac>
     <mo>)</mo>
    </mrow>
    <mfrac>
     <mrow>
      <mi>d</mi>
      <mpadded width="+5pt">
       <mi>q</mi>
      </mpadded>
      <mi>𝐫</mi>
     </mrow>
     <msup>
      <mi>r</mi>
      <mn>3</mn>
     </msup>
    </mfrac>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mrow>
     <mo>(</mo>
     <mfrac>
      <mrow>
       <mo>-</mo>
       <mn>1</mn>
      </mrow>
      <mrow>
       <mn>4</mn>
       <mi>π</mi>
       <mi>ϵ</mi>
      </mrow>
     </mfrac>
     <mo>)</mo>
    </mrow>
    <mfrac>
     <mrow>
      <mpadded width="+1.7pt">
       <mi>σ</mi>
      </mpadded>
      <mi>d</mi>
      <mpadded width="+5pt">
       <mi>S</mi>
      </mpadded>
      <mi>𝐫</mi>
     </mrow>
     <msup>
      <mi>r</mi>
      <mn>3</mn>
     </msup>
    </mfrac>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <and></and>
    <apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <eq></eq>
      <ci>def</ci>
     </apply>
     <apply>
      <times></times>
      <ci>d</ci>
      <ci>𝐄</ci>
     </apply>
     <apply>
      <times></times>
      <apply>
       <divide></divide>
       <apply>
        <minus></minus>
        <cn type="integer">1</cn>
       </apply>
       <apply>
        <times></times>
        <cn type="integer">4</cn>
        <ci>π</ci>
        <ci>ϵ</ci>
       </apply>
      </apply>
      <apply>
       <divide></divide>
       <apply>
        <times></times>
        <ci>d</ci>
        <ci>q</ci>
        <ci>𝐫</ci>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>r</ci>
        <cn type="integer">3</cn>
       </apply>
      </apply>
     </apply>
    </apply>
    <apply>
     <eq></eq>
     <share href="#.cmml">
     </share>
     <apply>
      <times></times>
      <apply>
       <divide></divide>
       <apply>
        <minus></minus>
        <cn type="integer">1</cn>
       </apply>
       <apply>
        <times></times>
        <cn type="integer">4</cn>
        <ci>π</ci>
        <ci>ϵ</ci>
       </apply>
      </apply>
      <apply>
       <divide></divide>
       <apply>
        <times></times>
        <ci>σ</ci>
        <ci>d</ci>
        <ci>S</ci>
        <ci>𝐫</ci>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>r</ci>
        <cn type="integer">3</cn>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   d\mathbf{E}\ \stackrel{\mathrm{def}}{=}\ \left(\frac{-1}{4\pi\epsilon}\right)%
\frac{dq\ \mathbf{r}}{r^{3}}=\left(\frac{-1}{4\pi\epsilon}\right)\frac{\sigma%
\,dS\ \mathbf{r}}{r^{3}}
  </annotation>
 </semantics>
</math>

 The negative sign derives from the definition of 

<math display="inline" id="Ewald_summation:63">
 <semantics>
  <mi>𝐫</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>𝐫</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{r}
  </annotation>
 </semantics>
</math>

, which points towards the charge, not away from it.</p>
<h2 id="history">History</h2>

<p>The Ewald summation was developed by <a href="Paul_Peter_Ewald" title="wikilink">Paul Peter Ewald</a> in 1921 (see References below) to determine the electrostatic energy (and, hence, the <a href="Madelung_constant" title="wikilink">Madelung constant</a>) of ionic crystals.</p>
<h2 id="scaling">Scaling</h2>

<p>Generally different Ewald summation methods give different <a href="time_complexity" title="wikilink">time complexities</a>. Direct calculation gives 

<math display="inline" id="Ewald_summation:64">
 <semantics>
  <mrow>
   <mi>O</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <msup>
     <mi>N</mi>
     <mn>2</mn>
    </msup>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>O</ci>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>N</ci>
     <cn type="integer">2</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   O(N^{2})
  </annotation>
 </semantics>
</math>

, where 

<math display="inline" id="Ewald_summation:65">
 <semantics>
  <mi>N</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>N</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   N
  </annotation>
 </semantics>
</math>

 is the number of atoms in the system. The PME method gives 

<math display="inline" id="Ewald_summation:66">
 <semantics>
  <mrow>
   <mi>O</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mrow>
     <mpadded width="+1.7pt">
      <mi>N</mi>
     </mpadded>
     <mrow>
      <mi>log</mi>
      <mi>N</mi>
     </mrow>
    </mrow>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>O</ci>
    <apply>
     <times></times>
     <ci>N</ci>
     <apply>
      <log></log>
      <ci>N</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   O(N\,\log N)
  </annotation>
 </semantics>
</math>

.<a class="footnoteRef" href="#fn3" id="fnref3"><sup>3</sup></a></p>
<h2 id="see-also">See also</h2>
<ul>
<li><a href="Paul_Peter_Ewald" title="wikilink">Paul Peter Ewald</a></li>
<li><a href="Madelung_constant" title="wikilink">Madelung constant</a></li>
<li><a href="Poisson_summation_formula" title="wikilink">Poisson summation formula</a></li>
<li><a href="Molecular_modeling" title="wikilink">Molecular modeling</a></li>
<li><a href="Wolf_summation" title="wikilink">Wolf summation</a></li>
</ul>
<h2 id="references">References</h2>
<ul>
<li></li>
</ul>
<ul>
<li></li>
</ul>
<ul>
<li>Schlick T. (2002). <em>Molecular Modeling and Simulation: An Interdisciplinary Guide</em> <a class="uri" href="Springer-Verlag" title="wikilink">Springer-Verlag</a> Interdisciplinary Applied Mathematics, Mathematical Biology, Vol. 21. New York, NY.</li>
</ul>

<p>"</p>

<p><a class="uri" href="Category:Electromagnetism" title="wikilink">Category:Electromagnetism</a> <a href="Category:Potential_theory" title="wikilink">Category:Potential theory</a> <a href="Category:Fourier_analysis" title="wikilink">Category:Fourier analysis</a> <a href="Category:Computational_chemistry" title="wikilink">Category:Computational chemistry</a> <a href="Category:Theoretical_chemistry" title="wikilink">Category:Theoretical chemistry</a></p>
<section class="footnotes">
<hr/>
<ol>
<li id="fn1"><a href="#fnref1">↩</a></li>
<li id="fn2"><a href="#fnref2">↩</a></li>
<li id="fn3">J. Chem. Phys. 98, 10089 (1993); <a href="#fnref3">↩</a></li>
</ol>
</section>
</hr></body>
</html>
