   Stirling's approximation      Stirling's approximation   In mathematics , Stirling's approximation (or Stirling's formula ) is an approximation for factorials . It is a very powerful approximation, leading to accurate results even for small values of n . It is named after James Stirling , though it was first stated by Abraham de Moivre . 1 2 3  The formula as typically used in applications is       ln   (   n  !   )    =     n   ln   (  n  )     -  n   +   O   (   ln   (  n  )    )             n          n    n    n     O    n       \ln(n!)=n\ln(n)-n+O(\ln(n))     (in big O notation ). The next term in the O (ln( n )) is (1/2)ln(2π n ); a more precise variant of the formula is therefore        n  !   ∼     2  π  n      (   n  e   )   n     .     similar-to    n         2  π  n     superscript    n  e   n      n!\sim\sqrt{2\pi n}\left(\frac{n}{e}\right)^{n}.     As an asymptotic formula , Stirling's approximation has the property that the ratio       n  !      2  π  n      (   n  e   )   n          n         2  π  n     superscript    n  e   n      \frac{n!}{\sqrt{2\pi n}\left(\frac{n}{e}\right)^{n}}     approaches 1 as n grows to infinity.  Derivation  The formula, together with precise estimates of its error, can be derived as follows. Instead of approximating n !, one considers its natural logarithm as this is a slowly varying function:        ln   (   n  !   )    =    ln   (  1  )    +   ln   (  2  )    +  ⋯  +   ln   (  n  )      .          n        1     2   normal-⋯    n      \ln(n!)=\ln(1)+\ln(2)+\cdots+\ln(n).     The right-hand side of this equation minus          1  2     (    ln   (  1  )    +   ln   (  n  )     )    =     1  2     ln   (  n  )      ,          1  2       1     n         1  2     n      \tfrac{1}{2}(\ln(1)+\ln(n))=\tfrac{1}{2}\ln(n),     is the approximation by the trapezoid rule of the integral         ln   (   n  !   )    -     1  2     ln   (  n  )      ≈    ∫  1  n     ln   (  x  )    d  x    =     n   ln   (  n  )     -  n   +  1    ,              n        1  2     n       superscript   subscript   1   n       x   normal-d  x               n    n    n   1      \ln(n!)-\tfrac{1}{2}\ln(n)\approx\int_{1}^{n}\ln(x)\,{\rm d}x=n\ln(n)-n+1,     and the error in this approximation is given by the Euler–Maclaurin formula :       ln   (   n  !   )    -    1  2    ln   (  n  )             n        1  2     n      \displaystyle\ln(n!)-\tfrac{1}{2}\ln(n)     where B k is a Bernoulli number and R m , n is the remainder term in the Euler–Maclaurin formula. Take limits to find that         lim   n  →  ∞     (      ln   (   n  !   )    -   n   ln   (  n  )      +  n   -     1  2     ln   (  n  )      )    =    1  -    ∑   k  =  2   m       (   -  1   )   k    B  k     k   (   k  -  1   )       +    lim   n  →  ∞     R   m  ,  n       .        subscript    normal-→  n               n      n    n     n       1  2     n          1    superscript   subscript     k  2    m        superscript    1   k    subscript  B  k      k    k  1         subscript    normal-→  n      subscript  R   m  n        \lim_{n\to\infty}\left(\ln(n!)-n\ln(n)+n-\tfrac{1}{2}\ln(n)\right)=1-\sum_{k=2%
 }^{m}\frac{(-1)^{k}B_{k}}{k(k-1)}+\lim_{n\to\infty}R_{m,n}.     Denote this limit by y . Because the remainder R m , n in the Euler–Maclaurin formula satisfies        R   m  ,  n    =     lim   n  →  ∞     R   m  ,  n     +   O   (   1   n  m    )      ,       subscript  R   m  n        subscript    normal-→  n      subscript  R   m  n       O    1   superscript  n  m        R_{m,n}=\lim_{n\to\infty}R_{m,n}+O\left(\frac{1}{n^{m}}\right),     where we use Big-O notation , combining the equations above yields the approximation formula in its logarithmic form:        ln   (   n  !   )    =    n   ln   (   n  e   )     +     1  2     ln   (  n  )     +  y  +    ∑   k  =  2   m       (   -  1   )   k    B  k     k   (   k  -  1   )    n   k  -  1       +   O   (   1   n  m    )      .          n        n      n  e         1  2     n    y    superscript   subscript     k  2    m        superscript    1   k    subscript  B  k      k    k  1    superscript  n    k  1         O    1   superscript  n  m        \ln(n!)=n\ln\left(\frac{n}{e}\right)+\tfrac{1}{2}\ln(n)+y+\sum_{k=2}^{m}\frac{%
 (-1)^{k}B_{k}}{k(k-1)n^{k-1}}+O\left(\frac{1}{n^{m}}\right).     Taking the exponential of both sides, and choosing any positive integer m , we get a formula involving an unknown quantity e y . For m = 1, the formula is        n  !   =    e  y    n     (   n  e   )   n    (   1  +   O   (   1  n   )     )     .        n      superscript  e  y     n    superscript    n  e   n     1    O    1  n        n!=e^{y}\sqrt{n}\left(\frac{n}{e}\right)^{n}\left(1+O\left(\frac{1}{n}\right)%
 \right).     The quantity e y can be found by taking the limit on both sides as n tends to infinity and using Wallis' product , which shows that     e  y   =    2  π         superscript  e  y       2  π      e^{y}=\sqrt{2\pi}   . Therefore, we get Stirling's formula:        n  !   =     2  π  n      (   n  e   )   n    (   1  +   O   (   1  n   )     )     .        n         2  π  n     superscript    n  e   n     1    O    1  n        n!=\sqrt{2\pi n}\left(\frac{n}{e}\right)^{n}\left(1+O\left(\frac{1}{n}\right)%
 \right).     The formula may also be obtained by repeated integration by parts , and the leading term can be found through Laplace's method . Stirling's formula, without the factor     2  π  n         2  π  n     \sqrt{2\pi n}   that is often irrelevant in applications, can be quickly obtained by approximating the sum       ln   (   n  !   )    =    ∑   j  =  1   n    ln   (  j  )             n      superscript   subscript     j  1    n     j      \ln(n!)=\sum_{j=1}^{n}\ln(j)     with an integral:        ∑   j  =  1   n    ln   (  j  )     ≈    ∫  1  n     ln   (  x  )    d  x    =     n   ln   (  n  )     -  n   +  1.           superscript   subscript     j  1    n     j      superscript   subscript   1   n       x   normal-d  x               n    n    n   1.      \sum_{j=1}^{n}\ln(j)\approx\int_{1}^{n}\ln(x)\,{\rm d}x=n\ln(n)-n+1.     An alternative derivation  An alternative formula for    n  !      n    n!   using the Gamma function is        n  !   =    ∫  0  ∞     x  n    e   -  x    d  x     .        n     superscript   subscript   0        superscript  x  n    superscript  e    x    d  x      n!=\int_{0}^{\infty}x^{n}e^{-x}dx.   (as can be seen by repeated integration by parts). Rewriting and changing variables    x  =   n  y       x    n  y     x=ny   one gets        n  !   =    ∫  0  ∞     e    n   ln  x    -  x    d  x    =    e   n   ln  n     n    ∫  0  ∞     e   n   (    ln  y   -  y   )     d  y      .          n     superscript   subscript   0        superscript  e      n    x    x    d  x            superscript  e    n    n     n    superscript   subscript   0        superscript  e    n      y   y     d  y        n!=\int_{0}^{\infty}e^{n\ln x-x}dx=e^{n\ln n}n\int_{0}^{\infty}e^{n(\ln y-y)}dy.   Applying Laplace's method we have:        ∫  0  ∞     e   n   (    ln  y   -  y   )     d  y    ∼      2  π   n     e   -  n        similar-to    superscript   subscript   0        superscript  e    n      y   y     d  y            2  π   n     superscript  e    n       \int_{0}^{\infty}e^{n(\ln y-y)}dy\sim\sqrt{\frac{2\pi}{n}}e^{-n}   which recovers the Stirling's formula,        n  !   ∼    e   n   ln  n     n     2  π   n     e   -  n     =     2  π  n      (   n  e   )   n     .       similar-to    n      superscript  e    n    n     n        2  π   n     superscript  e    n                2  π  n     superscript    n  e   n       n!\sim e^{n\ln n}n\sqrt{\frac{2\pi}{n}}e^{-n}=\sqrt{2\pi n}\left(\frac{n}{e}%
 \right)^{n}.   In fact further corrections can also be obtained using Laplace's method. For example, computing two-order expansion using Laplace's method yields        ∫  0  ∞     e   n   (    ln  y   -  y   )     d  y    ∼      2  π   n     e   -  n     (   1  +   1   12  n     )       similar-to    superscript   subscript   0        superscript  e    n      y   y     d  y            2  π   n     superscript  e    n      1    1    12  n        \int_{0}^{\infty}e^{n(\ln y-y)}dy\sim\sqrt{\frac{2\pi}{n}}e^{-n}\left(1+\frac{%
 1}{12n}\right)   and gives Stirling's formula to two orders,        n  !   ∼    e   n   ln  n     n     2  π   n     e   -  n     (   1  +   1   12  n     )    =     2  π  n      (   n  e   )   n    (   1  +   1   12  n     )     .       similar-to    n      superscript  e    n    n     n        2  π   n     superscript  e    n      1    1    12  n                 2  π  n     superscript    n  e   n     1    1    12  n         n!\sim e^{n\ln n}n\sqrt{\frac{2\pi}{n}}e^{-n}\left(1+\frac{1}{12n}\right)=%
 \sqrt{2\pi n}\left(\frac{n}{e}\right)^{n}\left(1+\frac{1}{12n}\right).     Speed of convergence and error estimates  (Figure)  The relative error in a truncated Stirling series vs. n , for 1 to 5 terms   Stirling's formula is in fact the first approximation to the following series (now called the Stirling series ):      n  !      n    \displaystyle n!     An explicit formula for the coefficients in this series was given by G. Nemes. 4 The first graph in this section shows the relative error vs. n , for 1 through all 5 terms listed above.  (Figure)  The relative error in a truncated Stirling series vs. the number of terms used   As n → ∞, the error in the truncated series is asymptotically equal to the first omitted term. This is an example of an asymptotic expansion . It is not a convergent series ; for any particular value of n there are only so many terms of the series that improve accuracy, after which point accuracy actually gets worse. This is shown in the next graph, which shows the relative error versus the number of terms in the series, for larger numbers of terms. More precisely, let S ( n , t ) be the Stirling series to t terms evaluated at n . The graphs show       |   ln   (    S   (  n  ,  t  )     n  !    )    |   ,            S   n  t      n       \left|\ln\left(\frac{S(n,t)}{n!}\right)\right|,   which, when small, is essentially the relative error.  Writing Stirling's series in the form:      ln   n  !         n     \displaystyle\ln n!     it is known that the error in truncating the series is always of the same sign and at most the same magnitude as the first omitted term.  It is also possible to give a version of Stirling's formula with bounds valid for all positive integers n , rather than asymptotics: one has          2  π      n   n  +   1  /  2      e   -  n     ≤   n  !   ≤    e    n   n  +   1  /  2      e   -  n                 2  π     superscript  n    n    1  2      superscript  e    n       n          e   superscript  n    n    1  2      superscript  e    n        \sqrt{2\pi}\ n^{n+1/2}e^{-n}\leq n!\leq e\ n^{n+1/2}e^{-n}     for all positive integers n . Thus the ratio     n  !     n   n  +   1  /  2      e   -  n           n      superscript  n    n    1  2      superscript  e    n       \frac{n!}{n^{n+1/2}e^{-n}}   is always between      2  π    =   2.5066  …           2  π      2.5066  normal-…     \sqrt{2\pi}=2.5066\ldots   and    e  =   2.71828  …       e    2.71828  normal-…     e=2.71828\ldots   .  Stirling's formula for the gamma function  For all positive integers,        n  !   =   Γ   (   n  +  1   )     ,        n     normal-Γ    n  1      n!=\Gamma(n+1),     where Γ denotes the gamma function .  However, the gamma function, unlike the factorial, is more broadly defined for all complex numbers other than non-positive integers; nevertheless, Stirling's formula may still be applied. If Re( z ) > 0 then         ln  Γ    (  z  )    =     z   ln  z    -  z   +    1  2    ln    2  π   z     +    ∫  0  ∞       2   arctan   (   t  z   )       e   2  π  t    -  1     d  t      .          normal-Γ   z         z    z    z       1  2         2  π   z       superscript   subscript   0           2      t  z        superscript  e    2  π  t    1    normal-d  t       \ln\Gamma(z)=z\ln z-z+\frac{1}{2}\ln\frac{2\pi}{z}+\int_{0}^{\infty}\frac{2%
 \arctan(\frac{t}{z})}{e^{2\pi t}-1}\,{\rm d}t.     Repeated integration by parts gives        ln  Γ    (  z  )    ∼     z   ln  z    -  z   +    1  2    ln    2  π   z     +    ∑   n  =  1   ∞     B   2  n     2  n   (    2  n   -  1   )    z    2  n   -  1           similar-to      normal-Γ   z         z    z    z       1  2         2  π   z       superscript   subscript     n  1         subscript  B    2  n      2  n      2  n   1    superscript  z      2  n   1          \ln\Gamma(z)\sim z\ln z-z+\frac{1}{2}\ln\frac{2\pi}{z}+\sum_{n=1}^{\infty}%
 \frac{B_{2n}}{2n(2n-1)z^{2n-1}}     where B n is the n -th Bernoulli number (note that the infinite sum is not convergent, so this formula is just an asymptotic expansion ). The formula is valid for z large enough in absolute value when |arg( z )| O(z^{-2m - 1}) when the first m terms are used. The corresponding approximation may now be written:        Γ   (  z  )    =       2  π   z       (   z  e   )   z    (   1  +   O   (   1  z   )     )     .        normal-Γ  z           2  π   z     superscript    z  e   z     1    O    1  z        \Gamma(z)=\sqrt{\frac{2\pi}{z}}~{}{\left(\frac{z}{e}\right)}^{z}\left(1+O\left%
 (\frac{1}{z}\right)\right).     A further application of this asymptotic expansion is for complex argument z with constant Re( z ). See for example the Stirling formula applied in Im( z ) = t of the Riemann-Siegel theta function on the straight line 1/4 + it .  A convergent version of Stirling's formula  Thomas Bayes showed, in a letter to John Canton published by the Royal Society in 1763, that Stirling's formula did not give a convergent series . 5  Obtaining a convergent version of Stirling's formula entails evaluating         ∫  0  ∞      2   arctan   (   t  x   )       e   2  π  t    -  1    d  t    =       ln  Γ    (   1  +  x   )    -   x   ln  x     +  x   -    1  2    ln   2  π  x       .        superscript   subscript   0           2      t  x        superscript  e    2  π  t    1    d  t              normal-Γ     1  x      x    x     x       1  2       2  π  x        \int_{0}^{\infty}\frac{2\arctan(\frac{t}{x})}{e^{2\pi t}-1}dt=\ln\Gamma(1+x)-x%
 \ln x+x-\frac{1}{2}\ln 2\pi x.     One way to do this is by means of a convergent series of inverted rising exponentials . If        z   n  ¯    =   z   (   z  +  1   )   ⋯   (    z  +  n   -  1   )     ;       superscript  z   normal-¯  n      z    z  1   normal-⋯      z  n   1      z^{\bar{n}}=z(z+1)\cdots(z+n-1);     then        ∫  0  ∞      2   arctan   (   t  x   )       e   2  π  t    -  1    d  t    =    ∑   n  =  1   ∞     c  n     (   x  +  1   )    n  ¯            superscript   subscript   0           2      t  x        superscript  e    2  π  t    1    d  t      superscript   subscript     n  1         subscript  c  n    superscript    x  1    normal-¯  n        \int_{0}^{\infty}\frac{2\arctan(\frac{t}{x})}{e^{2\pi t}-1}dt=\sum_{n=1}^{%
 \infty}\frac{c_{n}}{(x+1)^{\bar{n}}}     where       c  n   =    1  n     ∫  0  1     x   n  ¯     (   x  -    1  2     )   d  x     =    1   2  n      ∑   k  =  1   n     k   |   s   (  n  ,  k  )    |      (   k  +  1   )    (   k  +  2   )              subscript  c  n       1  n     superscript   subscript   0   1      superscript  x   normal-¯  n      x    1  2    normal-d  x              1    2  n      superscript   subscript     k  1    n       k      s   n  k          k  1     k  2          c_{n}=\frac{1}{n}\int_{0}^{1}x^{\bar{n}}\left(x-\tfrac{1}{2}\right)\,{\rm d}x=%
 \frac{1}{2n}\sum_{k=1}^{n}\frac{k|s(n,k)|}{(k+1)(k+2)}     where s ( n , k ) denotes the Stirling numbers of the first kind . From this we obtain a version of Stirling's series        ln  Γ    (  x  )    =     x   ln  x    -  x   +     1  2     ln     2  π   x      +    1   12   (   x  +  1   )      +     1   12   (   x  +  1   )    (   x  +  2   )      +            normal-Γ   x         x    x    x       1  2         2  π   x       1    12    x  1      limit-from    1    12    x  1     x  2          \displaystyle\ln\Gamma(x)=x\ln x-x+\frac{1}{2}\ln\frac{2\pi}{x}+\frac{1}{12(x+%
 1)}+\frac{1}{12(x+1)(x+2)}+     which converges when Re( x ) > 0.  Versions suitable for calculators  The approximation:        Γ   (  z  )    ≈      2  π   z      (    z  e      z   sinh   1  z     +   1   810   z  6        )   z     ,        normal-Γ  z           2  π   z     superscript      z  e         z      1  z       1    810   superscript  z  6        z      \Gamma(z)\approx\sqrt{\frac{2\pi}{z}}\left(\frac{z}{e}\sqrt{z\sinh\frac{1}{z}+%
 \frac{1}{810z^{6}}}\right)^{z},     or equivalently,        2   ln   (   Γ   (  z  )    )     ≈     ln   (   2  π   )    -   ln   (  z  )     +   z   (     2   ln   (  z  )     +   ln   (    z   sinh   1  z     +   1   810   z  6      )     -  2   )      ,        2      normal-Γ  z             2  π      z      z        2    z          z      1  z       1    810   superscript  z  6        2       2\ln(\Gamma(z))\approx\ln(2\pi)-\ln(z)+z\left(2\ln(z)+\ln\left(z\sinh\frac{1}{%
 z}+\frac{1}{810z^{6}}\right)-2\right),     can be obtained by rearranging Stirling's extended formula and observing a coincidence between the resultant power series and the Taylor series expansion of the hyperbolic sine function. This approximation is good to more than 8 decimal digits for z with a real part greater than 8. Robert H. Windschitl suggested it in 2002 for computing the Gamma function with fair accuracy on calculators with limited program or register memory. 6  Gergő Nemes proposed in 2007 an approximation which gives the same number of exact digits as the Windschitl approximation but is much simpler: 7        Γ   (  z  )    ≈      2  π   z      (    1  e    (   z  +   1    12  z   -   1   10  z       )    )   z     ,        normal-Γ  z           2  π   z     superscript      1  e     z    1      12  z     1    10  z        z      \Gamma(z)\approx\sqrt{\frac{2\pi}{z}}\left(\frac{1}{e}\left(z+\frac{1}{12z-%
 \frac{1}{10z}}\right)\right)^{z},     or equivalently,        ln   (   Γ   (  z  )    )    ≈      1  2     [    ln   (   2  π   )    -   ln   (  z  )     ]    +   z   [    ln   (   z  +   1    12  z   -   1   10  z       )    -  1   ]      .          normal-Γ  z          1  2    delimited-[]        2  π      z        z   delimited-[]        z    1      12  z     1    10  z        1        \ln(\Gamma(z))\approx\tfrac{1}{2}\left[\ln(2\pi)-\ln(z)\right]+z\left[\ln\left%
 (z+\frac{1}{12z-\frac{1}{10z}}\right)-1\right].     An alternative approximation for  was also given by Srinivasa Ramanujan ( Ramanujan 1988 )        ln   (   n  !   )    ≈     n   ln   (  n  )     -  n   +     1  6     ln   (   n   (   1  +   4  n   (   1  +   2  n    )     )    )     +     1  2     ln   (  π  )       .          n          n    n    n       1  6       n    1    4  n    1    2  n             1  2     π       \ln(n!)\approx n\ln(n)-n+\tfrac{1}{6}\ln(n(1+4n(1+2n)))+\tfrac{1}{2}\ln(\pi).     History  The formula was first discovered by Abraham de Moivre 8 in the form        n  !   ∼     [  constant  ]   ⋅   n   n  +   1  /  2       e   -  n      .     similar-to    n      normal-⋅   delimited-[]  constant    superscript  n    n    1  2       superscript  e    n       n!\sim[{\rm constant}]\cdot n^{n+1/2}e^{-n}.     De Moivre gave an expression for the constant in terms of its natural logarithm. Stirling's contribution consisted of showing that the constant is     2  π         2  π     \sqrt{2\pi}   . 9  See also   Factorial  Gamma Function  Lanczos approximation  Spouge's approximation   Notes  References       Dan Romik, Stirling’s Approximation for n!: The Ultimate Short Proof? , The American Mathematical Monthly, Vol. 107, No. 6 (Jun. – Jul., 2000), 556–557.  Y.-C. Li, A Note on an Identity of The Gamma Function and Stirling’s Formula , Real Analysis Exchang, Vol. 32(1), 2006/2007, pp. 267–272.   External links    Peter Luschny, Approximation formulas for the factorial function n!     "  Category:Approximations  Category:Asymptotic analysis  Category:Analytic number theory  Category:Gamma and related functions  Category:Theorems in analysis     ↩  . ↩  ↩  ↩  http://www.york.ac.uk/depts/maths/histstat/letter.pdf ↩  Toth, V. T. Programmable Calculators: Calculators and the Gamma Function (2006) ↩  ↩       