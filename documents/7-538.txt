   Schoof's algorithm      Schoof's algorithm   Schoof's algorithm is an efficient algorithm to count points on elliptic curves over finite fields . The algorithm has applications in elliptic curve cryptography where it is important to know the number of points to judge the difficulty of solving the discrete logarithm problem in the group of points on an elliptic curve.  The algorithm was published by René Schoof in 1985 and it was a theoretical breakthrough, as it was the first deterministic polynomial time algorithm for counting points on elliptic curves . Before Schoof's algorithm, approaches to counting points on elliptic curves such as the naive and baby-step giant-step algorithms were, for the most part, tedious and had an exponential running time.  This article explains Schoof's approach, laying emphasis on the mathematical ideas underlying the structure of the algorithm.  Introduction  Let   E   E   E   be an elliptic curve defined over the finite field    𝔽  q     subscript  𝔽  q    \mathbb{F}_{q}   , where    q  =   p  n       q   superscript  p  n     q=p^{n}   for   p   p   p   a prime and   n   n   n   an integer     ≥  1      absent  1    \geq 1   . Over a field of characteristic     ≠   2  ,  3       absent   2  3     \neq 2,3   an elliptic curve can be given by a (short) Weierstrass equation       y  2   =    x  3   +   A  x   +   B         superscript  y  2      superscript  x  3     A  x   B     y^{2}=x^{3}+Ax+B\,   with     A  ,  B   ∈   𝔽  q        A  B    subscript  𝔽  q     A,B\in\mathbb{F}_{q}   . The set of points defined over    𝔽  q     subscript  𝔽  q    \mathbb{F}_{q}   consists of the solutions     (  a  ,  b  )   ∈   𝔽  q  2        a  b    superscript   subscript  𝔽  q   2     (a,b)\in\mathbb{F}_{q}^{2}   satisfying the curve equation and a point at infinity    O   O   O   . Using the group law on elliptic curves restricted to this set one can see that this set    E   (   𝔽  q   )       E   subscript  𝔽  q     E(\mathbb{F}_{q})   forms an abelian group , with   O   O   O   acting as the zero element. In order to count points on an elliptic curve, we compute the cardinality of    E   (   𝔽  q   )       E   subscript  𝔽  q     E(\mathbb{F}_{q})   . Schoof's approach to computing the cardinality    ♯  E   (   𝔽  q   )       normal-♯  E   subscript  𝔽  q     \sharp E(\mathbb{F}_{q})   makes use of Hasse's theorem on elliptic curves along with the Chinese remainder theorem and division polynomials .  Hasse's theorem  Hasse's theorem states that if    E  /   𝔽  q       E   subscript  𝔽  q     E/\mathbb{F}_{q}   is an elliptic curve over the finite field    𝔽  q     subscript  𝔽  q    \mathbb{F}_{q}   , then    ♯  E   (   𝔽  q   )       normal-♯  E   subscript  𝔽  q     \sharp E(\mathbb{F}_{q})   satisfies        ∣    q  +  1   -   ♯  E   (   𝔽  q   )     ∣   ≤   2   q     .       delimited-∣∣      q  1     normal-♯  E   subscript  𝔽  q        2    q      \mid q+1-\sharp E(\mathbb{F}_{q})\mid\leq 2\sqrt{q}.     This powerful result, given by Hasse in 1934, simplifies our problem by narrowing down    ♯  E   (   𝔽  q   )       normal-♯  E   subscript  𝔽  q     \sharp E(\mathbb{F}_{q})   to a finite (albeit large) set of possibilities. Defining   t   t   t   to be     q  +  1   -   ♯  E   (   𝔽  q   )          q  1     normal-♯  E   subscript  𝔽  q      q+1-\sharp E(\mathbb{F}_{q})   , and making use of this result, we now have that computing the cardinality of   t   t   t   modulo   N   N   N   where    N  >   4   q        N    4    q      N>4\sqrt{q}   , is sufficient for determining   t   t   t   , and thus    ♯  E   (   𝔽  q   )       normal-♯  E   subscript  𝔽  q     \sharp E(\mathbb{F}_{q})   . While there is no efficient way to compute    t     (   mod  N   )      annotated  t   pmod  N     t\;\;(\mathop{{\rm mod}}N)   directly for general   N   N   N   , it is possible to compute    t     (   mod  l   )      annotated  t   pmod  l     t\;\;(\mathop{{\rm mod}}l)   for   l   l   l   a small prime, rather efficiently. We choose    S  =   {   l  1   ,   l  2   ,  …  ,   l  r   }       S    subscript  l  1    subscript  l  2   normal-…   subscript  l  r      S=\{l_{1},l_{2},...,l_{r}\}   to be a set of distinct primes such that     ∏   l  i    =  N  >   4   q           product   subscript  l  i    N         4    q       \prod l_{i}=N>4\sqrt{q}   . Given    t     (   mod   l  i    )      annotated  t   pmod   subscript  l  i      t\;\;(\mathop{{\rm mod}}l_{i})   for all     l  i   ∈  S       subscript  l  i   S    l_{i}\in S   , the Chinese remainder theorem allows us to compute    t     (   mod  N   )      annotated  t   pmod  N     t\;\;(\mathop{{\rm mod}}N)   .  In order to compute    t     (   mod  l   )      annotated  t   pmod  l     t\;\;(\mathop{{\rm mod}}l)   for a prime    l  ≠  p      l  p    l\neq p   , we make use of the theory of the Frobenius endomorphism   ϕ   ϕ   \phi   and division polynomials . Note that considering primes    l  ≠  p      l  p    l\neq p   is no loss since we can always pick a bigger prime to take its place to ensure the product is big enough. In any case Schoof's algorithm is most frequently used in addressing the case    q  =  p      q  p    q=p   since there are more efficient, so called   p   p   p   adic algorithms for small-characteristic fields.  The Frobenius endomorphism  Given the elliptic curve   E   E   E   defined over    𝔽  q     subscript  𝔽  q    \mathbb{F}_{q}   we consider points on   E   E   E   over     𝔽  q   ¯     normal-¯   subscript  𝔽  q     \overline{\mathbb{F}_{q}}   , the algebraic closure of    𝔽  q     subscript  𝔽  q    \mathbb{F}_{q}   ; i.e. we allow points with coordinates in     𝔽  ¯   q     subscript   normal-¯  𝔽   q    \bar{\mathbb{F}}_{q}   . The Frobenius endomorphism of     𝔽  ¯   q     subscript   normal-¯  𝔽   q    \bar{\mathbb{F}}_{q}   over    𝔽  q     subscript  𝔽  q    \mathbb{F}_{q}   extends to the elliptic curve by    ϕ  :    (  x  ,  y  )   ↦   (   x  q   ,   y  q   )       normal-:  ϕ   maps-to   x  y     superscript  x  q    superscript  y  q       \phi:(x,y)\mapsto(x^{q},y^{q})   .  This map is the identity on    E   (   𝔽  q   )       E   subscript  𝔽  q     E(\mathbb{F}_{q})   and one can extend it to the point at infinity   O   O   O   , making it a group morphism from    E   (    𝔽  q   ¯   )       E   normal-¯   subscript  𝔽  q      E(\bar{\mathbb{F}_{q}})   to itself.  The Frobenius endomorphism satisfies a quadratic polynomial which is linked to the cardinality of    E   (   𝔽  q   )       E   subscript  𝔽  q     E(\mathbb{F}_{q})   by the following theorem:  Theorem: The Frobenius endomorphism given by   ϕ   ϕ   \phi   satisfies the characteristic equation          ϕ  2   -   t  ϕ    +  q   =  0   ,           superscript  ϕ  2     t  ϕ    q   0    \phi^{2}-t\phi+q=0,   where    t  =    q  +  1   -   ♯  E   (   𝔽  q   )         t      q  1     normal-♯  E   subscript  𝔽  q       t=q+1-\sharp E(\mathbb{F}_{q})     Thus we have for all    P  =   (  x  ,  y  )   ∈  E        P   x  y        E     P=(x,y)\in E   that      (   x   q  2    ,   y   q  2    )   +   q   (  x  ,  y  )     =   t   (   x  q   ,   y  q   )            superscript  x   superscript  q  2     superscript  y   superscript  q  2       q   x  y       t    superscript  x  q    superscript  y  q       (x^{q^{2}},y^{q^{2}})+q(x,y)=t(x^{q},y^{q})   , where + denotes addition on the elliptic curve and    q   (  x  ,  y  )       q   x  y     q(x,y)   and    t   (   x  q   ,   y  q   )       t    superscript  x  q    superscript  y  q      t(x^{q},y^{q})   denote scalar multiplication of    (  x  ,  y  )     x  y    (x,y)   by   q   q   q   and of    (   x  q   ,   y  q   )      superscript  x  q    superscript  y  q     (x^{q},y^{q})   by   t   t   t   .  One could try to symbolically compute these points    (   x   q  2    ,   y   q  2    )      superscript  x   superscript  q  2     superscript  y   superscript  q  2      (x^{q^{2}},y^{q^{2}})   ,    (   x  q   ,   y  q   )      superscript  x  q    superscript  y  q     (x^{q},y^{q})   and    q   (  x  ,  y  )       q   x  y     q(x,y)   as functions in the coordinate ring       𝔽  q    [  x  ,  y  ]    /   (    y  2   -   x  3   -   A  x   -  B   )          subscript  𝔽  q    x  y       superscript  y  2    superscript  x  3     A  x   B     \mathbb{F}_{q}[x,y]/(y^{2}-x^{3}-Ax-B)   of   E   E   E   and the search for a value of   t   t   t   which satisfies the equation. However, the degrees get very large and this approach is impractical.  Schoof's idea was to carry out this computation restricted to points of order   l   l   l   for various small primes   l   l   l   . Fixing an odd prime   l   l   l   , we now move on to solving the problem of determining    t  l     subscript  t  l    t_{l}   , defined as    t     (   mod  l   )      annotated  t   pmod  l     t\;\;(\mathop{{\rm mod}}l)   , for a given prime    l  ≠   2  ,  p       l   2  p     l\neq 2,p   . If a point    (  x  ,  y  )     x  y    (x,y)   is in the   l   l   l   - torsion subgroup      E   [  l  ]    =   {   P  ∈   E   (    𝔽  q   ¯   )     ∣    l  P   =  O   }         E   delimited-[]  l     conditional-set    P    E   normal-¯   subscript  𝔽  q          l  P   O      E[l]=\{P\in E(\bar{\mathbb{F}_{q}})\mid lP=O\}   , then     q  P   =    q  ¯   P         q  P      normal-¯  q   P     qP=\bar{q}P   where    q  ¯     normal-¯  q    \bar{q}   is the unique integer such that    q  ≡    q  ¯      (   mod  l   )        q   annotated   normal-¯  q    pmod  l      q\equiv\bar{q}\;\;(\mathop{{\rm mod}}l)   and     ∣   q  ¯   ∣   <   l  /  2        delimited-∣∣   normal-¯  q      l  2     \mid\bar{q}\mid   . Note that     ϕ   (  O  )    =  O        ϕ  O   O    \phi(O)=O   and that for any integer   r   r   r   we have     r  ϕ   (  P  )    =   ϕ   (   r  P   )          r  ϕ  P     ϕ    r  P      r\phi(P)=\phi(rP)   . Thus    ϕ   (  P  )       ϕ  P    \phi(P)   will have the same order as   P   P   P   . Thus for    (  x  ,  y  )     x  y    (x,y)   belonging to    E   [  l  ]       E   delimited-[]  l     E[l]   , we also have     t   (   x  q   ,   y  q   )    =    t  ¯    (   x  q   ,   y  q   )          t    superscript  x  q    superscript  y  q        normal-¯  t     superscript  x  q    superscript  y  q       t(x^{q},y^{q})=\bar{t}(x^{q},y^{q})   if    t  ≡    t  ¯      (   mod  l   )        t   annotated   normal-¯  t    pmod  l      t\equiv\bar{t}\;\;(\mathop{{\rm mod}}l)   . Hence we have reduced our problem to solving the equation         (   x   q  2    ,   y   q  2    )   +    q  ¯    (  x  ,  y  )     ≡    t  ¯    (   x  q   ,   y  q   )     ,          superscript  x   superscript  q  2     superscript  y   superscript  q  2        normal-¯  q    x  y        normal-¯  t     superscript  x  q    superscript  y  q       (x^{q^{2}},y^{q^{2}})+\bar{q}(x,y)\equiv\bar{t}(x^{q},y^{q}),     where    t  ¯     normal-¯  t    \bar{t}   and    q  ¯     normal-¯  q    \bar{q}   have integer values in    [   -    (   l  -  1   )   /  2    ,    (   l  -  1   )   /  2   ]           l  1   2        l  1   2     [-(l-1)/2,(l-1)/2]   .  Computation modulo primes  The   l   l   l   th division polynomial is such that its roots are precisely the   x   x   x   coordinates of points of order   l   l   l   . Thus, to restrict the computation of     (   x   q  2    ,   y   q  2    )   +    q  ¯    (  x  ,  y  )          superscript  x   superscript  q  2     superscript  y   superscript  q  2        normal-¯  q    x  y      (x^{q^{2}},y^{q^{2}})+\bar{q}(x,y)   to the   l   l   l   -torsion points means computing these expressions as functions in the coordinate ring of   E   E   E    and modulo the   l   l   l   th division polynomial. I.e. we are working in      𝔽  q    [  x  ,  y  ]    /   (    y  2   -   x  3   -   A  x   -  B   ,   ψ  l   )          subscript  𝔽  q    x  y        superscript  y  2    superscript  x  3     A  x   B    subscript  ψ  l      \mathbb{F}_{q}[x,y]/(y^{2}-x^{3}-Ax-B,\psi_{l})   . This means in particular that the degree of   X   X   X   and   Y   Y   Y   defined via     (   X   (  x  ,  y  )    ,   Y   (  x  ,  y  )    )   :=    (   x   q  2    ,   y   q  2    )   +    q  ¯    (  x  ,  y  )        assign     X   x  y      Y   x  y         superscript  x   superscript  q  2     superscript  y   superscript  q  2        normal-¯  q    x  y       (X(x,y),Y(x,y)):=(x^{q^{2}},y^{q^{2}})+\bar{q}(x,y)   is at most 1 in   y   y   y   and at most     (    l  2   -  3   )   /  2         superscript  l  2   3   2    (l^{2}-3)/2   in   x   x   x   .  The scalar multiplication     q  ¯    (  x  ,  y  )        normal-¯  q    x  y     \bar{q}(x,y)   can be done either by double-and-add methods or by using the    q  ¯     normal-¯  q    \bar{q}   th division polynomial. The latter approach gives:        q  ¯    (  x  ,  y  )    =   (   x   q  ¯    ,   y   q  ¯    )   =   (   x  -     ψ    q  ¯   -  1     ψ    q  ¯   +  1      ψ   q  ¯   2     ,    ψ   2   q  ¯      2   ψ   q  ¯   4     )            normal-¯  q    x  y      subscript  x   normal-¯  q     subscript  y   normal-¯  q             x       subscript  ψ     normal-¯  q   1     subscript  ψ     normal-¯  q   1      subscript   superscript  ψ  2    normal-¯  q         subscript  ψ    2   normal-¯  q       2   subscript   superscript  ψ  4    normal-¯  q          \bar{q}(x,y)=(x_{\bar{q}},y_{\bar{q}})=\left(x-\frac{\psi_{\bar{q}-1}\psi_{%
 \bar{q}+1}}{\psi^{2}_{\bar{q}}},\frac{\psi_{2\bar{q}}}{2\psi^{4}_{\bar{q}}}\right)     where    ψ  n     subscript  ψ  n    \psi_{n}   is the   n   n   n   th division polynomial. Note that     y   q  ¯    /  y       subscript  y   normal-¯  q    y    y_{\bar{q}}/y   is a function in   x   x   x   only and denote it by    θ   (  x  )       θ  x    \theta(x)   .  We must split the problem into two cases: the case in which     (   x   q  2    ,   y   q  2    )   ≠   ±    q  ¯    (  x  ,  y  )           superscript  x   superscript  q  2     superscript  y   superscript  q  2      plus-or-minus     normal-¯  q    x  y       (x^{q^{2}},y^{q^{2}})\neq\pm\bar{q}(x,y)   , and the case in which     (   x   q  2    ,   y   q  2    )   =   ±    q  ¯    (  x  ,  y  )           superscript  x   superscript  q  2     superscript  y   superscript  q  2      plus-or-minus     normal-¯  q    x  y       (x^{q^{2}},y^{q^{2}})=\pm\bar{q}(x,y)   . Note that these equalities are checked modulo    ψ  l     subscript  ψ  l    \psi_{l}   .  Case 1     (   x   q  2    ,   y   q  2    )   ≠   ±    q  ¯    (  x  ,  y  )           superscript  x   superscript  q  2     superscript  y   superscript  q  2      plus-or-minus     normal-¯  q    x  y       (x^{q^{2}},y^{q^{2}})\neq\pm\bar{q}(x,y)     By using the addition formula for the group    E   (   𝔽  q   )       E   subscript  𝔽  q     E(\mathbb{F}_{q})   we obtain:        X   (  x  ,  y  )    =     (     y   q  2    -   y   q  ¯       x   q  2    -   x   q  ¯      )   2   -   x   q  2    -   x   q  ¯      .        X   x  y       superscript       superscript  y   superscript  q  2     subscript  y   normal-¯  q        superscript  x   superscript  q  2     subscript  x   normal-¯  q      2    superscript  x   superscript  q  2     subscript  x   normal-¯  q       X(x,y)=\left(\frac{y^{q^{2}}-y_{\bar{q}}}{x^{q^{2}}-x_{\bar{q}}}\right)^{2}-x^%
 {q^{2}}-x_{\bar{q}}.   Note that this computation fails in case the assumption of inequality was wrong.  We are now able to use the   x   x   x   -coordinate to narrow down the choice of    t  ¯     normal-¯  t    \bar{t}   to two possibilities, namely the positive and negative case. Using the   y   y   y   -coordinate one later determines which of the two cases holds.  We first show that   X   X   X   is a function in   x   x   x   alone. Consider      (    y   q  2    -   y   q  ¯     )   2   =    y  2     (    y    q  2   -  1    -    y   q  ¯    /  y    )   2         superscript     superscript  y   superscript  q  2     subscript  y   normal-¯  q     2      superscript  y  2    superscript     superscript  y     superscript  q  2   1       subscript  y   normal-¯  q    y    2      (y^{q^{2}}-y_{\bar{q}})^{2}=y^{2}(y^{q^{2}-1}-y_{\bar{q}}/y)^{2}   . Since     q  2   -  1       superscript  q  2   1    q^{2}-1   is even, by replacing    y  2     superscript  y  2    y^{2}   by     x  3   +   A  x   +  B       superscript  x  3     A  x   B    x^{3}+Ax+B   , we rewrite the expression as       (    x  3   +   A  x   +  B   )    (     (    x  3   +   A  x   +  B   )      q  2   -  1   2    -   θ   (  x  )     )          superscript  x  3     A  x   B      superscript     superscript  x  3     A  x   B        superscript  q  2   1   2      θ  x      (x^{3}+Ax+B)((x^{3}+Ax+B)^{\frac{q^{2}-1}{2}}-\theta(x))     and have that        X   (  x  )    ≡     (    x  3   +   A  x   +  B   )    (     (    x  3   +   A  x   +  B   )      q  2   -  1   2    -   θ   (  x  )     )    mod    ψ  l    (  x  )      .        X  x    modulo       superscript  x  3     A  x   B      superscript     superscript  x  3     A  x   B        superscript  q  2   1   2      θ  x        subscript  ψ  l   x      X(x)\equiv(x^{3}+Ax+B)((x^{3}+Ax+B)^{\frac{q^{2}-1}{2}}-\theta(x))\bmod\psi_{l%
 }(x).     Now if    X  ≡    x   t  ¯   q   mod    ψ  l    (  x  )         X   modulo   subscript   superscript  x  q    normal-¯  t       subscript  ψ  l   x      X\equiv x^{q}_{\bar{t}}\bmod\psi_{l}(x)   for one     t  ¯   ∈   [  0  ,    (   l  -  1   )   /  2   ]        normal-¯  t    0      l  1   2      \bar{t}\in[0,(l-1)/2]   then    t  ¯     normal-¯  t    \bar{t}   satisfies          ϕ  2    (  P  )    ∓    t  ¯   ϕ   (  P  )     +    q  ¯   P    =  O         minus-or-plus     superscript  ϕ  2   P      normal-¯  t   ϕ  P       normal-¯  q   P    O    \phi^{2}(P)\mp\bar{t}\phi(P)+\bar{q}P=O     for all   l   l   l   -torsion points   P   P   P   .  As mentioned earlier, using   Y   Y   Y   and    y   t  ¯   q     superscript   subscript  y   normal-¯  t    q    y_{\bar{t}}^{q}   we are now able to determine which of the two values of    t  ¯     normal-¯  t    \bar{t}   (    t  ¯     normal-¯  t    \bar{t}   or    -   t  ¯        normal-¯  t     -\bar{t}   ) works. This gives the value of    t  ≡    t  ¯      (   mod  l   )        t   annotated   normal-¯  t    pmod  l      t\equiv\bar{t}\;\;(\mathop{{\rm mod}}l)   . Schoof's algorithm stores the values of     t  ¯      (   mod  l   )      annotated   normal-¯  t    pmod  l     \bar{t}\;\;(\mathop{{\rm mod}}l)   in a variable    t  l     subscript  t  l    t_{l}   for each prime   l   l   l   considered.  Case 2     (   x   q  2    ,   y   q  2    )   =   ±    q  ¯    (  x  ,  y  )           superscript  x   superscript  q  2     superscript  y   superscript  q  2      plus-or-minus     normal-¯  q    x  y       (x^{q^{2}},y^{q^{2}})=\pm\bar{q}(x,y)     We begin with the assumption that     (   x   q  2    ,   y   q  2    )   =    q  ¯    (  x  ,  y  )          superscript  x   superscript  q  2     superscript  y   superscript  q  2        normal-¯  q    x  y      (x^{q^{2}},y^{q^{2}})=\bar{q}(x,y)   . Since   l   l   l   is an odd prime it cannot be that      q  ¯    (  x  ,  y  )    =   -    q  ¯    (  x  ,  y  )            normal-¯  q    x  y         normal-¯  q    x  y       \bar{q}(x,y)=-\bar{q}(x,y)   and thus     t  ¯   ≠  0       normal-¯  t   0    \bar{t}\neq 0   . The characteristic equation yields that      t  ¯   ϕ   (  P  )    =   2   q  ¯   P          normal-¯  t   ϕ  P     2   normal-¯  q   P     \bar{t}\phi(P)=2\bar{q}P   . And consequently that       t  ¯   2    q  ¯    ≡     (   2  q   )   2      (   mod  l   )           superscript   normal-¯  t   2    normal-¯  q     annotated   superscript    2  q   2    pmod  l      \bar{t}^{2}\bar{q}\equiv(2q)^{2}\;\;(\mathop{{\rm mod}}l)   . This implies that   q   q   q   is a square modulo   l   l   l   . Let    q  ≡    w  2      (   mod  l   )        q   annotated   superscript  w  2    pmod  l      q\equiv w^{2}\;\;(\mathop{{\rm mod}}l)   . Compute    w  ϕ   (  x  ,  y  )       w  ϕ   x  y     w\phi(x,y)   in      𝔽  q    [  x  ,  y  ]    /   (    y  2   -   x  3   -   A  x   -  B   ,   ψ  l   )          subscript  𝔽  q    x  y        superscript  y  2    superscript  x  3     A  x   B    subscript  ψ  l      \mathbb{F}_{q}[x,y]/(y^{2}-x^{3}-Ax-B,\psi_{l})   and check whether      q  ¯    (  x  ,  y  )    =   w  ϕ   (  x  ,  y  )           normal-¯  q    x  y      w  ϕ   x  y      \bar{q}(x,y)=w\phi(x,y)   . If so,    t  l     subscript  t  l    t_{l}   is     ±   2  w       (   mod  l   )      annotated   plus-or-minus    2  w     pmod  l     \pm 2w\;\;(\mathop{{\rm mod}}l)   depending on the y-coordinate.  If   q   q   q   turns out not to be a square modulo   l   l   l   or if the equation does not hold for any of   w   w   w   and    -  w      w    -w   , our assumption that     (   x   q  2    ,   y   q  2    )   =   +    q  ¯    (  x  ,  y  )           superscript  x   superscript  q  2     superscript  y   superscript  q  2          normal-¯  q    x  y       (x^{q^{2}},y^{q^{2}})=+\bar{q}(x,y)   is false, thus     (   x   q  2    ,   y   q  2    )   =   -    q  ¯    (  x  ,  y  )           superscript  x   superscript  q  2     superscript  y   superscript  q  2          normal-¯  q    x  y       (x^{q^{2}},y^{q^{2}})=-\bar{q}(x,y)   . The characteristic equation gives     t  l   =  0       subscript  t  l   0    t_{l}=0   .  Additional case    l  =  2      l  2    l=2     If you recall, our initial considerations omit the case of    l  =  2      l  2    l=2   . Since we assume   q   q   q   to be odd,      q  +  1   -  t   ≡   t     (   mod  2   )            q  1   t    annotated  t   pmod  2      q+1-t\equiv t\;\;(\mathop{{\rm mod}}2)   and in particular,     t  2   ≡   0     (   mod  2   )         subscript  t  2    annotated  0   pmod  2      t_{2}\equiv 0\;\;(\mathop{{\rm mod}}2)   if and only if    E   (   𝔽  q   )       E   subscript  𝔽  q     E(\mathbb{F}_{q})   has an element of order 2. By definition of addition in the group, any element of order 2 must be of the form    (   x  0   ,  0  )      subscript  x  0   0    (x_{0},0)   . Thus     t  2   ≡   0     (   mod  2   )         subscript  t  2    annotated  0   pmod  2      t_{2}\equiv 0\;\;(\mathop{{\rm mod}}2)   if and only if the polynomial     x  3   +   A  x   +  B       superscript  x  3     A  x   B    x^{3}+Ax+B   has a root in    𝔽  q     subscript  𝔽  q    \mathbb{F}_{q}   , if and only if     gcd   (    x  q   -  x   ,    x  3   +   A  x   +  B   )    ≠  1           superscript  x  q   x      superscript  x  3     A  x   B    1    \gcd(x^{q}-x,x^{3}+Ax+B)\neq 1   .  The algorithm   (1) Choose a set of odd primes   S   S   S   not containing   p   p   p   such that     N  =    ∏   l  ∈  S    l   >   4   q     .        N    subscript  product    l  S    l          4    q       N=\prod_{l\in S}l>4\sqrt{q}.     (2) Put     t  2   =  0       subscript  t  2   0    t_{2}=0   if     gcd   (    x  q   -  x   ,    x  3   +   A  x   +  B   )    ≠  1           superscript  x  q   x      superscript  x  3     A  x   B    1    \gcd(x^{q}-x,x^{3}+Ax+B)\neq 1   , else     t  2   =  1       subscript  t  2   1    t_{2}=1   .  (3) Compute the division polynomial    ψ  l     subscript  ψ  l    \psi_{l}   . All computations in the loop below are performed in the ring       𝔽  q    [  x  ,  y  ]    /   (    y  2   -   x  3   -   A  x   -  B   ,   ψ  l   )    .         subscript  𝔽  q    x  y        superscript  y  2    superscript  x  3     A  x   B    subscript  ψ  l      \mathbb{F}_{q}[x,y]/(y^{2}-x^{3}-Ax-B,\psi_{l}).     (4) For    l  ∈  S      l  S    l\in S   do:  (a) Let    q  ¯     normal-¯  q    \bar{q}   be the unique integer such that    q  ≡    q  ¯      (   mod  l   )        q   annotated   normal-¯  q    pmod  l      q\equiv\bar{q}\;\;(\mathop{{\rm mod}}l)   and     ∣   q  ¯   ∣   <   l  /  2        delimited-∣∣   normal-¯  q      l  2     \mid\bar{q}\mid   .  (b) Compute    (   x  q   ,   y  q   )      superscript  x  q    superscript  y  q     (x^{q},y^{q})   ,    (   x   q  2    ,   y   q  2    )      superscript  x   superscript  q  2     superscript  y   superscript  q  2      (x^{q^{2}},y^{q^{2}})   and    (   x   q  ¯    ,   y   q  ¯    )      subscript  x   normal-¯  q     subscript  y   normal-¯  q      (x_{\bar{q}},y_{\bar{q}})   .  (c) if     x   q  2    ≠   x   q  ¯         superscript  x   superscript  q  2     subscript  x   normal-¯  q      x^{q^{2}}\neq x_{\bar{q}}   then  (i) Compute    (  X  ,  Y  )     X  Y    (X,Y)   .  (ii) For    1  ≤   t  ¯   ≤    (   l  -  1   )   /  2         1   normal-¯  t            l  1   2      1\leq\bar{t}\leq(l-1)/2   do:  (iii) if    X  =   x   t  ¯   q       X   subscript   superscript  x  q    normal-¯  t      X=x^{q}_{\bar{t}}   then  (iv) if    Y  =   y   t  ¯   q       Y   subscript   superscript  y  q    normal-¯  t      Y=y^{q}_{\bar{t}}   then     t  l   =   t  ¯        subscript  t  l    normal-¯  t     t_{l}=\bar{t}   ; else     t  l   =   -   t  ¯         subscript  t  l      normal-¯  t      t_{l}=-\bar{t}   .        (d) else if   q   q   q   is a square modulo   l   l   l   then  (i) compute   w   w   w   with    q  ≡    w  2      (   mod  l   )        q   annotated   superscript  w  2    pmod  l      q\equiv w^{2}\;\;(\mathop{{\rm mod}}l)     (ii) compute    w   (   x  q   ,   y  q   )       w    superscript  x  q    superscript  y  q      w(x^{q},y^{q})     (iii) if     w   (   x  q   ,   y  q   )    =   (   x   q  2    ,   y   q  2    )         w    superscript  x  q    superscript  y  q       superscript  x   superscript  q  2     superscript  y   superscript  q  2       w(x^{q},y^{q})=(x^{q^{2}},y^{q^{2}})   then     t  l   =   2  w        subscript  t  l     2  w     t_{l}=2w     (iv) else if     w   (   x  q   ,   y  q   )    =   (   x   q  2    ,   -   y   q  2     )         w    superscript  x  q    superscript  y  q       superscript  x   superscript  q  2       superscript  y   superscript  q  2        w(x^{q},y^{q})=(x^{q^{2}},-y^{q^{2}})   then     t  l   =   -   2  w         subscript  t  l       2  w      t_{l}=-2w     (v) else     t  l   =  0       subscript  t  l   0    t_{l}=0       (e) else     t  l   =  0       subscript  t  l   0    t_{l}=0       (5) Use the Chinese Remainder Theorem to compute   t   t   t   modulo   N   N   N   .   Note that since the set   S   S   S   was chosen so that    N  >   4   q        N    4    q      N>4\sqrt{q}   , by Hasse's theorem, we in fact know   t   t   t   and     ♯  E   (   𝔽  q   )    =    q  +  1   -  t         normal-♯  E   subscript  𝔽  q        q  1   t     \sharp E(\mathbb{F}_{q})=q+1-t   precisely.  Complexity  Most of the computation is taken by the evaluation of    ϕ   (  P  )       ϕ  P    \phi(P)   and     ϕ  2    (  P  )        superscript  ϕ  2   P    \phi^{2}(P)   , for each prime   l   l   l   , that is computing    x  q     superscript  x  q    x^{q}   ,    y  q     superscript  y  q    y^{q}   ,    x   q  2      superscript  x   superscript  q  2     x^{q^{2}}   ,    y   q  2      superscript  y   superscript  q  2     y^{q^{2}}   for each prime   l   l   l   . This involves exponentiation in the ring    R  =     𝔽  q    [  x  ,  y  ]    /   (    y  2   -   x  3   -   A  x   -  B   ,   ψ  l   )        R       subscript  𝔽  q    x  y        superscript  y  2    superscript  x  3     A  x   B    subscript  ψ  l       R=\mathbb{F}_{q}[x,y]/(y^{2}-x^{3}-Ax-B,\psi_{l})   and requires    O   (   log  q   )       O    q     O(\log q)   multiplications. Since the degree of    ψ  l     subscript  ψ  l    \psi_{l}   is      l  2   -  1   2         superscript  l  2   1   2    \frac{l^{2}-1}{2}   , each element in the ring is a polynomial of degree    O   (   l  2   )       O   superscript  l  2     O(l^{2})   . By the prime number theorem , there are around    O   (   log  q   )       O    q     O(\log q)   primes of size    O   (   log  q   )       O    q     O(\log q)   , giving that   l   l   l   is    O   (   log  q   )       O    q     O(\log q)   and we obtain that     O   (   l  2   )    =   O   (    log  2   q   )          O   superscript  l  2      O    superscript   2   q      O(l^{2})=O(\log^{2}q)   . Thus each multiplication in the ring   R   R   R   requires    O   (    log  4   q   )       O    superscript   4   q     O(\log^{4}q)   multiplications in    𝔽  q     subscript  𝔽  q    \mathbb{F}_{q}   which in turn requires    O   (    log  2   q   )       O    superscript   2   q     O(\log^{2}q)   bit operations. In total, the number of bit operations for each prime   l   l   l   is    O   (    log  7   q   )       O    superscript   7   q     O(\log^{7}q)   . Given that this computation needs to be carried out for each of the    O   (   log  q   )       O    q     O(\log q)   primes, the total complexity of Schoof's algorithm turns out to be    O   (    log  8   q   )       O    superscript   8   q     O(\log^{8}q)   . Using fast polynomial and integer arithmetic reduces this to     O  ~    (    log  5   q   )        normal-~  O     superscript   5   q     \tilde{O}(\log^{5}q)   .  Improvements to Schoof's algorithm  In the 1990s, Noam Elkies , followed by A. O. L. Atkin , devised improvements to Schoof's basic algorithm by restricting the set of primes    S  =   {   l  1   ,  …  ,   l  s   }       S    subscript  l  1   normal-…   subscript  l  s      S=\{l_{1},\ldots,l_{s}\}   considered before to primes of a certain kind. These came to be called Elkies primes and Atkin primes respectively. A prime   l   l   l   is called an Elkies prime if the characteristic equation       ϕ  2   -   t  ϕ    +  q   =  0           superscript  ϕ  2     t  ϕ    q   0    \phi^{2}-t\phi+q=0   splits over    𝔽  l     subscript  𝔽  l    \mathbb{F}_{l}   , while an Atkin prime is a prime that is not an Elkies prime. Atkin showed how to combine information obtained from the Atkin primes with the information obtained from Elkies primes to produce an efficient algorithm, which came to be known as the Schoof–Elkies–Atkin algorithm . The first problem to address is to determine whether a given prime is Elkies or Atkin. In order to do so, we make use of modular polynomials, which come from the study of modular forms and an interpretation of elliptic curves over the complex numbers as lattices. Once we have determined which case we are in, instead of using division polynomials , we are able to work with a polynomial that has lower degree than the corresponding division polynomial    O   (  l  )       O  l    O(l)   rather than    O   (   l  2   )       O   superscript  l  2     O(l^{2})   . For efficient implementation, probabilistic root-finding algorithms are used, which makes this a Las Vegas algorithm rather than a deterministic algorithm. Under the heuristic assumption that approximately half of the primes up to an    O   (   log  q   )       O    q     O(\log q)   bound are Elkies primes, this yields an algorithm that is more efficient than Schoof's, with an expected running time of    O   (    log  6   q   )       O    superscript   6   q     O(\log^{6}q)   using naive arithmetic, and     O  ~    (    log  4   q   )        normal-~  O     superscript   4   q     \tilde{O}(\log^{4}q)   using fast arithmetic. It should be noted that while this heuristic assumption is known to hold for most elliptic curves, it is not known to hold in every case, even under the GRH .  Implementations  Several algorithms were implemented in C++ by Mike Scott and are available with source code . The implementations are free (no terms, no conditions), and make use of the MIRACL library which is distributed under the AGPLv3 .   Schoof's algorithm implementation for    E   (   𝔽  p   )       E   subscript  𝔽  p     E(\mathbb{F}_{p})   with prime   p   p   p   .  Schoof's algorithm implementation for    E   (   𝔽   2  m    )       E   subscript  𝔽   superscript  2  m      E(\mathbb{F}_{2^{m}})   .   See also   Elliptic curve cryptography  Counting points on elliptic curves  Division Polynomials  Frobenius endomorphism   References   R. Schoof: Elliptic Curves over Finite Fields and the Computation of Square Roots mod p. Math. Comp., 44(170):483–494, 1985. Available at http://www.mat.uniroma2.it/~schoof/ctpts.pdf  R. Schoof: Counting Points on Elliptic Curves over Finite Fields. J. Theor. Nombres Bordeaux 7:219–254, 1995. Available at http://www.mat.uniroma2.it/~schoof/ctg.pdf  G. Musiker: Schoof's Algorithm for Counting Points on    E   (   𝔽  q   )       E   subscript  𝔽  q     E(\mathbb{F}_{q})   . Available at http://www.math.umn.edu/~musiker/schoof.pdf  V. Müller : Die Berechnung der Punktanzahl von elliptischen kurven über endlichen Primkörpern. Master's Thesis. Universität des Saarlandes, Saarbrücken, 1991. Available at http://lecturer.ukdw.ac.id/vmueller/publications.php  A. Enge: Elliptic Curves and their Applications to Cryptography: An Introduction. Kluwer Academic Publishers, Dordrecht, 1999.  L. C. Washington: Elliptic Curves: Number Theory and Cryptography. Chapman & Hall/CRC, New York, 2003.  N. Koblitz: A Course in Number Theory and Cryptography, Graduate Texts in Math. No. 114, Springer-Verlag, 1987. Second edition, 1994   "  Category:Asymmetric-key algorithms  Category:Elliptic curve cryptography  Category:Elliptic curves  Category:Group theory  Category:Finite fields  Category:Number theory   