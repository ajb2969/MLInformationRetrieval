   Canonical transformation      Canonical transformation   In Hamiltonian mechanics , a canonical transformation is a change of canonical coordinates      (  𝐪  ,  𝐩  ,  t  )   →   (  𝐐  ,  𝐏  ,  t  )        𝐪  𝐩  t   normal-→   𝐐  𝐏  t     (\mathbf{q},\mathbf{p},t)→(\mathbf{Q},\mathbf{P},t)   that preserves the form of Hamilton's equations (that is, the new Hamilton's equations resulting from the transformed Hamiltonian may be simply obtained by substituting the new coordinates for the old coordinates), although it might not preserve the Hamiltonian itself. This is sometimes known as form invariance . Canonical transformations are useful in their own right, and also form the basis for the Hamilton–Jacobi equations (a useful method for calculating conserved quantities ) and Liouville's theorem (itself the basis for classical statistical mechanics ).  Since Lagrangian mechanics is based on generalized coordinates , transformations of the coordinates    𝐪  →  𝐐      𝐪  normal-→  𝐐    \mathbf{q}→\mathbf{Q}   do not affect the form of Lagrange's equations and, hence, do not affect the form of Hamilton's equations if we simultaneously change the momentum by a Legendre transform into        P  i   =    ∂  L    ∂    Q  ˙   i      .       subscript  P  i       L      subscript   normal-˙  Q   i       P_{i}=\frac{\partial L}{\partial\dot{Q}_{i}}.     Therefore, coordinate transformations (also called point transformations ) are a type of canonical transformation. However, the class of canonical transformations is much broader, since the old generalized coordinates, momenta and even time may be combined to form the new generalized coordinates and momenta. Canonical transformations that do not include the time explicitly are called restricted canonical transformations (many textbooks consider only this type).  For clarity, we restrict the presentation here to calculus and classical mechanics . Readers familiar with more advanced mathematics such as cotangent bundles , exterior derivatives and symplectic manifolds should read the related symplectomorphism article. (Canonical transformations are a special case of a symplectomorphism.) However, a brief introduction to the modern mathematical description is included at the end of this article.  Notation  Boldface variables such as   𝐪   𝐪   \mathbf{q}   represent a list of   N   N   N    generalized coordinates that need not transform like a vector under rotation , e.g.,       𝐪  ≡   (   q  1   ,   q  2   ,  …  ,   q   N  -  1    ,   q  N   )    .      𝐪    subscript  q  1    subscript  q  2   normal-…   subscript  q    N  1     subscript  q  N      \mathbf{q}\equiv\left(q_{1},q_{2},\ldots,q_{N-1},q_{N}\right).     A dot over a variable or list signifies the time derivative, e.g.,        𝐪  ˙   ≡    d  𝐪    d  t     .       normal-˙  𝐪       d  𝐪     d  t      \dot{\mathbf{q}}\equiv\frac{d\mathbf{q}}{dt}.     The dot product notation between two lists of the same number of coordinates is a shorthand for the sum of the products of corresponding components, e.g.,        𝐩  ⋅  𝐪   ≡    ∑   k  =  1   N     p  k    q  k      .       normal-⋅  𝐩  𝐪     superscript   subscript     k  1    N      subscript  p  k    subscript  q  k       \mathbf{p}\cdot\mathbf{q}\equiv\sum_{k=1}^{N}p_{k}q_{k}.     The dot product (also known as an "inner product") maps the two coordinate lists into one variable representing a single numerical value.  Direct approach  The functional form of Hamilton's equations is      𝐩  ˙     normal-˙  𝐩    \displaystyle\dot{\mathbf{p}}     By definition, the transformed coordinates have analogous dynamics      𝐏  ˙     normal-˙  𝐏    \displaystyle\dot{\mathbf{P}}     where    K   (  𝐐  ,  𝐏  )       K   𝐐  𝐏     K(\mathbf{Q},\mathbf{P})   is a new Hamiltonian that must be determined.  In general, a transformation     (  𝐪  ,  𝐩  ,  t  )   →   (  𝐐  ,  𝐏  ,  t  )        𝐪  𝐩  t   normal-→   𝐐  𝐏  t     (\mathbf{q},\mathbf{p},t)→(\mathbf{Q},\mathbf{P},t)   does not preserve the form of Hamilton's equations . For time independent transformations between    (  𝐪  ,  𝐩  )     𝐪  𝐩    (\mathbf{q},\mathbf{p})   and    (  𝐐  ,  𝐏  )     𝐐  𝐏    (\mathbf{Q},\mathbf{P})   we may check if the transformation is restricted canonical, as follows. Since restricted transformations have no explicit time dependence (by definition), the time derivative of a new generalized coordinate is       Q  ˙   m     subscript   normal-˙  Q   m    \displaystyle\dot{Q}_{m}     where  is the Poisson bracket .  We also have the identity for the conjugate momentum P m        ∂  H    ∂   P  m     =      ∂  H    ∂  𝐪    ⋅    ∂  𝐪    ∂   P  m      +     ∂  H    ∂  𝐩    ⋅    ∂  𝐩    ∂   P  m               H      subscript  P  m        normal-⋅      H     𝐪        𝐪      subscript  P  m       normal-⋅      H     𝐩        𝐩      subscript  P  m         \frac{\partial H}{\partial P_{m}}=\frac{\partial H}{\partial\mathbf{q}}\cdot%
 \frac{\partial\mathbf{q}}{\partial P_{m}}+\frac{\partial H}{\partial\mathbf{p}%
 }\cdot\frac{\partial\mathbf{p}}{\partial P_{m}}     If the transformation is canonical, these two must be equal, resulting in the equations       (     ∂   Q  m     ∂   p  n      )    𝐪  ,  𝐩      subscript       subscript  Q  m       subscript  p  n      𝐪  𝐩     \displaystyle\left(\frac{\partial Q_{m}}{\partial p_{n}}\right)_{\mathbf{q},%
 \mathbf{p}}     The analogous argument for the generalized momenta P m leads to two other sets of equations       (     ∂   P  m     ∂   p  n      )    𝐪  ,  𝐩      subscript       subscript  P  m       subscript  p  n      𝐪  𝐩     \displaystyle\left(\frac{\partial P_{m}}{\partial p_{n}}\right)_{\mathbf{q},%
 \mathbf{p}}     These are the direct conditions to check whether a given transformation is canonical.  Liouville's theorem  The direct conditions allow us to prove Liouville's theorem , which states that the volume in phase space is conserved under canonical transformations, i.e.,       ∫   d  𝐪  d  𝐩    =   ∫   d  𝐐  d  𝐏            d  𝐪  d  𝐩        d  𝐐  d  𝐏      \int d\mathbf{q}d\mathbf{p}=\int d\mathbf{Q}d\mathbf{P}     By calculus , the latter integral must equal the former times the Jacobian    J   J   J          ∫   d  𝐐  d  𝐏    =   ∫   J  d  𝐪  d  𝐩            d  𝐐  d  𝐏        J  d  𝐪  d  𝐩      \int d\mathbf{Q}d\mathbf{P}=\int Jd\mathbf{q}d\mathbf{p}     where the Jacobian is the determinant of the matrix of partial derivatives , which we write as      J  ≡    ∂   (  𝐐  ,  𝐏  )     ∂   (  𝐪  ,  𝐩  )         J      𝐐  𝐏     𝐪  𝐩      J\equiv\frac{\partial(\mathbf{Q},\mathbf{P})}{\partial(\mathbf{q},\mathbf{p})}     Exploiting the "division" property of Jacobians yields      J  ≡     ∂   (  𝐐  ,  𝐏  )     ∂   (  𝐪  ,  𝐏  )     /    ∂   (  𝐪  ,  𝐩  )     ∂   (  𝐪  ,  𝐏  )          J   normal-/      𝐐  𝐏     𝐪  𝐏        𝐪  𝐩     𝐪  𝐏       J\equiv\frac{\partial(\mathbf{Q},\mathbf{P})}{\partial(\mathbf{q},\mathbf{P})}%
 \left/\frac{\partial(\mathbf{q},\mathbf{p})}{\partial(\mathbf{q},\mathbf{P})}\right.     Eliminating the repeated variables gives      J  ≡     ∂   (  𝐐  )     ∂   (  𝐪  )     /    ∂   (  𝐩  )     ∂   (  𝐏  )          J   normal-/      𝐐     𝐪        𝐩     𝐏       J\equiv\frac{\partial(\mathbf{Q})}{\partial(\mathbf{q})}\left/\frac{\partial(%
 \mathbf{p})}{\partial(\mathbf{P})}\right.     Application of the direct conditions above yields    J  =  1      J  1    J=1   .  Generating function approach  To guarantee a valid transformation between    (  𝐪  ,  𝐩  ,  H  )     𝐪  𝐩  H    (\mathbf{q},\mathbf{p},H)   and    (  𝐐  ,  𝐏  ,  K  )     𝐐  𝐏  K    (\mathbf{Q},\mathbf{P},K)   , we may resort to an indirect generating function approach. Both sets of variables must obey Hamilton's principle . That is the Action Integral over the Lagrangian      ℒ   q  p    =    𝐩  ⋅   𝐪  ˙    -   H   (  𝐪  ,  𝐩  ,  t  )          subscript  ℒ    q  p       normal-⋅  𝐩   normal-˙  𝐪      H   𝐪  𝐩  t       \mathcal{L}_{qp}=\mathbf{p}\cdot\dot{\mathbf{q}}-H(\mathbf{q},\mathbf{p},t)   and     ℒ   Q  P    =    𝐏  ⋅   𝐐  ˙    -   K   (  𝐐  ,  𝐏  ,  t  )          subscript  ℒ    Q  P       normal-⋅  𝐏   normal-˙  𝐐      K   𝐐  𝐏  t       \mathcal{L}_{QP}=\mathbf{P}\cdot\dot{\mathbf{Q}}-K(\mathbf{Q},\mathbf{P},t)   respectively, obtained by the Hamiltonian via ("inverse") Legendre transformation , both must be stationary (so that one can use the Euler–Lagrange equations to arrive at equations of the above-mentioned and designated form; as it is shown for example here ):      δ     ∫   t  1    t  2       [    𝐩  ⋅   𝐪  ˙    -   H   (  𝐪  ,  𝐩  ,  t  )     ]   d  t        δ    superscript   subscript    subscript  t  1     subscript  t  2       delimited-[]     normal-⋅  𝐩   normal-˙  𝐪      H   𝐪  𝐩  t      d  t      \displaystyle\delta\int_{t_{1}}^{t_{2}}\left[\mathbf{p}\cdot\dot{\mathbf{q}}-H%
 (\mathbf{q},\mathbf{p},t)\right]dt     One way for both variational integral equalities to be satisfied is to have       λ   [    𝐩  ⋅   𝐪  ˙    -   H   (  𝐪  ,  𝐩  ,  t  )     ]    =     𝐏  ⋅   𝐐  ˙    -   K   (  𝐐  ,  𝐏  ,  t  )     +    d  G    d  t           λ   delimited-[]     normal-⋅  𝐩   normal-˙  𝐪      H   𝐪  𝐩  t            normal-⋅  𝐏   normal-˙  𝐐      K   𝐐  𝐏  t         d  G     d  t       \lambda\left[\mathbf{p}\cdot\dot{\mathbf{q}}-H(\mathbf{q},\mathbf{p},t)\right]%
 =\mathbf{P}\cdot\dot{\mathbf{Q}}-K(\mathbf{Q},\mathbf{P},t)+\frac{dG}{dt}     Lagrangians are not unique: one can always multiply by a constant   λ   λ   λ   and add a total time derivative     d  G    d  t         d  G     d  t     \frac{dG}{dt}   and yield the same equations of motion (see for reference: http://en.wikibooks.org/wiki/Classical_Mechanics/Lagrange_Theory#Is_the_Lagrangian_unique.3F ).  In general, the scaling factor   λ   λ   λ   is set equal to one; canonical transformations for which    λ  ≠  1      λ  normal-≠  1    λ≠1   are called extended canonical transformations .     d  G    d  t         d  G     d  t     \frac{dG}{dt}   is kept, otherwise the problem would be rendered trivial and there would be not much freedom for the new canonical variables to differ from the old ones.  Here   G   G   G   is a generating function of one old canonical coordinate (   𝐪   𝐪   \mathbf{q}   or   𝐩   𝐩   \mathbf{p}   ), one new canonical coordinate (   𝐐   𝐐   \mathbf{Q}   or   𝐏   𝐏   \mathbf{P}   ) and (possibly) the time   t   t   t   . Thus, there are four basic types of generating functions (although it should be noted that mixtures of these four types can exist), depending on the choice of variables. As will be shown below, the generating function will define a transformation from old to new canonical coordinates , and any such transformation     (  𝐪  ,  𝐩  )   →   (  𝐐  ,  𝐏  )        𝐪  𝐩   normal-→   𝐐  𝐏     (\mathbf{q},\mathbf{p})→(\mathbf{Q},\mathbf{P})   is guaranteed to be canonical.  Type 1 generating function  The type 1 generating function depends only on the old and new generalized coordinates      G  ≡    G  1    (  𝐪  ,  𝐐  ,  t  )        G     subscript  G  1    𝐪  𝐐  t      G\equiv G_{1}(\mathbf{q},\mathbf{Q},t)   To derive the implicit transformation, we expand the defining equation above        𝐩  ⋅   𝐪  ˙    -   H   (  𝐪  ,  𝐩  ,  t  )     =     𝐏  ⋅   𝐐  ˙    -   K   (  𝐐  ,  𝐏  ,  t  )     +    ∂   G  1     ∂  t    +     ∂   G  1     ∂  𝐪    ⋅   𝐪  ˙    +     ∂   G  1     ∂  𝐐    ⋅   𝐐  ˙            normal-⋅  𝐩   normal-˙  𝐪      H   𝐪  𝐩  t          normal-⋅  𝐏   normal-˙  𝐐      K   𝐐  𝐏  t          subscript  G  1      t     normal-⋅       subscript  G  1      𝐪     normal-˙  𝐪     normal-⋅       subscript  G  1      𝐐     normal-˙  𝐐       \mathbf{p}\cdot\dot{\mathbf{q}}-H(\mathbf{q},\mathbf{p},t)=\mathbf{P}\cdot\dot%
 {\mathbf{Q}}-K(\mathbf{Q},\mathbf{P},t)+\frac{\partial G_{1}}{\partial t}+%
 \frac{\partial G_{1}}{\partial\mathbf{q}}\cdot\dot{\mathbf{q}}+\frac{\partial G%
 _{1}}{\partial\mathbf{Q}}\cdot\dot{\mathbf{Q}}     Since the new and old coordinates are each independent, the following     2  N   +  1        2  N   1    2N+1   equations must hold     𝐩   𝐩   \displaystyle\mathbf{p}     These equations define the transformation     (  𝐪  ,  𝐩  )   →   (  𝐐  ,  𝐏  )        𝐪  𝐩   normal-→   𝐐  𝐏     (\mathbf{q},\mathbf{p})→(\mathbf{Q},\mathbf{P})   as follows. The first set of   N   N   N   equations      𝐩  =    ∂   G  1     ∂  𝐪        𝐩       subscript  G  1      𝐪      \mathbf{p}=\frac{\partial G_{1}}{\partial\mathbf{q}}     define relations between the new generalized coordinates    𝐐   𝐐   \mathbf{Q}   and the old canonical coordinates     (  𝐪  ,  𝐩  )     𝐪  𝐩    (\mathbf{q},\mathbf{p})   . Ideally, one can invert these relations to obtain formulae for each as a function of the old canonical coordinates. Substitution of these formulae for the   𝐐   𝐐   \mathbf{Q}   coordinates into the second set of   N   N   N   equations      𝐏  =   -    ∂   G  1     ∂  𝐐         𝐏         subscript  G  1      𝐐       \mathbf{P}=-\frac{\partial G_{1}}{\partial\mathbf{Q}}     yields analogous formulae for the new generalized momenta   𝐏   𝐏   \mathbf{P}   in terms of the old canonical coordinates     (  𝐪  ,  𝐩  )     𝐪  𝐩    (\mathbf{q},\mathbf{p})   . We then invert both sets of formulae to obtain the old  canonical coordinates     (  𝐪  ,  𝐩  )     𝐪  𝐩    (\mathbf{q},\mathbf{p})   as functions of the new  canonical coordinates     (  𝐐  ,  𝐏  )     𝐐  𝐏    (\mathbf{Q},\mathbf{P})   . Substitution of the inverted formulae into the final equation      K  =   H  +    ∂   G  1     ∂  t         K    H       subscript  G  1      t       K=H+\frac{\partial G_{1}}{\partial t}   yields a formula for   K   K   K   as a function of the new canonical coordinates     (  𝐐  ,  𝐏  )     𝐐  𝐏    (\mathbf{Q},\mathbf{P})   .  In practice, this procedure is easier than it sounds, because the generating function is usually simple. For example, let       G  1   ≡   𝐪  ⋅  𝐐        subscript  G  1    normal-⋅  𝐪  𝐐     G_{1}\equiv\mathbf{q}\cdot\mathbf{Q}   This results in swapping the generalized coordinates for the momenta and vice versa     𝐩   𝐩   \displaystyle\mathbf{p}   and    K  =  H      K  H    K=H   . This example illustrates how independent the coordinates and momenta are in the Hamiltonian formulation; they are equivalent variables.  Type 2 generating function  The type 2 generating function depends only on the old generalized coordinates and the new generalized momenta      G  ≡    -   𝐐  ⋅  𝐏    +    G  2    (  𝐪  ,  𝐏  ,  t  )         G       normal-⋅  𝐐  𝐏       subscript  G  2    𝐪  𝐏  t       G\equiv-\mathbf{Q}\cdot\mathbf{P}+G_{2}(\mathbf{q},\mathbf{P},t)   where the    -   𝐐  ⋅  𝐏        normal-⋅  𝐐  𝐏     -\mathbf{Q}\cdot\mathbf{P}   terms represent a Legendre transformation to change the right-hand side of the equation below. To derive the implicit transformation, we expand the defining equation above        𝐩  ⋅   𝐪  ˙    -   H   (  𝐪  ,  𝐩  ,  t  )     =     -   𝐐  ⋅   𝐏  ˙     -   K   (  𝐐  ,  𝐏  ,  t  )     +    ∂   G  2     ∂  t    +     ∂   G  2     ∂  𝐪    ⋅   𝐪  ˙    +     ∂   G  2     ∂  𝐏    ⋅   𝐏  ˙            normal-⋅  𝐩   normal-˙  𝐪      H   𝐪  𝐩  t            normal-⋅  𝐐   normal-˙  𝐏       K   𝐐  𝐏  t          subscript  G  2      t     normal-⋅       subscript  G  2      𝐪     normal-˙  𝐪     normal-⋅       subscript  G  2      𝐏     normal-˙  𝐏       \mathbf{p}\cdot\dot{\mathbf{q}}-H(\mathbf{q},\mathbf{p},t)=-\mathbf{Q}\cdot%
 \dot{\mathbf{P}}-K(\mathbf{Q},\mathbf{P},t)+\frac{\partial G_{2}}{\partial t}+%
 \frac{\partial G_{2}}{\partial\mathbf{q}}\cdot\dot{\mathbf{q}}+\frac{\partial G%
 _{2}}{\partial\mathbf{P}}\cdot\dot{\mathbf{P}}     Since the old coordinates and new momenta are each independent, the following     2  N   +  1        2  N   1    2N+1   equations must hold     𝐩   𝐩   \displaystyle\mathbf{p}     These equations define the transformation     (  𝐪  ,  𝐩  )   →   (  𝐐  ,  𝐏  )        𝐪  𝐩   normal-→   𝐐  𝐏     (\mathbf{q},\mathbf{p})→(\mathbf{Q},\mathbf{P})   as follows. The first set of   N   N   N   equations      𝐩  =    ∂   G  2     ∂  𝐪        𝐩       subscript  G  2      𝐪      \mathbf{p}=\frac{\partial G_{2}}{\partial\mathbf{q}}     define relations between the new generalized momenta   𝐏   𝐏   \mathbf{P}   and the old canonical coordinates     (  𝐪  ,  𝐩  )     𝐪  𝐩    (\mathbf{q},\mathbf{p})   . Ideally, one can invert these relations to obtain formulae for each as a function of the old canonical coordinates. Substitution of these formulae for the   𝐏   𝐏   \mathbf{P}   coordinates into the second set of   N   N   N   equations      𝐐  =    ∂   G  2     ∂  𝐏        𝐐       subscript  G  2      𝐏      \mathbf{Q}=\frac{\partial G_{2}}{\partial\mathbf{P}}     yields analogous formulae for the new generalized coordinates   𝐐   𝐐   \mathbf{Q}   in terms of the old canonical coordinates     (  𝐪  ,  𝐩  )     𝐪  𝐩    (\mathbf{q},\mathbf{p})   . We then invert both sets of formulae to obtain the old  canonical coordinates     (  𝐪  ,  𝐩  )     𝐪  𝐩    (\mathbf{q},\mathbf{p})   as functions of the new  canonical coordinates     (  𝐐  ,  𝐏  )     𝐐  𝐏    (\mathbf{Q},\mathbf{P})   . Substitution of the inverted formulae into the final equation      K  =   H  +    ∂   G  2     ∂  t         K    H       subscript  G  2      t       K=H+\frac{\partial G_{2}}{\partial t}   yields a formula for   K   K   K   as a function of the new canonical coordinates     (  𝐐  ,  𝐏  )     𝐐  𝐏    (\mathbf{Q},\mathbf{P})   .  In practice, this procedure is easier than it sounds, because the generating function is usually simple. For example, let       G  2   ≡    𝐠   (  𝐪  ;  t  )    ⋅  𝐏        subscript  G  2    normal-⋅    𝐠   𝐪  t    𝐏     G_{2}\equiv\mathbf{g}(\mathbf{q};t)\cdot\mathbf{P}   where   𝐠   𝐠   \mathbf{g}   is a set of   N   N   N   functions. This results in a point transformation of the generalized coordinates      𝐐  =    ∂   G  2     ∂  𝐏    =   𝐠   (  𝐪  ;  t  )          𝐐       subscript  G  2      𝐏           𝐠   𝐪  t       \mathbf{Q}=\frac{\partial G_{2}}{\partial\mathbf{P}}=\mathbf{g}(\mathbf{q};t)     Type 3 generating function  The type 3 generating function depends only on the old generalized momenta and the new generalized coordinates      G  ≡    𝐪  ⋅  𝐩   +    G  3    (  𝐩  ,  𝐐  ,  t  )         G     normal-⋅  𝐪  𝐩      subscript  G  3    𝐩  𝐐  t       G\equiv\mathbf{q}\cdot\mathbf{p}+G_{3}(\mathbf{p},\mathbf{Q},t)   where the    𝐪  ⋅  𝐩     normal-⋅  𝐪  𝐩    \mathbf{q}\cdot\mathbf{p}   terms represent a Legendre transformation to change the left-hand side of the equation below. To derive the implicit transformation, we expand the defining equation above        -   𝐪  ⋅   𝐩  ˙     -   H   (  𝐪  ,  𝐩  ,  t  )     =     𝐏  ⋅   𝐐  ˙    -   K   (  𝐐  ,  𝐏  ,  t  )     +    ∂   G  3     ∂  t    +     ∂   G  3     ∂  𝐩    ⋅   𝐩  ˙    +     ∂   G  3     ∂  𝐐    ⋅   𝐐  ˙              normal-⋅  𝐪   normal-˙  𝐩       H   𝐪  𝐩  t          normal-⋅  𝐏   normal-˙  𝐐      K   𝐐  𝐏  t          subscript  G  3      t     normal-⋅       subscript  G  3      𝐩     normal-˙  𝐩     normal-⋅       subscript  G  3      𝐐     normal-˙  𝐐       -\mathbf{q}\cdot\dot{\mathbf{p}}-H(\mathbf{q},\mathbf{p},t)=\mathbf{P}\cdot%
 \dot{\mathbf{Q}}-K(\mathbf{Q},\mathbf{P},t)+\frac{\partial G_{3}}{\partial t}+%
 \frac{\partial G_{3}}{\partial\mathbf{p}}\cdot\dot{\mathbf{p}}+\frac{\partial G%
 _{3}}{\partial\mathbf{Q}}\cdot\dot{\mathbf{Q}}     Since the new and old coordinates are each independent, the following     2  N   +  1        2  N   1    2N+1   equations must hold     𝐪   𝐪   \displaystyle\mathbf{q}     These equations define the transformation     (  𝐪  ,  𝐩  )   →   (  𝐐  ,  𝐏  )        𝐪  𝐩   normal-→   𝐐  𝐏     (\mathbf{q},\mathbf{p})→(\mathbf{Q},\mathbf{P})   as follows. The first set of   N   N   N   equations      𝐪  =   -    ∂   G  3     ∂  𝐩         𝐪         subscript  G  3      𝐩       \mathbf{q}=-\frac{\partial G_{3}}{\partial\mathbf{p}}     define relations between the new generalized coordinates    𝐐   𝐐   \mathbf{Q}   and the old canonical coordinates     (  𝐪  ,  𝐩  )     𝐪  𝐩    (\mathbf{q},\mathbf{p})   . Ideally, one can invert these relations to obtain formulae for each as a function of the old canonical coordinates. Substitution of these formulae for the   𝐐   𝐐   \mathbf{Q}   coordinates into the second set of   N   N   N   equations      𝐏  =   -    ∂   G  3     ∂  𝐐         𝐏         subscript  G  3      𝐐       \mathbf{P}=-\frac{\partial G_{3}}{\partial\mathbf{Q}}     yields analogous formulae for the new generalized momenta   𝐏   𝐏   \mathbf{P}   in terms of the old canonical coordinates     (  𝐪  ,  𝐩  )     𝐪  𝐩    (\mathbf{q},\mathbf{p})   . We then invert both sets of formulae to obtain the old  canonical coordinates     (  𝐪  ,  𝐩  )     𝐪  𝐩    (\mathbf{q},\mathbf{p})   as functions of the new  canonical coordinates     (  𝐐  ,  𝐏  )     𝐐  𝐏    (\mathbf{Q},\mathbf{P})   . Substitution of the inverted formulae into the final equation      K  =   H  +    ∂   G  3     ∂  t         K    H       subscript  G  3      t       K=H+\frac{\partial G_{3}}{\partial t}   yields a formula for   K   K   K   as a function of the new canonical coordinates     (  𝐐  ,  𝐏  )     𝐐  𝐏    (\mathbf{Q},\mathbf{P})   .  In practice, this procedure is easier than it sounds, because the generating function is usually simple.  Type 4 generating function  The type 4 generating function     G  4    (  𝐩  ,  𝐏  ,  t  )        subscript  G  4    𝐩  𝐏  t     G_{4}(\mathbf{p},\mathbf{P},t)   depends only on the old and new generalized momenta      G  ≡     𝐪  ⋅  𝐩   -   𝐐  ⋅  𝐏    +    G  4    (  𝐩  ,  𝐏  ,  t  )         G       normal-⋅  𝐪  𝐩    normal-⋅  𝐐  𝐏       subscript  G  4    𝐩  𝐏  t       G\equiv\mathbf{q}\cdot\mathbf{p}-\mathbf{Q}\cdot\mathbf{P}+G_{4}(\mathbf{p},%
 \mathbf{P},t)   where the     𝐪  ⋅  𝐩   -   𝐐  ⋅  𝐏        normal-⋅  𝐪  𝐩    normal-⋅  𝐐  𝐏     \mathbf{q}\cdot\mathbf{p}-\mathbf{Q}\cdot\mathbf{P}   terms represent a Legendre transformation to change both sides of the equation below. To derive the implicit transformation, we expand the defining equation above        -   𝐪  ⋅   𝐩  ˙     -   H   (  𝐪  ,  𝐩  ,  t  )     =     -   𝐐  ⋅   𝐏  ˙     -   K   (  𝐐  ,  𝐏  ,  t  )     +    ∂   G  4     ∂  t    +     ∂   G  4     ∂  𝐩    ⋅   𝐩  ˙    +     ∂   G  4     ∂  𝐏    ⋅   𝐏  ˙              normal-⋅  𝐪   normal-˙  𝐩       H   𝐪  𝐩  t            normal-⋅  𝐐   normal-˙  𝐏       K   𝐐  𝐏  t          subscript  G  4      t     normal-⋅       subscript  G  4      𝐩     normal-˙  𝐩     normal-⋅       subscript  G  4      𝐏     normal-˙  𝐏       -\mathbf{q}\cdot\dot{\mathbf{p}}-H(\mathbf{q},\mathbf{p},t)=-\mathbf{Q}\cdot%
 \dot{\mathbf{P}}-K(\mathbf{Q},\mathbf{P},t)+\frac{\partial G_{4}}{\partial t}+%
 \frac{\partial G_{4}}{\partial\mathbf{p}}\cdot\dot{\mathbf{p}}+\frac{\partial G%
 _{4}}{\partial\mathbf{P}}\cdot\dot{\mathbf{P}}     Since the new and old coordinates are each independent, the following     2  N   +  1        2  N   1    2N+1   equations must hold     𝐪   𝐪   \displaystyle\mathbf{q}     These equations define the transformation     (  𝐪  ,  𝐩  )   →   (  𝐐  ,  𝐏  )        𝐪  𝐩   normal-→   𝐐  𝐏     (\mathbf{q},\mathbf{p})→(\mathbf{Q},\mathbf{P})   as follows. The first set of   N   N   N   equations      𝐪  =   -    ∂   G  4     ∂  𝐩         𝐪         subscript  G  4      𝐩       \mathbf{q}=-\frac{\partial G_{4}}{\partial\mathbf{p}}     define relations between the new generalized momenta   𝐏   𝐏   \mathbf{P}   and the old canonical coordinates     (  𝐪  ,  𝐩  )     𝐪  𝐩    (\mathbf{q},\mathbf{p})   . Ideally, one can invert these relations to obtain formulae for each as a function of the old canonical coordinates. Substitution of these formulae for the   𝐏   𝐏   \mathbf{P}   coordinates into the second set of   N   N   N   equations      𝐐  =    ∂   G  4     ∂  𝐏        𝐐       subscript  G  4      𝐏      \mathbf{Q}=\frac{\partial G_{4}}{\partial\mathbf{P}}     yields analogous formulae for the new generalized coordinates   𝐐   𝐐   \mathbf{Q}   in terms of the old canonical coordinates     (  𝐪  ,  𝐩  )     𝐪  𝐩    (\mathbf{q},\mathbf{p})   . We then invert both sets of formulae to obtain the old  canonical coordinates     (  𝐪  ,  𝐩  )     𝐪  𝐩    (\mathbf{q},\mathbf{p})   as functions of the new  canonical coordinates     (  𝐐  ,  𝐏  )     𝐐  𝐏    (\mathbf{Q},\mathbf{P})   . Substitution of the inverted formulae into the final equation      K  =   H  +    ∂   G  4     ∂  t         K    H       subscript  G  4      t       K=H+\frac{\partial G_{4}}{\partial t}   yields a formula for   K   K   K   as a function of the new canonical coordinates     (  𝐐  ,  𝐏  )     𝐐  𝐏    (\mathbf{Q},\mathbf{P})   .  Motion as a canonical transformation  Motion itself (or, equivalently, a shift in the time origin) is a canonical transformation. If     𝐐   (  t  )    ≡   𝐪   (   t  +  τ   )          𝐐  t     𝐪    t  τ      \mathbf{Q}(t)\equiv\mathbf{q}(t+\tau)   and     𝐏   (  t  )    ≡   𝐩   (   t  +  τ   )          𝐏  t     𝐩    t  τ      \mathbf{P}(t)\equiv\mathbf{p}(t+\tau)   , then Hamilton's principle is automatically satisfied       δ    ∫   t  1    t  2      [    𝐏  ⋅   𝐐  ˙    -   K   (  𝐐  ,  𝐏  ,  t  )     ]   d  t     =   δ    ∫    t  1   +  τ     t  2   +  τ      [    𝐩  ⋅   𝐪  ˙    -   H   (  𝐪  ,  𝐩  ,   t  +  τ   )     ]   d  t     =  0          δ    superscript   subscript    subscript  t  1     subscript  t  2       delimited-[]     normal-⋅  𝐏   normal-˙  𝐐      K   𝐐  𝐏  t      d  t       δ    superscript   subscript      subscript  t  1   τ       subscript  t  2   τ       delimited-[]     normal-⋅  𝐩   normal-˙  𝐪      H   𝐪  𝐩    t  τ       d  t          0     \delta\int_{t_{1}}^{t_{2}}\left[\mathbf{P}\cdot\dot{\mathbf{Q}}-K(\mathbf{Q},%
 \mathbf{P},t)\right]dt=\delta\int_{t_{1}+\tau}^{t_{2}+\tau}\left[\mathbf{p}%
 \cdot\dot{\mathbf{q}}-H(\mathbf{q},\mathbf{p},t+\tau)\right]dt=0     since a valid trajectory    (   𝐪   (  t  )    ,   𝐩   (  t  )    )       𝐪  t     𝐩  t     (\mathbf{q}(t),\mathbf{p}(t))   should always satisfy Hamilton's principle , regardless of the endpoints.  Modern mathematical description  In mathematical terms, canonical coordinates are any coordinates on the phase space ( cotangent bundle ) of the system that allow the canonical one-form to be written as       ∑  i      p  i    d   q  i        subscript   i      subscript  p  i   d   superscript  q  i      \sum_{i}p_{i}\,dq^{i}     up to a total differential ( exact form ). The change of variable between one set of canonical coordinates and another is a canonical transformation . The index of the generalized coordinates    𝐪   𝐪   \mathbf{q}   is written here as a superscript (    q  i     superscript  q  i    q^{i}   ), not as a subscript as done above (    q  i     subscript  q  i    q_{i}   ). The superscript conveys the contravariant transformation properties of the generalized coordinates, and does not mean that the coordinate is being raised to a power. Further details may be found at the symplectomorphism article.  History  The first major application of the canonical transformation was in 1846, by Charles Delaunay , in the study of the Earth-Moon-Sun system . This work resulted in the publication of a pair of large volumes as Mémoires by the French Academy of Sciences , in 1860 and 1867.  See also   Symplectomorphism  Hamilton–Jacobi equation  Liouville's theorem (Hamiltonian)  Mathieu transformation  Linear canonical transformation   References   Landau LD and Lifshitz EM (1976) Mechanics , 3rd. ed., Pergamon Press. ISBN 0-08-021022-8 (hardcover) and ISBN 0-08-029141-4 (softcover).  Goldstein H. (1980) Classical Mechanics , 2nd. ed., Addison-Wesley. ISBN 0-201-02918-9   "  Category:Concepts in physics  Category:Hamiltonian mechanics  Category:Transforms   