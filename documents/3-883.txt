   Conditional expectation      Conditional expectation   In probability theory , the conditional expectation of a random variable is another random variable equal to the average of the former over each possible "condition". In the case when the random variable is defined over a discrete probability space , the "conditions" are a partition of this probability space. This definition is then generalized to any probability space using measure theory .  Conditional expectation is also known as conditional expected value or conditional mean .  In modern probability theory the concept of conditional probability is defined in terms of conditional expectation.  Concept  The concept of conditional probability can be nicely illustrated through the following example. Suppose we have daily rainfall data (mm of rain each day) collected by a weather station on every day of the ten year period from Jan 1, 1990 to Dec 31, 1999. The conditional expectation of daily rainfall knowing the month of the year is the average of daily rainfall over all days of the ten year period that fall in a given month. These data then may be considered either as a function of each day (so for example its value for Mar 3, 1992, would be the sum of daily rainfalls on all days that are in the month of March during the ten years, divided by the number of these days, which is 310) or as a function of just the month (so for example the value for March would be equal to the value of the previous example).  It is important to note the following.   The conditional expectation of daily rainfall knowing that we are in a month of March of the given ten years is not a monthly rainfall data, that is it is not the average of the ten monthly total March rainfalls. That number would be 31 times higher.  The average daily rainfall in March 1992 is not equal to the conditional expectation of daily rainfall knowing that we are in a month of March of the given ten years, because we have restricted ourselves to 1992, that is we have more conditions than just that of being in March. This shows that reasoning as "we are in March 1992, so I know we are in March, so the average daily rainfall is the March average daily rainfall" is incorrect. Stated differently, although we use the expression "conditional expectation knowing that we are in March" this really means "conditional expectation knowing nothing other than that we are in March".   History  The related concept of conditional probability dates back at least to Laplace who calculated conditional distributions. It was Andrey Kolmogorov who in 1933 formalized it using the Radon‚ÄìNikodym theorem . 1 In works of Paul Halmos 1950 2 and Joseph L. Doob 1953 3 conditional expectation was generalized to its now usual definition using sub-sigma-algebras . 4  Classical definition  Conditional expectation with respect to an event  In classical probability theory the conditional expectation of X given an event H (which may be the event Y=y for a random variable Y ) is the average of X over all outcomes in H , that is       E   (  X  ‚à£  H  )    =     ‚àë   œâ  ‚àà  H     X   (  œâ  )      |  H  |         normal-E  X  H       subscript     œâ  H      X  œâ      H      \operatorname{E}(X\mid H)=\frac{\sum_{\omega\in H}X(\omega)}{|H|}     The sum above can be grouped by different values of    X   (  œâ  )       X  œâ    \scriptstyle X(\omega)   , to get a sum over the range    ùí≥   ùí≥   \scriptstyle\mathcal{X}   of X       E   (  X  ‚à£  H  )    =    ‚àë   x  ‚àà  ùí≥      x     |   {   œâ  ‚àà  H   ‚à£    X   (  œâ  )    =  x   }   |    |  H  |           normal-E  X  H     subscript     x  ùí≥      x       conditional-set    œâ  H       X  œâ   x       H        \operatorname{E}(X\mid H)=\sum_{x\in\mathcal{X}}x\,\frac{|\{\omega\in H\mid X(%
 \omega)=x\}|}{|H|}     In modern probability theory, when H is an event with strictly positive probability, it is possible to give a similar formula. This is notably the case for a discrete random variable  Y and for y in the range of Y if the event H is Y=y . Let    (  Œ©  ,  ‚Ñ±  ,  P  )     normal-Œ©  ‚Ñ±  P    \scriptstyle(\Omega,\mathcal{F},P)   be a probability space, X a random variable on that probability space, and    H  ‚àà  ‚Ñ±      H  ‚Ñ±    \scriptstyle H\in\mathcal{F}   an event with strictly positive probability     P   (  H  )    >  0        P  H   0    \scriptstyle P(H)>0   . Then the conditional expectation of X given the event H is        E   (  X  ‚à£  H  )    =    E   (    1  H   X   )     P   (  H  )     =    ‚à´   x  ‚àà  ùí≥     x   P   (   d  x   ‚à£  H  )       ,         normal-E  X  H      normal-E     subscript  1  H   X     normal-P  H           subscript     x  ùí≥      x   normal-P    d  x   H        \operatorname{E}(X\mid H)=\frac{\operatorname{E}(1_{H}X)}{\operatorname{P}(H)}%
 =\int_{x\in\mathcal{X}}x\operatorname{P}(dx\mid H),     where   ùí≥   ùí≥   \scriptstyle\mathcal{X}   is the range of X and     P   (  A  ‚à£  H  )    =    P   (   A  ‚à©  H   )     P   (  H  )          normal-P  A  H      normal-P    A  H     normal-P  H      \operatorname{P}(A\mid H)=\frac{\operatorname{P}(A\cap H)}{\operatorname{P}(H)}   is the conditional probability of A knowing H .  When P ( H ) = 0 (for instance if Y is a continuous random variable and H is the event Y=y , this is in general the case), the Borel‚ÄìKolmogorov paradox demonstrates the ambiguity of attempting to define the conditional probability knowing the event H . The above formula shows that this problem transposes to the conditional expectation. So instead one only defines the conditional expectation with respect to a sigma-algebra or a random variable.  Conditional expectation with respect to a random variable  If Y is a discrete random variable with range   ùí¥   ùí¥   \scriptstyle\mathcal{Y}   , then we can define on   ùí¥   ùí¥   \scriptstyle\mathcal{Y}   the function       g  :   y  ‚Ü¶   E   (  X  ‚à£   Y  =  y   )      .     normal-:  g   maps-to  y   normal-E  X    Y  y       g:y\mapsto\operatorname{E}(X\mid Y=y).     Sometimes this function is called the conditional expectation of X with respect to Y . In fact, according to the modern definition, it is    g  ‚àò  Y      g  Y    \scriptstyle g\circ Y   that is called the conditional expectation of X with respect to Y , so that we have        E   (  X  ‚à£  Y  )    :   œâ  ‚Ü¶   E   (  X  ‚à£   Y  =   Y   (  œâ  )     )      .     normal-:   normal-E  X  Y    maps-to  œâ   normal-E  X    Y    Y  œâ        \operatorname{E}(X\mid Y):\omega\mapsto\operatorname{E}(X\mid Y=Y(\omega)).     which is a random variable.  As mentioned above, if Y is a continuous random variable, it is not possible to define    E   (  X  ‚à£  Y  )      normal-E  X  Y    \scriptstyle\operatorname{E}(X\mid Y)   by this method. As explained in the Borel‚ÄìKolmogorov paradox , we have to specify what limiting procedure produces the set Y = y . This can be naturally done by defining the set     H  y  œµ   =   {  œâ  ‚à£    ‚à•    Y   (  œâ  )    -  y   ‚à•   <  œµ   }        superscript   subscript  H  y   œµ    conditional-set  œâ     norm      Y  œâ   y    œµ      \scriptstyle H_{y}^{\epsilon}=\{\omega\mid\|Y(\omega)-y\|<\epsilon\}   , and taking the limit    œµ  ‚Üí  0     normal-‚Üí  œµ  0    \scriptstyle\epsilon\to 0   , so that if     P   (   H  y  œµ   )    >  0        P   superscript   subscript  H  y   œµ    0    \scriptstyle P(H_{y}^{\epsilon})>0   for all    œµ  >  0      œµ  0    \scriptstyle\epsilon>0   , then      g  :   y  ‚Ü¶    lim   œµ  ‚Üí  0     E   (  X  ‚à£   H  y  Œµ   )         normal-:  g   maps-to  y    subscript    normal-‚Üí  œµ  0     normal-E  X   superscript   subscript  H  y   Œµ        g:y\mapsto\lim_{\epsilon\to 0}\operatorname{E}(X\mid H_{y}^{\varepsilon})   .  The modern definition is analogous to the above except that the above limiting process is replaced by the Radon‚ÄìNikodym derivative , so the result holds more generally.  Formal definition  Conditional expectation with respect to a œÉ-algebra  [[ File:LokaleMittelwertbildung.svg|thumb|upright=1.5 | Conditional expectation with respect to a sigma-algebra: in this example the probability space    (  Œ©  ,  ‚Ñ±  ,  P  )     normal-Œ©  ‚Ñ±  normal-P    \scriptstyle(\Omega,\mathcal{F},\operatorname{P})   is the [0,1] interval with the Lebesgue measure . We define the following œÉ-algebras    ùíú  =  ‚Ñ±      ùíú  ‚Ñ±    \scriptstyle\mathcal{A}=\mathcal{F}   while   ‚Ñ¨   ‚Ñ¨   \scriptstyle\mathcal{B}   is the œÉ-algebra generated by the intervals with end-points 0, ¬º, ¬Ω, ¬æ, 1 and   ùíû   ùíû   \scriptstyle\mathcal{C}   is the œÉ-algebra generated by the intervals with end-points 0, ¬Ω, 1. Here the conditional expectation is effectively the average over the minimal sets of the œÉ-algebra.]]  Consider the following       (  Œ©  ,  ‚Ñ±  ,  P  )     normal-Œ©  ‚Ñ±  normal-P    \scriptstyle(\Omega,\mathcal{F},\operatorname{P})   is a probability space      X  :   Œ©  ‚Üí   ‚Ñù  n       normal-:  X   normal-‚Üí  normal-Œ©   superscript  ‚Ñù  n      \scriptstyle X:\Omega\to\mathbb{R}^{n}   is a random variable on that probability space      ‚Ñã  ‚äÜ  ‚Ñ±      ‚Ñã  ‚Ñ±    \scriptstyle\mathcal{H}\subseteq\mathcal{F}   is a sub- œÉ-algebra of   ‚Ñ±   ‚Ñ±   \scriptstyle\mathcal{F}      Then a conditional expectation of X given   ‚Ñã   ‚Ñã   \scriptstyle\mathcal{H}   , denoted as    E   (  X  ‚à£  ‚Ñã  )      normal-E  X  ‚Ñã    \scriptstyle\operatorname{E}(X\mid\mathcal{H})   , is any   ‚Ñã   ‚Ñã   \scriptstyle\mathcal{H}   - measurable function (    Œ©  ‚Üí   ‚Ñù  n      normal-‚Üí  normal-Œ©   superscript  ‚Ñù  n     \scriptstyle\Omega\to\mathbb{R}^{n}   ) which satisfies:         ‚à´  H     E   (  X  ‚à£  ‚Ñã  )    d   P   |  ‚Ñã      =     ‚à´  H     X   d  P    for each     H  ‚àà  ‚Ñã      formulae-sequence      subscript   H      normal-E  X  ‚Ñã   d   subscript  P   fragments  normal-|  H         subscript   H     X  d  P    for each      H  ‚Ñã     \int_{H}\operatorname{E}(X\mid\mathcal{H})\;dP_{|\mathcal{H}}=\int_{H}X\;dP%
 \qquad\text{for each}\quad H\in\mathcal{H}   . 5  The existence of    E   (  X  ‚à£  ‚Ñã  )      normal-E  X  ‚Ñã    \scriptstyle\operatorname{E}(X\mid\mathcal{H})   can be established by noting that     Œº  X   :   F  ‚Ü¶    ‚à´  F   X       normal-:   superscript  Œº  X    maps-to  F    subscript   F   X      \scriptstyle\mu^{X}:F\mapsto\int_{F}X   for    F  ‚àà  ‚Ñ±      F  ‚Ñ±    \scriptstyle F\in\mathcal{F}   is a measure on    (  Œ©  ,  ‚Ñ±  )     normal-Œ©  ‚Ñ±    \scriptstyle(\Omega,\mathcal{F})   that is absolutely continuous with respect to   P   P   \scriptstyle P   . Furthermore, if   h   h   \scriptstyle h   is the natural injection from   ‚Ñã   ‚Ñã   \scriptstyle\mathcal{H}   to   ‚Ñ±   ‚Ñ±   \scriptstyle\mathcal{F}   then      Œº  X   ‚àò  h   =   Œº   |  ‚Ñã   X          superscript  Œº  X   h    subscript   superscript  Œº  X    fragments  normal-|  H      \scriptstyle\mu^{X}\circ h=\mu^{X}_{|\mathcal{H}}   is the restriction of    Œº  X     superscript  Œº  X    \scriptstyle\mu^{X}   to   ‚Ñã   ‚Ñã   \scriptstyle\mathcal{H}   and     P  ‚àò  h   =   P   |  ‚Ñã          P  h    subscript  P   fragments  normal-|  H      \scriptstyle P\circ h=P_{|\mathcal{H}}   is the restriction of   P   P   \scriptstyle P   to   ‚Ñã   ‚Ñã   \scriptstyle\mathcal{H}   and     Œº  X   ‚àò  h       superscript  Œº  X   h    \scriptstyle\mu^{X}\circ h   is absolutely continuous with respect to    P  ‚àò  h      P  h    \scriptstyle P\circ h   since       P  ‚àò  h    (  H  )    =  0   ‚áî    P   (   h   (  H  )    )    =  0  ‚áí    Œº  X    (   h   (  H  )    )    =  0   ‚áî      Œº  X   ‚àò  h    (  H  )    =  0        normal-‚áî        P  h   H   0         P    h  H    0    normal-‚áí       superscript  Œº  X     h  H         0      normal-‚áî           superscript  Œº  X   h   H   0      \scriptstyle P\circ h(H)=0\Leftrightarrow P(h(H))=0\Rightarrow\mu^{X}(h(H))=0%
 \Leftrightarrow\mu^{X}\circ h(H)=0   . Thus, we have       E   (  X  ‚à£  ‚Ñã  )    =    d   Œº   |  ‚Ñã   X     d   P   |  ‚Ñã      =    d   (    Œº  X   ‚àò  h   )     d   (   P  ‚àò  h   )            normal-E  X  ‚Ñã       d   subscript   superscript  Œº  X    fragments  normal-|  H       d   subscript  P   fragments  normal-|  H               d     superscript  Œº  X   h      d    P  h        \operatorname{E}(X\mid\mathcal{H})=\frac{d\mu^{X}_{|\mathcal{H}}}{dP_{|%
 \mathcal{H}}}=\frac{d(\mu^{X}\circ h)}{d(P\circ h)}     where the derivatives are Radon‚ÄìNikodym derivatives of measures.  Conditional expectation with respect to a random variable  Consider further to the above       (  U  ,  Œ£  )     U  normal-Œ£    \scriptstyle(U,\Sigma)   is a measurable space      Y  :   Œ©  ‚Üí  U      normal-:  Y   normal-‚Üí  normal-Œ©  U     \scriptstyle Y:\Omega\to U   is a random variable   Then for any   Œ£   normal-Œ£   \scriptstyle\Sigma   - measurable function     g  :   U  ‚Üí   ‚Ñù  n       normal-:  g   normal-‚Üí  U   superscript  ‚Ñù  n      \scriptstyle g:U\to\mathbb{R}^{n}   which satisfies:        ‚à´   g   (  Y  )   f   (  Y  )     =    ‚à´   X  f   (  Y  )      for every  Œ£  -measurable function   f    :   U  ‚Üí   ‚Ñù  n       normal-:        g  Y  f  Y         X  f  Y      for every  normal-Œ£  -measurable function   f     normal-‚Üí  U   superscript  ‚Ñù  n      \int g(Y)f(Y)=\int Xf(Y)\qquad\text{for every }\Sigma\text{-measurable %
 function}\quad f:U\to\mathbb{R}^{n}   .  the random variable    g   (  Y  )       g  Y    \scriptstyle g(Y)   , denoted as    E   (  X  ‚à£  Y  )      normal-E  X  Y    \scriptstyle\operatorname{E}(X\mid Y)   , is a conditional expectation of X given   Y   Y   \scriptstyle Y   .  This definition is equivalent to defining the conditional expectation using the pre-image of Œ£ with respect to Y . If we define      ‚Ñã  =   œÉ   (  Y  )    :=    Y   -  1     (  Œ£  )    :=   {    Y   -  1     (  B  )    :   B  ‚àà  Œ£   }         ‚Ñã    œÉ  Y     assign       superscript  Y    1    normal-Œ£     assign     conditional-set     superscript  Y    1    B     B  normal-Œ£       \mathcal{H}=\sigma(Y):=Y^{-1}\left(\Sigma\right):=\{Y^{-1}(B):B\in\Sigma\}     then       E   (  X  ‚à£  Y  )    =   E   (  X  ‚à£  ‚Ñã  )    =     d   (    Œº  X   ‚àò   Y   -  1     )     d   (   P  ‚àò   Y   -  1     )     ‚àò  Y          normal-E  X  Y    normal-E  X  ‚Ñã              d     superscript  Œº  X    superscript  Y    1        d    P   superscript  Y    1       Y      \operatorname{E}(X\mid Y)=\operatorname{E}(X\mid\mathcal{H})=\frac{d(\mu^{X}%
 \circ Y^{-1})}{d(P\circ Y^{-1})}\circ Y   .  Discussion  A couple of points worth noting about the definition:   This is not a constructive definition; we are merely given the required property that a conditional expectation must satisfy.  The definition of    E   (  X  ‚à£  ‚Ñã  )      normal-E  X  ‚Ñã    \scriptstyle\operatorname{E}(X\mid\mathcal{H})   may resemble that of    E   (  X  ‚à£  H  )      normal-E  X  H    \scriptstyle\operatorname{E}(X\mid H)   but these are very different objects, the former being a   ‚Ñã   ‚Ñã   \scriptstyle\mathcal{H}   -measurable function    Œ©  ‚Üí   ‚Ñù  n      normal-‚Üí  normal-Œ©   superscript  ‚Ñù  n     \scriptstyle\Omega\to\mathbb{R}^{n}   , while the latter is an element of    ‚Ñù  n     superscript  ‚Ñù  n    \scriptstyle\mathbb{R}^{n}   for fixed   H   H   \scriptstyle H   , or a function    ‚Ñ±  ‚Üí   ‚Ñù  n      normal-‚Üí  ‚Ñ±   superscript  ‚Ñù  n     \scriptstyle\mathcal{F}\to\mathbb{R}^{n}   if considered as the function    H  ‚Ü¶   E   (  X  ‚à£  H  )       maps-to  H   normal-E  X  H     \scriptstyle H\mapsto\operatorname{E}(X\mid H)   .  Existence of a conditional expectation function is determined by the Radon‚ÄìNikodym theorem , a sufficient condition is that the (unconditional) expected value for X exist.  Uniqueness can be shown to be almost sure : that is, versions of the same conditional expectation will only differ on a set of probability zero .   The œÉ-algebra   ‚Ñã   ‚Ñã   \scriptstyle\mathcal{H}   controls the "granularity" of the conditioning. A conditional expectation    E   (  X  ‚à£  ‚Ñã  )      fragments  E   fragments  normal-(  X  normal-‚à£  H  normal-)     \scriptstyle{E}(X\mid\mathcal{H})   over a finer-grained œÉ-algebra   ‚Ñã   ‚Ñã   \scriptstyle\mathcal{H}   will allow us to condition on a wider variety of events.   Conditioning as factorization  In the definition of conditional expectation that we provided above, the fact that   Y   Y   Y   is a real random element is irrelevant. Let    (  U  ,  Œ£  )     U  normal-Œ£    (U,\Sigma)   be a measurable space, where    Œ£  ‚äÇ   ùí´   (  U  )        normal-Œ£    ùí´  U     \Sigma\subset\mathcal{P}(U)   is a œÉ-algebra in   U   U   U   . A   U   U   U   -valued random element is a measurable function    Y  :   Œ©  ‚Üí  U      normal-:  Y   normal-‚Üí  normal-Œ©  U     Y\colon\Omega\to U   , i.e.      Y   -  1     (  B  )    ‚àà  ‚Ñ±         superscript  Y    1    B   ‚Ñ±    Y^{-1}(B)\in\mathcal{F}   for all    B  ‚àà  Œ£      B  normal-Œ£    B\in\Sigma   . The distribution of   Y   Y   Y   is the probability measure     ‚Ñô  Y   :   Œ£  ‚Üí  ‚Ñù      normal-:   subscript  ‚Ñô  Y    normal-‚Üí  normal-Œ£  ‚Ñù     \mathbb{P}_{Y}:\Sigma\to\mathbb{R}   such that      ‚Ñô  Y    (  B  )    =   ‚Ñô   (    Y   -  1     (  B  )    )           subscript  ‚Ñô  Y   B     ‚Ñô     superscript  Y    1    B      \mathbb{P}_{Y}(B)=\mathbb{P}(Y^{-1}(B))   .  Theorem . If    X  :   Œ©  ‚Üí  ‚Ñù      normal-:  X   normal-‚Üí  normal-Œ©  ‚Ñù     X:\Omega\to\mathbb{R}   is an integrable random variable, then there exists a    ‚Ñô  Y     subscript  ‚Ñô  Y    \mathbb{P}_{Y}   -unique integrable random element     E   (  X  ‚à£  Y  )    :   U  ‚Üí  ‚Ñù      normal-:   normal-E  X  Y    normal-‚Üí  U  ‚Ñù     \operatorname{E}(X\mid Y):U\to\mathbb{R}   , such that         ‚à´    Y   -  1     (  B  )       X   d  ‚Ñô    =    ‚à´  B     E   (  X  ‚à£  Y  )    d   ‚Ñô  Y      ,        subscript      superscript  Y    1    B      X  d  ‚Ñô      subscript   B      normal-E  X  Y   d   subscript  ‚Ñô  normal-Y       \int_{Y^{-1}(B)}X\;d\operatorname{\mathbb{P}}=\int_{B}\operatorname{E}(X\mid Y%
 )\;d\operatorname{\mathbb{P}_{Y}},     for all    B  ‚àà  Œ£      B  normal-Œ£    B\in\Sigma   .  Proof sketch  Let    Œº  :   Œ£  ‚Üí  ‚Ñù      normal-:  Œº   normal-‚Üí  normal-Œ£  ‚Ñù     \mu:\Sigma\to\mathbb{R}   be such that     Œº   (  B  )    =    ‚à´    Y   -  1     (  B  )       X   d  ‚Ñô          Œº  B     subscript      superscript  Y    1    B      X  d  ‚Ñô      \mu(B)=\int_{Y^{-1}(B)}X\;d\operatorname{\mathbb{P}}   . Then   Œº   Œº   \mu   is a signed measure which is absolutely continuous with respect to    ‚Ñô  Y     subscript  ‚Ñô  Y    \mathbb{P}_{Y}   . Indeed      ‚Ñô  Y    (  B  )    =  0         subscript  ‚Ñô  Y   B   0    \mathbb{P}_{Y}(B)=0   means exactly that     ‚Ñô   (    Y   -  1     (  B  )    )    =  0        ‚Ñô     superscript  Y    1    B    0    \mathbb{P}(Y^{-1}(B))=0   . Since the integral of an integrable function on a set of probability 0 is 0, this proves absolute continuity. The Radon‚ÄìNikodym theorem then proves the existence of a density of   Œº   Œº   \mu   with respect to    ‚Ñô  Y     subscript  ‚Ñô  Y    \mathbb{P}_{Y}   , which we denote by    E   (  X  ‚à£  Y  )      normal-E  X  Y    \operatorname{E}(X\mid Y)   .   ‚ñ°   normal-‚ñ°   \square     Comparing with conditional expectation with respect to sub-sigma algebras, it holds that         E   (  X  ‚à£  Y  )    ‚àò  Y   =   E   (  X  ‚à£    Y   -  1     (  Œ£  )    )     .         normal-E  X  Y   Y    normal-E  X     superscript  Y    1    normal-Œ£      \operatorname{E}(X\mid Y)\circ Y=\operatorname{E}\left(X\mid Y^{-1}\left(%
 \Sigma\right)\right).     We can further interpret this equality by considering the abstract change of variables formula to transport the integral on the right hand side to an integral over Œ©:         ‚à´    Y   -  1     (  B  )       X   d  ‚Ñô    =    ‚à´    Y   -  1     (  B  )       (    E   (  X  ‚à£  Y  )    ‚àò  Y   )   d  ‚Ñô     .        subscript      superscript  Y    1    B      X  d  ‚Ñô      subscript      superscript  Y    1    B         normal-E  X  Y   Y   d  ‚Ñô      \int_{Y^{-1}(B)}X\ d\operatorname{\mathbb{P}}=\int_{Y^{-1}(B)}(\operatorname{E%
 }(X\mid Y)\circ Y)\ d\operatorname{\mathbb{P}}.     The equation means that the integrals of   X   X   X   and the composition     E   (  X  ‚à£  Y  )    ‚àò  Y       normal-E  X  Y   Y    \operatorname{E}(X\mid Y)\circ Y   over sets of the form     Y   -  1     (  B  )        superscript  Y    1    B    Y^{-1}(B)   , for    B  ‚àà  Œ£      B  normal-Œ£    B\in\Sigma   , are identical.  This equation can be interpreted to say that the following diagram is commutative  in the average .        Computation  When X and Y are both discrete random variables , then the conditional expectation of X given the event Y=y can be considered as function of y for y in the range of Y        E   (  X  ‚à£   Y  =  y   )    =    ‚àë   x  ‚àà  ùí≥      x    P   (   X  =  x   ‚à£   Y  =  y   )      =    ‚àë   x  ‚àà  ùí≥      x     P   (   X  =  x   ,   Y  =  y   )     P   (   Y  =  y   )        ,         normal-E  X    Y  y      subscript     x  ùí≥      x   normal-P    X  x     Y  y             subscript     x  ùí≥      x     normal-P    X  x     Y  y     normal-P    Y  y          \operatorname{E}(X\mid Y=y)=\sum_{x\in\mathcal{X}}x\ \operatorname{P}(X=x\mid Y%
 =y)=\sum_{x\in\mathcal{X}}x\ \frac{\operatorname{P}(X=x,Y=y)}{\operatorname{P}%
 (Y=y)},     where   ùí≥   ùí≥   \mathcal{X}   is the range of X .  If X is a continuous random variable , while Y remains a discrete variable, the conditional expectation is:      E   (  X  ‚à£  Y  =  y  )   =   ‚à´  ùí≥   x   f  X    (  x  ‚à£  Y  =  y  )   d  x     fragments  normal-E   fragments  normal-(  X  normal-‚à£  Y   y  normal-)     subscript   ùí≥   x   subscript  f  X    fragments  normal-(  x  normal-‚à£  Y   y  normal-)   d  x    \operatorname{E}(X\mid Y=y)=\int_{\mathcal{X}}xf_{X}(x\mid Y=y)\,dx     with     f  X    (  x  ‚à£  Y  =  y  )   =     f   X  ,  Y     (  x  ,  y  )     P   (   Y  =  y   )        fragments   subscript  f  X    fragments  normal-(  x  normal-‚à£  Y   y  normal-)         subscript  f   X  Y     x  y     normal-P    Y  y       f_{X}(x\mid Y=y)=\frac{f_{X,Y}(x,y)}{\operatorname{P}(Y=y)}   (where f X,Y ( x, y ) gives the joint density of X and Y ) is the conditional density of X given Y=y .  If both X and Y are continuous random variables, then the conditional expectation is:      E   (  X  ‚à£  Y  =  y  )   =   ‚à´  ùí≥   x   f   X  ‚à£  Y     (  x  ‚à£  y  )   d  x     fragments  normal-E   fragments  normal-(  X  normal-‚à£  Y   y  normal-)     subscript   ùí≥   x   subscript  f   fragments  X  normal-‚à£  Y     fragments  normal-(  x  normal-‚à£  y  normal-)   d  x    \operatorname{E}(X\mid Y=y)=\int_{\mathcal{X}}xf_{X\mid Y}(x\mid y)\,dx     where     f   X  ‚à£  Y     (  x  ‚à£  y  )   =     f   X  ,  Y     (  x  ,  y  )      f  Y    (  y  )        fragments   subscript  f   fragments  X  normal-‚à£  Y     fragments  normal-(  x  normal-‚à£  y  normal-)         subscript  f   X  Y     x  y       subscript  f  Y   y      f_{X\mid Y}(x\mid y)=\frac{f_{X,Y}(x,y)}{f_{Y}(y)}   (where f Y ( y ) gives the density of Y ).  Basic properties  All the following formulas are to be understood in an almost sure sense. The sigma-algebra   ‚Ñã   ‚Ñã   \scriptstyle\mathcal{H}   could be replaced by a random variable   Z   Z   \scriptstyle Z      Pulling out independent factors:  If   X   X   X   is independent of   ‚Ñã   ‚Ñã   \mathcal{H}   , then    E   (  X  ‚à£  ‚Ñã  )   =  E   (  X  )      fragments  E   fragments  normal-(  X  normal-‚à£  H  normal-)    E   fragments  normal-(  X  normal-)     E(X\mid\mathcal{H})=E(X)   .    Let    B  ‚àà  ‚Ñã      B  ‚Ñã    B\in\mathcal{H}   . Then   X   X   X   is independent of    1  B     subscript  1  B    1_{B}   , so we get that        ‚à´  B    X  d  P    =   E   (   X   1  B    )    =   E   (  X  )   E   (   1  B   )    =   E   (  X  )   P   (  B  )    =    ‚à´  B    E   (  X  )   d  P            subscript   B     X  d  P      E    X   subscript  1  B            E  X  E   subscript  1  B           E  X  P  B          subscript   B     E  X  d  P       \int_{B}XdP=E(X1_{B})=E(X)E(1_{B})=E(X)P(B)=\int_{B}E(X)dP   Thus the definition of conditional expectation is satisfied by the constant random variable    E   (  X  )       E  X    E(X)   , as desired.    If   X   X   X   is independent of    œÉ   (  Y  ,  ‚Ñã  )       œÉ   Y  ‚Ñã     \sigma(Y,\mathcal{H})   , then    E   (  X  Y  ‚à£  ‚Ñã  )   =  E   (  X  )   E   (  Y  ‚à£  ‚Ñã  )      fragments  E   fragments  normal-(  X  Y  normal-‚à£  H  normal-)    E   fragments  normal-(  X  normal-)   E   fragments  normal-(  Y  normal-‚à£  H  normal-)     E(XY\mid\mathcal{H})=E(X)\,E(Y\mid\mathcal{H})   . Note that this is not necessarily the case if   X   X   X   is only independent of   ‚Ñã   ‚Ñã   \mathcal{H}   and of   Y   Y   Y   .  If    X  ,  Y     X  Y    X,Y   are independent,    ùí¢  ,  ‚Ñã     ùí¢  ‚Ñã    \mathcal{G},\mathcal{H}   are independent,   X   X   X   is independent of   ‚Ñã   ‚Ñã   \mathcal{H}   and   Y   Y   Y   is independent of   ùí¢   ùí¢   \mathcal{G}   , then    E   (  E   (  X  Y  ‚à£  ùí¢  )   ‚à£  ‚Ñã  )   =  E   (  X  )   E   (  Y  )   =  E   (  E   (  X  Y  ‚à£  ‚Ñã  )   ‚à£  ùí¢  )   .     fragments  E   fragments  normal-(  E   fragments  normal-(  X  Y  normal-‚à£  G  normal-)   normal-‚à£  H  normal-)    E   fragments  normal-(  X  normal-)   E   fragments  normal-(  Y  normal-)    E   fragments  normal-(  E   fragments  normal-(  X  Y  normal-‚à£  H  normal-)   normal-‚à£  G  normal-)   normal-.    E(E(XY\mid\mathcal{G})\mid\mathcal{H})=E(X)E(Y)=E(E(XY\mid\mathcal{H})\mid%
 \mathcal{G}).        Stability:  If   X   X   X   is   ‚Ñã   ‚Ñã   \mathcal{H}   -measurable, then    E   (  X  ‚à£  ‚Ñã  )   =  X     fragments  E   fragments  normal-(  X  normal-‚à£  H  normal-)    X    E(X\mid\mathcal{H})=X   .  If Z is a random variable, then     E   (   f   (  Z  )    ‚à£  Z  )    =   f   (  Z  )         normal-E    f  Z   Z     f  Z     \operatorname{E}(f(Z)\mid Z)=f(Z)   and in its simplest form     E   (  Z  ‚à£  Z  )    =  Z       normal-E  Z  Z   Z    \operatorname{E}(Z\mid Z)=Z        Pulling out known factors:  If   X   X   X   is   ‚Ñã   ‚Ñã   \mathcal{H}   -measurable, then    E   (  X  Y  ‚à£  ‚Ñã  )   =   X   E   (  Y  ‚à£  ‚Ñã  )      fragments  E   fragments  normal-(  X  Y  normal-‚à£  H  normal-)    X  E   fragments  normal-(  Y  normal-‚à£  H  normal-)     E(XY\mid\mathcal{H})=X\,E(Y\mid\mathcal{H})   .  If Z is a random variable, then     E   (   f   (  Z  )   Y   ‚à£  Z  )    =   f   (  Z  )    E   (  Y  ‚à£  Z  )          normal-E    f  Z  Y   Z     f  Z   normal-E  Y  Z      \operatorname{E}(f(Z)Y\mid Z)=f(Z)\operatorname{E}(Y\mid Z)        Law of total expectation     E   (  E   (  X  ‚à£  ‚Ñã  )   )   =  E   (  X  )      fragments  E   fragments  normal-(  E   fragments  normal-(  X  normal-‚à£  H  normal-)   normal-)    E   fragments  normal-(  X  normal-)     E(E(X\mid\mathcal{H}))=E(X)   .    Tower property: for sub-œÉ-algebras     ‚Ñã  1   ‚äÇ   ‚Ñã  2   ‚äÇ  ‚Ñ±         subscript  ‚Ñã  1    subscript  ‚Ñã  2        ‚Ñ±     \mathcal{H}_{1}\subset\mathcal{H}_{2}\subset\mathcal{F}   we have    E   (  E   (  X  ‚à£   ‚Ñã  2   )   ‚à£   ‚Ñã  1   )   =  E   (  X  ‚à£   ‚Ñã  1   )   =  E   (  E   (  X  |   ‚Ñã  1   )   ‚à£   ‚Ñã  2   )      fragments  E   fragments  normal-(  E   fragments  normal-(  X  normal-‚à£   subscript  ‚Ñã  2   normal-)   normal-‚à£   subscript  ‚Ñã  1   normal-)    E   fragments  normal-(  X  normal-‚à£   subscript  ‚Ñã  1   normal-)    E   fragments  normal-(  E   fragments  normal-(  X  normal-|   subscript  ‚Ñã  1   normal-)   normal-‚à£   subscript  ‚Ñã  2   normal-)     E(E(X\mid\mathcal{H}_{2})\mid\mathcal{H}_{1})=E(X\mid\mathcal{H}_{1})=E(E(X|%
 \mathcal{H}_{1})\mid\mathcal{H}_{2})   .  A special case is when Z is a   ‚Ñã   ‚Ñã   \mathcal{H}   -measurable random variable. Then     œÉ   (  Z  )    ‚äÇ  ‚Ñã        œÉ  Z   ‚Ñã    \sigma(Z)\subset\mathcal{H}   and thus    E   (  E   (  X  ‚à£  ‚Ñã  )   ‚à£  Z  )   =  E   (  X  ‚à£  Z  )      fragments  E   fragments  normal-(  E   fragments  normal-(  X  normal-‚à£  H  normal-)   normal-‚à£  Z  normal-)    E   fragments  normal-(  X  normal-‚à£  Z  normal-)     E(E(X\mid\mathcal{H})\mid Z)=E(X\mid Z)     Doob martingale property: the above with    Z  =  E   (  X  ‚à£  ‚Ñã  )      fragments  Z   E   fragments  normal-(  X  normal-‚à£  H  normal-)     Z=E(X\mid\mathcal{H})   (which is   ‚Ñã   ‚Ñã   \mathcal{H}   -measurable), and using also     E   (  Z  ‚à£  Z  )    =  Z       normal-E  Z  Z   Z    \operatorname{E}(Z\mid Z)=Z   , gives    E   (  X  ‚à£  E   (  X  ‚à£  ‚Ñã  )   )   =  E   (  X  ‚à£  ‚Ñã  )      fragments  E   fragments  normal-(  X  normal-‚à£  E   fragments  normal-(  X  normal-‚à£  H  normal-)   normal-)    E   fragments  normal-(  X  normal-‚à£  H  normal-)     E(X\mid E(X\mid\mathcal{H}))=E(X\mid\mathcal{H})   .     Linearity: we have    E   (   X  1   +   X  2   ‚à£  ‚Ñã  )   =  E   (   X  1   ‚à£  ‚Ñã  )   +  E   (   X  2   ‚à£  ‚Ñã  )      fragments  E   fragments  normal-(   subscript  X  1     subscript  X  2   normal-‚à£  H  normal-)    E   fragments  normal-(   subscript  X  1   normal-‚à£  H  normal-)    E   fragments  normal-(   subscript  X  2   normal-‚à£  H  normal-)     E(X_{1}+X_{2}\mid\mathcal{H})=E(X_{1}\mid\mathcal{H})+E(X_{2}\mid\mathcal{H})   and    E   (  a  X  ‚à£  ‚Ñã  )   =   a   E   (  X  ‚à£  ‚Ñã  )      fragments  E   fragments  normal-(  a  X  normal-‚à£  H  normal-)    a  E   fragments  normal-(  X  normal-‚à£  H  normal-)     E(aX\mid\mathcal{H})=a\,E(X\mid\mathcal{H})   for    a  ‚àà   \R       a  \R    a\in\R   .    Positivity: If    X  ‚â•  0      X  0    X\geq 0   then    E   (  X  ‚à£  ‚Ñã  )   ‚â•  0     fragments  E   fragments  normal-(  X  normal-‚à£  H  normal-)    0    E(X\mid\mathcal{H})\geq 0   .    Monotonicity: If     X  1   ‚â§   X  2        subscript  X  1    subscript  X  2     X_{1}\leq X_{2}   then    E   (   X  1   ‚à£  ‚Ñã  )   ‚â§  E   (   X  2   ‚à£  ‚Ñã  )      fragments  E   fragments  normal-(   subscript  X  1   normal-‚à£  H  normal-)    E   fragments  normal-(   subscript  X  2   normal-‚à£  H  normal-)     E(X_{1}\mid\mathcal{H})\leq E(X_{2}\mid\mathcal{H})   .    Monotone convergence : If    0  ‚â§   X  n   ‚Üë  X        0   subscript  X  n     normal-‚Üë    X     0\leq X_{n}\uparrow X   then    E   (   X  n   ‚à£  ‚Ñã  )   ‚Üë  E   (  X  ‚à£  ‚Ñã  )      fragments  E   fragments  normal-(   subscript  X  n   normal-‚à£  H  normal-)   normal-‚Üë  E   fragments  normal-(  X  normal-‚à£  H  normal-)     E(X_{n}\mid\mathcal{H})\uparrow E(X\mid\mathcal{H})   .    Dominated convergence : If     X  n   ‚Üí  X     normal-‚Üí   subscript  X  n   X    X_{n}\to X   and     |   X  n   |   ‚â§  Y         subscript  X  n    Y    |X_{n}|\leq Y   with    Y  ‚àà   L  1       Y   superscript  L  1     Y\in L^{1}   then    E   (   X  n   ‚à£  ‚Ñã  )   ‚Üí  E   (  X  ‚à£  ‚Ñã  )      fragments  E   fragments  normal-(   subscript  X  n   normal-‚à£  H  normal-)   normal-‚Üí  E   fragments  normal-(  X  normal-‚à£  H  normal-)     E(X_{n}\mid\mathcal{H})\to E(X\mid\mathcal{H})   .    Fatou's lemma : If    E   (   inf  n    X  n   ‚à£  ‚Ñã  )   >  -  ‚àû     fragments  E   fragments  normal-(   subscript  infimum  n    subscript  X  n   normal-‚à£  H  normal-)        \textstyle E(\inf_{n}X_{n}\mid\mathcal{H})>-\infty   then    E   (   lim inf   n  ‚Üí  ‚àû     X  n   ‚à£  ‚Ñã  )   ‚â§   lim inf   n  ‚Üí  ‚àû    E   (   X  n   ‚à£  ‚Ñã  )      fragments  E   fragments  normal-(   subscript  limit-infimum   normal-‚Üí  n      subscript  X  n   normal-‚à£  H  normal-)     subscript  limit-infimum   normal-‚Üí  n     E   fragments  normal-(   subscript  X  n   normal-‚à£  H  normal-)     \textstyle E(\liminf_{n\to\infty}X_{n}\mid\mathcal{H})\leq\liminf_{n\to\infty}%
 E(X_{n}\mid\mathcal{H})   .    Jensen's inequality : If    f  :   ‚Ñù  ‚Üí  ‚Ñù      normal-:  f   normal-‚Üí  ‚Ñù  ‚Ñù     f\colon\mathbb{R}\rightarrow\mathbb{R}   is a convex function , then    f   (  E   (  X  ‚à£  ‚Ñã  )   )   ‚â§  E   (  f   (  X  )   ‚à£  ‚Ñã  )      fragments  f   fragments  normal-(  E   fragments  normal-(  X  normal-‚à£  H  normal-)   normal-)    E   fragments  normal-(  f   fragments  normal-(  X  normal-)   normal-‚à£  H  normal-)     f(E(X\mid\mathcal{H}))\leq E(f(X)\mid\mathcal{H})   .    Conditional variance : Using the conditional expectation we can define, by analogy with the definition of the variance as the mean square deviation from the average, the conditional variance  Definition     Var   (  X  ‚à£  ‚Ñã  )    =   E   (    (   X  -   E   (  X  ‚à£  ‚Ñã  )     )   2   ‚à£  ‚Ñã  )         Var  X  ‚Ñã    normal-E   superscript    X   normal-E  X  ‚Ñã    2   ‚Ñã     \operatorname{Var}(X\mid\mathcal{H})=\operatorname{E}\bigl((X-\operatorname{E}%
 (X\mid\mathcal{H}))^{2}\mid\mathcal{H}\bigr)     Algebraic formula for the variance      Var   (  X  ‚à£  ‚Ñã  )    =    E   (   X  2   ‚à£  ‚Ñã  )    -    (   E   (  X  ‚à£  ‚Ñã  )    )   2         Var  X  ‚Ñã      normal-E   superscript  X  2   ‚Ñã    superscript   normal-E  X  ‚Ñã   2      \operatorname{Var}(X\mid\mathcal{H})=\operatorname{E}(X^{2}\mid\mathcal{H})-%
 \bigl(\operatorname{E}(X\mid\mathcal{H})\bigr)^{2}     Law of total variance      Var   (  X  )    =    E   (   Var   (  X  ‚à£  ‚Ñã  )    )    +   Var   (   E   (  X  ‚à£  ‚Ñã  )    )          Var  X      normal-E   Var  X  ‚Ñã     Var   normal-E  X  ‚Ñã       \operatorname{Var}(X)=\operatorname{E}(\operatorname{Var}(X\mid\mathcal{H}))+%
 \operatorname{Var}(\operatorname{E}(X\mid\mathcal{H}))   .     Martingale convergence : For a random variable   X   X   X   , that has finite expectation, we have    E   (  X  ‚à£   ‚Ñã  n   )   ‚Üí  E   (  X  ‚à£  ‚Ñã  )      fragments  E   fragments  normal-(  X  normal-‚à£   subscript  ‚Ñã  n   normal-)   normal-‚Üí  E   fragments  normal-(  X  normal-‚à£  H  normal-)     E(X\mid\mathcal{H}_{n})\to E(X\mid\mathcal{H})   , if either     ‚Ñã  1   ‚äÇ   ‚Ñã  2   ‚äÇ  ‚ãØ         subscript  ‚Ñã  1    subscript  ‚Ñã  2        normal-‚ãØ     \mathcal{H}_{1}\subset\mathcal{H}_{2}\subset\cdots   is an increasing series of sub-œÉ-algebras and    ‚Ñã  =   œÉ   (    ‚ãÉ   n  =  1   ‚àû    ‚Ñã  n    )        ‚Ñã    œÉ    superscript   subscript     n  1       subscript  ‚Ñã  n       \textstyle\mathcal{H}=\sigma(\bigcup_{n=1}^{\infty}\mathcal{H}_{n})   or if     ‚Ñã  1   ‚äÉ   ‚Ñã  2   ‚äÉ  ‚ãØ       superset-of   subscript  ‚Ñã  1    subscript  ‚Ñã  2     superset-of    normal-‚ãØ     \mathcal{H}_{1}\supset\mathcal{H}_{2}\supset\cdots   is a decreasing series of sub-œÉ-algebras and    ‚Ñã  =    ‚ãÇ   n  =  1   ‚àû    ‚Ñã  n        ‚Ñã    superscript   subscript     n  1       subscript  ‚Ñã  n      \textstyle\mathcal{H}=\bigcap_{n=1}^{\infty}\mathcal{H}_{n}   .    Conditional expectation as    L  2     superscript  L  2    L^{2}   -projection: If    X  ,  Y     X  Y    X,Y   are in the Hilbert space of square-integrable real random variables (real random variables with finite second moment) then  for   ‚Ñã   ‚Ñã   \mathcal{H}   -measurable   Y   Y   Y   we have    E   (  Y   (  X  -  E   (  X  ‚à£  ‚Ñã  )   )   )   =  0     fragments  E   fragments  normal-(  Y   fragments  normal-(  X   E   fragments  normal-(  X  normal-‚à£  H  normal-)   normal-)   normal-)    0    E(Y(X-E(X\mid\mathcal{H})))=0   , i.e. the conditional expectation    E   (  X  ‚à£  ‚Ñã  )      fragments  E   fragments  normal-(  X  normal-‚à£  H  normal-)     E(X\mid\mathcal{H})   is in the sense of the L 2 ( P ) scalar product the orthogonal projection from   X   X   X   to the linear subspace of   ‚Ñã   ‚Ñã   \mathcal{H}   -measurable functions. (This allows to define and prove the existence of the conditional expectation based on the Hilbert projection theorem .)  the mapping    X  ‚Ü¶   E   (  X  ‚à£  ‚Ñã  )       maps-to  X   normal-E  X  ‚Ñã     X\mapsto\operatorname{E}(X\mid\mathcal{H})   is self-adjoint      E   (   X   E   (  Y  ‚à£  ‚Ñã  )     )    =   E   (    E   (  X  ‚à£  ‚Ñã  )     E   (  Y  ‚à£  ‚Ñã  )     )    =   E   (    E   (  X  ‚à£  ‚Ñã  )    Y   )           normal-E    X   normal-E  Y  ‚Ñã      normal-E     normal-E  X  ‚Ñã    normal-E  Y  ‚Ñã           normal-E     normal-E  X  ‚Ñã   Y       \operatorname{E}(X\operatorname{E}(Y\mid\mathcal{H}))=\operatorname{E}\left(%
 \operatorname{E}(X\mid\mathcal{H})\operatorname{E}(Y\mid\mathcal{H})\right)=%
 \operatorname{E}(\operatorname{E}(X\mid\mathcal{H})Y)        Conditioning is a contractive projection of L p spaces      L  P  s    (  Œ©  ;  ‚Ñ±  )    ‚Üí    L  P  s    (  Œ©  ;  ‚Ñã  )       normal-‚Üí     subscript   superscript  L  s   P    normal-Œ©  ‚Ñ±       subscript   superscript  L  s   P    normal-Œ©  ‚Ñã      L^{s}_{P}(\Omega;\mathcal{F})\rightarrow L^{s}_{P}(\Omega;\mathcal{H})   i.e.     E    |   E   (  X  ‚à£  ‚Ñã  )    |   s    ‚â§   E    |  X  |   s         normal-E   superscript     normal-E  X  ‚Ñã    s     normal-E   superscript    X   s      \operatorname{E}|\operatorname{E}(X\mid\mathcal{H})|^{s}\leq\operatorname{E}|X%
 |^{s}   for any s ‚â•¬†1.   See also   Non-commutative conditional expectation  Law of total probability  Law of total expectation  Law of total variance  Law of total cumulance (generalizes the other three)  Conditioning (probability)  Joint probability distribution  Disintegration theorem   Notes  References   William Feller , An Introduction to Probability Theory and its Applications , vol 1, 1950, page 223  Paul A. Meyer, Probability and Potentials , Blaisdell Publishing Co., 1966   , pages 67‚Äì69   External links     "  Category:Probability theory  Category:Statistical terminology        Olav Kallenberg: Foundations of Modern Probability. 2. edition. Springer, New York 2002, ISBN 0-387-95313-2, S. 573. ‚Ü©      