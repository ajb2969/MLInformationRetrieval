<html lang="en">
<head>
<meta charset="utf-8"/>
<title offset="1514">Weighted fair queueing</title>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG.js" type="text/javascript">
</script>
</head>
<body>
<h1>Weighted fair queueing</h1>
<hr/>

<p><strong>Weighted fair queueing</strong> (WFQ) is a <a href="data_packet" title="wikilink">data packet</a> scheduling used by <a href="network_scheduler" title="wikilink">network schedulers</a>. WFQ is both a packet based implementation of the <a href="generalized_processor_sharing" title="wikilink">generalized processor sharing</a> policy (GPS), and a natural generalization of <a href="fair_queuing" title="wikilink">fair queuing</a> (FQ): whereas FQ shares the links capacity in equal subparts, WFQ allows to specify, for each flow, which fraction of the capacity will be given.</p>

<p>Weighted fair queuing (WFQ) is also known as Packet-by-Packet GPS (PGPS or P-GPS) since it approximates <a href="generalized_processor_sharing" title="wikilink">generalized processor sharing</a> "to within one packet transmission time, regardless of the arrival patterns."<a class="footnoteRef" href="#fn1" id="fnref1"><sup>1</sup></a></p>

<p>In WFQ, a scheduler handling 

<math display="inline" id="Weighted_fair_queueing:0">
 <semantics>
  <mi>N</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>N</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   N
  </annotation>
 </semantics>
</math>

 flows is configured with one weight 

<math display="inline" id="Weighted_fair_queueing:1">
 <semantics>
  <msub>
   <mi>w</mi>
   <mi>i</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>w</ci>
    <ci>i</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   w_{i}
  </annotation>
 </semantics>
</math>

 for each flow. Then, the flow of number 

<math display="inline" id="Weighted_fair_queueing:2">
 <semantics>
  <mi>i</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>i</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   i
  </annotation>
 </semantics>
</math>

 will achieve an average data rate of 

<math display="inline" id="Weighted_fair_queueing:3">
 <semantics>
  <mrow>
   <mfrac>
    <msub>
     <mi>w</mi>
     <mi>i</mi>
    </msub>
    <mrow>
     <mo stretchy="false">(</mo>
     <mrow>
      <msub>
       <mi>w</mi>
       <mn>1</mn>
      </msub>
      <mo>+</mo>
      <msub>
       <mi>w</mi>
       <mn>2</mn>
      </msub>
      <mo>+</mo>
      <mi mathvariant="normal">…</mi>
      <mo>+</mo>
      <msub>
       <mi>w</mi>
       <mi>N</mi>
      </msub>
     </mrow>
     <mo stretchy="false">)</mo>
    </mrow>
   </mfrac>
   <mi>R</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <divide></divide>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>w</ci>
      <ci>i</ci>
     </apply>
     <apply>
      <plus></plus>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>w</ci>
       <cn type="integer">1</cn>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>w</ci>
       <cn type="integer">2</cn>
      </apply>
      <ci>normal-…</ci>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>w</ci>
       <ci>N</ci>
      </apply>
     </apply>
    </apply>
    <ci>R</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \frac{w_{i}}{(w_{1}+w_{2}+...+w_{N})}R
  </annotation>
 </semantics>
</math>

. A WFQ scheduler where all weights are equals is a FQ scheduler.</p>

<p>Like all fair-queuing schedulers, each flow is protected from the others, and it can be proven that if a data flow is <a href="leaky_bucket" title="wikilink">leaky bucket</a> constrained, an end-to-end delay bound can be guaranteed.<a class="footnoteRef" href="#fn2" id="fnref2"><sup>2</sup></a></p>
<h2 id="parametrisation-and-fairness">Parametrisation and Fairness</h2>

<p>Like other GPS-like scheduling algorithm, the choice of the weights is left to the network administrator.</p>

<p>By regulating the WFQ weights dynamically, WFQ can be utilized for controlling the <a href="quality_of_service" title="wikilink">quality of service</a>, for example to achieve guaranteed data rate.</p>

<p>As presented for <a href="Fair_queuing#Fairness" title="wikilink">fair queueing</a>, there is no unique definition on what is "fair".</p>

<p><a href="Proportional_fairness" title="wikilink">Proportional fairness</a> can be achieved by setting the weights to 

<math display="inline" id="Weighted_fair_queueing:4">
 <semantics>
  <mrow>
   <msub>
    <mi>w</mi>
    <mi>i</mi>
   </msub>
   <mo>=</mo>
   <mrow>
    <mn>1</mn>
    <mo>/</mo>
    <msub>
     <mi>c</mi>
     <mi>i</mi>
    </msub>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>w</ci>
     <ci>i</ci>
    </apply>
    <apply>
     <divide></divide>
     <cn type="integer">1</cn>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>c</ci>
      <ci>i</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   w_{i}=1/c_{i}
  </annotation>
 </semantics>
</math>

, where 

<math display="inline" id="Weighted_fair_queueing:5">
 <semantics>
  <msub>
   <mi>c</mi>
   <mi>i</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>c</ci>
    <ci>i</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   c_{i}
  </annotation>
 </semantics>
</math>

 is the cost per data bit of data flow 

<math display="inline" id="Weighted_fair_queueing:6">
 <semantics>
  <mi>i</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>i</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   i
  </annotation>
 </semantics>
</math>

. For example in <a class="uri" href="CDMA" title="wikilink">CDMA</a> spread spectrum cellular networks, the cost may be the required energy (the interference level), and in <a href="channel_allocation_schemes" title="wikilink">dynamic channel allocation</a> systems, the cost may be the number of nearby base station sites that can not use the same frequency channel, in view to avoid co-channel interference.</p>
<h2 id="algorithm">Algorithm</h2>

<p>The algorithm of WFQ is very similar to <a href="Fair_queuing#A_byte-weighted_fair_queuing_algorithm" title="wikilink">the one of FQ</a>. For each packet, a virtual theoretical departure date will be computed, defined as the departure date if the scheduler was a perfect GPS scheduler. Then, each time the output link is idle, the packet with the smaller date is selected for emission.</p>

<p>The pseudo code can be obtained simply from <a href="Fair_queuing#Pseudo_code" title="wikilink">the one of FQ</a> by replacing the computation of the virtual departure time by</p>

<p><code>packet.virFinish= virStart + packet.size * Ri</code></p>

<p>with 

<math display="inline" id="Weighted_fair_queueing:7">
 <semantics>
  <mrow>
   <mrow>
    <mi>R</mi>
    <mi>i</mi>
   </mrow>
   <mo>:=</mo>
   <mrow>
    <mfrac>
     <msub>
      <mi>w</mi>
      <mi>i</mi>
     </msub>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <msub>
        <mi>w</mi>
        <mn>1</mn>
       </msub>
       <mo>+</mo>
       <msub>
        <mi>w</mi>
        <mn>2</mn>
       </msub>
       <mo>+</mo>
       <mi mathvariant="normal">…</mi>
       <mo>+</mo>
       <msub>
        <mi>w</mi>
        <mi>N</mi>
       </msub>
      </mrow>
      <mo stretchy="false">)</mo>
     </mrow>
    </mfrac>
    <mi>R</mi>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="latexml">assign</csymbol>
    <apply>
     <times></times>
     <ci>R</ci>
     <ci>i</ci>
    </apply>
    <apply>
     <times></times>
     <apply>
      <divide></divide>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>w</ci>
       <ci>i</ci>
      </apply>
      <apply>
       <plus></plus>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>w</ci>
        <cn type="integer">1</cn>
       </apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>w</ci>
        <cn type="integer">2</cn>
       </apply>
       <ci>normal-…</ci>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>w</ci>
        <ci>N</ci>
       </apply>
      </apply>
     </apply>
     <ci>R</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   Ri:=\frac{w_{i}}{(w_{1}+w_{2}+...+w_{N})}R
  </annotation>
 </semantics>
</math>

.</p>
<h2 id="wfq-as-a-gps-approximation">WFQ as a GPS approximation</h2>

<p>WFQ, under the name PGPS, has been designed as "an excellent approximation to GPS", and its has been proved that it approximates GPS "to within one packet transmission time, regardless of the arrival patterns."<a class="footnoteRef" href="#fn3" id="fnref3"><sup>3</sup></a></p>

<p>Since WFQ implementation is similar to <a href="fair_queuing" title="wikilink">fair queuing</a>, is has the same <em>O(log(n))</em> complexity, where <em>n</em> is the number of flows. This complexity comes from the need to select the queue with the smallest virtual finish time each time a packet is sent.</p>

<p>After WFQ, several others implementations of GPS have been defined.</p>
<ul>
<li>Even if WFQ is a most "one packet" late w.r.t. the ideal GPS policy, it can be arbitrary ahead. The <em>Worst-case Fair Weighted Fair Queueing</em> (WF2Q) fixes it by adding a virtual start of service to each packet, and selects a packet only if its virtual start of service is not less than the current time.<a class="footnoteRef" href="#fn4" id="fnref4"><sup>4</sup></a></li>
<li>The selection of the queue with minimal virtual finish time can be hard to implement at wire speed. Then, other approximations of GPS has been defined with smaller complexity, like <a href="deficit_round_robin" title="wikilink">deficit round robin</a>.</li>
</ul>
<h2 id="history">History</h2>

<p>The introduction of parameters to share the bandwidth in an arbitrary way in mentioned at the end of <a class="footnoteRef" href="#fn5" id="fnref5"><sup>5</sup></a> as a possible extension to FQ. The term <em>weighted</em> first appears in.<a class="footnoteRef" href="#fn6" id="fnref6"><sup>6</sup></a></p>
<h2 id="see-also">See also</h2>
<ul>
<li><a href="Statistical_multiplexing" title="wikilink">Statistical multiplexing</a></li>
<li>Computing <a href="scheduling_disciplines" title="wikilink">scheduling disciplines</a></li>
<li><a href="Scheduling_algorithm" title="wikilink">Scheduling algorithm</a></li>
<li><a href="Fair_Queuing" title="wikilink">Fair Queuing</a></li>
<li><a href="Generalized_processor_sharing" title="wikilink">Generalized processor sharing</a></li>
<li><a href="Deficit_round_robin" title="wikilink">Deficit round robin</a></li>
<li><a href="Weighted_round_robin" title="wikilink">Weighted round robin</a></li>
<li><a href="Fairness_measure" title="wikilink">Fairness measure</a></li>
<li><a href="Max-min_fairness" title="wikilink">Max-min fairness</a></li>
<li><a href="Proportional_fairness" title="wikilink">Proportional fairness</a></li>
</ul>
<h2 id="references">References</h2>

<p>"</p>

<p><a href="Category:Network_scheduling_algorithms" title="wikilink">Category:Network scheduling algorithms</a> <a href="Category:Routing_algorithms" title="wikilink">Category:Routing algorithms</a></p>
<section class="footnotes">
<hr/>
<ol>
<li id="fn1"><a href="#fnref1">↩</a></li>
<li id="fn2"><a href="#fnref2">↩</a></li>
<li id="fn3"></li>
<li id="fn4"><a href="#fnref4">↩</a></li>
<li id="fn5"><a href="#fnref5">↩</a></li>
<li id="fn6"></li>
</ol>
</section>
</body>
</html>
