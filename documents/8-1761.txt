


Zipper (data structure)




Zipper (data structure)

A zipper is a technique of representing an aggregate data structure so that it is convenient for writing programs that traverse the structure arbitrarily and update its contents, especially in purely functional programming languages. The zipper was described by Gérard Huet in 1997.1 It includes and generalizes the gap buffer technique sometimes used with arrays.
The zipper technique is general in the sense that it can be adapted to lists, trees, and other recursively defined data structures. Such modified data structures are usually referred to as "a tree with zipper" or "a list with zipper" to emphasize that the structure is conceptually a tree or list, while the zipper is a detail of the implementation.
A layman's explanation for a tree with zipper would be an ordinary computer filesystem with operations to go to parent (often cd ..), and the possibility to go downwards (cd subdirectory). The zipper is the pointer to the current path. Behind the scenes the zippers are efficient when making (functional) changes to a data structure, where a new, slightly changed, data structure is returned from an edit operation (instead of making a change in the current data structure).
Example: Bidirectional list traversal
Many common data structures in computer science can be expressed as the structure generated by a few primitive constructor operations or observer operations. These include the structure of finite lists, which can be generated by two operations:

Empty: Constructs an empty list
Insert(x, L): Constructs a list by inserting value x in front of list L

The list [1, 2, 3] is then constructed as Insert(1, Insert(2, Insert(3, Empty))). It is possible to describe the location of a value in a list as the number of steps from the front of the list to that value. More formally, a location is the number of additional Insert operations used to construct the whole list, after a particular value was inserted.
A context for a location in the list is constructed by recording not just the number of Insert operations, but all of the other information about them—namely, the values that were inserted. These are represented in a separate list that is reversed from the order of the original data structure. Specifically, the context of "3" in the list [1, 2, 3] is represented as [2, 1]. A list with a zipper represents the entire structure, and a location within the structure. This is a pair consisting of the location's context, and the part of the structure that begins at the location. The list [1, 2, 3, 4] with a reference to the "3" is represented as ([2, 1], [3, 4]).
With the list represented this way, it is easy to define efficient operations that move the location forward or backward and manipulate the list at that location, for example by inserting or removing items. Similarly, applying the zipper transformation to a tree makes it easy to insert or remove values at a particular location in the tree.
Uses
The zipper is often used where there is some concept of 'focus' or of moving around in some set of data, since its semantics reflect that of moving around but in a functional non-destructive manner.
The zipper has been used in

Xmonad, to manage focus and placement of windows
Huet's papers cover a structural editor2 based on zippers and a theorem prover
A filesystem (ZipperFS) written in Haskell offering "...transactional semantics; undo of any file and directory operation; snapshots; statically guaranteed the strongest, repeatable read, isolation mode for clients; pervasive copy-on-write for files and directories; built-in traversal facility; and just the right behavior for cyclic directory references."3
Clojure has extensive support for zippers. 4

Zipper contexts and differentiation
It has been shown that the type of the items in the context list produced by the zipper transformation is the "derivative" of the original type in a sense that is related to differentiation in calculus by decategorification. Most datatypes are constructed from products and sums of datatypes; any given datatype looks like a polynomial or a Taylor series, and the representation of the type of context items looks like the derivative of that polynomial or series.56 In a recursive datatype like a list or a tree, the derivative is taken with respect to the recursion variable.
Consider a recursive data structure like a binary tree labeled by data of type A.





That is, a tree is either empty, or a triple consisting of a value of type 
 
 
 
  and two subtrees of type 
 
 
 
 . The datatype of the context is





By taking the fixed point 
 
 
 
  we find that a zipper for a tree consists of a "path" and a downward subtree, where a path is a context list of triples consisting of

a value for the root of the tree (type A)
a choice of left or right subtree in which to find the hole (type 2), and
the value of the other subtree (type R).

In general, then, a zipper for a datatype 
 
 
 
  parameterized by some other type 
 
 
 
  and a recursion variable 
 
 
 
  consists of two parts: a context list with items of type 
 
 
 
  and a copy of the downward substructure 
 
 

Alternatives and extensions
Direct modification
In a non-purely-functional programming language, it may be more convenient to simply traverse the original data structure and modify it directly (perhaps after deep cloning it, to avoid affecting other code that might hold a reference to it).
Generic zipper
The Generic Zipper789 is a technique to achieve the same goal as the conventional zipper by capturing the state of the traversal in a continuation while visiting each node. (The Haskell code given in the reference uses generic programming to generate a traversal function for any data structure, but this is optional – any suitable traversal function can be used.)
However, the Generic Zipper involves inversion of control, so some uses of it require a state machine (or equivalent) to keep track of what to do next.
References
Further reading


Hinze, Ralf, et al. "Type-indexed data types". 23 July 2003

External links

Zipper
Theseus and the Zipper
"Roll Your Own Window Manager: Tracking Focus with a Zipper"
Definition
"An Applicative Control-Flow Graph Based on Huet's Zipper"
Infinitesimal Types

"
Category:Functional programming Category:Data structures




"Functional Pearl: Weaving a web".
Generic Zipper: the context of a traversal

Joyal, André (1981), "Une théorie combinatoire des séries formelles", Advances in Mathematics 42:1-82.
McBride, Conor (2001), "The Derivative of a Regular Type is its Type of One-Hole Contexts"







