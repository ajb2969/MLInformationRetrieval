<html lang="en">
<head>
<meta charset="utf-8"/>
<title offset="1172">Monad transformer</title>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG.js" type="text/javascript">
</script>
</head>
<body>
<h1>Monad transformer</h1>
<hr/>

<p>In <a href="functional_programming" title="wikilink">functional programming</a>, a <strong>monad transformer</strong> is a type constructor which takes a <a href="monads_in_functional_programming" title="wikilink">monad</a> as an argument and returns a monad as a result.</p>

<p>Monad transformers can be used to compose features encapsulated by monads - such as state, <a href="exception_handling" title="wikilink">exception handling</a>, and I/O - in a modular way. Typically, a monad transformer is created by generalising an existing monad; applying the resulting monad transformer to the identity monad yields a monad which is equivalent to the original monad (ignoring any necessary boxing and unboxing).</p>
<h2 id="definition">Definition</h2>

<p>A monad transformer consists of:</p>
<ol>
<li>A type constructor <code>t</code> of <a href="kind_(type_theory)" title="wikilink">kind</a> <code>(* -&gt; *) -&gt; * -&gt; *</code></li>
<li>Monad operations <code>return</code> and <code>bind</code> (or an equivalent formulation) for all <code>t m</code> where <code>m</code> is a monad, satisfying the monad laws</li>
<li>An additional operation, <code>lift :: m a -&gt; t m a</code>, satisfying the following laws:<ref name="modular-interpreters"></ref></li>
</ol>

<p> (the notation <code>`bind`</code> below indicates infix application):</p>
<ol>
<li><ol>
<li><code>lift . return = return</code></li>
<li><code>lift (m `bind` k) = (lift m) `bind` (lift . k)</code></li>
</ol></li>
</ol>
<h2 id="examples">Examples</h2>
<h3 id="the-option-monad-transformer">The option monad transformer</h3>

<p>Given any monad 

<math display="inline" id="Monad_transformer:0">
 <semantics>
  <mrow>
   <mpadded width="+1.7pt">
    <mi mathvariant="normal">M</mi>
   </mpadded>
   <mi>A</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>normal-M</ci>
    <ci>A</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathrm{M}\,A
  </annotation>
 </semantics>
</math>

, the option monad transformer 

<math display="inline" id="Monad_transformer:1">
 <semantics>
  <mrow>
   <mi mathvariant="normal">M</mi>
   <mrow>
    <mo>(</mo>
    <msup>
     <mi>A</mi>
     <mi mathvariant="normal">?</mi>
    </msup>
    <mo>)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>normal-M</ci>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>A</ci>
     <ci>normal-?</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathrm{M}\left(A^{?}\right)
  </annotation>
 </semantics>
</math>

 (where 

<math display="inline" id="Monad_transformer:2">
 <semantics>
  <msup>
   <mi>A</mi>
   <mi mathvariant="normal">?</mi>
  </msup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <ci>A</ci>
    <ci>normal-?</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A^{?}
  </annotation>
 </semantics>
</math>

 denotes the <a href="option_type" title="wikilink">option type</a>) is defined by:</p>
<ul>
<li>

<math display="inline" id="Monad_transformer:3">
 <semantics>
  <mrow>
   <mi>return</mi>
   <mo>:</mo>
   <mrow>
    <mi>A</mi>
    <mo>→</mo>
    <mrow>
     <mi mathvariant="normal">M</mi>
     <mrow>
      <mo>(</mo>
      <msup>
       <mi>A</mi>
       <mi mathvariant="normal">?</mi>
      </msup>
      <mo>)</mo>
     </mrow>
    </mrow>
    <mo>=</mo>
    <mi>a</mi>
    <mo>↦</mo>
    <mrow>
     <mi>return</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <mpadded width="+1.7pt">
        <mi>Just</mi>
       </mpadded>
       <mi>a</mi>
      </mrow>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <ci>return</ci>
    <apply>
     <and></and>
     <apply>
      <ci>normal-→</ci>
      <ci>A</ci>
      <apply>
       <times></times>
       <ci>normal-M</ci>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>A</ci>
        <ci>normal-?</ci>
       </apply>
      </apply>
     </apply>
     <apply>
      <eq></eq>
      <share href="#.cmml">
      </share>
      <ci>a</ci>
     </apply>
     <apply>
      <csymbol cd="latexml">maps-to</csymbol>
      <share href="#.cmml">
      </share>
      <apply>
       <times></times>
       <ci>return</ci>
       <apply>
        <times></times>
        <ci>Just</ci>
        <ci>a</ci>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathrm{return}:A\rightarrow\mathrm{M}\left(A^{?}\right)=a\mapsto\mathrm{%
return}(\mathrm{Just}\,a)
  </annotation>
 </semantics>
</math>

</li>
<li>

<math display="inline" id="Monad_transformer:4">
 <semantics>
  <mrow>
   <mi>bind</mi>
   <mo>:</mo>
   <mi mathvariant="normal">M</mi>
   <mrow>
    <mo>(</mo>
    <msup>
     <mi>A</mi>
     <mi mathvariant="normal">?</mi>
    </msup>
    <mo>)</mo>
   </mrow>
   <mo>→</mo>
   <mrow>
    <mo>(</mo>
    <mi>A</mi>
    <mo>→</mo>
    <mi mathvariant="normal">M</mi>
    <mrow>
     <mo>(</mo>
     <msup>
      <mi>B</mi>
      <mi mathvariant="normal">?</mi>
     </msup>
     <mo>)</mo>
    </mrow>
    <mo>)</mo>
   </mrow>
   <mo>→</mo>
   <mi mathvariant="normal">M</mi>
   <mrow>
    <mo>(</mo>
    <msup>
     <mi>B</mi>
     <mi mathvariant="normal">?</mi>
    </msup>
    <mo>)</mo>
   </mrow>
   <mo>=</mo>
   <mi>m</mi>
   <mo>↦</mo>
   <mi>f</mi>
   <mo>↦</mo>
   <mpadded width="+1.7pt">
    <mi>bind</mi>
   </mpadded>
   <mpadded width="+1.7pt">
    <mi>m</mi>
   </mpadded>
   <mrow>
    <mo>(</mo>
    <mi>a</mi>
    <mo>↦</mo>
    <mrow>
     <mo>{</mo>
     <mtable>
      <mtr>
       <mtd columnalign="left">
        <mtext>return Nothing</mtext>
       </mtd>
       <mtd columnalign="left">
        <mrow>
         <mrow>
          <mtext>if</mtext>
          <mi>a</mi>
         </mrow>
         <mo>=</mo>
         <mi>Nothing</mi>
        </mrow>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="left">
        <mrow>
         <mpadded width="+1.7pt">
          <mi>f</mi>
         </mpadded>
         <msup>
          <mi>a</mi>
          <mo>′</mo>
         </msup>
        </mrow>
       </mtd>
       <mtd columnalign="left">
        <mrow>
         <mrow>
          <mtext>if</mtext>
          <mi>a</mi>
         </mrow>
         <mo>=</mo>
         <mrow>
          <mpadded width="+1.7pt">
           <mi>Just</mi>
          </mpadded>
          <msup>
           <mi>a</mi>
           <mo>′</mo>
          </msup>
         </mrow>
        </mrow>
       </mtd>
      </mtr>
     </mtable>
    </mrow>
    <mo>)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">bind</csymbol>
    <ci>normal-:</ci>
    <csymbol cd="unknown">M</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>A</ci>
      <ci>normal-?</ci>
     </apply>
     <ci>normal-)</ci>
    </cerror>
    <ci>normal-→</ci>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">A</csymbol>
     <ci>normal-→</ci>
     <csymbol cd="unknown">M</csymbol>
     <cerror>
      <csymbol cd="ambiguous">fragments</csymbol>
      <ci>normal-(</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>B</ci>
       <ci>normal-?</ci>
      </apply>
      <ci>normal-)</ci>
     </cerror>
     <ci>normal-)</ci>
    </cerror>
    <ci>normal-→</ci>
    <csymbol cd="unknown">M</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>B</ci>
      <ci>normal-?</ci>
     </apply>
     <ci>normal-)</ci>
    </cerror>
    <eq></eq>
    <csymbol cd="unknown">m</csymbol>
    <csymbol cd="latexml">maps-to</csymbol>
    <csymbol cd="unknown">f</csymbol>
    <csymbol cd="latexml">maps-to</csymbol>
    <csymbol cd="unknown">bind</csymbol>
    <csymbol cd="unknown">m</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">a</csymbol>
     <csymbol cd="latexml">maps-to</csymbol>
     <apply>
      <csymbol cd="latexml">cases</csymbol>
      <mtext>return Nothing</mtext>
      <apply>
       <eq></eq>
       <apply>
        <times></times>
        <mtext>if</mtext>
        <ci>a</ci>
       </apply>
       <ci>Nothing</ci>
      </apply>
      <apply>
       <times></times>
       <ci>f</ci>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>a</ci>
        <ci>normal-′</ci>
       </apply>
      </apply>
      <apply>
       <eq></eq>
       <apply>
        <times></times>
        <mtext>if</mtext>
        <ci>a</ci>
       </apply>
       <apply>
        <times></times>
        <ci>Just</ci>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>a</ci>
         <ci>normal-′</ci>
        </apply>
       </apply>
      </apply>
     </apply>
     <ci>normal-)</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathrm{bind}:\mathrm{M}\left(A^{?}\right)\rightarrow\left(A\rightarrow\mathrm%
{M}\left(B^{?}\right)\right)\rightarrow\mathrm{M}\left(B^{?}\right)=m\mapsto f%
\mapsto\mathrm{bind}\,m\,\left(a\mapsto\begin{cases}\mbox{return Nothing}&%
\mbox{if }a=\mathrm{Nothing}\\
f\,a^{\prime}&\mbox{if }a=\mathrm{Just}\,a^{\prime}\end{cases}\right)
  </annotation>
 </semantics>
</math>


</li>
<li>

<math display="inline" id="Monad_transformer:5">
 <semantics>
  <mrow>
   <mi>lift</mi>
   <mo>:</mo>
   <mi mathvariant="normal">M</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>A</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>→</mo>
   <mi mathvariant="normal">M</mi>
   <mrow>
    <mo>(</mo>
    <msup>
     <mi>A</mi>
     <mi mathvariant="normal">?</mi>
    </msup>
    <mo>)</mo>
   </mrow>
   <mo>=</mo>
   <mi>m</mi>
   <mo>↦</mo>
   <mpadded width="+1.7pt">
    <mi>bind</mi>
   </mpadded>
   <mpadded width="+1.7pt">
    <mi>m</mi>
   </mpadded>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>a</mi>
    <mo>↦</mo>
    <mi>return</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mpadded width="+1.7pt">
      <mi>Just</mi>
     </mpadded>
     <mi>a</mi>
     <mo stretchy="false">)</mo>
    </mrow>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">lift</csymbol>
    <ci>normal-:</ci>
    <csymbol cd="unknown">M</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">A</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <ci>normal-→</ci>
    <csymbol cd="unknown">M</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>A</ci>
      <ci>normal-?</ci>
     </apply>
     <ci>normal-)</ci>
    </cerror>
    <eq></eq>
    <csymbol cd="unknown">m</csymbol>
    <csymbol cd="latexml">maps-to</csymbol>
    <csymbol cd="unknown">bind</csymbol>
    <csymbol cd="unknown">m</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">a</csymbol>
     <csymbol cd="latexml">maps-to</csymbol>
     <csymbol cd="unknown">return</csymbol>
     <cerror>
      <csymbol cd="ambiguous">fragments</csymbol>
      <ci>normal-(</ci>
      <csymbol cd="unknown">Just</csymbol>
      <csymbol cd="unknown">a</csymbol>
      <ci>normal-)</ci>
     </cerror>
     <ci>normal-)</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathrm{lift}:\mathrm{M}(A)\rightarrow\mathrm{M}\left(A^{?}\right)=m\mapsto%
\mathrm{bind}\,m\,(a\mapsto\mathrm{return}(\mathrm{Just}\,a))
  </annotation>
 </semantics>
</math>

</li>
</ul>
<h3 id="the-exception-monad-transformer">The exception monad transformer</h3>

<p>Given any monad 

<math display="inline" id="Monad_transformer:6">
 <semantics>
  <mrow>
   <mpadded width="+1.7pt">
    <mi mathvariant="normal">M</mi>
   </mpadded>
   <mi>A</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>normal-M</ci>
    <ci>A</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathrm{M}\,A
  </annotation>
 </semantics>
</math>

, the exception monad transformer 

<math display="inline" id="Monad_transformer:7">
 <semantics>
  <mrow>
   <mi mathvariant="normal">M</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mrow>
     <mi>A</mi>
     <mo>+</mo>
     <mi>E</mi>
    </mrow>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>normal-M</ci>
    <apply>
     <plus></plus>
     <ci>A</ci>
     <ci>E</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathrm{M}(A+E)
  </annotation>
 </semantics>
</math>

 (where 

<math display="inline" id="Monad_transformer:8">
 <semantics>
  <mi>E</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>E</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   E
  </annotation>
 </semantics>
</math>

 is the type of exceptions) is defined by:</p>
<ul>
<li>

<math display="inline" id="Monad_transformer:9">
 <semantics>
  <mrow>
   <mi>return</mi>
   <mo>:</mo>
   <mrow>
    <mi>A</mi>
    <mo>→</mo>
    <mrow>
     <mi mathvariant="normal">M</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <mi>A</mi>
       <mo>+</mo>
       <mi>E</mi>
      </mrow>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
    <mo>=</mo>
    <mi>a</mi>
    <mo>↦</mo>
    <mrow>
     <mi>return</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <mpadded width="+1.7pt">
        <mi>value</mi>
       </mpadded>
       <mi>a</mi>
      </mrow>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <ci>return</ci>
    <apply>
     <and></and>
     <apply>
      <ci>normal-→</ci>
      <ci>A</ci>
      <apply>
       <times></times>
       <ci>normal-M</ci>
       <apply>
        <plus></plus>
        <ci>A</ci>
        <ci>E</ci>
       </apply>
      </apply>
     </apply>
     <apply>
      <eq></eq>
      <share href="#.cmml">
      </share>
      <ci>a</ci>
     </apply>
     <apply>
      <csymbol cd="latexml">maps-to</csymbol>
      <share href="#.cmml">
      </share>
      <apply>
       <times></times>
       <ci>return</ci>
       <apply>
        <times></times>
        <ci>value</ci>
        <ci>a</ci>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathrm{return}:A\rightarrow\mathrm{M}(A+E)=a\mapsto\mathrm{return}(\mathrm{%
value}\,a)
  </annotation>
 </semantics>
</math>


</li>
<li>

<math display="inline" id="Monad_transformer:10">
 <semantics>
  <mrow>
   <mi>bind</mi>
   <mo>:</mo>
   <mi mathvariant="normal">M</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>A</mi>
    <mo>+</mo>
    <mi>E</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>→</mo>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>A</mi>
    <mo>→</mo>
    <mi mathvariant="normal">M</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>B</mi>
     <mo>+</mo>
     <mi>E</mi>
     <mo stretchy="false">)</mo>
    </mrow>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>→</mo>
   <mi mathvariant="normal">M</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>B</mi>
    <mo>+</mo>
    <mi>E</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>=</mo>
   <mi>m</mi>
   <mo>↦</mo>
   <mi>f</mi>
   <mo>↦</mo>
   <mpadded width="+1.7pt">
    <mi>bind</mi>
   </mpadded>
   <mpadded width="+1.7pt">
    <mi>m</mi>
   </mpadded>
   <mrow>
    <mo>(</mo>
    <mi>a</mi>
    <mo>↦</mo>
    <mrow>
     <mo>{</mo>
     <mtable>
      <mtr>
       <mtd columnalign="left">
        <mrow>
         <mtext>return err</mtext>
         <mi>e</mi>
        </mrow>
       </mtd>
       <mtd columnalign="left">
        <mrow>
         <mrow>
          <mtext>if</mtext>
          <mi>a</mi>
         </mrow>
         <mo>=</mo>
         <mrow>
          <mpadded width="+1.7pt">
           <mi>err</mi>
          </mpadded>
          <mi>e</mi>
         </mrow>
        </mrow>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="left">
        <mrow>
         <mpadded width="+1.7pt">
          <mi>f</mi>
         </mpadded>
         <msup>
          <mi>a</mi>
          <mo>′</mo>
         </msup>
        </mrow>
       </mtd>
       <mtd columnalign="left">
        <mrow>
         <mrow>
          <mtext>if</mtext>
          <mi>a</mi>
         </mrow>
         <mo>=</mo>
         <mrow>
          <mpadded width="+1.7pt">
           <mi>value</mi>
          </mpadded>
          <msup>
           <mi>a</mi>
           <mo>′</mo>
          </msup>
         </mrow>
        </mrow>
       </mtd>
      </mtr>
     </mtable>
    </mrow>
    <mo>)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">bind</csymbol>
    <ci>normal-:</ci>
    <csymbol cd="unknown">M</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">A</csymbol>
     <plus></plus>
     <csymbol cd="unknown">E</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <ci>normal-→</ci>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">A</csymbol>
     <ci>normal-→</ci>
     <csymbol cd="unknown">M</csymbol>
     <cerror>
      <csymbol cd="ambiguous">fragments</csymbol>
      <ci>normal-(</ci>
      <csymbol cd="unknown">B</csymbol>
      <plus></plus>
      <csymbol cd="unknown">E</csymbol>
      <ci>normal-)</ci>
     </cerror>
     <ci>normal-)</ci>
    </cerror>
    <ci>normal-→</ci>
    <csymbol cd="unknown">M</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">B</csymbol>
     <plus></plus>
     <csymbol cd="unknown">E</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <eq></eq>
    <csymbol cd="unknown">m</csymbol>
    <csymbol cd="latexml">maps-to</csymbol>
    <csymbol cd="unknown">f</csymbol>
    <csymbol cd="latexml">maps-to</csymbol>
    <csymbol cd="unknown">bind</csymbol>
    <csymbol cd="unknown">m</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">a</csymbol>
     <csymbol cd="latexml">maps-to</csymbol>
     <apply>
      <csymbol cd="latexml">cases</csymbol>
      <apply>
       <times></times>
       <mtext>return err</mtext>
       <ci>e</ci>
      </apply>
      <apply>
       <eq></eq>
       <apply>
        <times></times>
        <mtext>if</mtext>
        <ci>a</ci>
       </apply>
       <apply>
        <times></times>
        <ci>err</ci>
        <ci>e</ci>
       </apply>
      </apply>
      <apply>
       <times></times>
       <ci>f</ci>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>a</ci>
        <ci>normal-′</ci>
       </apply>
      </apply>
      <apply>
       <eq></eq>
       <apply>
        <times></times>
        <mtext>if</mtext>
        <ci>a</ci>
       </apply>
       <apply>
        <times></times>
        <ci>value</ci>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>a</ci>
         <ci>normal-′</ci>
        </apply>
       </apply>
      </apply>
     </apply>
     <ci>normal-)</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathrm{bind}:\mathrm{M}(A+E)\rightarrow(A\rightarrow\mathrm{M}(B+E))%
\rightarrow\mathrm{M}(B+E)=m\mapsto f\mapsto\mathrm{bind}\,m\,\left(a\mapsto%
\begin{cases}\mbox{return err }e&\mbox{if }a=\mathrm{err}\,e\\
f\,a^{\prime}&\mbox{if }a=\mathrm{value}\,a^{\prime}\end{cases}\right)
  </annotation>
 </semantics>
</math>

</li>
<li>

<math display="inline" id="Monad_transformer:11">
 <semantics>
  <mrow>
   <mi>lift</mi>
   <mo>:</mo>
   <mpadded width="+1.7pt">
    <mi mathvariant="normal">M</mi>
   </mpadded>
   <mi>A</mi>
   <mo>→</mo>
   <mi mathvariant="normal">M</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>A</mi>
    <mo>+</mo>
    <mi>E</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>=</mo>
   <mi>m</mi>
   <mo>↦</mo>
   <mpadded width="+1.7pt">
    <mi>bind</mi>
   </mpadded>
   <mpadded width="+1.7pt">
    <mi>m</mi>
   </mpadded>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>a</mi>
    <mo>↦</mo>
    <mi>return</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mpadded width="+1.7pt">
      <mi>value</mi>
     </mpadded>
     <mi>a</mi>
     <mo stretchy="false">)</mo>
    </mrow>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">lift</csymbol>
    <ci>normal-:</ci>
    <csymbol cd="unknown">M</csymbol>
    <csymbol cd="unknown">A</csymbol>
    <ci>normal-→</ci>
    <csymbol cd="unknown">M</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">A</csymbol>
     <plus></plus>
     <csymbol cd="unknown">E</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <eq></eq>
    <csymbol cd="unknown">m</csymbol>
    <csymbol cd="latexml">maps-to</csymbol>
    <csymbol cd="unknown">bind</csymbol>
    <csymbol cd="unknown">m</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">a</csymbol>
     <csymbol cd="latexml">maps-to</csymbol>
     <csymbol cd="unknown">return</csymbol>
     <cerror>
      <csymbol cd="ambiguous">fragments</csymbol>
      <ci>normal-(</ci>
      <csymbol cd="unknown">value</csymbol>
      <csymbol cd="unknown">a</csymbol>
      <ci>normal-)</ci>
     </cerror>
     <ci>normal-)</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathrm{lift}:\mathrm{M}\,A\rightarrow\mathrm{M}(A+E)=m\mapsto\mathrm{bind}\,m%
\,(a\mapsto\mathrm{return}(\mathrm{value}\,a))
  </annotation>
 </semantics>
</math>

</li>
</ul>
<h3 id="the-reader-monad-transformer">The reader monad transformer</h3>

<p>Given any monad 

<math display="inline" id="Monad_transformer:12">
 <semantics>
  <mrow>
   <mpadded width="+1.7pt">
    <mi mathvariant="normal">M</mi>
   </mpadded>
   <mi>A</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>normal-M</ci>
    <ci>A</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathrm{M}\,A
  </annotation>
 </semantics>
</math>

, the reader monad transformer 

<math display="inline" id="Monad_transformer:13">
 <semantics>
  <mrow>
   <mi>E</mi>
   <mo>→</mo>
   <mrow>
    <mpadded width="+1.7pt">
     <mi mathvariant="normal">M</mi>
    </mpadded>
    <mi>A</mi>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-→</ci>
    <ci>E</ci>
    <apply>
     <times></times>
     <ci>normal-M</ci>
     <ci>A</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   E\rightarrow\mathrm{M}\,A
  </annotation>
 </semantics>
</math>

 (where 

<math display="inline" id="Monad_transformer:14">
 <semantics>
  <mi>E</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>E</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   E
  </annotation>
 </semantics>
</math>


 is the environment type) is defined by:</p>
<ul>
<li>

<math display="inline" id="Monad_transformer:15">
 <semantics>
  <mrow>
   <mi>return</mi>
   <mo>:</mo>
   <mrow>
    <mi>A</mi>
    <mo>→</mo>
    <mi>E</mi>
    <mo>→</mo>
    <mrow>
     <mpadded width="+1.7pt">
      <mi mathvariant="normal">M</mi>
     </mpadded>
     <mi>A</mi>
    </mrow>
    <mo>=</mo>
    <mi>a</mi>
    <mo>↦</mo>
    <mi>e</mi>
    <mo>↦</mo>
    <mrow>
     <mpadded width="+1.7pt">
      <mi>return</mi>
     </mpadded>
     <mi>a</mi>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <ci>return</ci>
    <apply>
     <and></and>
     <apply>
      <ci>normal-→</ci>
      <ci>A</ci>
      <ci>E</ci>
     </apply>
     <apply>
      <ci>normal-→</ci>
      <share href="#.cmml">
      </share>
      <apply>
       <times></times>
       <ci>normal-M</ci>
       <ci>A</ci>
      </apply>
     </apply>
     <apply>
      <eq></eq>
      <share href="#.cmml">
      </share>
      <ci>a</ci>
     </apply>
     <apply>
      <csymbol cd="latexml">maps-to</csymbol>
      <share href="#.cmml">
      </share>
      <ci>e</ci>
     </apply>
     <apply>
      <csymbol cd="latexml">maps-to</csymbol>
      <share href="#.cmml">
      </share>
      <apply>
       <times></times>
       <ci>return</ci>
       <ci>a</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathrm{return}:A\rightarrow E\rightarrow\mathrm{M}\,A=a\mapsto e\mapsto%
\mathrm{return}\,a
  </annotation>
 </semantics>
</math>

</li>
<li>

<math display="inline" id="Monad_transformer:16">
 <semantics>
  <mrow>
   <mi>bind</mi>
   <mo>:</mo>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>E</mi>
    <mo>→</mo>
    <mpadded width="+1.7pt">
     <mi mathvariant="normal">M</mi>
    </mpadded>
    <mi>A</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>→</mo>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>A</mi>
    <mo>→</mo>
    <mi>E</mi>
    <mo>→</mo>
    <mpadded width="+1.7pt">
     <mi mathvariant="normal">M</mi>
    </mpadded>
    <mi>B</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>→</mo>
   <mi>E</mi>
   <mo>→</mo>
   <mpadded width="+1.7pt">
    <mi mathvariant="normal">M</mi>
   </mpadded>
   <mi>B</mi>
   <mo>=</mo>
   <mi>m</mi>
   <mo>↦</mo>
   <mi>k</mi>
   <mo>↦</mo>
   <mi>e</mi>
   <mo>↦</mo>
   <mpadded width="+1.7pt">
    <mi>bind</mi>
   </mpadded>
   <mrow>
    <mo stretchy="false">(</mo>
    <mpadded width="+1.7pt">
     <mi>m</mi>
    </mpadded>
    <mi>e</mi>
    <mo rspace="4.2pt" stretchy="false">)</mo>
   </mrow>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>a</mi>
    <mo>↦</mo>
    <mpadded width="+1.7pt">
     <mi>k</mi>
    </mpadded>
    <mpadded width="+1.7pt">
     <mi>a</mi>
    </mpadded>
    <mi>e</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">bind</csymbol>
    <ci>normal-:</ci>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">E</csymbol>
     <ci>normal-→</ci>
     <csymbol cd="unknown">M</csymbol>
     <csymbol cd="unknown">A</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <ci>normal-→</ci>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">A</csymbol>
     <ci>normal-→</ci>
     <csymbol cd="unknown">E</csymbol>
     <ci>normal-→</ci>
     <csymbol cd="unknown">M</csymbol>
     <csymbol cd="unknown">B</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <ci>normal-→</ci>
    <csymbol cd="unknown">E</csymbol>
    <ci>normal-→</ci>
    <csymbol cd="unknown">M</csymbol>
    <csymbol cd="unknown">B</csymbol>
    <eq></eq>
    <csymbol cd="unknown">m</csymbol>
    <csymbol cd="latexml">maps-to</csymbol>
    <csymbol cd="unknown">k</csymbol>
    <csymbol cd="latexml">maps-to</csymbol>
    <csymbol cd="unknown">e</csymbol>
    <csymbol cd="latexml">maps-to</csymbol>
    <csymbol cd="unknown">bind</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">m</csymbol>
     <csymbol cd="unknown">e</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">a</csymbol>
     <csymbol cd="latexml">maps-to</csymbol>
     <csymbol cd="unknown">k</csymbol>
     <csymbol cd="unknown">a</csymbol>
     <csymbol cd="unknown">e</csymbol>
     <ci>normal-)</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathrm{bind}:(E\rightarrow\mathrm{M}\,A)\rightarrow(A\rightarrow E\rightarrow%
\mathrm{M}\,B)\rightarrow E\rightarrow\mathrm{M}\,B=m\mapsto k\mapsto e\mapsto%
\mathrm{bind}\,(m\,e)\,(a\mapsto k\,a\,e)
  </annotation>
 </semantics>
</math>

</li>
<li>

<math display="inline" id="Monad_transformer:17">
 <semantics>
  <mrow>
   <mi>lift</mi>
   <mo>:</mo>
   <mrow>
    <mrow>
     <mpadded width="+1.7pt">
      <mi mathvariant="normal">M</mi>
     </mpadded>
     <mi>A</mi>
    </mrow>
    <mo>→</mo>
    <mi>E</mi>
    <mo>→</mo>
    <mrow>
     <mpadded width="+1.7pt">
      <mi mathvariant="normal">M</mi>
     </mpadded>
     <mi>A</mi>
    </mrow>
    <mo>=</mo>
    <mi>a</mi>
    <mo>↦</mo>
    <mi>e</mi>
    <mo>↦</mo>
    <mi>a</mi>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <ci>lift</ci>
    <apply>
     <and></and>
     <apply>
      <ci>normal-→</ci>
      <apply>
       <times></times>
       <ci>normal-M</ci>
       <ci>A</ci>
      </apply>
      <ci>E</ci>
     </apply>
     <apply>
      <ci>normal-→</ci>
      <share href="#.cmml">
      </share>
      <apply>
       <times></times>
       <ci>normal-M</ci>
       <ci>A</ci>
      </apply>
     </apply>
     <apply>
      <eq></eq>
      <share href="#.cmml">
      </share>
      <ci>a</ci>
     </apply>
     <apply>
      <csymbol cd="latexml">maps-to</csymbol>
      <share href="#.cmml">
      </share>
      <ci>e</ci>
     </apply>
     <apply>
      <csymbol cd="latexml">maps-to</csymbol>
      <share href="#.cmml">
      </share>
      <ci>a</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathrm{lift}:\mathrm{M}\,A\rightarrow E\rightarrow\mathrm{M}\,A=a\mapsto e\mapsto
a
  </annotation>
 </semantics>
</math>

</li>
</ul>
<h3 id="the-state-monad-transformer">The state monad transformer</h3>

<p>Given any monad 

<math display="inline" id="Monad_transformer:18">
 <semantics>
  <mrow>
   <mpadded width="+1.7pt">
    <mi mathvariant="normal">M</mi>
   </mpadded>
   <mi>A</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>normal-M</ci>
    <ci>A</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathrm{M}\,A
  </annotation>
 </semantics>
</math>

, the state monad transformer 

<math display="inline" id="Monad_transformer:19">
 <semantics>
  <mrow>
   <mi>S</mi>
   <mo>→</mo>
   <mrow>
    <mi mathvariant="normal">M</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mrow>
      <mi>A</mi>
      <mo>×</mo>
      <mi>S</mi>
     </mrow>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-→</ci>
    <ci>S</ci>
    <apply>
     <times></times>
     <ci>normal-M</ci>
     <apply>
      <times></times>
      <ci>A</ci>
      <ci>S</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S\rightarrow\mathrm{M}(A\times S)
  </annotation>
 </semantics>
</math>


 (where 

<math display="inline" id="Monad_transformer:20">
 <semantics>
  <mi>S</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>S</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S
  </annotation>
 </semantics>
</math>

 is the state type) is defined by:</p>
<ul>
<li>

<math display="inline" id="Monad_transformer:21">
 <semantics>
  <mrow>
   <mi>return</mi>
   <mo>:</mo>
   <mrow>
    <mi>A</mi>
    <mo>→</mo>
    <mi>S</mi>
    <mo>→</mo>
    <mrow>
     <mi mathvariant="normal">M</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <mi>A</mi>
       <mo>×</mo>
       <mi>S</mi>
      </mrow>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
    <mo>=</mo>
    <mi>a</mi>
    <mo>↦</mo>
    <mi>s</mi>
    <mo>↦</mo>
    <mrow>
     <mpadded width="+1.7pt">
      <mi>return</mi>
     </mpadded>
     <mrow>
      <mo stretchy="false">(</mo>
      <mi>a</mi>
      <mo>,</mo>
      <mi>s</mi>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <ci>return</ci>
    <apply>
     <and></and>
     <apply>
      <ci>normal-→</ci>
      <ci>A</ci>
      <ci>S</ci>
     </apply>
     <apply>
      <ci>normal-→</ci>
      <share href="#.cmml">
      </share>
      <apply>
       <times></times>
       <ci>normal-M</ci>
       <apply>
        <times></times>
        <ci>A</ci>
        <ci>S</ci>
       </apply>
      </apply>
     </apply>
     <apply>
      <eq></eq>
      <share href="#.cmml">
      </share>
      <ci>a</ci>
     </apply>
     <apply>
      <csymbol cd="latexml">maps-to</csymbol>
      <share href="#.cmml">
      </share>
      <ci>s</ci>
     </apply>
     <apply>
      <csymbol cd="latexml">maps-to</csymbol>
      <share href="#.cmml">
      </share>
      <apply>
       <times></times>
       <ci>return</ci>
       <interval closure="open">
        <ci>a</ci>
        <ci>s</ci>
       </interval>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathrm{return}:A\rightarrow S\rightarrow\mathrm{M}(A\times S)=a\mapsto s%
\mapsto\mathrm{return}\,(a,s)
  </annotation>
 </semantics>
</math>

</li>
<li>

<math display="inline" id="Monad_transformer:22">
 <semantics>
  <mrow>
   <mi>bind</mi>
   <mo>:</mo>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>S</mi>
    <mo>→</mo>
    <mi mathvariant="normal">M</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>A</mi>
     <mo>×</mo>
     <mi>S</mi>
     <mo stretchy="false">)</mo>
    </mrow>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>→</mo>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>A</mi>
    <mo>→</mo>
    <mi>S</mi>
    <mo>→</mo>
    <mi mathvariant="normal">M</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>B</mi>
     <mo>×</mo>
     <mi>S</mi>
     <mo stretchy="false">)</mo>
    </mrow>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>→</mo>
   <mi>S</mi>
   <mo>→</mo>
   <mi mathvariant="normal">M</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>B</mi>
    <mo>×</mo>
    <mi>S</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>=</mo>
   <mi>m</mi>
   <mo>↦</mo>
   <mi>k</mi>
   <mo>↦</mo>
   <mi>s</mi>
   <mo>↦</mo>
   <mpadded width="+1.7pt">
    <mi>bind</mi>
   </mpadded>
   <mrow>
    <mo stretchy="false">(</mo>
    <mpadded width="+1.7pt">
     <mi>m</mi>
    </mpadded>
    <mi>s</mi>
    <mo rspace="4.2pt" stretchy="false">)</mo>
   </mrow>
   <mrow>
    <mo stretchy="false">(</mo>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>a</mi>
     <mo>,</mo>
     <msup>
      <mi>s</mi>
      <mo>′</mo>
     </msup>
     <mo stretchy="false">)</mo>
    </mrow>
    <mo>↦</mo>
    <mpadded width="+1.7pt">
     <mi>k</mi>
    </mpadded>
    <mpadded width="+1.7pt">
     <mi>a</mi>
    </mpadded>
    <msup>
     <mi>s</mi>
     <mo>′</mo>
    </msup>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">bind</csymbol>
    <ci>normal-:</ci>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">S</csymbol>
     <ci>normal-→</ci>
     <csymbol cd="unknown">M</csymbol>
     <cerror>
      <csymbol cd="ambiguous">fragments</csymbol>
      <ci>normal-(</ci>
      <csymbol cd="unknown">A</csymbol>
      <times></times>
      <csymbol cd="unknown">S</csymbol>
      <ci>normal-)</ci>
     </cerror>
     <ci>normal-)</ci>
    </cerror>
    <ci>normal-→</ci>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">A</csymbol>
     <ci>normal-→</ci>
     <csymbol cd="unknown">S</csymbol>
     <ci>normal-→</ci>
     <csymbol cd="unknown">M</csymbol>
     <cerror>
      <csymbol cd="ambiguous">fragments</csymbol>
      <ci>normal-(</ci>
      <csymbol cd="unknown">B</csymbol>
      <times></times>
      <csymbol cd="unknown">S</csymbol>
      <ci>normal-)</ci>
     </cerror>
     <ci>normal-)</ci>
    </cerror>
    <ci>normal-→</ci>
    <csymbol cd="unknown">S</csymbol>
    <ci>normal-→</ci>
    <csymbol cd="unknown">M</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">B</csymbol>
     <times></times>
     <csymbol cd="unknown">S</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <eq></eq>
    <csymbol cd="unknown">m</csymbol>
    <csymbol cd="latexml">maps-to</csymbol>
    <csymbol cd="unknown">k</csymbol>
    <csymbol cd="latexml">maps-to</csymbol>
    <csymbol cd="unknown">s</csymbol>
    <csymbol cd="latexml">maps-to</csymbol>
    <csymbol cd="unknown">bind</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">m</csymbol>
     <csymbol cd="unknown">s</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <cerror>
      <csymbol cd="ambiguous">fragments</csymbol>
      <ci>normal-(</ci>
      <csymbol cd="unknown">a</csymbol>
      <ci>normal-,</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>s</ci>
       <ci>normal-′</ci>
      </apply>
      <ci>normal-)</ci>
     </cerror>
     <csymbol cd="latexml">maps-to</csymbol>
     <csymbol cd="unknown">k</csymbol>
     <csymbol cd="unknown">a</csymbol>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>s</ci>
      <ci>normal-′</ci>
     </apply>
     <ci>normal-)</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathrm{bind}:(S\rightarrow\mathrm{M}(A\times S))\rightarrow(A\rightarrow S%
\rightarrow\mathrm{M}(B\times S))\rightarrow S\rightarrow\mathrm{M}(B\times S)%
=m\mapsto k\mapsto s\mapsto\mathrm{bind}\,(m\,s)\,((a,s^{\prime})\mapsto k\,a%
\,s^{\prime})
  </annotation>
 </semantics>
</math>

</li>
<li>

<math display="inline" id="Monad_transformer:23">
 <semantics>
  <mrow>
   <mi>lift</mi>
   <mo>:</mo>
   <mpadded width="+1.7pt">
    <mi mathvariant="normal">M</mi>
   </mpadded>
   <mi>A</mi>
   <mo>→</mo>
   <mi>S</mi>
   <mo>→</mo>
   <mi mathvariant="normal">M</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>A</mi>
    <mo>×</mo>
    <mi>S</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>=</mo>
   <mi>m</mi>
   <mo>↦</mo>
   <mi>s</mi>
   <mo>↦</mo>
   <mpadded width="+1.7pt">
    <mi>bind</mi>
   </mpadded>
   <mpadded width="+1.7pt">
    <mi>m</mi>
   </mpadded>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>a</mi>
    <mo>↦</mo>
    <mpadded width="+1.7pt">
     <mi>return</mi>
    </mpadded>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>a</mi>
     <mo>,</mo>
     <mi>s</mi>
     <mo stretchy="false">)</mo>
    </mrow>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">lift</csymbol>
    <ci>normal-:</ci>
    <csymbol cd="unknown">M</csymbol>
    <csymbol cd="unknown">A</csymbol>
    <ci>normal-→</ci>
    <csymbol cd="unknown">S</csymbol>
    <ci>normal-→</ci>
    <csymbol cd="unknown">M</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">A</csymbol>
     <times></times>
     <csymbol cd="unknown">S</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <eq></eq>
    <csymbol cd="unknown">m</csymbol>
    <csymbol cd="latexml">maps-to</csymbol>
    <csymbol cd="unknown">s</csymbol>
    <csymbol cd="latexml">maps-to</csymbol>
    <csymbol cd="unknown">bind</csymbol>
    <csymbol cd="unknown">m</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">a</csymbol>
     <csymbol cd="latexml">maps-to</csymbol>
     <csymbol cd="unknown">return</csymbol>
     <cerror>
      <csymbol cd="ambiguous">fragments</csymbol>
      <ci>normal-(</ci>
      <csymbol cd="unknown">a</csymbol>
      <ci>normal-,</ci>
      <csymbol cd="unknown">s</csymbol>
      <ci>normal-)</ci>
     </cerror>
     <ci>normal-)</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathrm{lift}:\mathrm{M}\,A\rightarrow S\rightarrow\mathrm{M}(A\times S)=m%
\mapsto s\mapsto\mathrm{bind}\,m\,(a\mapsto\mathrm{return}\,(a,s))
  </annotation>
 </semantics>
</math>

</li>
</ul>
<h3 id="the-writer-monad-transformer">The writer monad transformer</h3>

<p>Given any monad 

<math display="inline" id="Monad_transformer:24">
 <semantics>
  <mrow>
   <mpadded width="+1.7pt">
    <mi mathvariant="normal">M</mi>
   </mpadded>
   <mi>A</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>normal-M</ci>
    <ci>A</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathrm{M}\,A
  </annotation>
 </semantics>
</math>


, the writer monad transformer 

<math display="inline" id="Monad_transformer:25">
 <semantics>
  <mrow>
   <mi mathvariant="normal">M</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mrow>
     <mi>W</mi>
     <mo>×</mo>
     <mi>A</mi>
    </mrow>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>normal-M</ci>
    <apply>
     <times></times>
     <ci>W</ci>
     <ci>A</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathrm{M}(W\times A)
  </annotation>
 </semantics>
</math>

 (where 

<math display="inline" id="Monad_transformer:26">
 <semantics>
  <mi>W</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>W</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   W
  </annotation>
 </semantics>
</math>

 is endowed with a <a class="uri" href="monoid" title="wikilink">monoid</a> operation 

<math display="inline" id="Monad_transformer:27">
 <semantics>
  <mo>*</mo>
  <annotation-xml encoding="MathML-Content">
   <times></times>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   *
  </annotation>
 </semantics>
</math>

 with identity element 

<math display="inline" id="Monad_transformer:28">
 <semantics>
  <mi>ε</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>ε</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \varepsilon
  </annotation>
 </semantics>
</math>

) is defined by:</p>
<ul>
<li>

<math display="inline" id="Monad_transformer:29">
 <semantics>
  <mrow>
   <mi>return</mi>
   <mo>:</mo>
   <mrow>
    <mi>A</mi>
    <mo>→</mo>
    <mrow>
     <mi mathvariant="normal">M</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <mi>W</mi>
       <mo>×</mo>
       <mi>A</mi>
      </mrow>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
    <mo>=</mo>
    <mi>a</mi>
    <mo>↦</mo>
    <mrow>
     <mpadded width="+1.7pt">
      <mi>return</mi>
     </mpadded>
     <mrow>
      <mo stretchy="false">(</mo>
      <mi>ε</mi>
      <mo>,</mo>
      <mi>a</mi>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <ci>return</ci>
    <apply>
     <and></and>
     <apply>
      <ci>normal-→</ci>
      <ci>A</ci>
      <apply>
       <times></times>
       <ci>normal-M</ci>
       <apply>
        <times></times>
        <ci>W</ci>
        <ci>A</ci>
       </apply>
      </apply>
     </apply>
     <apply>
      <eq></eq>
      <share href="#.cmml">
      </share>
      <ci>a</ci>
     </apply>
     <apply>
      <csymbol cd="latexml">maps-to</csymbol>
      <share href="#.cmml">
      </share>
      <apply>
       <times></times>
       <ci>return</ci>
       <interval closure="open">
        <ci>ε</ci>
        <ci>a</ci>
       </interval>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathrm{return}:A\rightarrow\mathrm{M}(W\times A)=a\mapsto\mathrm{return}\,(%
\varepsilon,a)
  </annotation>
 </semantics>
</math>


</li>
<li>

<math display="inline" id="Monad_transformer:30">
 <semantics>
  <mrow>
   <mi>bind</mi>
   <mo>:</mo>
   <mi mathvariant="normal">M</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>W</mi>
    <mo>×</mo>
    <mi>A</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>→</mo>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>A</mi>
    <mo>→</mo>
    <mi mathvariant="normal">M</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>W</mi>
     <mo>×</mo>
     <mi>B</mi>
     <mo stretchy="false">)</mo>
    </mrow>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>→</mo>
   <mi mathvariant="normal">M</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>W</mi>
    <mo>×</mo>
    <mi>B</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>=</mo>
   <mi>m</mi>
   <mo>↦</mo>
   <mi>f</mi>
   <mo>↦</mo>
   <mpadded width="+1.7pt">
    <mi>bind</mi>
   </mpadded>
   <mpadded width="+1.7pt">
    <mi>m</mi>
   </mpadded>
   <mrow>
    <mo stretchy="false">(</mo>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>w</mi>
     <mo>,</mo>
     <mi>a</mi>
     <mo stretchy="false">)</mo>
    </mrow>
    <mo>↦</mo>
    <mpadded width="+1.7pt">
     <mi>bind</mi>
    </mpadded>
    <mrow>
     <mo stretchy="false">(</mo>
     <mpadded width="+1.7pt">
      <mi>f</mi>
     </mpadded>
     <mi>a</mi>
     <mo rspace="4.2pt" stretchy="false">)</mo>
    </mrow>
    <mrow>
     <mo stretchy="false">(</mo>
     <mrow>
      <mo stretchy="false">(</mo>
      <msup>
       <mi>w</mi>
       <mo>′</mo>
      </msup>
      <mo>,</mo>
      <mi>b</mi>
      <mo stretchy="false">)</mo>
     </mrow>
     <mo>↦</mo>
     <mpadded width="+1.7pt">
      <mi>return</mi>
     </mpadded>
     <mrow>
      <mo stretchy="false">(</mo>
      <mi>w</mi>
      <mo>*</mo>
      <msup>
       <mi>w</mi>
       <mo>′</mo>
      </msup>
      <mo>,</mo>
      <mi>b</mi>
      <mo stretchy="false">)</mo>
     </mrow>
     <mo stretchy="false">)</mo>
    </mrow>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">bind</csymbol>
    <ci>normal-:</ci>
    <csymbol cd="unknown">M</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">W</csymbol>
     <times></times>
     <csymbol cd="unknown">A</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <ci>normal-→</ci>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">A</csymbol>
     <ci>normal-→</ci>
     <csymbol cd="unknown">M</csymbol>
     <cerror>
      <csymbol cd="ambiguous">fragments</csymbol>
      <ci>normal-(</ci>
      <csymbol cd="unknown">W</csymbol>
      <times></times>
      <csymbol cd="unknown">B</csymbol>
      <ci>normal-)</ci>
     </cerror>
     <ci>normal-)</ci>
    </cerror>
    <ci>normal-→</ci>
    <csymbol cd="unknown">M</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">W</csymbol>
     <times></times>
     <csymbol cd="unknown">B</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <eq></eq>
    <csymbol cd="unknown">m</csymbol>
    <csymbol cd="latexml">maps-to</csymbol>
    <csymbol cd="unknown">f</csymbol>
    <csymbol cd="latexml">maps-to</csymbol>
    <csymbol cd="unknown">bind</csymbol>
    <csymbol cd="unknown">m</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <cerror>
      <csymbol cd="ambiguous">fragments</csymbol>
      <ci>normal-(</ci>
      <csymbol cd="unknown">w</csymbol>
      <ci>normal-,</ci>
      <csymbol cd="unknown">a</csymbol>
      <ci>normal-)</ci>
     </cerror>
     <csymbol cd="latexml">maps-to</csymbol>
     <csymbol cd="unknown">bind</csymbol>
     <cerror>
      <csymbol cd="ambiguous">fragments</csymbol>
      <ci>normal-(</ci>
      <csymbol cd="unknown">f</csymbol>
      <csymbol cd="unknown">a</csymbol>
      <ci>normal-)</ci>
     </cerror>
     <cerror>
      <csymbol cd="ambiguous">fragments</csymbol>
      <ci>normal-(</ci>
      <cerror>
       <csymbol cd="ambiguous">fragments</csymbol>
       <ci>normal-(</ci>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>w</ci>
        <ci>normal-′</ci>
       </apply>
       <ci>normal-,</ci>
       <csymbol cd="unknown">b</csymbol>
       <ci>normal-)</ci>
      </cerror>
      <csymbol cd="latexml">maps-to</csymbol>
      <csymbol cd="unknown">return</csymbol>
      <cerror>
       <csymbol cd="ambiguous">fragments</csymbol>
       <ci>normal-(</ci>
       <csymbol cd="unknown">w</csymbol>
       <times></times>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>w</ci>
        <ci>normal-′</ci>
       </apply>
       <ci>normal-,</ci>
       <csymbol cd="unknown">b</csymbol>
       <ci>normal-)</ci>
      </cerror>
      <ci>normal-)</ci>
     </cerror>
     <ci>normal-)</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathrm{bind}:\mathrm{M}(W\times A)\rightarrow(A\rightarrow\mathrm{M}(W\times B%
))\rightarrow\mathrm{M}(W\times B)=m\mapsto f\mapsto\mathrm{bind}\,m\,((w,a)%
\mapsto\mathrm{bind}\,(f\,a)\,((w^{\prime},b)\mapsto\mathrm{return}\,(w*w^{%
\prime},b)))
  </annotation>
 </semantics>
</math>

</li>
<li>

<math display="inline" id="Monad_transformer:31">
 <semantics>
  <mrow>
   <mi>lift</mi>
   <mo>:</mo>
   <mpadded width="+1.7pt">
    <mi mathvariant="normal">M</mi>
   </mpadded>
   <mi>A</mi>
   <mo>→</mo>
   <mi mathvariant="normal">M</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>W</mi>
    <mo>×</mo>
    <mi>A</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>=</mo>
   <mi>m</mi>
   <mo>↦</mo>
   <mpadded width="+1.7pt">
    <mi>bind</mi>
   </mpadded>
   <mpadded width="+1.7pt">
    <mi>m</mi>
   </mpadded>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>a</mi>
    <mo>↦</mo>
    <mpadded width="+1.7pt">
     <mi>return</mi>
    </mpadded>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>ε</mi>
     <mo>,</mo>
     <mi>a</mi>
     <mo stretchy="false">)</mo>
    </mrow>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">lift</csymbol>
    <ci>normal-:</ci>
    <csymbol cd="unknown">M</csymbol>
    <csymbol cd="unknown">A</csymbol>
    <ci>normal-→</ci>
    <csymbol cd="unknown">M</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">W</csymbol>
     <times></times>
     <csymbol cd="unknown">A</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <eq></eq>
    <csymbol cd="unknown">m</csymbol>
    <csymbol cd="latexml">maps-to</csymbol>
    <csymbol cd="unknown">bind</csymbol>
    <csymbol cd="unknown">m</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">a</csymbol>
     <csymbol cd="latexml">maps-to</csymbol>
     <csymbol cd="unknown">return</csymbol>
     <cerror>
      <csymbol cd="ambiguous">fragments</csymbol>
      <ci>normal-(</ci>
      <csymbol cd="unknown">ε</csymbol>
      <ci>normal-,</ci>
      <csymbol cd="unknown">a</csymbol>
      <ci>normal-)</ci>
     </cerror>
     <ci>normal-)</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathrm{lift}:\mathrm{M}\,A\rightarrow\mathrm{M}(W\times A)=m\mapsto\mathrm{%
bind}\,m\,(a\mapsto\mathrm{return}\,(\varepsilon,a))
  </annotation>
 </semantics>
</math>

</li>
</ul>
<h3 id="the-continuation-monad-transformer">The continuation monad transformer</h3>

<p>Given any monad 

<math display="inline" id="Monad_transformer:32">
 <semantics>
  <mrow>
   <mpadded width="+1.7pt">
    <mi mathvariant="normal">M</mi>
   </mpadded>
   <mi>A</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>normal-M</ci>
    <ci>A</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathrm{M}\,A
  </annotation>
 </semantics>
</math>

, the continuation monad transformer maps an arbitrary type 

<math display="inline" id="Monad_transformer:33">
 <semantics>
  <mi>R</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>R</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   R
  </annotation>
 </semantics>
</math>

 into functions of type 

<math display="inline" id="Monad_transformer:34">
 <semantics>
  <mrow>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>A</mi>
    <mo>→</mo>
    <mpadded width="+1.7pt">
     <mi mathvariant="normal">M</mi>
    </mpadded>
    <mi>R</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>→</mo>
   <mpadded width="+1.7pt">
    <mi mathvariant="normal">M</mi>
   </mpadded>
   <mi>R</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">A</csymbol>
     <ci>normal-→</ci>
     <csymbol cd="unknown">M</csymbol>
     <csymbol cd="unknown">R</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <ci>normal-→</ci>
    <csymbol cd="unknown">M</csymbol>
    <csymbol cd="unknown">R</csymbol>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   (A\rightarrow\mathrm{M}\,R)\rightarrow\mathrm{M}\,R
  </annotation>
 </semantics>
</math>


, where 

<math display="inline" id="Monad_transformer:35">
 <semantics>
  <mi>R</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>R</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   R
  </annotation>
 </semantics>
</math>

 is the result type of the continuation. It is defined by:</p>
<ul>
<li>

<math display="inline" id="Monad_transformer:36">
 <semantics>
  <mrow>
   <mi>return</mi>
   <mo>:</mo>
   <mi>A</mi>
   <mo>→</mo>
   <mrow>
    <mo>(</mo>
    <mi>A</mi>
    <mo>→</mo>
    <mpadded width="+1.7pt">
     <mi mathvariant="normal">M</mi>
    </mpadded>
    <mi>R</mi>
    <mo>)</mo>
   </mrow>
   <mo>→</mo>
   <mpadded width="+1.7pt">
    <mi mathvariant="normal">M</mi>
   </mpadded>
   <mi>R</mi>
   <mo>=</mo>
   <mi>a</mi>
   <mo>↦</mo>
   <mi>k</mi>
   <mo>↦</mo>
   <mpadded width="+1.7pt">
    <mi>k</mi>
   </mpadded>
   <mi>a</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">return</csymbol>
    <ci>normal-:</ci>
    <csymbol cd="unknown">A</csymbol>
    <ci>normal-→</ci>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">A</csymbol>
     <ci>normal-→</ci>
     <csymbol cd="unknown">M</csymbol>
     <csymbol cd="unknown">R</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <ci>normal-→</ci>
    <csymbol cd="unknown">M</csymbol>
    <csymbol cd="unknown">R</csymbol>
    <eq></eq>
    <csymbol cd="unknown">a</csymbol>
    <csymbol cd="latexml">maps-to</csymbol>
    <csymbol cd="unknown">k</csymbol>
    <csymbol cd="latexml">maps-to</csymbol>
    <csymbol cd="unknown">k</csymbol>
    <csymbol cd="unknown">a</csymbol>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathrm{return}\colon A\rightarrow\left(A\rightarrow\mathrm{M}\,R\right)%
\rightarrow\mathrm{M}\,R=a\mapsto k\mapsto k\,a
  </annotation>
 </semantics>
</math>

</li>
<li>

<math display="inline" id="Monad_transformer:37">
 <semantics>
  <mrow>
   <mi>bind</mi>
   <mo>:</mo>
   <mrow>
    <mo>(</mo>
    <mrow>
     <mo>(</mo>
     <mi>A</mi>
     <mo>→</mo>
     <mpadded width="+1.7pt">
      <mi mathvariant="normal">M</mi>
     </mpadded>
     <mi>R</mi>
     <mo>)</mo>
    </mrow>
    <mo>→</mo>
    <mpadded width="+1.7pt">
     <mi mathvariant="normal">M</mi>
    </mpadded>
    <mi>R</mi>
    <mo>)</mo>
   </mrow>
   <mo>→</mo>
   <mrow>
    <mo>(</mo>
    <mi>A</mi>
    <mo>→</mo>
    <mrow>
     <mo>(</mo>
     <mi>B</mi>
     <mo>→</mo>
     <mpadded width="+1.7pt">
      <mi mathvariant="normal">M</mi>
     </mpadded>
     <mi>R</mi>
     <mo>)</mo>
    </mrow>
    <mo>→</mo>
    <mpadded width="+1.7pt">
     <mi mathvariant="normal">M</mi>
    </mpadded>
    <mi>R</mi>
    <mo>)</mo>
   </mrow>
   <mo>→</mo>
   <mrow>
    <mo>(</mo>
    <mi>B</mi>
    <mo>→</mo>
    <mpadded width="+1.7pt">
     <mi mathvariant="normal">M</mi>
    </mpadded>
    <mi>R</mi>
    <mo>)</mo>
   </mrow>
   <mo>→</mo>
   <mpadded width="+1.7pt">
    <mi mathvariant="normal">M</mi>
   </mpadded>
   <mi>R</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">bind</csymbol>
    <ci>normal-:</ci>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <cerror>
      <csymbol cd="ambiguous">fragments</csymbol>
      <ci>normal-(</ci>
      <csymbol cd="unknown">A</csymbol>
      <ci>normal-→</ci>
      <csymbol cd="unknown">M</csymbol>
      <csymbol cd="unknown">R</csymbol>
      <ci>normal-)</ci>
     </cerror>
     <ci>normal-→</ci>
     <csymbol cd="unknown">M</csymbol>
     <csymbol cd="unknown">R</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <ci>normal-→</ci>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">A</csymbol>
     <ci>normal-→</ci>
     <cerror>
      <csymbol cd="ambiguous">fragments</csymbol>
      <ci>normal-(</ci>
      <csymbol cd="unknown">B</csymbol>
      <ci>normal-→</ci>
      <csymbol cd="unknown">M</csymbol>
      <csymbol cd="unknown">R</csymbol>
      <ci>normal-)</ci>
     </cerror>
     <ci>normal-→</ci>
     <csymbol cd="unknown">M</csymbol>
     <csymbol cd="unknown">R</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <ci>normal-→</ci>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">B</csymbol>
     <ci>normal-→</ci>
     <csymbol cd="unknown">M</csymbol>
     <csymbol cd="unknown">R</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <ci>normal-→</ci>
    <csymbol cd="unknown">M</csymbol>
    <csymbol cd="unknown">R</csymbol>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathrm{bind}\colon\left(\left(A\rightarrow\mathrm{M}\,R\right)\rightarrow%
\mathrm{M}\,R\right)\rightarrow\left(A\rightarrow\left(B\rightarrow\mathrm{M}%
\,R\right)\rightarrow\mathrm{M}\,R\right)\rightarrow\left(B\rightarrow\mathrm{%
M}\,R\right)\rightarrow\mathrm{M}\,R
  </annotation>
 </semantics>
</math>



<math display="inline" id="Monad_transformer:38">
 <semantics>
  <mrow>
   <mo>=</mo>
   <mi>c</mi>
   <mo>↦</mo>
   <mi>f</mi>
   <mo>↦</mo>
   <mi>k</mi>
   <mo>↦</mo>
   <mpadded width="+1.7pt">
    <mi>c</mi>
   </mpadded>
   <mrow>
    <mo>(</mo>
    <mi>a</mi>
    <mo>↦</mo>
    <mpadded width="+1.7pt">
     <mi>f</mi>
    </mpadded>
    <mpadded width="+1.7pt">
     <mi>a</mi>
    </mpadded>
    <mi>k</mi>
    <mo>)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <eq></eq>
    <csymbol cd="unknown">c</csymbol>
    <csymbol cd="latexml">maps-to</csymbol>
    <csymbol cd="unknown">f</csymbol>
    <csymbol cd="latexml">maps-to</csymbol>
    <csymbol cd="unknown">k</csymbol>
    <csymbol cd="latexml">maps-to</csymbol>
    <csymbol cd="unknown">c</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">a</csymbol>
     <csymbol cd="latexml">maps-to</csymbol>
     <csymbol cd="unknown">f</csymbol>
     <csymbol cd="unknown">a</csymbol>
     <csymbol cd="unknown">k</csymbol>
     <ci>normal-)</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   =c\mapsto f\mapsto k\mapsto c\,\left(a\mapsto f\,a\,k\right)
  </annotation>
 </semantics>
</math>

</li>
<li>

<math display="inline" id="Monad_transformer:39">
 <semantics>
  <mrow>
   <mi>lift</mi>
   <mo>:</mo>
   <mpadded width="+1.7pt">
    <mi mathvariant="normal">M</mi>
   </mpadded>
   <mi>A</mi>
   <mo>→</mo>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>A</mi>
    <mo>→</mo>
    <mpadded width="+1.7pt">
     <mi mathvariant="normal">M</mi>
    </mpadded>
    <mi>R</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>→</mo>
   <mpadded width="+1.7pt">
    <mi mathvariant="normal">M</mi>
   </mpadded>
   <mi>R</mi>
   <mo>=</mo>
   <mi>bind</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">lift</csymbol>
    <ci>normal-:</ci>
    <csymbol cd="unknown">M</csymbol>
    <csymbol cd="unknown">A</csymbol>
    <ci>normal-→</ci>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">A</csymbol>
     <ci>normal-→</ci>
     <csymbol cd="unknown">M</csymbol>
     <csymbol cd="unknown">R</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <ci>normal-→</ci>
    <csymbol cd="unknown">M</csymbol>
    <csymbol cd="unknown">R</csymbol>
    <eq></eq>
    <csymbol cd="unknown">bind</csymbol>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathrm{lift}:\mathrm{M}\,A\rightarrow(A\rightarrow\mathrm{M}\,R)\rightarrow%
\mathrm{M}\,R=\mathrm{bind}
  </annotation>
 </semantics>
</math>


</li>
</ul>

<p>Note that monad transformations are usually not <a class="uri" href="commutative" title="wikilink">commutative</a>: for instance, applying the state transformer to the option monad yields a type 

<math display="inline" id="Monad_transformer:40">
 <semantics>
  <mrow>
   <mi>S</mi>
   <mo>→</mo>
   <msup>
    <mrow>
     <mo>(</mo>
     <mrow>
      <mi>A</mi>
      <mo>×</mo>
      <mi>S</mi>
     </mrow>
     <mo>)</mo>
    </mrow>
    <mi mathvariant="normal">?</mi>
   </msup>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-→</ci>
    <ci>S</ci>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <times></times>
      <ci>A</ci>
      <ci>S</ci>
     </apply>
     <ci>normal-?</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S\rightarrow\left(A\times S\right)^{?}
  </annotation>
 </semantics>
</math>

 (a computation which may fail and yield no final state), whereas the converse transformation has type 

<math display="inline" id="Monad_transformer:41">
 <semantics>
  <mrow>
   <mi>S</mi>
   <mo>→</mo>
   <mrow>
    <mo>(</mo>
    <mrow>
     <msup>
      <mi>A</mi>
      <mi mathvariant="normal">?</mi>
     </msup>
     <mo>×</mo>
     <mi>S</mi>
    </mrow>
    <mo>)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-→</ci>
    <ci>S</ci>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>A</ci>
      <ci>normal-?</ci>
     </apply>
     <ci>S</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S\rightarrow\left(A^{?}\times S\right)
  </annotation>
 </semantics>
</math>

 (a computation which yields a final state and an optional return value).</p>
<h2 id="see-also">See also</h2>
<ul>
<li><a href="Monads_in_functional_programming" title="wikilink">Monads in functional programming</a></li>
</ul>
<h2 id="references">References</h2>
<h2 id="external-links">External links</h2>
<ul>
<li><a href="http://conway.rutgers.edu/~ccshan/wiki/blog/posts/Monad_transformers/">A highly technical blog post briefly reviewing some of the literature on monad transformers and related concepts, with a focus on categorical-theoretic treatment</a></li>
</ul>

<p>"</p>

<p><a href="Category:Functional_programming" title="wikilink">Category:Functional programming</a></p>
</body>
</html>
