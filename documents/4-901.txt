   Importance sampling      Importance sampling   In statistics , importance sampling is a general technique for estimating properties of a particular distribution , while only having samples generated from a different distribution than the distribution of interest. It is related to umbrella sampling in computational physics . Depending on the application, the term may refer to the process of sampling from this alternative distribution, the process of inference, or both.  Basic theory  Let    X  :   Ω  →  ℝ      normal-:  X   normal-→  normal-Ω  ℝ     X:\Omega\to\mathbb{R}   be a random variable in some probability space     (  Ω  ,  ℱ  ,  P  )     normal-Ω  ℱ  P    (\Omega,\mathcal{F},P)   . We wish to estimate the expected value of X under P , denoted E [ X;P ]. If we have random samples     x  1   ,  …  ,   x  n       subscript  x  1   normal-…   subscript  x  n     x_{1},\ldots,x_{n}   , generated according to P , then an empirical estimate of E [ X;P ] is          𝐄  ^   n    [  X  ;  P  ]    =    1  n     ∑   i  =  1   n    x  i      .         subscript   normal-^  𝐄   n    X  P        1  n     superscript   subscript     i  1    n    subscript  x  i       \widehat{\mathbf{E}}_{n}[X;P]=\frac{1}{n}\sum_{i=1}^{n}x_{i}.     The basic idea of importance sampling is to change the probability measure P so that the estimation of E [ X;P ] is easier. Choose a random variable    L  ≥  0      L  0    L\geq 0   such that E [L;P]=1 and that P - almost everywhere      L   (  ω  )    ≠  0        L  ω   0    L(\omega)\neq 0   . With the variate L we define another probability     P   (  L  )    :=    L   P      assign   superscript  P  L     L  P     P^{(L)}:=L\,P   that satisfies        𝐄   [  X  ;  P  ]    =   𝐄   [   X  L   ;   P   (  L  )    ]     .        𝐄   X  P      𝐄     X  L    superscript  P  L       \mathbf{E}[X;P]=\mathbf{E}\left[\frac{X}{L};P^{(L)}\right].     The variable X/L will thus be sampled under P (L) to estimate    𝐄   [  X  ;  P  ]       𝐄   X  P     \mathbf{E}[X;P]   as above. This procedure will improve the estimation when     var   [   X  L   ;   P   (  L  )    ]    <   var   [  X  ;  P  ]         var    X  L    superscript  P  L     var  X  P     \operatorname{var}\left[\frac{X}{L};P^{(L)}\right]<\operatorname{var}[X;P]   . Another case of interest is when X/L is easier to sample under P (L) than X under P .  When X is of constant sign over Ω, the best variable L would clearly be     L  *   =   X   𝐄   [  X  ;  P  ]     ≥  0         superscript  L      X    𝐄   X  P          0     L^{*}=\frac{X}{\mathbf{E}[X;P]}\geq 0   , so that X/L* is the searched constant E [X;P] and a single sample under P (L*) suffices to give its value. Unfortunately we cannot take that choice, because E [X;P] is precisely the value we are looking for! However this theoretical best case L* gives us an insight into what importance sampling does:      ∀  a  ∈  ℝ  ,   P   (   L  *   )     (  X  ∈   [  a  ;  a  +  d  a  ]   )      fragments  for-all  a   R  normal-,   superscript  P   superscript  L      fragments  normal-(  X    fragments  normal-[  a  normal-;  a   d  a  normal-]   normal-)     \displaystyle\forall a\in\mathbb{R},\;P^{(L^{*})}(X\in[a;a+da])   to the right,     a   P   (  X  ∈   [  a  ;  a  +  d  a  ]   )      fragments  a  P   fragments  normal-(  X    fragments  normal-[  a  normal-;  a   d  a  normal-]   normal-)     a\,P(X\in[a;a+da])   is one of the infinitesimal elements that sum up to E [X;P] :      E   [  X  ;  P  ]   =   ∫   a  =   -  ∞     +  ∞     a   P   (  X  ∈   [  a  ;  a  +  d  a  ]   )      fragments  E   fragments  normal-[  X  normal-;  P  normal-]     superscript   subscript     a             a  P   fragments  normal-(  X    fragments  normal-[  a  normal-;  a   d  a  normal-]   normal-)     E[X;P]=\int_{a=-\infty}^{+\infty}a\,P(X\in[a;a+da])   therefore, a good probability change P (L) in importance sampling will redistribute the law of X so that its samples' frequencies are sorted directly according to their weights in  E [X;P] . Hence the name "importance sampling."  Note that whenever   P   P   P   is the uniform distribution and    Ω  =  ℝ      normal-Ω  ℝ    \Omega=\mathbb{R}   , we are just estimating the integral of the real function    X  :   ℝ  →  ℝ      normal-:  X   normal-→  ℝ  ℝ     X:\mathbb{R}\to\mathbb{R}   , so the method can also be used for estimating simple integrals.  Application to probabilistic inference  Such methods are frequently used to estimate posterior densities or expectations in state and/or parameter estimation problems in probabilistic models that are too hard to treat analytically, for example in Bayesian networks .  Application to simulation  Importance sampling is a variance reduction technique that can be used in the Monte Carlo method . The idea behind importance sampling is that certain values of the input random variables in a simulation have more impact on the parameter being estimated than others. If these "important" values are emphasized by sampling more frequently, then the estimator variance can be reduced. Hence, the basic methodology in importance sampling is to choose a distribution which "encourages" the important values. This use of "biased" distributions will result in a biased estimator if it is applied directly in the simulation. However, the simulation outputs are weighted to correct for the use of the biased distribution, and this ensures that the new importance sampling estimator is unbiased. The weight is given by the likelihood ratio , that is, the Radon–Nikodym derivative of the true underlying distribution with respect to the biased simulation distribution.  The fundamental issue in implementing importance sampling simulation is the choice of the biased distribution which encourages the important regions of the input variables. Choosing or designing a good biased distribution is the "art" of importance sampling. The rewards for a good distribution can be huge run-time savings; the penalty for a bad distribution can be longer run times than for a general Monte Carlo simulation without importance sampling.  Consider   X   X   X   to be the sample and     f   (  X  )     g   (  X  )          f  X     g  X     \frac{f(X)}{g(X)}   to be the likelihood ratio, where   f   f   f   is the probability density (mass) function of the desired distribution and   g   g   g   is the probability density (mass) function of the biased/proposal/sample distribution. Then the problem can be characterize by choosing the sample distribution   g   g   g   that minimizes the variance of the scaled sample:       g  *   =    min  g     Var  g    (   X    f   (  X  )     g   (  X  )      )          superscript  g       subscript   g     subscript  Var  g     X      f  X     g  X         g^{*}=\min_{g}\operatorname{Var}_{g}\left(X\frac{f(X)}{g(X)}\right)   .  It can be shown that the following distribution minimizes the above variance: 1         g  *    (  X  )    =     |  X  |   f   (  X  )     ∫    |  x  |   f   (  x  )   d  x      .         superscript  g    X         X   f  X         x   f  x  d  x       g^{*}(X)=\frac{|X|f(X)}{\int|x|f(x)dx}.     It is easy to see that when    X  ≥  0      X  0    X\geq 0   , this variance becomes 0.  Mathematical approach  Consider estimating by simulation the probability     p  t      subscript  p  t    p_{t}\,   of an event    X  ≥   t       X  t    {X\geq t\ }   , where   X   X   X   is a random variable with distribution    F   F   F   and probability density function      f   (  x  )    =    F  ′    (  x  )          f  x      superscript  F  normal-′   x     f(x)=F^{\prime}(x)\,   , where prime denotes derivative . A   K   K   K   -length independent and identically distributed (i.i.d.) sequence     X  i      subscript  X  i    X_{i}\,   is generated from the distribution   F   F   F   , and the number    k  t     subscript  k  t    k_{t}   of random variables that lie above the threshold   t   t   t   are counted. The random variable    k  t     subscript  k  t    k_{t}   is characterized by the Binomial distribution      P   (   k  t   =  k  )   =   (     K      k     )    p  t  k     (  1  -   p  t   )    K  -  k    ,  k  =  0  ,  1  ,  …  ,  K  .     fragments  P   fragments  normal-(   subscript  k  t    k  normal-)     binomial  K  k    superscript   subscript  p  t   k    superscript   fragments  normal-(  1    subscript  p  t   normal-)     K  k    normal-,  k   0  normal-,  1  normal-,  normal-…  normal-,  K  normal-.    P(k_{t}=k)={K\choose k}p_{t}^{k}(1-p_{t})^{K-k},\,\quad\quad k=0,1,\dots,K.     One can show that     E   [    k  t   /  K   ]    =   p  t        normal-E     subscript  k  t   K     subscript  p  t     \operatorname{E}[k_{t}/K]=p_{t}   , and     var   [    k  t   /  K   ]    =     p  t    (   1  -   p  t    )    /  K        var     subscript  k  t   K         subscript  p  t     1   subscript  p  t     K     \operatorname{var}[k_{t}/K]=p_{t}(1-p_{t})/K   , so in the limit    K  →  ∞     normal-→  K     K\to\infty   we are able to obtain    p  t     subscript  p  t    p_{t}   . Note that the variance is low if     p  t   ≈  1       subscript  p  t   1    p_{t}\approx 1   . Importance sampling is concerned with the determination and use of an alternate density function     f  *      subscript  f     f_{*}\,   (for X), usually referred to as a biasing density, for the simulation experiment. This density allows the event    X  ≥   t       X  t    {X\geq t\ }   to occur more frequently, so the sequence lengths   K   K   K   gets smaller for a given estimator variance. Alternatively, for a given   K   K   K   , use of the biasing density results in a variance smaller than that of the conventional Monte Carlo estimate. From the definition of     p  t      subscript  p  t    p_{t}\,   , we can introduce     f  *      subscript  f     f_{*}\,   as below.      p  t     subscript  p  t    \displaystyle p_{t}     where       W   (  ⋅  )    ≡    f   (  ⋅  )      f  *    (  ⋅  )           W  normal-⋅       f  normal-⋅      subscript  f    normal-⋅      W(\cdot)\equiv\frac{f(\cdot)}{f_{*}(\cdot)}     is a likelihood ratio and is referred to as the weighting function. The last equality in the above equation motivates the estimator        p  ^   t   =    1  K     ∑   i  =  1   K   1   (   X  i   ≥  t  )   W   (   X  i   )   ,   X  i   ∼   f  *      fragments   subscript   normal-^  p   t      1  K    superscript   subscript     i  1    K   1   fragments  normal-(   subscript  X  i    t  normal-)   W   fragments  normal-(   subscript  X  i   normal-)   normal-,   subscript  X  i   similar-to   subscript  f      \hat{p}_{t}=\frac{1}{K}\,\sum_{i=1}^{K}1(X_{i}\geq t)W(X_{i}),\,\quad\quad X_{%
 i}\sim f_{*}     This is the importance sampling estimator of     p  t      subscript  p  t    p_{t}\,   and is unbiased. That is, the estimation procedure is to generate i.i.d. samples from     f  *      subscript  f     f_{*}\,   and for each sample which exceeds    t    t   t\,   , the estimate is incremented by the weight    W    W   W\,   evaluated at the sample value. The results are averaged over    K    K   K\,   trials. The variance of the importance sampling estimator is easily shown to be       var  *     p  ^   t       subscript  var     subscript   normal-^  p   t     \displaystyle\operatorname{var}_{*}\hat{p}_{t}     Now, the importance sampling problem then focuses on finding a biasing density     f  *      subscript  f     f_{*}\,   such that the variance of the importance sampling estimator is less than the variance of the general Monte Carlo estimate. For some biasing density function, which minimizes the variance, and under certain conditions reduces it to zero, it is called an optimal biasing density function.  Conventional biasing methods  Although there are many kinds of biasing methods, the following two methods are most widely used in the applications of importance sampling.  Scaling  Shifting probability mass into the event region    X  ≥   t       X  t    {X\geq t\ }   by positive scaling of the random variable    X    X   X\,   with a number greater than unity has the effect of increasing the variance (mean also) of the density function. This results in a heavier tail of the density, leading to an increase in the event probability. Scaling is probably one of the earliest biasing methods known and has been extensively used in practice. It is simple to implement and usually provides conservative simulation gains as compared to other methods.  In importance sampling by scaling, the simulation density is chosen as the density function of the scaled random variable    a   X       a  X    aX\,   , where usually    a  >  1      a  1    a>1   for tail probability estimation. By transformation,        f  *    (  x  )    =    1  a   f   (   x  a   )           subscript  f    x       1  a   f    x  a      f_{*}(x)=\frac{1}{a}f\bigg(\frac{x}{a}\bigg)\,     and the weighting function is       W   (  x  )    =   a     f   (  x  )     f   (   x  /  a   )             W  x     a      f  x     f    x  a        W(x)=a\frac{f(x)}{f(x/a)}\,     While scaling shifts probability mass into the desired event region, it also pushes mass into the complementary region    n    n   n\,   is a sum of    n    n   n\,   random variables, the spreading of mass takes place in an    n    n   n\,   dimensional space. The consequence of this is a decreasing importance sampling gain for increasing       f  *    (  x  )    =   f   (   x  -  c   )     ,   c  >   0       formulae-sequence       subscript  f    x     f    x  c       c  0     f_{*}(x)=f(x-c),\quad c>0\,   , and is called the dimensionality effect.  Translation  Another simple and effective biasing technique employs translation of the density function (and hence random variable) to place much of its probability mass in the rare event region. Translation does not suffer from a dimensionality effect and has been successfully used in several applications relating to simulation of digital communication systems. It often provides better simulation gains than scaling. In biasing by translation, the simulation density is given by      c    c   c\,     where     σ   M  C   2   /    σ   I  S   2         subscript   superscript  σ  2     M  C     subscript   superscript  σ  2     I  S      \sigma^{2}_{MC}/\sigma^{2}_{IS}\,   is the amount of shift and is to be chosen to minimize the variance of the importance sampling estimator.  Effects of system complexity  The fundamental problem with importance sampling is that designing good biased distributions becomes more complicated as the system complexity increases. Complex systems are the systems with long memory since complex processing of a few inputs is much easier to handle. This dimensionality or memory can cause problems in three ways:   long memory (severe intersymbol interference (ISI))  unknown memory ( Viterbi decoders )  possibly infinite memory (adaptive equalizers)   In principle, the importance sampling ideas remain the same in these situations, but the design becomes much harder. A successful approach to combat this problem is essentially breaking down a simulation into several smaller, more sharply defined subproblems. Then importance sampling strategies are used to target each of the simpler subproblems. Examples of techniques to break the simulation down are conditioning and error-event simulation (EES) and regenerative simulation.  Evaluation of importance sampling  In order to identify successful importance sampling techniques, it is useful to be able to quantify the run-time savings due to the use of the importance sampling approach. The performance measure commonly used is     σ   M  C   2   /    σ   I  S   2         subscript   superscript  σ  2     M  C     subscript   superscript  σ  2     I  S      \sigma^{2}_{MC}/\sigma^{2}_{IS}\,   , and this can be interpreted as the speed-up factor by which the importance sampling estimator achieves the same precision as the MC estimator. This has to be computed empirically since the estimator variances are not likely to be analytically possible when their mean is intractable. Other useful concepts in quantifying an importance sampling estimator are the variance bounds and the notion of asymptotic efficiency.  Variance cost function  Variance is not the only possible cost function for a simulation, and other cost functions, such as the mean absolute deviation, are used in various statistical applications. Nevertheless, the variance is the primary cost function addressed in the literature, probably due to the use of variances in confidence intervals and in the performance measure     σ   M  C   2   /    σ   I  S   2         subscript   superscript  σ  2     M  C     subscript   superscript  σ  2     I  S      \sigma^{2}_{MC}/\sigma^{2}_{IS}\,   .  An associated issue is the fact that the ratio $\sigma^2_{MC} / \sigma^2_{IS} \,$ overestimates the run-time savings due to importance sampling since it does not include the extra computing time required to compute the weight function. Hence, some people evaluate the net run-time improvement by various means. Perhaps a more serious overhead to importance sampling is the time taken to devise and program the technique and analytically derive the desired weight function.  See also   Monte Carlo method  variance reduction  Stratified sampling  Recursive stratified sampling  VEGAS algorithm  Particle filter — a sequential Monte Carlo method, which uses importance sampling  Auxiliary field Monte Carlo  Rejection sampling   References             External links   Sequential Monte Carlo Methods (Particle Filtering) homepage on University of Cambridge  Introduction to importance sampling in rare-event simulations European journal of Physics. PDF document.  Adaptive monte carlo methods for rare event simulation: adaptive monte carlo methods for rare event simulations Winter Simulation Conference   "  Category:Monte Carlo methods  Category:Variance reduction  Category:Stochastic simulation     Rubinstein, R. Y., & Kroese, D. P. (2011). Simulation and the Monte Carlo method (Vol. 707). John Wiley & Sons. ↩     