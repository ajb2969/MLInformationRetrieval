   Faà di Bruno's formula      Faà di Bruno's formula   Faà di Bruno's formula is an identity in mathematics generalizing the chain rule to higher derivatives, named after , though he was not the first to state or prove the formula. In 1800, more than 50 years before Faà di Bruno, the French mathematician Louis François Antoine Arbogast stated the formula in a calculus textbook, 1 considered the first published reference on the subject. 2  Perhaps the most well-known form of Faà di Bruno's formula says that          d  n    d   x  n     f   (   g   (  x  )    )    =   ∑       n  !      m  1   !      1  !    m  1       m  2   !      2  !    m  2      ⋯     m  n   !     n  !    m  n      ⋅   f   (    m  1   +  ⋯  +   m  n    )      (   g   (  x  )    )    ⋅    ∏   j  =  1   n     (    g   (  j  )     (  x  )    )    m  j        ,           superscript  d  n     d   superscript  x  n     f    g  x       normal-⋅     normal-⋅      n        subscript  m  1     superscript    1    subscript  m  1       subscript  m  2     superscript    2    subscript  m  2    normal-⋯     subscript  m  n     superscript    n    subscript  m  n       superscript  f     subscript  m  1   normal-⋯   subscript  m  n        g  x      superscript   subscript  product    j  1    n    superscript     superscript  g  j   x    subscript  m  j         {d^{n}\over dx^{n}}f(g(x))=\sum\frac{n!}{m_{1}!\,1!^{m_{1}}\,m_{2}!\,2!^{m_{2}%
 }\,\cdots\,m_{n}!\,n!^{m_{n}}}\cdot f^{(m_{1}+\cdots+m_{n})}(g(x))\cdot\prod_{%
 j=1}^{n}\left(g^{(j)}(x)\right)^{m_{j}},     where the sum is over all n - tuples of nonnegative integers ( m 1 , …, m n ) satisfying the constraint         1  ⋅   m  1    +   2  ⋅   m  2    +   3  ⋅   m  3    +  ⋯  +   n  ⋅   m  n     =  n   .         normal-⋅  1   subscript  m  1     normal-⋅  2   subscript  m  2     normal-⋅  3   subscript  m  3    normal-⋯   normal-⋅  n   subscript  m  n     n    1\cdot m_{1}+2\cdot m_{2}+3\cdot m_{3}+\cdots+n\cdot m_{n}=n.\,     Sometimes, to give it a memorable pattern, it is written in a way in which the coefficients that have the combinatorial interpretation discussed below are less explicit:          d  n    d   x  n     f   (   g   (  x  )    )    =   ∑       n  !      m  1   !     m  2   !    ⋯     m  n   !     ⋅   f   (    m  1   +  ⋯  +   m  n    )      (   g   (  x  )    )    ⋅    ∏   j  =  1   n     (     g   (  j  )     (  x  )     j  !    )    m  j        .           superscript  d  n     d   superscript  x  n     f    g  x       normal-⋅     normal-⋅      n        subscript  m  1       subscript  m  2    normal-⋯     subscript  m  n       superscript  f     subscript  m  1   normal-⋯   subscript  m  n        g  x      superscript   subscript  product    j  1    n    superscript       superscript  g  j   x     j     subscript  m  j         {d^{n}\over dx^{n}}f(g(x))=\sum\frac{n!}{m_{1}!\,m_{2}!\,\cdots\,m_{n}!}\cdot f%
 ^{(m_{1}+\cdots+m_{n})}(g(x))\cdot\prod_{j=1}^{n}\left(\frac{g^{(j)}(x)}{j!}%
 \right)^{m_{j}}.     Combining the terms with the same value of m 1 + m 2 + ... + m n = k and noticing that m  j has to be zero for j > n − k + 1 leads to a somewhat simpler formula expressed in terms of Bell polynomials  B n , k ( x 1 ,..., x n − k +1 ):          d  n    d   x  n     f   (   g   (  x  )    )    =    ∑   k  =  1   n       f   (  k  )     (   g   (  x  )    )    ⋅   B   n  ,  k      (    g  ′    (  x  )    ,    g  ′′    (  x  )    ,  …  ,    g   (    n  -  k   +  1   )     (  x  )    )      .           superscript  d  n     d   superscript  x  n     f    g  x      superscript   subscript     k  1    n      normal-⋅     superscript  f  k     g  x     subscript  B   n  k         superscript  g  normal-′   x      superscript  g  ′′   x   normal-…     superscript  g      n  k   1    x        {d^{n}\over dx^{n}}f(g(x))=\sum_{k=1}^{n}f^{(k)}(g(x))\cdot B_{n,k}\left(g^{%
 \prime}(x),g^{\prime\prime}(x),\dots,g^{(n-k+1)}(x)\right).     Combinatorial form  The formula has a "combinatorial" form:         d  n    d   x  n     f   (   g   (  x  )    )    =     (   f  ∘  g   )    (  n  )     (  x  )    =    ∑   π  ∈  Π       f   (   |  π  |   )     (   g   (  x  )    )    ⋅    ∏   B  ∈  π      g   (   |  B  |   )     (  x  )                  superscript  d  n     d   superscript  x  n     f    g  x       superscript    f  g   n   x          subscript     π  normal-Π     normal-⋅     superscript  f    π      g  x      subscript  product    B  π       superscript  g    B    x         {d^{n}\over dx^{n}}f(g(x))=(f\circ g)^{(n)}(x)=\sum_{\pi\in\Pi}f^{(\left|\pi%
 \right|)}(g(x))\cdot\prod_{B\in\pi}g^{(\left|B\right|)}(x)     where   π runs through the set Π of all partitions of the set { 1, ..., n },    " B ∈ π" means the variable B runs through the list of all of the "blocks" of the partition π, and    | A | denotes the cardinality of the set A (so that |π| is the number of blocks in the partition π and | B | is the size of the block B ).   Explanation via an example  The combinatorial form may initially seem forbidding, so let us examine a concrete case, and see what the pattern is:        (   f  ∘  g   )   ′′′′    (  x  )        superscript    f  g   ′′′′   x    \displaystyle(f\circ g)^{\prime\prime\prime\prime}(x)     The pattern is       g  ′     (  x  )   4        superscript  g  normal-′    superscript  x  4     \displaystyle g^{\prime}(x)^{4}     The factor     g  ′′    (  x  )    g  ′      (  x  )   2         superscript  g  ′′   x   superscript  g  normal-′    superscript  x  2     \scriptstyle g^{\prime\prime}(x)g^{\prime}(x)^{2}\;   corresponds to the partition 2 + 1 + 1 of the integer 4, in the obvious way. The factor     f  ′′′    (   g   (  x  )    )        superscript  f  ′′′     g  x     \scriptstyle f^{\prime\prime\prime}(g(x))\;   that goes with it corresponds to the fact that there are three summands in that partition. The coefficient 6 that goes with those factors corresponds to the fact that there are exactly six partitions of a set of four members that break it into one part of size 2 and two parts of size 1.  Similarly, the factor     g  ′′      (  x  )   2         superscript  g  ′′    superscript  x  2     \scriptstyle g^{\prime\prime}(x)^{2}\;   in the third line corresponds to the partition 2 + 2 of the integer 4, (4, because we are finding the fourth derivative), while     f  ′′    (   g   (  x  )    )        superscript  f  ′′     g  x     \scriptstyle f^{\prime\prime}(g(x))\,\!   corresponds to the fact that there are two summands (2 + 2) in that partition. The coefficient 3 corresponds to the fact that there are      1  2    (      4      2      )    =  3          1  2    binomial  4  2    3    \tfrac{1}{2}{\textstyle\left({{4}\atop{2}}\right)}=3   ways of partitioning 4 objects into groups of 2. The same concept applies to the others.  A memorizable scheme is as follows:         D  1    (   f  ∘  g   )     1  !           superscript  D  1     f  g      1     \displaystyle\frac{D^{1}(f\circ{}g)}{1!}     Combinatorics of the Faà di Bruno coefficients  These partition-counting Faà di Bruno coefficients have a "closed-form" expression. The number of partitions of a set of size n corresponding to the integer partition      n  =       1  +  ⋯  +  1   ⏟    m  1     +      2  +  ⋯  +  2   ⏟    m  2     +     3  +  ⋯  +  3   ⏟    m  3    +  ⋯       n     subscript   normal-⏟    1  normal-⋯  1     subscript  m  1     subscript   normal-⏟    2  normal-⋯  2     subscript  m  2     subscript   normal-⏟    3  normal-⋯  3     subscript  m  3    normal-⋯     \displaystyle n=\underbrace{1+\cdots+1}_{m_{1}}\,+\,\underbrace{2+\cdots+2}_{m%
 _{2}}\,+\,\underbrace{3+\cdots+3}_{m_{3}}+\cdots     of the integer n is equal to        n  !      m  1   !     m  2   !     m  3   !   ⋯    1  !    m  1      2  !    m  2       3  !    m  3     ⋯    .        n        subscript  m  1       subscript  m  2       subscript  m  3    normal-⋯   superscript    1    subscript  m  1     superscript    2    subscript  m  2     superscript    3    subscript  m  3    normal-⋯     \frac{n!}{m_{1}!\,m_{2}!\,m_{3}!\,\cdots 1!^{m_{1}}\,2!^{m_{2}}\,3!^{m_{3}}\,%
 \cdots}.     These coefficients also arise in the Bell polynomials , which are relevant to the study of cumulants .  Variations  Multivariate version  Let y = g ( x 1 , ..., x n ). Then the following identity holds regardless of whether the n variables are all distinct, or all identical, or partitioned into several distinguishable classes of indistinguishable variables (if it seems opaque, see the very concrete example below): 3         ∂  n     ∂    x  1   ⋯     ∂   x  n      f   (  y  )    =    ∑   π  ∈  Π       f   (   |  π  |   )     (  y  )    ⋅    ∏   B  ∈  π       ∂   |  B  |    y     ∏   j  ∈  B     ∂   x  j                  superscript   n          subscript  x  1   normal-⋯       subscript  x  n      f  y     subscript     π  normal-Π     normal-⋅     superscript  f    π    y     subscript  product    B  π        superscript     B    y     subscript  product    j  B       subscript  x  j           {\partial^{n}\over\partial x_{1}\cdots\partial x_{n}}f(y)=\sum_{\pi\in\Pi}f^{(%
 \left|\pi\right|)}(y)\cdot\prod_{B\in\pi}{\partial^{\left|B\right|}y\over\prod%
 _{j\in B}\partial x_{j}}     where (as above)   π runs through the set Π of all partitions of the set { 1, ..., n },    " B ∈ π" means the variable B runs through the list of all of the "blocks" of the partition π, and    | A | denotes the cardinality of the set A (so that |π| is the number of blocks in the partition π and | B | is the size of the block B ).   A further generalization, due to Tsoy-Wo Ma, considers the case where y is a vector-valued variable. 4 The general form, for variational calculus ( Gâteaux differentials are the most general form of differential), was derived in 2012. 5   Example   The five terms in the following expression correspond in the obvious way to the five partitions of the set { 1, 2, 3 }, and in each case the order of the derivative of f is the number of parts in the partition:         ∂  3     ∂    x  1      ∂    x  2      ∂   x  3       f   (  y  )          superscript   3        subscript  x  1       subscript  x  2       subscript  x  3      f  y    \displaystyle{\partial^{3}\over\partial x_{1}\,\partial x_{2}\,\partial x_{3}}%
 f(y)     If the three variables are indistinguishable from each other, then three of the five terms above are also indistinguishable from each other, and then we have the classic one-variable formula.  Formal power series version  Suppose     f   (  x  )    =    ∑   n  =  0   ∞     a  n    x  n           f  x     superscript   subscript     n  0         subscript  a  n    superscript  x  n       f(x)=\sum_{n=0}^{\infty}{a_{n}}x^{n}   and     g   (  x  )    =    ∑   n  =  0   ∞     b  n    x  n           g  x     superscript   subscript     n  0         subscript  b  n    superscript  x  n       g(x)=\sum_{n=0}^{\infty}{b_{n}}x^{n}   are formal power series and     b  0   =  0       subscript  b  0   0    b_{0}=0   .  Then the composition    f  ∘  g      f  g    f\circ g   is again a formal power series,        f   (   g   (  x  )    )    =    ∑   n  =  0   ∞     c  n    x  n      ,        f    g  x      superscript   subscript     n  0         subscript  c  n    superscript  x  n       f(g(x))=\sum_{n=0}^{\infty}{c_{n}}x^{n},   and the coefficient c n , for n ≥ 1 , can be expressed as a sum over compositions of n or as an equivalent sum over partitions of n :        c  n   =    ∑   𝐢  ∈   𝒞  n       a  k    b   i  1     b   i  2    ⋯   b   i  k       ,       subscript  c  n     subscript     𝐢   subscript  𝒞  n        subscript  a  k    subscript  b   subscript  i  1     subscript  b   subscript  i  2    normal-⋯   subscript  b   subscript  i  k        c_{n}=\sum_{\mathbf{i}\in\mathcal{C}_{n}}a_{k}b_{i_{1}}b_{i_{2}}\cdots b_{i_{k%
 }},   where       𝒞  n   =   {   (   i  1   ,   i  2   ,  …  ,   i  k   )   :    1  ≤  k  ≤  n   ,     i  1   +   i  2   +  ⋯  +   i  k    =  n    }        subscript  𝒞  n    conditional-set    subscript  i  1    subscript  i  2   normal-…   subscript  i  k     formulae-sequence      1  k       n         subscript  i  1    subscript  i  2   normal-⋯   subscript  i  k    n       \mathcal{C}_{n}=\{(i_{1},i_{2},\dots,i_{k})\,:\ 1\leq k\leq n,\ i_{1}+i_{2}+%
 \cdots+i_{k}=n\}   is the set of compositions of n with k denoting the number of parts,  or        c  n   =    ∑   k  =  1   n     a  k     ∑   π  ∈   𝒫   n  ,  k        (     k        π  1   ,   π  2   ,  …  ,   π  n       )    b  1   π  1     b  2   π  2    ⋯   b  n   π  n         ,       subscript  c  n     superscript   subscript     k  1    n      subscript  a  k     subscript     π   subscript  𝒫   n  k         binomial  k    subscript  π  1    subscript  π  2   normal-…   subscript  π  n      superscript   subscript  b  1    subscript  π  1     superscript   subscript  b  2    subscript  π  2    normal-⋯   superscript   subscript  b  n    subscript  π  n          c_{n}=\sum_{k=1}^{n}a_{k}\sum_{\mathbf{\pi}\in\mathcal{P}_{n,k}}{\left({{k}%
 \atop{\pi_{1},\pi_{2},...,\pi_{n}}}\right)}b_{1}^{\pi_{1}}b_{2}^{\pi_{2}}%
 \cdots b_{n}^{\pi_{n}},   where       𝒫   n  ,  k    =   {   (   π  1   ,   π  2   ,  …  ,   π  n   )   :      π  1   +   π  2   +  ⋯  +   π  n    =  k   ,      π  1   ⋅  1   +    π  2   ⋅  2   +  ⋯  +    π  n   ⋅  n    =  n    }        subscript  𝒫   n  k     conditional-set    subscript  π  1    subscript  π  2   normal-…   subscript  π  n     formulae-sequence       subscript  π  1    subscript  π  2   normal-⋯   subscript  π  n    k        normal-⋅   subscript  π  1   1    normal-⋅   subscript  π  2   2   normal-⋯   normal-⋅   subscript  π  n   n    n       \mathcal{P}_{n,k}=\{(\pi_{1},\pi_{2},\dots,\pi_{n})\,:\ \pi_{1}+\pi_{2}+\cdots%
 +\pi_{n}=k,\ \pi_{1}\cdot 1+\pi_{2}\cdot 2+\cdots+\pi_{n}\cdot n=n\}   is the set of partitions of n into k parts, in frequency-of-parts form.  The first form is obtained by picking out the coefficient of x n in     (     b  1   x   +    b  2    x  2    +  ⋯   )   k     superscript       subscript  b  1   x      subscript  b  2    superscript  x  2    normal-⋯   k    (b_{1}x+b_{2}x^{2}+\cdots)^{k}   "by inspection", and the second form is then obtained by collecting like terms, or alternatively, by applying the multinomial theorem .  The special case f(x) = e x , g(x) = ∑ n ≥ 1 a n /n! x n gives the exponential formula . The special case f(x) = 1/(1-x), g(x) = ∑ n ≥ 1 (-a n ) x n gives an expression for the reciprocal of the formal power series '' ∑ n ≥ 0 a n x n '' in the case a 0 = 1 .  Stanley 6 gives a version for exponential power series. In the formal power series        f   (  x  )    =    ∑  n      a  n    n  !     x  n      ,        f  x     subscript   n        subscript  a  n     n     superscript  x  n       f(x)=\sum_{n}{a_{n}\over n!}x^{n},     we have the n th derivative at 0:         f   (  n  )     (  0  )    =   a  n    .         superscript  f  n   0    subscript  a  n     f^{(n)}(0)=a_{n}.\;     This should not be construed as the value of a function, since these series are purely formal; there is no such thing as convergence or divergence in this context.  If       g   (  x  )    =    ∑   n  =  0   ∞      b  n    n  !     x  n           g  x     superscript   subscript     n  0           subscript  b  n     n     superscript  x  n       g(x)=\sum_{n=0}^{\infty}{b_{n}\over n!}x^{n}     and       f   (  x  )    =    ∑   n  =  1   ∞      a  n    n  !     x  n           f  x     superscript   subscript     n  1           subscript  a  n     n     superscript  x  n       f(x)=\sum_{n=1}^{\infty}{a_{n}\over n!}x^{n}     and        g   (   f   (  x  )    )    =   h   (  x  )    =    ∑   n  =  0   ∞      c  n    n  !     x  n      ,          g    f  x      h  x          superscript   subscript     n  0           subscript  c  n     n     superscript  x  n        g(f(x))=h(x)=\sum_{n=0}^{\infty}{c_{n}\over n!}x^{n},     then the coefficient c n (which would be the n th derivative of h evaluated at 0 if we were dealing with convergent series rather than formal power series) is given by       c  n   =    ∑   π  =   {   B  1   ,  …  ,    B  k    }       a   |   B  1   |    ⋯   a   |   B  k   |     b  k          subscript  c  n     subscript     π    subscript  B  1   normal-…   subscript  B  k         subscript  a     subscript  B  1     normal-⋯   subscript  a     subscript  B  k      subscript  b  k       c_{n}=\sum_{\pi=\left\{\,B_{1},\,\dots,\,B_{k}\,\right\}}a_{\left|B_{1}\right|%
 }\cdots a_{\left|B_{k}\right|}b_{k}     where π runs through the set of all partitions of the set { 1, ..., n } and B 1 , ..., B k are the blocks of the partition π, and | B j | is the number of members of the j th block, for j = 1, ..., k .  This version of the formula is particularly well suited to the purposes of combinatorics .  We can also write with respect to the notation above        g   (   f   (  x  )    )    =    b  0   +    ∑   n  =  1   ∞       ∑   k  =  1   n     b  k    B   n  ,  k     (   a  1   ,  …  ,   a    n  -  k   +  1    )      n  !     x  n       ,        g    f  x       subscript  b  0     superscript   subscript     n  1            superscript   subscript     k  1    n      subscript  b  k    subscript  B   n  k      subscript  a  1   normal-…   subscript  a      n  k   1         n     superscript  x  n        g(f(x))=b_{0}+\sum_{n=1}^{\infty}{\sum_{k=1}^{n}b_{k}B_{n,k}(a_{1},\dots,a_{n-%
 k+1})\over n!}x^{n},     where B n , k ( a 1 ,..., a n − k +1 ) are Bell polynomials .  A special case  If f ( x ) = e x then all of the derivatives of f are the same, and are a factor common to every term. In case g ( x ) is a cumulant-generating function , then f ( g ( x )) is a moment-generating function , and the polynomial in various derivatives of g is the polynomial that expresses the moments as functions of the cumulants .  Notes  References    , Entirely freely available from Google books .   .   . Entirely freely available from Google books . A well-known paper where Francesco Faà di Bruno presents the two versions of the formula that now bears his name, published in the journal founded by Barnaba Tortolini .   . Entirely freely available from Google books .   . Entirely freely available from Google books .    .    .   , available at NUMDAM . This paper, according to  is one of the precursors of : note that the author signs only as "T.A.", and the attribution to J. F. C. Tiburce Abadie is due again to Johnson.   , available at NUMDAM . This paper, according to  is one of the precursors of : note that the author signs only as "A.", and the attribution to J. F. C. Tiburce Abadie is due again to Johnson.   External links    An intuitive presentation of Faà di Bruno's formula, with examples   "  Category:Differentiation rules  Category:Differential calculus  Category:Differential algebra  Category:Enumerative combinatorics  Category:Factorial and binomial topics  Category:Theorems in analysis     ↩  ↩  ↩  ↩  ↩  See the "compositional formula" in Chapter 5 of ↩     