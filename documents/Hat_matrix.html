<html lang="en">
<head>
<meta charset="utf-8"/>
<title offset="1796">Hat matrix</title>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG.js" type="text/javascript">
</script>
</head>
<body>
<h1>Hat matrix</h1>
<hr/>

<p>In <a class="uri" href="statistics" title="wikilink">statistics</a>, the <strong>hat matrix</strong>, <strong><em>H</em></strong>, sometimes also called <strong>influence matrix</strong><a class="footnoteRef" href="#fn1" id="fnref1"><sup>1</sup></a> and <strong>projection matrix</strong>, maps the vector of <a href="response_variable" title="wikilink">response values</a> to the vector of <a href="fitted_value" title="wikilink">fitted values</a> (or predicted values). It describes the <a href="influence_function_(statistics)" title="wikilink">influence</a> each response value has on each fitted value.<a class="footnoteRef" href="#fn2" id="fnref2"><sup>2</sup></a><a class="footnoteRef" href="#fn3" id="fnref3"><sup>3</sup></a> The diagonal elements of the hat matrix are the <a href="leverage_(statistics)" title="wikilink">leverages</a>, which describe the influence each response value has on the fitted value for that same observation.</p>

<p>If the vector of response values is denoted by <strong>y</strong> and the vector of fitted values by <strong>ŷ</strong>,</p>

<p>

<math display="block" id="Hat_matrix:0">
 <semantics>
  <mrow>
   <mrow>
    <mover accent="true">
     <mi>𝐲</mi>
     <mo stretchy="false">^</mo>
    </mover>
    <mo>=</mo>
    <mrow>
     <mi>H</mi>
     <mi>𝐲</mi>
    </mrow>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <ci>normal-^</ci>
     <ci>𝐲</ci>
    </apply>
    <apply>
     <times></times>
     <ci>H</ci>
     <ci>𝐲</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \hat{\mathbf{y}}=H\mathbf{y}.
  </annotation>
 </semantics>
</math>

 As <strong>ŷ</strong> is usually pronounced "y-hat", the hat matrix is so named as it "puts a <a href="circumflex" title="wikilink">hat</a> on <strong>y</strong>". The formula for the vector of <a href="errors_and_residuals_in_statistics" title="wikilink">residuals</a> <strong>r</strong> can also be expressed compactly using the hat matrix:</p>

<p>

<math display="block" id="Hat_matrix:1">
 <semantics>
  <mrow>
   <mrow>
    <mi>𝐫</mi>
    <mo>=</mo>
    <mrow>
     <mi>𝐲</mi>
     <mo>-</mo>
     <mover accent="true">
      <mi>𝐲</mi>
      <mo stretchy="false">^</mo>
     </mover>
    </mrow>
    <mo>=</mo>
    <mrow>
     <mi>𝐲</mi>
     <mo>-</mo>
     <mrow>
      <mi>H</mi>
      <mi>𝐲</mi>
     </mrow>
    </mrow>
    <mo>=</mo>
    <mrow>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <mi>I</mi>
       <mo>-</mo>
       <mi>H</mi>
      </mrow>
      <mo stretchy="false">)</mo>
     </mrow>
     <mi>𝐲</mi>
    </mrow>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <and></and>
    <apply>
     <eq></eq>
     <ci>𝐫</ci>
     <apply>
      <minus></minus>
      <ci>𝐲</ci>
      <apply>
       <ci>normal-^</ci>
       <ci>𝐲</ci>
      </apply>
     </apply>
    </apply>
    <apply>
     <eq></eq>
     <share href="#.cmml">
     </share>
     <apply>
      <minus></minus>
      <ci>𝐲</ci>
      <apply>
       <times></times>
       <ci>H</ci>
       <ci>𝐲</ci>
      </apply>
     </apply>
    </apply>
    <apply>
     <eq></eq>
     <share href="#.cmml">
     </share>
     <apply>
      <times></times>
      <apply>
       <minus></minus>
       <ci>I</ci>
       <ci>H</ci>
      </apply>
      <ci>𝐲</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{r}=\mathbf{y}-\mathbf{\hat{y}}=\mathbf{y}-H\mathbf{y}=(I-H)\mathbf{y}.
  </annotation>
 </semantics>
</math>

 Moreover, the element in the <em>i</em><sup>th</sup> row and <em>j</em><sup>th</sup> column of <strong><em>H</em></strong> is equal to the <a class="uri" href="covariance" title="wikilink">covariance</a> between the <em>j</em><sup>th</sup> response value and the <em>i</em><sup>th</sup> fitted value, divided by the <a class="uri" href="variance" title="wikilink">variance</a> of the former:</p>

<p>

<math display="inline" id="Hat_matrix:2">
 <semantics>
  <mrow>
   <msub>
    <mi>h</mi>
    <mrow>
     <mi>i</mi>
     <mi>j</mi>
    </mrow>
   </msub>
   <mo>=</mo>
   <mrow>
    <mrow>
     <mo>cov</mo>
     <mrow>
      <mo stretchy="false">[</mo>
      <msub>
       <mover accent="true">
        <mi>y</mi>
        <mo stretchy="false">^</mo>
       </mover>
       <mi>i</mi>
      </msub>
      <mo>,</mo>
      <msub>
       <mi>y</mi>
       <mi>j</mi>
      </msub>
      <mo stretchy="false">]</mo>
     </mrow>
    </mrow>
    <mo>/</mo>
    <mrow>
     <mo>var</mo>
     <mrow>
      <mo stretchy="false">[</mo>
      <msub>
       <mi>y</mi>
       <mi>j</mi>
      </msub>
      <mo stretchy="false">]</mo>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>h</ci>
     <apply>
      <times></times>
      <ci>i</ci>
      <ci>j</ci>
     </apply>
    </apply>
    <apply>
     <divide></divide>
     <apply>
      <ci>cov</ci>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <apply>
        <ci>normal-^</ci>
        <ci>y</ci>
       </apply>
       <ci>i</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>y</ci>
       <ci>j</ci>
      </apply>
     </apply>
     <apply>
      <ci>var</ci>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>y</ci>
       <ci>j</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \displaystyle h_{ij}=\operatorname{cov}[\hat{y}_{i},y_{j}]/\operatorname{var}[%
y_{j}]
  </annotation>
 </semantics>
</math>


 The <a href="covariance_matrix" title="wikilink">covariance matrix</a> of the residuals is therefore, by <a href="error_propagation" title="wikilink">error propagation</a>, equal to 

<math display="inline" id="Hat_matrix:3">
 <semantics>
  <mrow>
   <msup>
    <mrow>
     <mo>(</mo>
     <mrow>
      <mi>I</mi>
      <mo>-</mo>
      <mi>H</mi>
     </mrow>
     <mo>)</mo>
    </mrow>
    <mo>⊤</mo>
   </msup>
   <mi mathvariant="normal">Σ</mi>
   <mrow>
    <mo>(</mo>
    <mrow>
     <mi>I</mi>
     <mo>-</mo>
     <mi>H</mi>
    </mrow>
    <mo>)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <minus></minus>
      <ci>I</ci>
      <ci>H</ci>
     </apply>
     <csymbol cd="latexml">top</csymbol>
    </apply>
    <ci>normal-Σ</ci>
    <apply>
     <minus></minus>
     <ci>I</ci>
     <ci>H</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \left(I-H\right)^{\top}\Sigma\left(I-H\right)
  </annotation>
 </semantics>
</math>

, where Σ is the covariance matrix of the error vector (and by extension, the response vector as well). For the case of linear models with <a href="independent_and_identically_distributed" title="wikilink">independent and identically distributed</a> errors in which Σ = <em>σ</em><sup>2</sup><em>I</em>, this reduces to (<em>I</em> − <em>H</em>)<em>σ</em><sup>2</sup>.<a class="footnoteRef" href="#fn4" id="fnref4"><sup>4</sup></a></p>

<p>Many types of models and techniques are subject to this formulation. A few examples are:</p>
<ul>
<li><a href="Linear_model" title="wikilink">Linear model</a> / <a href="linear_least_squares_(mathematics)" title="wikilink">linear least squares</a></li>
<li><a href="Smoothing_splines" title="wikilink">Smoothing splines</a></li>
<li><a href="Regression_splines" title="wikilink">Regression splines</a></li>
<li><a href="Local_regression" title="wikilink">Local regression</a></li>
<li><a href="Kernel_regression" title="wikilink">Kernel regression</a></li>
<li><a href="Linear_filter" title="wikilink">Linear filtering</a></li>
</ul>
<h2 id="linear-model">Linear model</h2>

<p>Suppose that we wish to estimate a linear model using linear least squares. The model can be written as</p>

<p>

<math display="block" id="Hat_matrix:4">
 <semantics>
  <mrow>
   <mrow>
    <mi>𝐲</mi>
    <mo>=</mo>
    <mrow>
     <mrow>
      <mi>X</mi>
      <mi>𝜷</mi>
     </mrow>
     <mo>+</mo>
     <mi>𝜺</mi>
    </mrow>
   </mrow>
   <mo>,</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>𝐲</ci>
    <apply>
     <plus></plus>
     <apply>
      <times></times>
      <ci>X</ci>
      <ci>𝜷</ci>
     </apply>
     <ci>𝜺</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{y}=X\boldsymbol{\beta}+\boldsymbol{\varepsilon},
  </annotation>
 </semantics>
</math>

 where <em>X</em> is a matrix of <a href="explanatory_variable" title="wikilink">explanatory variables</a> (the <a href="design_matrix" title="wikilink">design matrix</a>), <strong><em>β</em></strong> is a vector of unknown parameters to be estimated, and <strong><em>ε</em></strong> is the error vector.</p>
<h3 id="solution-with-unit-weights-and-uncorrelated-errors">Solution with unit weights and uncorrelated errors</h3>

<p>When the weights for each observation are identical and the <a href="errors_and_residuals_in_statistics" title="wikilink">errors</a> are uncorrelated, the estimated parameters are</p>

<p>

<math display="block" id="Hat_matrix:5">
 <semantics>
  <mrow>
   <mrow>
    <mover accent="true">
     <mi>𝜷</mi>
     <mo stretchy="false">^</mo>
    </mover>
    <mo>=</mo>
    <mrow>
     <msup>
      <mrow>
       <mo>(</mo>
       <mrow>
        <msup>
         <mi>X</mi>
         <mo>⊤</mo>
        </msup>
        <mi>X</mi>
       </mrow>
       <mo>)</mo>
      </mrow>
      <mrow>
       <mo>-</mo>
       <mn>1</mn>
      </mrow>
     </msup>
     <msup>
      <mi>X</mi>
      <mo>⊤</mo>
     </msup>
     <mi>𝐲</mi>
    </mrow>
   </mrow>
   <mo>,</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <ci>normal-^</ci>
     <ci>𝜷</ci>
    </apply>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <times></times>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>X</ci>
        <csymbol cd="latexml">top</csymbol>
       </apply>
       <ci>X</ci>
      </apply>
      <apply>
       <minus></minus>
       <cn type="integer">1</cn>
      </apply>
     </apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>X</ci>
      <csymbol cd="latexml">top</csymbol>
     </apply>
     <ci>𝐲</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \hat{\boldsymbol{\beta}}=\left(X^{\top}X\right)^{-1}X^{\top}\mathbf{y},
  </annotation>
 </semantics>
</math>

</p>

<p>so the fitted values are</p>

<p>

<math display="block" id="Hat_matrix:6">
 <semantics>
  <mrow>
   <mrow>
    <mover accent="true">
     <mi>𝐲</mi>
     <mo stretchy="false">^</mo>
    </mover>
    <mo>=</mo>
    <mrow>
     <mi>X</mi>
     <mover accent="true">
      <mi>𝜷</mi>
      <mo stretchy="false">^</mo>
     </mover>
    </mrow>
    <mo>=</mo>
    <mrow>
     <mi>X</mi>
     <msup>
      <mrow>
       <mo>(</mo>
       <mrow>
        <msup>
         <mi>X</mi>
         <mo>⊤</mo>
        </msup>
        <mi>X</mi>
       </mrow>
       <mo>)</mo>
      </mrow>
      <mrow>
       <mo>-</mo>
       <mn>1</mn>
      </mrow>
     </msup>
     <msup>
      <mi>X</mi>
      <mo>⊤</mo>
     </msup>
     <mi>𝐲</mi>
    </mrow>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <and></and>
    <apply>
     <eq></eq>
     <apply>
      <ci>normal-^</ci>
      <ci>𝐲</ci>
     </apply>
     <apply>
      <times></times>
      <ci>X</ci>
      <apply>
       <ci>normal-^</ci>
       <ci>𝜷</ci>
      </apply>
     </apply>
    </apply>
    <apply>
     <eq></eq>
     <share href="#.cmml">
     </share>
     <apply>
      <times></times>
      <ci>X</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <times></times>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>X</ci>
         <csymbol cd="latexml">top</csymbol>
        </apply>
        <ci>X</ci>
       </apply>
       <apply>
        <minus></minus>
        <cn type="integer">1</cn>
       </apply>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>X</ci>
       <csymbol cd="latexml">top</csymbol>
      </apply>
      <ci>𝐲</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \hat{\mathbf{y}}=X\hat{\boldsymbol{\beta}}=X\left(X^{\top}X\right)^{-1}X^{\top%
}\mathbf{y}.
  </annotation>
 </semantics>
</math>

</p>

<p>Therefore the hat matrix is given by</p>

<p>

<math display="block" id="Hat_matrix:7">
 <semantics>
  <mrow>
   <mrow>
    <mi>H</mi>
    <mo>=</mo>
    <mrow>
     <mi>X</mi>
     <msup>
      <mrow>
       <mo>(</mo>
       <mrow>
        <msup>
         <mi>X</mi>
         <mo>⊤</mo>
        </msup>
        <mi>X</mi>
       </mrow>
       <mo>)</mo>
      </mrow>
      <mrow>
       <mo>-</mo>
       <mn>1</mn>
      </mrow>
     </msup>
     <msup>
      <mi>X</mi>
      <mo>⊤</mo>
     </msup>
    </mrow>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>H</ci>
    <apply>
     <times></times>
     <ci>X</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <times></times>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>X</ci>
        <csymbol cd="latexml">top</csymbol>
       </apply>
       <ci>X</ci>
      </apply>
      <apply>
       <minus></minus>
       <cn type="integer">1</cn>
      </apply>
     </apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>X</ci>
      <csymbol cd="latexml">top</csymbol>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   H=X\left(X^{\top}X\right)^{-1}X^{\top}.
  </annotation>
 </semantics>
</math>

</p>

<p>In the language of <a href="linear_algebra" title="wikilink">linear algebra</a>, the hat matrix is the <a href="orthogonal_projection" title="wikilink">orthogonal projection</a> onto the <a href="column_space" title="wikilink">column space</a> of the design matrix <em>X</em>.<a class="footnoteRef" href="#fn5" id="fnref5"><sup>5</sup></a>(Note that 

<math display="inline" id="Hat_matrix:8">
 <semantics>
  <mrow>
   <msup>
    <mrow>
     <mo>(</mo>
     <mrow>
      <msup>
       <mi>X</mi>
       <mo>⊤</mo>
      </msup>
      <mi>X</mi>
     </mrow>
     <mo>)</mo>
    </mrow>
    <mrow>
     <mo>-</mo>
     <mn>1</mn>
    </mrow>
   </msup>
   <msup>
    <mi>X</mi>
    <mo>⊤</mo>
   </msup>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>X</ci>
       <csymbol cd="latexml">top</csymbol>
      </apply>
      <ci>X</ci>
     </apply>
     <apply>
      <minus></minus>
      <cn type="integer">1</cn>
     </apply>
    </apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>X</ci>
     <csymbol cd="latexml">top</csymbol>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \left(X^{\top}X\right)^{-1}X^{\top}
  </annotation>
 </semantics>
</math>

 is the <a href="Moore–Penrose_pseudoinverse#Full_rank" title="wikilink">pseudoinverse of X</a>.)</p>

<p>Some facts of the hat matrix in this setting are summarized as follows:<a class="footnoteRef" href="#fn6" id="fnref6"><sup>6</sup></a></p>
<ul>
<li>

<math display="inline" id="Hat_matrix:9">
 <semantics>
  <mrow>
   <mrow>
    <mi>𝐫</mi>
    <mo>=</mo>
    <mrow>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <mi>I</mi>
       <mo>-</mo>
       <mi>H</mi>
      </mrow>
      <mo stretchy="false">)</mo>
     </mrow>
     <mi>𝐲</mi>
    </mrow>
   </mrow>
   <mo>,</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>𝐫</ci>
    <apply>
     <times></times>
     <apply>
      <minus></minus>
      <ci>I</ci>
      <ci>H</ci>
     </apply>
     <ci>𝐲</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{r}=(I-H)\mathbf{y},
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="Hat_matrix:10">
 <semantics>
  <mrow>
   <mrow>
    <mi>𝐫</mi>
    <mo>=</mo>
    <mrow>
     <mi>𝐲</mi>
     <mo>-</mo>
     <mrow>
      <mi>H</mi>
      <mi>𝐲</mi>
     </mrow>
    </mrow>
    <mo>⟂</mo>
    <mi>X</mi>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <and></and>
    <apply>
     <eq></eq>
     <ci>𝐫</ci>
     <apply>
      <minus></minus>
      <ci>𝐲</ci>
      <apply>
       <times></times>
       <ci>H</ci>
       <ci>𝐲</ci>
      </apply>
     </apply>
    </apply>
    <apply>
     <csymbol cd="latexml">perpendicular-to</csymbol>
     <share href="#.cmml">
     </share>
     <ci>X</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{r}=\mathbf{y}-H\mathbf{y}\perp X.
  </annotation>
 </semantics>
</math>

</li>
<li><em>H</em> is symmetric, and so is <em>I</em> - <em>H</em>.</li>
<li><em>H</em> is idempotent

<math display="block" id="Hat_matrix:11">
 <semantics>
  <mrow>
   <msup>
    <mi>H</mi>
    <mn>2</mn>
   </msup>
   <mo>=</mo>
   <mi>H</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>H</ci>
     <cn type="integer">2</cn>
    </apply>
    <ci>H</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   H^{2}=H
  </annotation>
 </semantics>
</math>

, and so is <em>I</em> - <em>H</em>.</li>
<li><em>X</em> is invariant under <em>H</em> 

<math display="block" id="Hat_matrix:12">
 <semantics>
  <mrow>
   <mrow>
    <mrow>
     <mi>H</mi>
     <mi>X</mi>
    </mrow>
    <mo>=</mo>
    <mi>X</mi>
   </mrow>
   <mo>,</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <ci>H</ci>
     <ci>X</ci>
    </apply>
    <ci>X</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   HX=X,
  </annotation>
 </semantics>
</math>

 hence 

<math display="inline" id="Hat_matrix:13">
 <semantics>
  <mrow>
   <mrow>
    <mrow>
     <mo stretchy="false">(</mo>
     <mrow>
      <mi>I</mi>
      <mo>-</mo>
      <mi>H</mi>
     </mrow>
     <mo stretchy="false">)</mo>
    </mrow>
    <mi>X</mi>
   </mrow>
   <mo>=</mo>
   <mn>0</mn>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <apply>
      <minus></minus>
      <ci>I</ci>
      <ci>H</ci>
     </apply>
     <ci>X</ci>
    </apply>
    <cn type="integer">0</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   (I-H)X=0
  </annotation>
 </semantics>
</math>

.</li>
<li>

<math display="inline" id="Hat_matrix:14">
 <semantics>
  <mrow>
   <mrow>
    <mrow>
     <mo stretchy="false">(</mo>
     <mrow>
      <mi>I</mi>
      <mo>-</mo>
      <mi>H</mi>
     </mrow>
     <mo stretchy="false">)</mo>
    </mrow>
    <mi>H</mi>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mi>H</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mrow>
      <mi>I</mi>
      <mo>-</mo>
      <mi>H</mi>
     </mrow>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mn>0.</mn>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <and></and>
    <apply>
     <eq></eq>
     <apply>
      <times></times>
      <apply>
       <minus></minus>
       <ci>I</ci>
       <ci>H</ci>
      </apply>
      <ci>H</ci>
     </apply>
     <apply>
      <times></times>
      <ci>H</ci>
      <apply>
       <minus></minus>
       <ci>I</ci>
       <ci>H</ci>
      </apply>
     </apply>
    </apply>
    <apply>
     <eq></eq>
     <share href="#.cmml">
     </share>
     <cn type="float">0.</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   (I-H)H=H(I-H)=0.
  </annotation>
 </semantics>
</math>

</li>
</ul>

<p>The hat matrix corresponding to a <a href="linear_model" title="wikilink">linear model</a> is <a href="symmetric_matrix" title="wikilink">symmetric</a> and <a class="uri" href="idempotent" title="wikilink">idempotent</a>, that is, 

<math display="inline" id="Hat_matrix:15">
 <semantics>
  <mrow>
   <msup>
    <mi>H</mi>
    <mn>2</mn>
   </msup>
   <mo>=</mo>
   <mi>H</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>H</ci>
     <cn type="integer">2</cn>
    </apply>
    <ci>H</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   H^{2}=H
  </annotation>
 </semantics>
</math>

. However, this is not always the case; in <a href="local_regression" title="wikilink">locally weighted scatterplot smoothing (LOESS)</a>, for example, the hat matrix is in general neither symmetric nor idempotent.</p>

<p>For <a href="linear_models" title="wikilink">linear models</a>, the <a href="trace_(linear_algebra)" title="wikilink">trace</a> of the hat matrix is equal to the <a href="rank_(linear_algebra)" title="wikilink">rank</a> of <em>X</em>, which is the number of independent parameters of the linear model. For other models such as LOESS that are still linear in the observations <strong>y</strong>, the hat matrix can be used to define the <a href="degrees_of_freedom_(statistics)#Effective_degrees_of_freedom" title="wikilink">effective degrees of freedom</a> of the model.</p>

<p>The hat matrix has a number of useful algebraic properties.<a class="footnoteRef" href="#fn7" id="fnref7"><sup>7</sup></a><a class="footnoteRef" href="#fn8" id="fnref8"><sup>8</sup></a> Practical applications of the hat matrix in regression analysis include <a href="Leverage_(statistics)" title="wikilink">leverage</a> and <a href="Cook's_distance" title="wikilink">Cook's distance</a>, which are concerned with identifying observations which have a large effect on the results of a regression.</p>
<h2 id="more-generally">More generally</h2>
<h3 id="non-identical-weights-andor-correlated-errors">Non-identical weights and/or correlated errors</h3>

<p>The above may be generalized to the cases where the weights are not identical and/or the errors are correlated. Suppose that the <a href="covariance_matrix" title="wikilink">covariance matrix</a> of the errors is Σ. Then since</p>

<p>

<math display="block" id="Hat_matrix:16">
 <semantics>
  <mrow>
   <mrow>
    <mover accent="true">
     <mi>𝜷</mi>
     <mo stretchy="false">^</mo>
    </mover>
    <mo>=</mo>
    <mrow>
     <msup>
      <mrow>
       <mo>(</mo>
       <mrow>
        <msup>
         <mi>X</mi>
         <mo>⊤</mo>
        </msup>
        <msup>
         <mi mathvariant="normal">Σ</mi>
         <mrow>
          <mo>-</mo>
          <mn>1</mn>
         </mrow>
        </msup>
        <mi>X</mi>
       </mrow>
       <mo>)</mo>
      </mrow>
      <mrow>
       <mo>-</mo>
       <mn>1</mn>
      </mrow>
     </msup>
     <msup>
      <mi>X</mi>
      <mo>⊤</mo>
     </msup>
     <mpadded width="+1.7pt">
      <msup>
       <mi mathvariant="normal">Σ</mi>
       <mrow>
        <mo>-</mo>
        <mn>1</mn>
       </mrow>
      </msup>
     </mpadded>
     <mi>𝐲</mi>
    </mrow>
   </mrow>
   <mo>,</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <ci>normal-^</ci>
     <ci>𝜷</ci>
    </apply>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <times></times>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>X</ci>
        <csymbol cd="latexml">top</csymbol>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>normal-Σ</ci>
        <apply>
         <minus></minus>
         <cn type="integer">1</cn>
        </apply>
       </apply>
       <ci>X</ci>
      </apply>
      <apply>
       <minus></minus>
       <cn type="integer">1</cn>
      </apply>
     </apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>X</ci>
      <csymbol cd="latexml">top</csymbol>
     </apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>normal-Σ</ci>
      <apply>
       <minus></minus>
       <cn type="integer">1</cn>
      </apply>
     </apply>
     <ci>𝐲</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \hat{\boldsymbol{\beta}}=\left(X^{\top}\Sigma^{-1}X\right)^{-1}X^{\top}\Sigma^%
{-1}\,\mathbf{y},
  </annotation>
 </semantics>
</math>

</p>

<p>the hat matrix is thus</p>

<p>

<math display="block" id="Hat_matrix:17">
 <semantics>
  <mrow>
   <mrow>
    <mi>H</mi>
    <mo>=</mo>
    <mrow>
     <mi>X</mi>
     <msup>
      <mrow>
       <mo>(</mo>
       <mrow>
        <msup>
         <mi>X</mi>
         <mo>⊤</mo>
        </msup>
        <msup>
         <mi mathvariant="normal">Σ</mi>
         <mrow>
          <mo>-</mo>
          <mn>1</mn>
         </mrow>
        </msup>
        <mi>X</mi>
       </mrow>
       <mo>)</mo>
      </mrow>
      <mrow>
       <mo>-</mo>
       <mn>1</mn>
      </mrow>
     </msup>
     <msup>
      <mi>X</mi>
      <mo>⊤</mo>
     </msup>
     <msup>
      <mi mathvariant="normal">Σ</mi>
      <mrow>
       <mo>-</mo>
       <mn>1</mn>
      </mrow>
     </msup>
    </mrow>
   </mrow>
   <mo>,</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>H</ci>
    <apply>
     <times></times>
     <ci>X</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <times></times>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>X</ci>
        <csymbol cd="latexml">top</csymbol>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>normal-Σ</ci>
        <apply>
         <minus></minus>
         <cn type="integer">1</cn>
        </apply>
       </apply>
       <ci>X</ci>
      </apply>
      <apply>
       <minus></minus>
       <cn type="integer">1</cn>
      </apply>
     </apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>X</ci>
      <csymbol cd="latexml">top</csymbol>
     </apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>normal-Σ</ci>
      <apply>
       <minus></minus>
       <cn type="integer">1</cn>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   H=X\left(X^{\top}\Sigma^{-1}X\right)^{-1}X^{\top}\Sigma^{-1},\,
  </annotation>
 </semantics>
</math>

</p>

<p>and again it may be seen that <em>H</em><sup>2</sup> = <em>H</em>, though now it is no longer symmetric.</p>
<h2 id="blockwise-formula">Blockwise formula</h2>

<p>Suppose the design matrix 

<math display="inline" id="Hat_matrix:18">
 <semantics>
  <mi>C</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>C</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C
  </annotation>
 </semantics>
</math>

 can be decomposed by columns as 

<math display="inline" id="Hat_matrix:19">
 <semantics>
  <mrow>
   <mi>C</mi>
   <mo>=</mo>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>A</mi>
    <mo>,</mo>
    <mi>B</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>C</ci>
    <interval closure="closed">
     <ci>A</ci>
     <ci>B</ci>
    </interval>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C=[A,B]
  </annotation>
 </semantics>
</math>

. Define the Hat operator as 

<math display="inline" id="Hat_matrix:20">
 <semantics>
  <mrow>
   <mrow>
    <mi>H</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>X</mi>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mi>X</mi>
    <msup>
     <mrow>
      <mo>(</mo>
      <mrow>
       <msup>
        <mi>X</mi>
        <mo>⊤</mo>
       </msup>
       <mi>X</mi>
      </mrow>
      <mo>)</mo>
     </mrow>
     <mrow>
      <mo>-</mo>
      <mn>1</mn>
     </mrow>
    </msup>
    <msup>
     <mi>X</mi>
     <mo>⊤</mo>
    </msup>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <ci>H</ci>
     <ci>X</ci>
    </apply>
    <apply>
     <times></times>
     <ci>X</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <times></times>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>X</ci>
        <csymbol cd="latexml">top</csymbol>
       </apply>
       <ci>X</ci>
      </apply>
      <apply>
       <minus></minus>
       <cn type="integer">1</cn>
      </apply>
     </apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>X</ci>
      <csymbol cd="latexml">top</csymbol>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   H(X)=X\left(X^{\top}X\right)^{-1}X^{\top}
  </annotation>
 </semantics>
</math>

. Similarly, define the residual operator as 

<math display="inline" id="Hat_matrix:21">
 <semantics>
  <mrow>
   <mrow>
    <mi>M</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>X</mi>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mi>I</mi>
    <mo>-</mo>
    <mrow>
     <mi>H</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mi>X</mi>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <ci>M</ci>
     <ci>X</ci>
    </apply>
    <apply>
     <minus></minus>
     <ci>I</ci>
     <apply>
      <times></times>
      <ci>H</ci>
      <ci>X</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   M(X)=I-H(X)
  </annotation>
 </semantics>
</math>

. Then the Hat matrix of 

<math display="inline" id="Hat_matrix:22">
 <semantics>
  <mi>C</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>C</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C
  </annotation>
 </semantics>
</math>

 can be decomposed as follows:</p>

<p>

<math display="inline" id="Hat_matrix:23">
 <semantics>
  <mrow>
   <mrow>
    <mi>H</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>C</mi>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mrow>
     <mi>H</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mi>A</mi>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
    <mo>+</mo>
    <mrow>
     <mi>H</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <mi>M</mi>
       <mrow>
        <mo stretchy="false">(</mo>
        <mi>A</mi>
        <mo stretchy="false">)</mo>
       </mrow>
       <mi>B</mi>
      </mrow>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <ci>H</ci>
     <ci>C</ci>
    </apply>
    <apply>
     <plus></plus>
     <apply>
      <times></times>
      <ci>H</ci>
      <ci>A</ci>
     </apply>
     <apply>
      <times></times>
      <ci>H</ci>
      <apply>
       <times></times>
       <ci>M</ci>
       <ci>A</ci>
       <ci>B</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   H(C)=H(A)+H(M(A)B)
  </annotation>
 </semantics>
</math>

 <a class="footnoteRef" href="#fn9" id="fnref9"><sup>9</sup></a></p>

<p>There are a number of applications of such a partitioning. The classical application has 

<math display="inline" id="Hat_matrix:24">
 <semantics>
  <mi>A</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>A</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A
  </annotation>
 </semantics>
</math>

 a column of all ones, which allows one to analyze the effects of adding an intercept term to a regression. Another use is in the fixed effects model, where 

<math display="inline" id="Hat_matrix:25">
 <semantics>
  <mi>A</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>A</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A
  </annotation>
 </semantics>
</math>

 is a large <a href="sparse_matrix" title="wikilink">sparse matrix</a> of the dummy variables for the fixed effect terms. One can use this partition to compute the hat matrix of 

<math display="inline" id="Hat_matrix:26">
 <semantics>
  <mi>C</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>C</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C
  </annotation>
 </semantics>
</math>

 without explicitly forming the matrix 

<math display="inline" id="Hat_matrix:27">
 <semantics>
  <mi>C</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>C</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C
  </annotation>
 </semantics>
</math>

, which might be too large to fit into computer memory.</p>
<h2 id="see-also">See also</h2>
<ul>
<li><a href="Moore–Penrose_pseudoinverse" title="wikilink">Moore–Penrose pseudoinverse</a></li>
<li><a href="Studentized_residuals" title="wikilink">Studentized residuals</a></li>
<li><a href="Degrees_of_freedom_(statistics)#Effective_degrees_of_freedom" title="wikilink">Effective degrees of freedom</a></li>
<li><a href="Idempotent_matrix" title="wikilink">Idempotent matrix</a></li>
<li><a href="Mean_and_predicted_response" title="wikilink">Mean and predicted response</a></li>
</ul>
<h2 id="references">References</h2>

<p>"</p>

<p><a href="Category:Statistical_terminology" title="wikilink">Category:Statistical terminology</a> <a href="Category:Regression_analysis" title="wikilink">Category:Regression analysis</a> <a class="uri" href="Category:Matrices" title="wikilink">Category:Matrices</a></p>
<section class="footnotes">
<hr/>
<ol>
<li id="fn1"><a href="http://old.ecmwf.int/newsevents/training/lecture_notes/pdf_files/ASSIM/ObservationInfluence.pdf">Data Assimilation: Observation inﬂuence diagnostic of a data assimilation system</a><a href="#fnref1">↩</a></li>
<li id="fn2"><a href="#fnref2">↩</a></li>
<li id="fn3"><a href="#fnref3">↩</a></li>
<li id="fn4"></li>
<li id="fn5"></li>
<li id="fn6"></li>
<li id="fn7">Gans, P. (1992) <em>Data Fitting in the Chemical Sciences,</em>, Wiley. ISBN 978-0-471-93412-7<a href="#fnref7">↩</a></li>
<li id="fn8">Draper, N.R., Smith, H. (1998) <em>Applied Regression Analysis</em>, Wiley. ISBN 0-471-17082-8<a href="#fnref8">↩</a></li>
<li id="fn9"><a href="#fnref9">↩</a></li>
</ol>
</section>
</body>
</html>
