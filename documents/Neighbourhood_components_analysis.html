<html lang="en">
<head>
<meta charset="utf-8"/>
<title offset="52">Neighbourhood components analysis</title>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG.js" type="text/javascript">
</script>
</head>
<body>
<h1>Neighbourhood components analysis</h1>
<hr/>

<p><strong>Neighbourhood components analysis</strong> is a <a href="supervised_learning" title="wikilink">supervised learning</a> method for <a href="Statistical_classification" title="wikilink">classifying</a> <a href="multivariate_statistics" title="wikilink">multivariate</a> data into distinct classes according to a given <a href="metric_(mathematics)" title="wikilink">distance metric</a> over the data. Functionally, it serves the same purposes as the <a href="K-nearest_neighbors_algorithm" title="wikilink">K-nearest neighbors algorithm</a>, and makes direct use of a related concept termed <em>stochastic nearest neighbours</em>.</p>
<h2 id="definition">Definition</h2>

<p>Neighbourhood components analysis aims at "learning" a distance metric by finding a linear transformation of input data such that the average leave-one-out (LOO) classification performance is maximized in the transformed space. The key insight to the algorithm is that a matrix 

<math display="inline" id="Neighbourhood_components_analysis:0">
 <semantics>
  <mi>A</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>A</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A
  </annotation>
 </semantics>
</math>

 corresponding to the transformation can be found by defining a differentiable objective function for 

<math display="inline" id="Neighbourhood_components_analysis:1">
 <semantics>
  <mi>A</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>A</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A
  </annotation>
 </semantics>
</math>

, followed by use of an iterative solver such as <a href="Conjugate_gradient_method" title="wikilink">conjugate gradient descent</a>. One of the benefits of this algorithm is that the number of classes 

<math display="inline" id="Neighbourhood_components_analysis:2">
 <semantics>
  <mi>k</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>k</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   k
  </annotation>
 </semantics>
</math>

 can be determined as a function of 

<math display="inline" id="Neighbourhood_components_analysis:3">
 <semantics>
  <mi>A</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>A</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A
  </annotation>
 </semantics>
</math>

, up to a scalar constant. This use of the algorithm therefore addresses the issue of <a href="model_selection" title="wikilink">model selection</a>.</p>
<h2 id="explanation">Explanation</h2>

<p>In order to define 

<math display="inline" id="Neighbourhood_components_analysis:4">
 <semantics>
  <mi>A</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>A</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A
  </annotation>
 </semantics>
</math>

, we define an objective function describing classification accuracy in the transformed space and try to determine 

<math display="inline" id="Neighbourhood_components_analysis:5">
 <semantics>
  <msup>
   <mi>A</mi>
   <mo>*</mo>
  </msup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <ci>A</ci>
    <times></times>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A^{*}
  </annotation>
 </semantics>
</math>

 such that this objective function is maximized.</p>

<p>

<math display="inline" id="Neighbourhood_components_analysis:6">
 <semantics>
  <mrow>
   <msup>
    <mi>A</mi>
    <mo>*</mo>
   </msup>
   <mo>=</mo>
   <mrow>
    <msub>
     <mtext>argmax</mtext>
     <mi>A</mi>
    </msub>
    <mi>f</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>A</mi>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>A</ci>
     <times></times>
    </apply>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <mtext>argmax</mtext>
      <ci>A</ci>
     </apply>
     <ci>f</ci>
     <ci>A</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A^{*}=\mbox{argmax}_{A}f(A)
  </annotation>
 </semantics>
</math>

</p>
<h3 id="leave-one-out-loo-classification">Leave-one-out (LOO) classification</h3>

<p>Consider predicting the class label of a single data point by consensus of its 

<math display="inline" id="Neighbourhood_components_analysis:7">
 <semantics>
  <mi>k</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>k</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   k
  </annotation>
 </semantics>
</math>

-nearest neighbours with a given distance metric. This is known as <em>leave-one-out</em> classification. However, the set of nearest-neighbours 

<math display="inline" id="Neighbourhood_components_analysis:8">
 <semantics>
  <msub>
   <mi>C</mi>
   <mi>i</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>C</ci>
    <ci>i</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C_{i}
  </annotation>
 </semantics>
</math>

 can be quite different after passing all the points through a linear transformation. Specifically, the set of neighbours for a point can undergo discrete changes in response to smooth changes in the elements of 

<math display="inline" id="Neighbourhood_components_analysis:9">
 <semantics>
  <mi>A</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>A</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A
  </annotation>
 </semantics>
</math>

, implying that any objective function 

<math display="inline" id="Neighbourhood_components_analysis:10">
 <semantics>
  <mrow>
   <mi>f</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mo>⋅</mo>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>f</ci>
    <ci>normal-⋅</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f(\cdot)
  </annotation>
 </semantics>
</math>

 based on the neighbours of a point will be <em>piecewise-constant</em>, and hence <em>not differentiable</em>.</p>
<h3 id="solution">Solution</h3>

<p>We can resolve this difficulty by using an approach inspired by <a href="stochastic_gradient_descent" title="wikilink">stochastic gradient descent</a>. Rather than considering the 

<math display="inline" id="Neighbourhood_components_analysis:11">
 <semantics>
  <mi>k</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>k</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   k
  </annotation>
 </semantics>
</math>

-nearest neighbours at each transformed point in LOO-classification, we'll consider the entire transformed data set as <em>stochastic nearest neighbours</em>. We define these using a <a href="Softmax_activation_function" title="wikilink">softmax function</a> of the squared <a href="Euclidean_distance" title="wikilink">Euclidean distance</a> between a given LOO-classification point and each other point in the transformed space:</p>

<p>

<math display="inline" id="Neighbourhood_components_analysis:12">
 <semantics>
  <mrow>
   <msub>
    <mi>p</mi>
    <mrow>
     <mi>i</mi>
     <mi>j</mi>
    </mrow>
   </msub>
   <mo>=</mo>
   <mrow>
    <mo>{</mo>
    <mtable>
     <mtr>
      <mtd columnalign="left">
       <mrow>
        <mfrac>
         <msup>
          <mi>e</mi>
          <mrow>
           <mo>-</mo>
           <msup>
            <mrow>
             <mo fence="true">||</mo>
             <mrow>
              <mrow>
               <mi>A</mi>
               <msub>
                <mi>x</mi>
                <mi>i</mi>
               </msub>
              </mrow>
              <mo>-</mo>
              <mrow>
               <mi>A</mi>
               <msub>
                <mi>x</mi>
                <mi>j</mi>
               </msub>
              </mrow>
             </mrow>
             <mo fence="true">||</mo>
            </mrow>
            <mn>2</mn>
           </msup>
          </mrow>
         </msup>
         <mrow>
          <mstyle displaystyle="false">
           <msub>
            <mo largeop="true" symmetric="true">∑</mo>
            <mi>k</mi>
           </msub>
          </mstyle>
          <msup>
           <mi>e</mi>
           <mrow>
            <mo>-</mo>
            <msup>
             <mrow>
              <mo fence="true">||</mo>
              <mrow>
               <mrow>
                <mi>A</mi>
                <msub>
                 <mi>x</mi>
                 <mi>i</mi>
                </msub>
               </mrow>
               <mo>-</mo>
               <mrow>
                <mi>A</mi>
                <msub>
                 <mi>x</mi>
                 <mi>k</mi>
                </msub>
               </mrow>
              </mrow>
              <mo fence="true">||</mo>
             </mrow>
             <mn>2</mn>
            </msup>
           </mrow>
          </msup>
         </mrow>
        </mfrac>
        <mo>,</mo>
       </mrow>
      </mtd>
      <mtd columnalign="left">
       <mrow>
        <mrow>
         <mtext>if</mtext>
         <mi>j</mi>
        </mrow>
        <mo>≠</mo>
        <mi>i</mi>
       </mrow>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="left">
       <mrow>
        <mn>0</mn>
        <mo>,</mo>
       </mrow>
      </mtd>
      <mtd columnalign="left">
       <mrow>
        <mrow>
         <mtext>if</mtext>
         <mi>j</mi>
        </mrow>
        <mo>=</mo>
        <mi>i</mi>
       </mrow>
      </mtd>
     </mtr>
    </mtable>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>p</ci>
     <apply>
      <times></times>
      <ci>i</ci>
      <ci>j</ci>
     </apply>
    </apply>
    <apply>
     <csymbol cd="latexml">cases</csymbol>
     <apply>
      <divide></divide>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>e</ci>
       <apply>
        <minus></minus>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <csymbol cd="latexml">norm</csymbol>
          <apply>
           <minus></minus>
           <apply>
            <times></times>
            <ci>A</ci>
            <apply>
             <csymbol cd="ambiguous">subscript</csymbol>
             <ci>x</ci>
             <ci>i</ci>
            </apply>
           </apply>
           <apply>
            <times></times>
            <ci>A</ci>
            <apply>
             <csymbol cd="ambiguous">subscript</csymbol>
             <ci>x</ci>
             <ci>j</ci>
            </apply>
           </apply>
          </apply>
         </apply>
         <cn type="integer">2</cn>
        </apply>
       </apply>
      </apply>
      <apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <sum></sum>
        <ci>k</ci>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>e</ci>
        <apply>
         <minus></minus>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <apply>
           <csymbol cd="latexml">norm</csymbol>
           <apply>
            <minus></minus>
            <apply>
             <times></times>
             <ci>A</ci>
             <apply>
              <csymbol cd="ambiguous">subscript</csymbol>
              <ci>x</ci>
              <ci>i</ci>
             </apply>
            </apply>
            <apply>
             <times></times>
             <ci>A</ci>
             <apply>
              <csymbol cd="ambiguous">subscript</csymbol>
              <ci>x</ci>
              <ci>k</ci>
             </apply>
            </apply>
           </apply>
          </apply>
          <cn type="integer">2</cn>
         </apply>
        </apply>
       </apply>
      </apply>
     </apply>
     <apply>
      <neq></neq>
      <apply>
       <times></times>
       <mtext>if</mtext>
       <ci>j</ci>
      </apply>
      <ci>i</ci>
     </apply>
     <cn type="integer">0</cn>
     <apply>
      <eq></eq>
      <apply>
       <times></times>
       <mtext>if</mtext>
       <ci>j</ci>
      </apply>
      <ci>i</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   p_{ij}=\begin{cases}\frac{e^{-||Ax_{i}-Ax_{j}||^{2}}}{\sum_{k}e^{-||Ax_{i}-Ax_%
{k}||^{2}}},&\mbox{if}j\neq i\\
0,&\mbox{if}j=i\end{cases}
  </annotation>
 </semantics>
</math>


</p>

<p>The probability of correctly classifying data point 

<math display="inline" id="Neighbourhood_components_analysis:13">
 <semantics>
  <mi>i</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>i</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   i
  </annotation>
 </semantics>
</math>

 is the probability of classifying the points of each of its neighbours 

<math display="inline" id="Neighbourhood_components_analysis:14">
 <semantics>
  <msub>
   <mi>C</mi>
   <mi>i</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>C</ci>
    <ci>i</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C_{i}
  </annotation>
 </semantics>
</math>

:</p>

<p>

<math display="inline" id="Neighbourhood_components_analysis:15">
 <semantics>
  <mrow>
   <mrow>
    <msub>
     <mi>p</mi>
     <mi>i</mi>
    </msub>
    <mo>=</mo>
    <mrow>
     <msub>
      <mo largeop="true" symmetric="true">∑</mo>
      <mrow>
       <mi>j</mi>
       <mo>∈</mo>
       <msub>
        <mi>C</mi>
        <mi>i</mi>
       </msub>
      </mrow>
     </msub>
     <msub>
      <mi>p</mi>
      <mrow>
       <mi>i</mi>
       <mi>j</mi>
      </mrow>
     </msub>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>p</ci>
     <ci>i</ci>
    </apply>
    <apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <sum></sum>
      <apply>
       <in></in>
       <ci>j</ci>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <ci>i</ci>
       </apply>
      </apply>
     </apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>p</ci>
      <apply>
       <times></times>
       <ci>i</ci>
       <ci>j</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   p_{i}=\sum_{j\in C_{i}}p_{ij}\quad
  </annotation>
 </semantics>
</math>

 where 

<math display="inline" id="Neighbourhood_components_analysis:16">
 <semantics>
  <msub>
   <mi>p</mi>
   <mrow>
    <mi>i</mi>
    <mi>j</mi>
   </mrow>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>p</ci>
    <apply>
     <times></times>
     <ci>i</ci>
     <ci>j</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   p_{ij}
  </annotation>
 </semantics>
</math>

 is the probability of classifying neighbour 

<math display="inline" id="Neighbourhood_components_analysis:17">
 <semantics>
  <mi>j</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>j</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   j
  </annotation>
 </semantics>
</math>


 of point 

<math display="inline" id="Neighbourhood_components_analysis:18">
 <semantics>
  <mi>i</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>i</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   i
  </annotation>
 </semantics>
</math>

.</p>

<p>Define the objective function using LOO classification, this time using the entire data set as stochastic nearest neighbours:</p>

<p>

<math display="inline" id="Neighbourhood_components_analysis:19">
 <semantics>
  <mrow>
   <mrow>
    <mi>f</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>A</mi>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <msub>
     <mo largeop="true" symmetric="true">∑</mo>
     <mi>i</mi>
    </msub>
    <mrow>
     <msub>
      <mo largeop="true" symmetric="true">∑</mo>
      <mrow>
       <mi>j</mi>
       <mo>∈</mo>
       <msub>
        <mi>C</mi>
        <mi>i</mi>
       </msub>
      </mrow>
     </msub>
     <msub>
      <mi>p</mi>
      <mrow>
       <mi>i</mi>
       <mi>j</mi>
      </mrow>
     </msub>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <msub>
     <mo largeop="true" symmetric="true">∑</mo>
     <mi>i</mi>
    </msub>
    <msub>
     <mi>p</mi>
     <mi>i</mi>
    </msub>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <and></and>
    <apply>
     <eq></eq>
     <apply>
      <times></times>
      <ci>f</ci>
      <ci>A</ci>
     </apply>
     <apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <sum></sum>
       <ci>i</ci>
      </apply>
      <apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <sum></sum>
        <apply>
         <in></in>
         <ci>j</ci>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>C</ci>
          <ci>i</ci>
         </apply>
        </apply>
       </apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>p</ci>
        <apply>
         <times></times>
         <ci>i</ci>
         <ci>j</ci>
        </apply>
       </apply>
      </apply>
     </apply>
    </apply>
    <apply>
     <eq></eq>
     <share href="#.cmml">
     </share>
     <apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <sum></sum>
       <ci>i</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>p</ci>
       <ci>i</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f(A)=\sum_{i}\sum_{j\in C_{i}}p_{ij}=\sum_{i}p_{i}
  </annotation>
 </semantics>
</math>

</p>

<p>Note that under stochastic nearest neighbours, the consensus class for a single point 

<math display="inline" id="Neighbourhood_components_analysis:20">
 <semantics>
  <mi>i</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>i</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   i
  </annotation>
 </semantics>
</math>

 is the expected value of a point's class in the limit of an infinite number of samples drawn from the distribution over its neighbours 

<math display="inline" id="Neighbourhood_components_analysis:21">
 <semantics>
  <mrow>
   <mi>j</mi>
   <mo>∈</mo>
   <msub>
    <mi>C</mi>
    <mi>i</mi>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <in></in>
    <ci>j</ci>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>C</ci>
     <ci>i</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   j\in C_{i}
  </annotation>
 </semantics>
</math>

 i.e.

<math display="block" id="Neighbourhood_components_analysis:22">
 <semantics>
  <mrow>
   <mi>P</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>C</mi>
    <mi>l</mi>
    <mi>a</mi>
    <mi>s</mi>
    <mi>s</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <msub>
      <mi>X</mi>
      <mi>i</mi>
     </msub>
     <mo stretchy="false">)</mo>
    </mrow>
    <mo>=</mo>
    <mi>C</mi>
    <mi>l</mi>
    <mi>a</mi>
    <mi>s</mi>
    <mi>s</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <msub>
      <mi>X</mi>
      <mi>j</mi>
     </msub>
     <mo stretchy="false">)</mo>
    </mrow>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>=</mo>
   <msub>
    <mi>p</mi>
    <mrow>
     <mi>i</mi>
     <mi>j</mi>
    </mrow>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">P</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">C</csymbol>
     <csymbol cd="unknown">l</csymbol>
     <csymbol cd="unknown">a</csymbol>
     <csymbol cd="unknown">s</csymbol>
     <csymbol cd="unknown">s</csymbol>
     <cerror>
      <csymbol cd="ambiguous">fragments</csymbol>
      <ci>normal-(</ci>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>X</ci>
       <ci>i</ci>
      </apply>
      <ci>normal-)</ci>
     </cerror>
     <eq></eq>
     <csymbol cd="unknown">C</csymbol>
     <csymbol cd="unknown">l</csymbol>
     <csymbol cd="unknown">a</csymbol>
     <csymbol cd="unknown">s</csymbol>
     <csymbol cd="unknown">s</csymbol>
     <cerror>
      <csymbol cd="ambiguous">fragments</csymbol>
      <ci>normal-(</ci>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>X</ci>
       <ci>j</ci>
      </apply>
      <ci>normal-)</ci>
     </cerror>
     <ci>normal-)</ci>
    </cerror>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>p</ci>
     <apply>
      <times></times>
      <ci>i</ci>
      <ci>j</ci>
     </apply>
    </apply>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   P(Class(X_{i})=Class(X_{j}))=p_{ij}
  </annotation>
 </semantics>
</math>

. Thus the predicted class is an <a href="affine_combination" title="wikilink">affine combination</a> of the classes of every other point, weighted by the softmax function for each 

<math display="inline" id="Neighbourhood_components_analysis:23">
 <semantics>
  <mrow>
   <mi>j</mi>
   <mo>∈</mo>
   <msub>
    <mi>C</mi>
    <mi>j</mi>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <in></in>
    <ci>j</ci>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>C</ci>
     <ci>j</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   j\in C_{j}
  </annotation>
 </semantics>
</math>

 where 

<math display="inline" id="Neighbourhood_components_analysis:24">
 <semantics>
  <msub>
   <mi>C</mi>
   <mi>j</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>C</ci>
    <ci>j</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C_{j}
  </annotation>
 </semantics>
</math>

 is now the entire transformed data set.</p>

<p>This choice of objective function is preferable as it is differentiable with respect to 

<math display="inline" id="Neighbourhood_components_analysis:25">
 <semantics>
  <mi>A</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>A</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A
  </annotation>
 </semantics>
</math>

:</p>

<p>

<math display="inline" id="Neighbourhood_components_analysis:26">
 <semantics>
  <mrow>
   <mfrac>
    <mrow>
     <mo>∂</mo>
     <mi>f</mi>
    </mrow>
    <mrow>
     <mo>∂</mo>
     <mi>A</mi>
    </mrow>
   </mfrac>
   <mo>=</mo>
   <mrow>
    <mo>-</mo>
    <mrow>
     <mn>2</mn>
     <mi>A</mi>
     <mrow>
      <msub>
       <mo largeop="true" symmetric="true">∑</mo>
       <mi>i</mi>
      </msub>
      <mrow>
       <msub>
        <mo largeop="true" symmetric="true">∑</mo>
        <mrow>
         <mi>j</mi>
         <mo>∈</mo>
         <msub>
          <mi>C</mi>
          <mi>i</mi>
         </msub>
        </mrow>
       </msub>
       <mrow>
        <msub>
         <mi>p</mi>
         <mrow>
          <mi>i</mi>
          <mi>j</mi>
         </mrow>
        </msub>
        <mrow>
         <mo>(</mo>
         <mrow>
          <mrow>
           <msub>
            <mi>x</mi>
            <mrow>
             <mi>i</mi>
             <mi>j</mi>
            </mrow>
           </msub>
           <msubsup>
            <mi>x</mi>
            <mrow>
             <mi>i</mi>
             <mi>j</mi>
            </mrow>
            <mi>T</mi>
           </msubsup>
          </mrow>
          <mo>-</mo>
          <mrow>
           <msub>
            <mo largeop="true" symmetric="true">∑</mo>
            <mi>k</mi>
           </msub>
           <mrow>
            <msub>
             <mi>p</mi>
             <mrow>
              <mi>i</mi>
              <mi>k</mi>
             </mrow>
            </msub>
            <msub>
             <mi>x</mi>
             <mrow>
              <mi>i</mi>
              <mi>k</mi>
             </mrow>
            </msub>
            <msubsup>
             <mi>x</mi>
             <mrow>
              <mi>i</mi>
              <mi>k</mi>
             </mrow>
             <mi>T</mi>
            </msubsup>
           </mrow>
          </mrow>
         </mrow>
         <mo>)</mo>
        </mrow>
       </mrow>
      </mrow>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <divide></divide>
     <apply>
      <partialdiff></partialdiff>
      <ci>f</ci>
     </apply>
     <apply>
      <partialdiff></partialdiff>
      <ci>A</ci>
     </apply>
    </apply>
    <apply>
     <minus></minus>
     <apply>
      <times></times>
      <cn type="integer">2</cn>
      <ci>A</ci>
      <apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <sum></sum>
        <ci>i</ci>
       </apply>
       <apply>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <sum></sum>
         <apply>
          <in></in>
          <ci>j</ci>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>C</ci>
           <ci>i</ci>
          </apply>
         </apply>
        </apply>
        <apply>
         <times></times>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>p</ci>
          <apply>
           <times></times>
           <ci>i</ci>
           <ci>j</ci>
          </apply>
         </apply>
         <apply>
          <minus></minus>
          <apply>
           <times></times>
           <apply>
            <csymbol cd="ambiguous">subscript</csymbol>
            <ci>x</ci>
            <apply>
             <times></times>
             <ci>i</ci>
             <ci>j</ci>
            </apply>
           </apply>
           <apply>
            <csymbol cd="ambiguous">superscript</csymbol>
            <apply>
             <csymbol cd="ambiguous">subscript</csymbol>
             <ci>x</ci>
             <apply>
              <times></times>
              <ci>i</ci>
              <ci>j</ci>
             </apply>
            </apply>
            <ci>T</ci>
           </apply>
          </apply>
          <apply>
           <apply>
            <csymbol cd="ambiguous">subscript</csymbol>
            <sum></sum>
            <ci>k</ci>
           </apply>
           <apply>
            <times></times>
            <apply>
             <csymbol cd="ambiguous">subscript</csymbol>
             <ci>p</ci>
             <apply>
              <times></times>
              <ci>i</ci>
              <ci>k</ci>
             </apply>
            </apply>
            <apply>
             <csymbol cd="ambiguous">subscript</csymbol>
             <ci>x</ci>
             <apply>
              <times></times>
              <ci>i</ci>
              <ci>k</ci>
             </apply>
            </apply>
            <apply>
             <csymbol cd="ambiguous">superscript</csymbol>
             <apply>
              <csymbol cd="ambiguous">subscript</csymbol>
              <ci>x</ci>
              <apply>
               <times></times>
               <ci>i</ci>
               <ci>k</ci>
              </apply>
             </apply>
             <ci>T</ci>
            </apply>
           </apply>
          </apply>
         </apply>
        </apply>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \frac{\partial f}{\partial A}=-2A\sum_{i}\sum_{j\in C_{i}}p_{ij}\left(x_{ij}x_%
{ij}^{T}-\sum_{k}p_{ik}x_{ik}x_{ik}^{T}\right)
  </annotation>
 </semantics>
</math>

 

<math display="inline" id="Neighbourhood_components_analysis:27">
 <semantics>
  <mrow>
   <mi></mi>
   <mo>=</mo>
   <mrow>
    <mn>2</mn>
    <mi>A</mi>
    <mrow>
     <msub>
      <mo largeop="true" symmetric="true">∑</mo>
      <mi>i</mi>
     </msub>
     <mrow>
      <mo>(</mo>
      <mrow>
       <mrow>
        <msub>
         <mi>p</mi>
         <mi>i</mi>
        </msub>
        <mrow>
         <msub>
          <mo largeop="true" symmetric="true">∑</mo>
          <mi>k</mi>
         </msub>
         <mrow>
          <msub>
           <mi>p</mi>
           <mrow>
            <mi>i</mi>
            <mi>k</mi>
           </mrow>
          </msub>
          <msub>
           <mi>x</mi>
           <mrow>
            <mi>i</mi>
            <mi>k</mi>
           </mrow>
          </msub>
          <msubsup>
           <mi>x</mi>
           <mrow>
            <mi>i</mi>
            <mi>k</mi>
           </mrow>
           <mi>T</mi>
          </msubsup>
         </mrow>
        </mrow>
       </mrow>
       <mo>-</mo>
       <mrow>
        <msub>
         <mo largeop="true" symmetric="true">∑</mo>
         <mrow>
          <mi>j</mi>
          <mo>∈</mo>
          <msub>
           <mi>C</mi>
           <mi>i</mi>
          </msub>
         </mrow>
        </msub>
        <mrow>
         <msub>
          <mi>p</mi>
          <mrow>
           <mi>i</mi>
           <mi>j</mi>
          </mrow>
         </msub>
         <msub>
          <mi>x</mi>
          <mrow>
           <mi>i</mi>
           <mi>j</mi>
          </mrow>
         </msub>
         <msubsup>
          <mi>x</mi>
          <mrow>
           <mi>i</mi>
           <mi>j</mi>
          </mrow>
          <mi>T</mi>
         </msubsup>
        </mrow>
       </mrow>
      </mrow>
      <mo>)</mo>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <csymbol cd="latexml">absent</csymbol>
    <apply>
     <times></times>
     <cn type="integer">2</cn>
     <ci>A</ci>
     <apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <sum></sum>
       <ci>i</ci>
      </apply>
      <apply>
       <minus></minus>
       <apply>
        <times></times>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>p</ci>
         <ci>i</ci>
        </apply>
        <apply>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <sum></sum>
          <ci>k</ci>
         </apply>
         <apply>
          <times></times>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>p</ci>
           <apply>
            <times></times>
            <ci>i</ci>
            <ci>k</ci>
           </apply>
          </apply>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>x</ci>
           <apply>
            <times></times>
            <ci>i</ci>
            <ci>k</ci>
           </apply>
          </apply>
          <apply>
           <csymbol cd="ambiguous">superscript</csymbol>
           <apply>
            <csymbol cd="ambiguous">subscript</csymbol>
            <ci>x</ci>
            <apply>
             <times></times>
             <ci>i</ci>
             <ci>k</ci>
            </apply>
           </apply>
           <ci>T</ci>
          </apply>
         </apply>
        </apply>
       </apply>
       <apply>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <sum></sum>
         <apply>
          <in></in>
          <ci>j</ci>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>C</ci>
           <ci>i</ci>
          </apply>
         </apply>
        </apply>
        <apply>
         <times></times>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>p</ci>
          <apply>
           <times></times>
           <ci>i</ci>
           <ci>j</ci>
          </apply>
         </apply>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>x</ci>
          <apply>
           <times></times>
           <ci>i</ci>
           <ci>j</ci>
          </apply>
         </apply>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>x</ci>
           <apply>
            <times></times>
            <ci>i</ci>
            <ci>j</ci>
           </apply>
          </apply>
          <ci>T</ci>
         </apply>
        </apply>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   =2A\sum_{i}\left(p_{i}\sum_{k}p_{ik}x_{ik}x_{ik}^{T}-\sum_{j\in C_{i}}p_{ij}x_%
{ij}x_{ij}^{T}\right)
  </annotation>
 </semantics>
</math>


</p>

<p>Obtaining a <a class="uri" href="gradient" title="wikilink">gradient</a> for 

<math display="inline" id="Neighbourhood_components_analysis:28">
 <semantics>
  <mi>A</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>A</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A
  </annotation>
 </semantics>
</math>

 means that it can be found with an iterative solver such as <a href="Conjugate_gradient_method" title="wikilink">conjugate gradient descent</a>. Note that in practice, most of the innermost terms of the gradient evaluate to insignificant contributions due to the rapidly diminishing contribution of distant points from the point of interest. This means that the inner sum of the gradient can be truncated, resulting in reasonable computation times even for large data sets.</p>
<h3 id="alternative-formulation">Alternative formulation</h3>

<p>"Maximizing 

<math display="inline" id="Neighbourhood_components_analysis:29">
 <semantics>
  <mrow>
   <mi>f</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mo>⋅</mo>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>f</ci>
    <ci>normal-⋅</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f(\cdot)
  </annotation>
 </semantics>
</math>

 is equivalent to minimizing the 

<math display="inline" id="Neighbourhood_components_analysis:30">
 <semantics>
  <msub>
   <mi>L</mi>
   <mn>1</mn>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>L</ci>
    <cn type="integer">1</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   L_{1}
  </annotation>
 </semantics>
</math>

-distance between the predicted class distribution and the true class distribution (ie: where the 

<math display="inline" id="Neighbourhood_components_analysis:31">
 <semantics>
  <msub>
   <mi>p</mi>
   <mi>i</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>p</ci>
    <ci>i</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   p_{i}
  </annotation>
 </semantics>
</math>

 induced by 

<math display="inline" id="Neighbourhood_components_analysis:32">
 <semantics>
  <mi>A</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>A</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A
  </annotation>
 </semantics>
</math>


 are all equal to 1). A natural alternative is the KL-divergence, which induces the following objective function and gradient:" (Goldberger 2005)</p>

<p>

<math display="inline" id="Neighbourhood_components_analysis:33">
 <semantics>
  <mrow>
   <mrow>
    <mi>g</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>A</mi>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <msub>
     <mo largeop="true" symmetric="true">∑</mo>
     <mi>i</mi>
    </msub>
    <mrow>
     <mi>log</mi>
     <mrow>
      <mo>(</mo>
      <mrow>
       <msub>
        <mo largeop="true" symmetric="true">∑</mo>
        <mrow>
         <mi>j</mi>
         <mo>∈</mo>
         <msub>
          <mi>C</mi>
          <mi>i</mi>
         </msub>
        </mrow>
       </msub>
       <msub>
        <mi>p</mi>
        <mrow>
         <mi>i</mi>
         <mi>j</mi>
        </mrow>
       </msub>
      </mrow>
      <mo>)</mo>
     </mrow>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <msub>
     <mo largeop="true" symmetric="true">∑</mo>
     <mi>i</mi>
    </msub>
    <mrow>
     <mi>log</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <msub>
       <mi>p</mi>
       <mi>i</mi>
      </msub>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <and></and>
    <apply>
     <eq></eq>
     <apply>
      <times></times>
      <ci>g</ci>
      <ci>A</ci>
     </apply>
     <apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <sum></sum>
       <ci>i</ci>
      </apply>
      <apply>
       <log></log>
       <apply>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <sum></sum>
         <apply>
          <in></in>
          <ci>j</ci>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>C</ci>
           <ci>i</ci>
          </apply>
         </apply>
        </apply>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>p</ci>
         <apply>
          <times></times>
          <ci>i</ci>
          <ci>j</ci>
         </apply>
        </apply>
       </apply>
      </apply>
     </apply>
    </apply>
    <apply>
     <eq></eq>
     <share href="#.cmml">
     </share>
     <apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <sum></sum>
       <ci>i</ci>
      </apply>
      <apply>
       <log></log>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>p</ci>
        <ci>i</ci>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   g(A)=\sum_{i}\log\left(\sum_{j\in C_{i}}p_{ij}\right)=\sum_{i}\log(p_{i})
  </annotation>
 </semantics>
</math>

 

<math display="inline" id="Neighbourhood_components_analysis:34">
 <semantics>
  <mrow>
   <mfrac>
    <mrow>
     <mo>∂</mo>
     <mi>g</mi>
    </mrow>
    <mrow>
     <mo>∂</mo>
     <mi>A</mi>
    </mrow>
   </mfrac>
   <mo>=</mo>
   <mrow>
    <mn>2</mn>
    <mi>A</mi>
    <mrow>
     <msub>
      <mo largeop="true" symmetric="true">∑</mo>
      <mi>i</mi>
     </msub>
     <mrow>
      <mo>(</mo>
      <mrow>
       <mrow>
        <msub>
         <mo largeop="true" symmetric="true">∑</mo>
         <mi>k</mi>
        </msub>
        <mrow>
         <msub>
          <mi>p</mi>
          <mrow>
           <mi>i</mi>
           <mi>k</mi>
          </mrow>
         </msub>
         <msub>
          <mi>x</mi>
          <mrow>
           <mi>i</mi>
           <mi>k</mi>
          </mrow>
         </msub>
         <msubsup>
          <mi>x</mi>
          <mrow>
           <mi>i</mi>
           <mi>k</mi>
          </mrow>
          <mi>T</mi>
         </msubsup>
        </mrow>
       </mrow>
       <mo>-</mo>
       <mfrac>
        <mrow>
         <mstyle displaystyle="false">
          <msub>
           <mo largeop="true" symmetric="true">∑</mo>
           <mrow>
            <mi>j</mi>
            <mo>∈</mo>
            <msub>
             <mi>C</mi>
             <mi>i</mi>
            </msub>
           </mrow>
          </msub>
         </mstyle>
         <mrow>
          <msub>
           <mi>p</mi>
           <mrow>
            <mi>i</mi>
            <mi>j</mi>
           </mrow>
          </msub>
          <msub>
           <mi>x</mi>
           <mrow>
            <mi>i</mi>
            <mi>j</mi>
           </mrow>
          </msub>
          <msubsup>
           <mi>x</mi>
           <mrow>
            <mi>i</mi>
            <mi>j</mi>
           </mrow>
           <mi>T</mi>
          </msubsup>
         </mrow>
        </mrow>
        <mrow>
         <mstyle displaystyle="false">
          <msub>
           <mo largeop="true" symmetric="true">∑</mo>
           <mrow>
            <mi>j</mi>
            <mo>∈</mo>
            <msub>
             <mi>C</mi>
             <mi>i</mi>
            </msub>
           </mrow>
          </msub>
         </mstyle>
         <msub>
          <mi>p</mi>
          <mrow>
           <mi>i</mi>
           <mi>j</mi>
          </mrow>
         </msub>
        </mrow>
       </mfrac>
      </mrow>
      <mo>)</mo>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <divide></divide>
     <apply>
      <partialdiff></partialdiff>
      <ci>g</ci>
     </apply>
     <apply>
      <partialdiff></partialdiff>
      <ci>A</ci>
     </apply>
    </apply>
    <apply>
     <times></times>
     <cn type="integer">2</cn>
     <ci>A</ci>
     <apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <sum></sum>
       <ci>i</ci>
      </apply>
      <apply>
       <minus></minus>
       <apply>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <sum></sum>
         <ci>k</ci>
        </apply>
        <apply>
         <times></times>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>p</ci>
          <apply>
           <times></times>
           <ci>i</ci>
           <ci>k</ci>
          </apply>
         </apply>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>x</ci>
          <apply>
           <times></times>
           <ci>i</ci>
           <ci>k</ci>
          </apply>
         </apply>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>x</ci>
           <apply>
            <times></times>
            <ci>i</ci>
            <ci>k</ci>
           </apply>
          </apply>
          <ci>T</ci>
         </apply>
        </apply>
       </apply>
       <apply>
        <divide></divide>
        <apply>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <sum></sum>
          <apply>
           <in></in>
           <ci>j</ci>
           <apply>
            <csymbol cd="ambiguous">subscript</csymbol>
            <ci>C</ci>
            <ci>i</ci>
           </apply>
          </apply>
         </apply>
         <apply>
          <times></times>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>p</ci>
           <apply>
            <times></times>
            <ci>i</ci>
            <ci>j</ci>
           </apply>
          </apply>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>x</ci>
           <apply>
            <times></times>
            <ci>i</ci>
            <ci>j</ci>
           </apply>
          </apply>
          <apply>
           <csymbol cd="ambiguous">superscript</csymbol>
           <apply>
            <csymbol cd="ambiguous">subscript</csymbol>
            <ci>x</ci>
            <apply>
             <times></times>
             <ci>i</ci>
             <ci>j</ci>
            </apply>
           </apply>
           <ci>T</ci>
          </apply>
         </apply>
        </apply>
        <apply>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <sum></sum>
          <apply>
           <in></in>
           <ci>j</ci>
           <apply>
            <csymbol cd="ambiguous">subscript</csymbol>
            <ci>C</ci>
            <ci>i</ci>
           </apply>
          </apply>
         </apply>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>p</ci>
          <apply>
           <times></times>
           <ci>i</ci>
           <ci>j</ci>
          </apply>
         </apply>
        </apply>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \frac{\partial g}{\partial A}=2A\sum_{i}\left(\sum_{k}p_{ik}x_{ik}x_{ik}^{T}-%
\frac{\sum_{j\in C_{i}}p_{ij}x_{ij}x_{ij}^{T}}{\sum_{j\in C_{i}}p_{ij}}\right)
  </annotation>
 </semantics>
</math>

</p>

<p>In practice, optimization of 

<math display="inline" id="Neighbourhood_components_analysis:35">
 <semantics>
  <mi>A</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>A</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A
  </annotation>
 </semantics>
</math>

 using this function tends to give similar performance results as with the original.</p>
<h2 id="history-and-background">History and background</h2>

<p>Neighbourhood components analysis was developed by Jacob Goldberger, Sam Roweis, Ruslan Salakhudinov, and Geoff Hinton at the University of Toronto's department of computer science in 2004.</p>
<h2 id="see-also">See also</h2>
<ul>
<li><a href="Spectral_clustering" title="wikilink">Spectral clustering</a></li>
<li><a href="Large_margin_nearest_neighbor" title="wikilink">Large margin nearest neighbor</a></li>
</ul>
<h2 id="references">References</h2>
<ul>
<li>J. Goldberger, G. Hinton, S. Roweis, R. Salakhutdinov. (2005) <em><a href="http://www.csri.utoronto.ca/~roweis/papers/ncanips.pdf">Neighbourhood Components Analysis</a>.</em> Advances in Neural Information Processing Systems. 17, 513-520, 2005.</li>
</ul>
<h2 id="external-links">External links</h2>
<h3 id="software">Software</h3>
<ul>
<li>The <a href="MLPACK_(C++_library)" title="wikilink">MLPACK library</a> contains a <a class="uri" href="C++" title="wikilink">C++</a> implementation</li>
<li><a href="http://github.com/vomjom/nca">nca</a> (<a class="uri" href="C++" title="wikilink">C++</a>)</li>
</ul>

<p>"</p>

<p><a href="Category:Multivariate_statistics" title="wikilink">Category:Multivariate statistics</a> <a href="Category:Data_analysis" title="wikilink">Category:Data analysis</a> <a href="Category:Statistical_models" title="wikilink">Category:Statistical models</a></p>
</body>
</html>
