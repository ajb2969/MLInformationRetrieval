   Wallenius' noncentral hypergeometric distribution      Wallenius' noncentral hypergeometric distribution   (Figure)  Probability mass function for Wallenius' Noncentral Hypergeometric Distribution for different values of the odds ratio ω. m 1 = 80, m 2 = 60, n = 100, ω = 0.1 ... 20   In probability theory and statistics , Wallenius' noncentral hypergeometric distribution (named after Kenneth Ted Wallenius) is a generalization of the hypergeometric distribution where items are sampled with bias .  This distribution can be illustrated as an urn model with bias. Assume, for example, that an urn contains m 1 red balls and m 2 white balls, totalling N = m 1 + m 2 balls. Each red ball has the weight ω 1 and each white ball has the weight ω 2 . We will say that the odds ratio is ω = ω 1 / ω 2 . Now we are taking n balls, one by one, in such a way that the probability of taking a particular ball at a particular draw is equal to its proportion of the total weight of all balls that lie in the urn at that moment. The number of red balls x 1 that we get in this experiment is a random variable with Wallenius' noncentral hypergeometric distribution.  The matter is complicated by the fact that there is more than one noncentral hypergeometric distribution. Wallenius' noncentral hypergeometric distribution is obtained if balls are sampled one by one in such a way that there is competition between the balls. Fisher's noncentral hypergeometric distribution is obtained if the balls are sampled simultaneously or independently of each other. Unfortunately, both distributions are known in the literature as "the" noncentral hypergeometric distribution. It is important to be specific about which distribution is meant when using this name.  The two distributions are both equal to the (central) hypergeometric distribution when the odds ratio is 1.  It is far from obvious why these two distributions are different. See the Wikipedia entry on noncentral hypergeometric distributions for a more detailed explanation of the difference between these two probability distributions.   Univariate distribution  (Figure)  | Recursive calculation of probability f( x , n ) in Wallenius' distribution. The light grey fields are possible points on the way to the final point. The arrows indicate an arbitrary trajectory.   Wallenius' distribution is particularly complicated because each ball has a probability of being taken that depends not only on its weight, but also on the total weight of its competitors. And the weight of the competing balls depends on the outcomes of all preceding draws.  This recursive dependency gives rise to a difference equation with a solution that is given in open form by the integral in the expression of the probability mass function in the table above.  Closed form expressions for the probability mass function exist (Lyons, 1980), but they are not very useful for practical calculations because of extreme numerical instability , except in degenerate cases.  Several other calculation methods are used, including recursion , Taylor expansion and numerical integration (Fog, 2007, 2008).  The most reliable calculation method is recursive calculation of f( x , n ) from f( x , n -1) and f( x -1, n -1) using the recursion formula given below under properties. The probabilities of all ( x , n ) combinations on all possible trajectories leading to the desired point are calculated, starting with f(0,0) = 1 as shown on the figure to the right. The total number of probabilities to calculate is n ( x +1)- x 2 . Other calculation methods must be used when n and x are so big that this method is too inefficient.  The probability that all balls have the same color is easier to calculate. See the formula below under multivariate distribution.  No exact formula for the mean is known (short of complete enumeration of all probabilities). The equation given above is reasonably accurate. This equation can be solved for μ by Newton-Raphson iteration . The same equation can be used for estimating the odds from an experimentally obtained value of the mean.  Properties of the univariate distribution  Wallenius' distribution has fewer symmetry relations than Fisher's noncentral hypergeometric distribution has. The only symmetry relates to the swapping of colors:        wnchypg   (  x  ;  n  ,   m  1   ,   m  2   ,  ω  )    =   wnchypg   (   n  -  x   ;  n  ,   m  2   ,   m  1   ,   1  /  ω   )     .       wnchypg  x  n   subscript  m  1    subscript  m  2   ω    wnchypg    n  x   n   subscript  m  2    subscript  m  1     1  ω      \operatorname{wnchypg}(x;n,m_{1},m_{2},\omega)=\operatorname{wnchypg}(n-x;n,m_%
 {2},m_{1},1/\omega)\,.   Unlike Fisher's distribution, Wallenius' distribution has no symmetry relating to the number of balls not taken.  The following recursion formula is useful for calculating probabilities:       wnchypg   (  x  ;  n  ,   m  1   ,   m  2   ,  ω  )    =        wnchypg  x  n   subscript  m  1    subscript  m  2   ω   absent    \operatorname{wnchypg}(x;n,m_{1},m_{2},\omega)=             wnchypg   (   x  -  1   ;   n  -  1   ,   m  1   ,   m  2   ,  ω  )       (     m  1   -  x   +  1   )   ω       (     m  1   -  x   +  1   )   ω   +   m  2   +  x   -  n     +     limit-from     wnchypg    x  1     n  1    subscript  m  1    subscript  m  2   ω            subscript  m  1   x   1   ω              subscript  m  1   x   1   ω    subscript  m  2   x   n        \operatorname{wnchypg}(x-1;n-1,m_{1},m_{2},\omega)\frac{(m_{1}-x+1)\omega}{(m_%
 {1}-x+1)\omega+m_{2}+x-n}+          wnchypg   (  x  ;   n  -  1   ,   m  1   ,   m  2   ,  ω  )         m  2   +  x   -  n   +  1        (    m  1   -  x   )   ω   +   m  2   +  x   -  n   +  1         wnchypg  x    n  1    subscript  m  1    subscript  m  2   ω            subscript  m  2   x   n   1              subscript  m  1   x   ω    subscript  m  2   x   n   1      \operatorname{wnchypg}(x;n-1,m_{1},m_{2},\omega)\frac{m_{2}+x-n+1}{(m_{1}-x)%
 \omega+m_{2}+x-n+1}        Another recursion formula is also known:       wnchypg   (  x  ;  n  ,   m  1   ,   m  2   ,  ω  )    =        wnchypg  x  n   subscript  m  1    subscript  m  2   ω   absent    \operatorname{wnchypg}(x;n,m_{1},m_{2},\omega)=             wnchypg   (   x  -  1   ;   n  -  1   ,    m  1   -  1   ,   m  2   ,  ω  )       m  1   ω      m  1   ω   +   m  2      +     limit-from     wnchypg    x  1     n  1      subscript  m  1   1    subscript  m  2   ω        subscript  m  1   ω        subscript  m  1   ω    subscript  m  2         \operatorname{wnchypg}(x-1;n-1,m_{1}-1,m_{2},\omega)\frac{m_{1}\omega}{m_{1}%
 \omega+m_{2}}+           wnchypg   (  x  ;   n  -  1   ,   m  1   ,    m  2   -  1   ,  ω  )       m  2      m  1   ω   +   m  2       .       wnchypg  x    n  1    subscript  m  1      subscript  m  2   1   ω      subscript  m  2        subscript  m  1   ω    subscript  m  2       \operatorname{wnchypg}(x;n-1,m_{1},m_{2}-1,\omega)\frac{m_{2}}{m_{1}\omega+m_{%
 2}}\,.        The probability is limited by          f  1    (  x  )    ≤   wnchypg   (  x  ;  n  ,   m  1   ,   m  2   ,  ω  )    ≤    f  2    (  x  )     ,     for   ω   <   1     ,     formulae-sequence        subscript  normal-f  1   x    wnchypg  x  n   subscript  m  1    subscript  m  2   ω          subscript  normal-f  2   x         for  ω   1     \operatorname{f}_{1}(x)\leq\operatorname{wnchypg}(x;n,m_{1},m_{2},\omega)\leq%
 \operatorname{f}_{2}(x)\,,\,\,\text{for}\,\,\omega<1\,,            f  1    (  x  )    ≥   wnchypg   (  x  ;  n  ,   m  1   ,   m  2   ,  ω  )    ≥    f  2    (  x  )     ,     for   ω   >    1   ,  where       formulae-sequence        subscript  normal-f  1   x    wnchypg  x  n   subscript  m  1    subscript  m  2   ω          subscript  normal-f  2   x         for  ω    1  where      \operatorname{f}_{1}(x)\geq\operatorname{wnchypg}(x;n,m_{1},m_{2},\omega)\geq%
 \operatorname{f}_{2}(x)\,,\,\,\text{for}\,\,\omega>1\,,\text{where}           f  1    (  x  )    =    (      m  1       x     )    (      m  2        n  -  x      )     n  !       (    m  1   +    m  2   /  ω    )    x  ¯       (    m  2   +   ω   (    m  1   -  x   )     )     n  -  x   ¯             subscript  normal-f  1   x      binomial   subscript  m  1   x    binomial   subscript  m  2     n  x        n      superscript     subscript  m  1      subscript  m  2   ω     normal-¯  x     superscript     subscript  m  2     ω     subscript  m  1   x      normal-¯    n  x          \operatorname{f}_{1}(x)={\left({{m_{1}}\atop{x}}\right)}{\left({{m_{2}}\atop{n%
 -x}}\right)}\frac{n!}{(m_{1}+m_{2}/\omega)^{\underline{x}}\,(m_{2}+\omega(m_{1%
 }-x))^{\underline{n-x}}}            f  2    (  x  )    =    (      m  1       x     )    (      m  2        n  -  x      )      n  !       (    m  1   +    (    m  2   -   x  2    )   /  ω    )    x  ¯       (    m  2   +   ω   m  1     )     n  -  x   ¯         ,        subscript  normal-f  2   x      binomial   subscript  m  1   x    binomial   subscript  m  2     n  x        n      superscript     subscript  m  1        subscript  m  2    subscript  x  2    ω     normal-¯  x     superscript     subscript  m  2     ω   subscript  m  1      normal-¯    n  x          \operatorname{f}_{2}(x)={\left({{m_{1}}\atop{x}}\right)}{\left({{m_{2}}\atop{n%
 -x}}\right)}\frac{n!}{(m_{1}+(m_{2}-x_{2})/\omega)^{\underline{x}}\,(m_{2}+%
 \omega m_{1})^{\underline{n-x}}}\,,     where the underlined superscript indicates the falling factorial      a   b  ¯    =   a   (   a  -  1   )   …   (    a  -  b   +  1   )         superscript  a   normal-¯  b      a    a  1   normal-…      a  b   1      a^{\underline{b}}=a(a-1)\ldots(a-b+1)   .   Multivariate distribution  The distribution can be expanded to any number of colors c of balls in the urn. The multivariate distribution is used when there are more than two colors.  The probability mass function can be calculated by various Taylor expansion methods or by numerical integration (Fog, 2008).  The probability that all balls have the same color, j , can be calculated as:       mwnchypg   (   (  0  ,  …  ,  0  ,   x  j   ,  0  ,  …  )   ;  n  ,  𝐦  ,  𝝎  )    =    m  j    n  ¯       (    1   ω  j      ∑   i  =  1   c     m  i    ω  i      )    n  ¯          mwnchypg   0  normal-…  0   subscript  x  j   0  normal-…   n  𝐦  𝝎      superscript   subscript  m  j    normal-¯  n     superscript      1   subscript  ω  j      superscript   subscript     i  1    c      subscript  m  i    subscript  ω  i       normal-¯  n       \operatorname{mwnchypg}((0,\ldots,0,x_{j},0,\ldots);n,\mathbf{m},\boldsymbol{%
 \omega})=\frac{m_{j}^{\,\,\underline{n}}}{\left(\frac{1}{\omega_{j}}\sum_{i=1}%
 ^{c}m_{i}\omega_{i}\right)^{\underline{n}}}   for x j = n ≤ m j , where the underlined superscript denotes the falling factorial .  A reasonably good approximation to the mean can be calculated using the equation given above. The equation can be solved by defining θ so that       μ  i   =    m  i    (   1  -   e    ω  i   θ     )         subscript  μ  i      subscript  m  i     1   superscript  e     subscript  ω  i   θ        \mu_{i}=m_{i}(1-e^{\omega_{i}\theta})   and solving        ∑   i  =  1   c    μ  i    =  n        superscript   subscript     i  1    c    subscript  μ  i    n    \sum_{i=1}^{c}\mu_{i}=n   for θ by Newton-Raphson iteration .  The equation for the mean is also useful for estimating the odds from experimentally obtained values for the mean.  No good way of calculating the variance is known. The best known method is to approximate the multivariate Wallenius distribution by a multivariate Fisher's noncentral hypergeometric distribution with the same mean, and insert the mean as calculated above in the approximate formula for the variance of the latter distribution.  Properties of the multivariate distribution  The order of the colors is arbitrary so that any colors can be swapped.  The weights can be arbitrarily scaled:       mwnchypg   (  𝐱  ;  n  ,  𝐦  ,  𝝎  )    =   mwnchypg   (  𝐱  ;  n  ,  𝐦  ,   r  𝝎   )         mwnchypg  𝐱  n  𝐦  𝝎    mwnchypg  𝐱  n  𝐦    r  𝝎      \operatorname{mwnchypg}(\mathbf{x};n,\mathbf{m},\boldsymbol{\omega})=%
 \operatorname{mwnchypg}(\mathbf{x};n,\mathbf{m},r\boldsymbol{\omega})\,\,   for all    r  ∈   ℝ  +       r   subscript  ℝ      r\in\mathbb{R}_{+}   .  Colors with zero number ( m i = 0) or zero weight (ω i = 0) can be omitted from the equations.  Colors with the same weight can be joined:       mwnchypg   (  𝐱  ;  n  ,  𝐦  ,   (   ω  1   ,  …  ,   ω   c  -  1    ,   ω   c  -  1    )   )    =        mwnchypg  𝐱  n  𝐦    subscript  ω  1   normal-…   subscript  ω    c  1     subscript  ω    c  1      absent    \operatorname{mwnchypg}\left(\mathbf{x};n,\mathbf{m},(\omega_{1},\ldots,\omega%
 _{c-1},\omega_{c-1})\right)\,=           mwnchypg   (   (   x  1   ,  …  ,   x   c  -  1    +   x  c   )   ;  n  ,   (   m  1   ,  …  ,   m   c  -  1    +   m  c   )   ,   (   ω  1   ,  …  ,   ω   c  -  1    )   )   ⋅     fragments  mwnchypg   fragments  normal-(   fragments  normal-(   subscript  x  1   normal-,  normal-…  normal-,   subscript  x    c  1      subscript  x  c   normal-)   normal-;  n  normal-,   fragments  normal-(   subscript  m  1   normal-,  normal-…  normal-,   subscript  m    c  1      subscript  m  c   normal-)   normal-,   fragments  normal-(   subscript  ω  1   normal-,  normal-…  normal-,   subscript  ω    c  1    normal-)   normal-)   normal-⋅    \operatorname{mwnchypg}\left((x_{1},\ldots,x_{c-1}+x_{c});n,(m_{1},\ldots,m_{c%
 -1}+m_{c}),(\omega_{1},\ldots,\omega_{c-1})\right)\,\cdot          hypg   (   x  c   ;    x   c  -  1    +   x  c    ,   m  c   ,    m   c  -  1    +   m  c    )    ,     hypg   subscript  x  c      subscript  x    c  1     subscript  x  c     subscript  m  c      subscript  m    c  1     subscript  m  c      \operatorname{hypg}(x_{c};x_{c-1}+x_{c},m_{c},m_{c-1}+m_{c})\,,        where    hypg   (  x  ;  n  ,  m  ,  N  )      hypg  x  n  m  N    \operatorname{hypg}(x;n,m,N)   is the (univariate, central) hypergeometric distribution probability.   Complementary Wallenius' noncentral hypergeometric distribution  (Figure)  Probability mass function for the Complementary Wallenius' Noncentral Hypergeometric Distribution for different values of the odds ratio ω. m 1 = 80, m 2 = 60, n = 40, ω = 0.05 ... 10   The balls that are not taken in the urn experiment have a distribution that is different from Wallenius' noncentral hypergeometric distribution, due to a lack of symmetry. The distribution of the balls not taken can be called the complementary Wallenius' noncentral hypergeometric distribution .  Probabilities in the complementary distribution are calculated from Wallenius' distribution by replacing n with N - n , x i with m i - x i , and ω i with 1/ω i .    Software available   WalleniusHypergeometricDistribution in Mathematica .  An implementation for the R programming language is available as the package named BiasedUrn . Includes univariate and multivariate probability mass functions, distribution functions, quantiles , random variable generating functions, mean and variance.  Implementation in C++ is available from www.agner.org .   See also   Noncentral hypergeometric distributions  Fisher's noncentral hypergeometric distribution  Hypergeometric distribution  Urn models  Biased sample  Bias  Population genetics  Fisher's exact test   References  .  .  .  .  .  .  .   "  Category:Discrete distributions  Category:Multivariate discrete distributions  Category:Probability distributions   