   Lucas–Lehmer primality test      Lucas–Lehmer primality test   In mathematics , the Lucas–Lehmer test ( LLT ) is a primality test for Mersenne numbers . The test was originally developed by Édouard Lucas in 1856 1 and subsequently improved by Lucas in 1878 and Derrick Henry Lehmer in the 1930s.  The test  The Lucas–Lehmer test works as follows. Let M p = 2 p − 1 be the Mersenne number to test with p an odd prime . The primality of p can be efficiently checked with a simple algorithm like trial division since p is exponentially smaller than M p . Define a sequence    {   s  i   }      subscript  s  i     \{s_{i}\}   for all i ≥ 0 by       s  i   =   {     4       if  i   =  0   ;         s   i  -  1   2   -  2     otherwise.           subscript  s  i    cases  4      if  i   0      superscript   subscript  s    i  1    2   2   otherwise.     s_{i}=\begin{cases}4&\text{if }i=0;\\
 s_{i-1}^{2}-2&\text{otherwise.}\end{cases}     The first few terms of this sequence are 4, 14, 194, 37634, ... . Then M p is prime if and only if        s   p  -  2    ≡   0     (   mod   M  p    )     .       subscript  s    p  2     annotated  0   pmod   subscript  M  p       s_{p-2}\equiv 0\;\;(\mathop{{\rm mod}}M_{p}).   The number s p − 2 mod M p is called the Lucas–Lehmer residue of p . (Some authors equivalently set s 1 = 4 and test s p −1 mod M p ). In pseudocode , the test might be written as  ''// Determine if M p = 2 p − 1 is prime  Lucas–Lehmer (p)   var s = 4   var M = 2 p − 1   repeat p − 2 times:  s = ((s × s) − 2) mod M   if s = 0 return PRIME else  return COMPOSITE  Performing the mod M at each iteration ensures that all intermediate results are at most p bits (otherwise the number of bits would double each iteration). The same strategy is used in modular exponentiation .  Time complexity  In the algorithm as written above, there are two expensive operations during each iteration: the multiplication s × s , and the mod M operation. The mod M operation can be made particularly efficient on standard binary computers by observing that       k  ≡     (    k   mod   2  n    )   +   ⌊   k  /   2  n    ⌋       (   mod    2  n   -  1    )     .      k   annotated     modulo  k   superscript  2  n        k   superscript  2  n       pmod     superscript  2  n   1       k\equiv(k\,\bmod\,2^{n})+\lfloor k/2^{n}\rfloor\;\;(\mathop{{\rm mod}}2^{n}-1).     This says that the least significant n bits of k plus the remaining bits of k are equivalent to k modulo 2 n −1. This equivalence can be used repeatedly until at most n bits remain. In this way, the remainder after dividing k by the Mersenne number 2 n −1 is computed without using division. For example,      916 mod 2 5 −1   =   1110010100 2 mod 2 5 −1      =   11100 2 + 10100 2 mod 2 5 −1      =   110000 2 mod 2 5 −1      =   1 2 + 10000 2 mod 2 5 −1      =   10001 2 mod 2 5 −1      =   10001 2      =   17.     Moreover, since s × s will never exceed M 2 2p, this simple technique converges in at most 1 p -bit addition (and possibly a carry from the p th bit to the 1st bit), which can be done in linear time. This algorithm has a small exceptional case. It will produce 2 n −1 for a multiple of the modulus rather than the correct value of 0. However, this case is easy to detect and correct.  With the modulus out of the way, the asymptotic complexity of the algorithm only depends on the multiplication algorithm used to square s at each step. The simple "grade-school" algorithm for multiplication requires O ( p 2 ) bit-level or word-level operations to square a p -bit number. Since this happens O( p ) times, the total time complexity is O( p 3 ). A more efficient multiplication algorithm is the Schönhage–Strassen algorithm , which is based on the Fast Fourier transform . It only requires O( p log p log log p ) time to square a p -bit number. This reduces the complexity to O( p 2 log p log log p ) or Õ( p 2 ). 2 Currently the most efficient known multiplication algorithm, Fürer's algorithm , only needs    p   log   p   2   O   (    log  *   p   )           p      p   superscript  2    O    superscript     p         p\log p\ 2^{O(\log^{*}p)}   time to multiply two p -bit numbers.  By comparison, the most efficient randomized primality test for general integers, the Miller–Rabin primality test , requires O( k  n 2 log n log log n ) bit operations using FFT multiplication for an n -digit number, where k is the number of iterations and is related to the error rate. For constant k , this is in the same complexity class as the Lucas-Lehmer test. In practice however, the cost of doing many iterations and other differences leads to worse performance for Miller–Rabin. The most efficient deterministic primality test for any n -digit number, the AKS primality test , requires Õ(n 6 ) bit operations in its best known variant and is dramatically slower in practice.  Examples  The Mersenne number M 3 = 7 is prime. The Lucas–Lehmer test verifies this as follows. Initially s is set to 4 and then is updated 3−2 = 1 time:   s ← ((4 × 4) − 2) mod 7 = 0.   Since the final value of s is 0, the conclusion is that M 3 is prime.  On the other hand, M 11 = 2047 = 23 × 89 is not prime. Again, s is set to 4 but is now updated 11−2 = 9 times:   s ← ((4 × 4) − 2) mod 2047 = 14  s ← ((14 × 14) − 2) mod 2047 = 194  s ← ((194 × 194) − 2) mod 2047 = 788  s ← ((788 × 788) − 2) mod 2047 = 701  s ← ((701 × 701) − 2) mod 2047 = 119  s ← ((119 × 119) − 2) mod 2047 = 1877  s ← ((1877 × 1877) − 2) mod 2047 = 240  s ← ((240 × 240) − 2) mod 2047 = 282  s ← ((282 × 282) − 2) mod 2047 = 1736   Since the final value of s is not 0, the conclusion is that M 11 = 2047 is not prime. Although M 11 = 2047 has nontrivial factors, the Lucas–Lehmer test gives no indication about what they might be.  Proof of correctness  The proof of correctness for this test presented here is simpler than the original proof given by Lehmer. Recall the definition       s  i   =   {     4       if  i   =  0   ;         s   i  -  1   2   -  2     otherwise.           subscript  s  i    cases  4      if  i   0      superscript   subscript  s    i  1    2   2   otherwise.     s_{i}=\begin{cases}4&\text{if }i=0;\\
 s_{i-1}^{2}-2&\text{otherwise.}\end{cases}   The goal is to show that M p is prime iff       s   p  -  2    ≡   0     (   mod   M  p    )     .       subscript  s    p  2     annotated  0   pmod   subscript  M  p       s_{p-2}\equiv 0\;\;(\mathop{{\rm mod}}M_{p}).     The sequence    ⟨   s  i   ⟩     delimited-⟨⟩   subscript  s  i     {\langle}s_{i}{\rangle}   is a recurrence relation with a closed-form solution . Let    ω  =   2  +   3        ω    2    3      \omega=2+\sqrt{3}   and     ω  ¯   =   2  -   3         normal-¯  ω     2    3      \bar{\omega}=2-\sqrt{3}   . It then follows by induction that     s  i   =    ω   2  i    +    ω  ¯    2  i          subscript  s  i      superscript  ω   superscript  2  i     superscript   normal-¯  ω    superscript  2  i       s_{i}=\omega^{2^{i}}+\bar{\omega}^{2^{i}}   for all i :       s  0   =    ω   2  0    +    ω  ¯    2  0     =    (   2  +   3    )   +   (   2  -   3    )    =  4         subscript  s  0      superscript  ω   superscript  2  0     superscript   normal-¯  ω    superscript  2  0              2    3      2    3          4     s_{0}=\omega^{2^{0}}+\bar{\omega}^{2^{0}}=\left(2+\sqrt{3}\right)+\left(2-%
 \sqrt{3}\right)=4   and      s  n     subscript  s  n    \displaystyle s_{n}   The last step uses     ω   ω  ¯    =    (   2  +   3    )    (   2  -   3    )    =  1.          ω   normal-¯  ω        2    3      2    3          1.     \omega\bar{\omega}=\left(2+\sqrt{3}\right)\left(2-\sqrt{3}\right)=1.   This closed form is used in both the proof of sufficiency and the proof of necessity.  Sufficiency  The goal is to show that     s   p  -  2    ≡   0     (   mod   M  p    )         subscript  s    p  2     annotated  0   pmod   subscript  M  p       s_{p-2}\equiv 0\;\;(\mathop{{\rm mod}}M_{p})   implies that    M  p     subscript  M  p    M_{p}   is prime. What follows is a straightforward proof exploiting elementary group theory given by J. W. Bruce 3 as related by Jason Wojciechowski. 4  Suppose      s   p  -  2    ≡   0     (   mod   M  p    )     .       subscript  s    p  2     annotated  0   pmod   subscript  M  p       s_{p-2}\equiv 0\;\;(\mathop{{\rm mod}}M_{p}).   Then        ω   2   p  -  2     +    ω  ¯    2   p  -  2      =   k   M  p           superscript  ω   superscript  2    p  2      superscript   normal-¯  ω    superscript  2    p  2        k   subscript  M  p      \omega^{2^{p-2}}+\bar{\omega}^{2^{p-2}}=kM_{p}   for some integer k , so        ω   2   p  -  2     =    k   M  p    -    ω  ¯    2   p  -  2       .       superscript  ω   superscript  2    p  2         k   subscript  M  p     superscript   normal-¯  ω    superscript  2    p  2        \omega^{2^{p-2}}=kM_{p}-\bar{\omega}^{2^{p-2}}.   Multiplying by    ω   2   p  -  2       superscript  ω   superscript  2    p  2      \omega^{2^{p-2}}   gives         (   ω   2   p  -  2     )   2   =    k   M  p    ω   2   p  -  2      -    (   ω   ω  ¯    )    2   p  -  2       .       superscript   superscript  ω   superscript  2    p  2     2       k   subscript  M  p    superscript  ω   superscript  2    p  2       superscript    ω   normal-¯  ω     superscript  2    p  2        \left(\omega^{2^{p-2}}\right)^{2}=kM_{p}\omega^{2^{p-2}}-(\omega\bar{\omega})^%
 {2^{p-2}}.   Thus,       ω   2   p  -  1     =     k   M  p    ω   2   p  -  2      -  1.    (  1  )         superscript  ω   superscript  2    p  1          k   subscript  M  p    superscript  ω   superscript  2    p  2      1.   1     \omega^{2^{p-1}}=kM_{p}\omega^{2^{p-2}}-1.\qquad\qquad(1)     For a contradiction, suppose M p is composite, and let q be the smallest prime factor of M p . Mersenne numbers are odd, so q > 2. Informally, 5 let    ℤ  q     subscript  ℤ  q    \mathbb{Z}_{q}   be the integers modulo q , and let     X  =   {   a  +   b   3     ∣    a  ,  b   ∈   ℤ  q    }    .      X   conditional-set    a    b    3        a  b    subscript  ℤ  q       X=\left\{a+b\sqrt{3}\mid a,b\in\mathbb{Z}_{q}\right\}.   Multiplication in   X   X   X   is defined as         (   a  +    3   b    )    (   c  +    3   d    )    =    [    (    a  c   +   3  b  d    )   mod  q   ]   +    3    [    (    a  d   +   b  c    )   mod  q   ]      .          a      3   b      c      3   d        delimited-[]   modulo      a  c     3  b  d    q        3    delimited-[]   modulo      a  d     b  c    q        \left(a+\sqrt{3}b\right)\left(c+\sqrt{3}d\right)=[(ac+3bd)\,\bmod\,q]+\sqrt{3}%
 [(ad+bc)\,\bmod\,q].     Clearly, this multiplication is closed, i.e. the product of numbers from X is itself in X . The size of X is denoted by     |  X  |   .      X    |X|.     Since q > 2, it follows that   ω   ω   \omega   and    ω  ¯     normal-¯  ω    \bar{\omega}   are in X . 6 The subset of elements in X with inverses forms a group, which is denoted by X * and has size     |   X  *   |   .       superscript  X      |X^{*}|.   One element in X that does not have an inverse is 0, so     |   X  *   |   ≤    |  X  |   -  1   =    q  2   -  1.            superscript  X         X   1           superscript  q  2   1.      |X^{*}|\leq|X|-1=q^{2}-1.     Now     M  p   ≡   0     (   mod  q   )         subscript  M  p    annotated  0   pmod  q      M_{p}\equiv 0\;\;(\mathop{{\rm mod}}q)   and    ω  ∈  X      ω  X    \omega\in X   , so       k   M  p    ω   2   p  -  2      =  0        k   subscript  M  p    superscript  ω   superscript  2    p  2      0    kM_{p}\omega^{2^{p-2}}=0   in X . Then by equation (1),       ω   2   p  -  1     =   -  1        superscript  ω   superscript  2    p  1       1     \omega^{2^{p-1}}=-1   in X , and squaring both sides gives       ω   2  p    =  1.       superscript  ω   superscript  2  p    1.    \omega^{2^{p}}=1.   Thus   ω   ω   \omega   lies in X * and has inverse     ω    2  p   -  1    .     superscript  ω     superscript  2  p   1     \omega^{2^{p}-1}.   Furthermore the order of   ω   ω   \omega   divides     2  p   .     superscript  2  p    2^{p}.   However     ω   2   p  -  1     ≠  1       superscript  ω   superscript  2    p  1     1    \omega^{2^{p-1}}\neq 1   , so the order does not divide     2   p  -  1    .     superscript  2    p  1     2^{p-1}.   Thus, the order is exactly     2  p   .     superscript  2  p    2^{p}.     The order of an element is at most the order (size) of the group, so        2  p   ≤   |   X  *   |   ≤    q  2   -  1   <   q  2    .         superscript  2  p      superscript  X             superscript  q  2   1         superscript  q  2      2^{p}\leq|X^{*}|\leq q^{2}-1   But q is the smallest prime factor of the composite    M  p     subscript  M  p    M_{p}   , so       q  2   ≤   M  p   =    2  p   -  1.          superscript  q  2    subscript  M  p           superscript  2  p   1.      q^{2}\leq M_{p}=2^{p}-1.   This yields the contradiction     2  p   <    2  p   -  1        superscript  2  p      superscript  2  p   1     2^{p}<2^{p}-1   . Therefore    M  p     subscript  M  p    M_{p}   is prime.  Necessity  In the other direction, the goal is to show that the primality of    M  p     subscript  M  p    M_{p}   implies     s   p  -  2    ≡   0     (   mod   M  p    )         subscript  s    p  2     annotated  0   pmod   subscript  M  p       s_{p-2}\equiv 0\;\;(\mathop{{\rm mod}}M_{p})   . The following simplified proof is by Öystein J. R. Ödseth. 7  Since      2  p   -  1   ≡   7     (   mod  12   )           superscript  2  p   1    annotated  7   pmod  12      2^{p}-1\equiv 7\;\;(\mathop{{\rm mod}}12)   for odd    p  >  1      p  1    p>1   , it follows from properties of the Legendre symbol that     (  3  |   M  p   )   =  -  1.     fragments   fragments  normal-(  3  normal-|   subscript  M  p   normal-)     1.    (3|M_{p})=-1.   This means that 3 is a quadratic nonresidue modulo     M  p   .     subscript  M  p    M_{p}.   By Euler's criterion , this is equivalent to        3     M  p   -  1   2    ≡    -  1      (   mod   M  p    )     .       superscript  3       subscript  M  p   1   2     annotated    1    pmod   subscript  M  p       3^{\frac{M_{p}-1}{2}}\equiv-1\;\;(\mathop{{\rm mod}}M_{p}).     In contrast, 2 is a quadratic residue modulo    M  p     subscript  M  p    M_{p}   since     2  p   ≡   1     (   mod   M  p    )         superscript  2  p    annotated  1   pmod   subscript  M  p       2^{p}\equiv 1\;\;(\mathop{{\rm mod}}M_{p})   and so     2  ≡   2   p  +  1    =     (   2    p  +  1   2    )   2      (   mod   M  p    )     .        2   superscript  2    p  1          annotated   superscript   superscript  2      p  1   2    2    pmod   subscript  M  p        2\equiv 2^{p+1}=\left(2^{\frac{p+1}{2}}\right)^{2}\;\;(\mathop{{\rm mod}}M_{p}).   This time, Euler's criterion gives        2     M  p   -  1   2    ≡   1     (   mod   M  p    )     .       superscript  2       subscript  M  p   1   2     annotated  1   pmod   subscript  M  p       2^{\frac{M_{p}-1}{2}}\equiv 1\;\;(\mathop{{\rm mod}}M_{p}).     Combining these two equivalence relations yields        24     M  p   -  1   2    ≡     (   2     M  p   -  1   2    )   3    (   3     M  p   -  1   2    )    ≡     (  1  )   3    (   -  1   )    ≡    -  1      (   mod   M  p    )     .         superscript  24       subscript  M  p   1   2       superscript   superscript  2       subscript  M  p   1   2    3    superscript  3       subscript  M  p   1   2             superscript  1  3     1          annotated    1    pmod   subscript  M  p        24^{\frac{M_{p}-1}{2}}\equiv\left(2^{\frac{M_{p}-1}{2}}\right)^{3}\left(3^{%
 \frac{M_{p}-1}{2}}\right)\equiv(1)^{3}(-1)\equiv-1\;\;(\mathop{{\rm mod}}M_{p}).     Let    σ  =   2   3        σ    2    3      \sigma=2\sqrt{3}   , and define X as before as the ring     X  =   {   a  +   b   3     ∣    a  ,  b   ∈   ℤ   M  p     }    .      X   conditional-set    a    b    3        a  b    subscript  ℤ   subscript  M  p        X=\{a+b\sqrt{3}\mid a,b\in\mathbb{Z}_{M_{p}}\}.   Then in the ring X , it follows that       (   6  +  σ   )    M  p      superscript    6  σ    subscript  M  p     \displaystyle(6+\sigma)^{M_{p}}     where the first equality uses the Binomial Theorem in a finite field , which is        (   x  +  y   )    M  p    ≡     x   M  p    +   y   M  p        (   mod   M  p    )         superscript    x  y    subscript  M  p     annotated     superscript  x   subscript  M  p     superscript  y   subscript  M  p      pmod   subscript  M  p       (x+y)^{M_{p}}\equiv x^{M_{p}}+y^{M_{p}}\;\;(\mathop{{\rm mod}}M_{p})   ,  and the second equality uses Fermat's little theorem , which is       a   M  p    ≡   a     (   mod   M  p    )         superscript  a   subscript  M  p     annotated  a   pmod   subscript  M  p       a^{M_{p}}\equiv a\;\;(\mathop{{\rm mod}}M_{p})     for any integer a . The value of   σ   σ   \sigma   was chosen so that     ω  =     (   6  +  σ   )   2   24    .      ω     superscript    6  σ   2   24     \omega=\frac{(6+\sigma)^{2}}{24}.   Consequently, this can be used to compute    ω     M  p   +  1   2      superscript  ω       subscript  M  p   1   2     \omega^{\frac{M_{p}+1}{2}}   in the ring X as      ω     M  p   +  1   2      superscript  ω       subscript  M  p   1   2     \displaystyle\omega^{\frac{M_{p}+1}{2}}     All that remains is to multiply both sides of this equation by     ω  ¯      M  p   +  1   4      superscript   normal-¯  ω        subscript  M  p   1   4     \bar{\omega}^{\frac{M_{p}+1}{4}}   and use     ω   ω  ¯    =  1        ω   normal-¯  ω    1    \omega\bar{\omega}=1   , which gives       ω     M  p   +  1   2      ω  ¯      M  p   +  1   4         superscript  ω       subscript  M  p   1   2     superscript   normal-¯  ω        subscript  M  p   1   4      \displaystyle\omega^{\frac{M_{p}+1}{2}}\bar{\omega}^{\frac{M_{p}+1}{4}}     Since    s   p  -  2      subscript  s    p  2     s_{p-2}   is 0 in X , it is also 0 modulo     M  p   .     subscript  M  p    M_{p}.     Applications  The Lucas–Lehmer test is the primality test used by the Great Internet Mersenne Prime Search to locate large primes. This search has been successful in locating many of the largest primes known to date. 8 The test is considered valuable because it can provably test a large set of very large numbers for primality within an affordable amount of time. In contrast, the equivalently fast Pépin's test for any Fermat number can only be used on a much smaller set of very large numbers before reaching computational limits.  See also   Mersenne's conjecture  Lucas–Lehmer–Riesel test  GIMPS   Notes    References     External links    GIMPS (The Great Internet Mersenne Prime Search)  A proof of Lucas–Lehmer–Reix test (for Fermat numbers)  Lucas–Lehmer test at MersenneWiki   "  Category:Primality tests     The Largest Known Prime by Year: A Brief History ↩  ↩  ↩  Jason Wojciechowski. Mersenne Primes, An Introduction and Overview . 2003. ↩  Formally, let     ℤ  q   =    ℤ  /  q   ℤ        subscript  ℤ  q       ℤ  q   ℤ     \mathbb{Z}_{q}=\mathbb{Z}/q\mathbb{Z}   and    X  =     ℤ  q    [  T  ]    /   ⟨    T  2   -  3   ⟩        X       subscript  ℤ  q    delimited-[]  T     delimited-⟨⟩     superscript  T  2   3       X=\mathbb{Z}_{q}[T]/\langle T^{2}-3\rangle   . ↩  Formally,    ω  +   ⟨    T  2   -  3   ⟩       ω   delimited-⟨⟩     superscript  T  2   3      \omega+\langle T^{2}-3\rangle   and     ω  ¯   +   ⟨    T  2   -  3   ⟩        normal-¯  ω    delimited-⟨⟩     superscript  T  2   3      \bar{\omega}+\langle T^{2}-3\rangle   are in X . By abuse of language   ω   ω   \omega   and    ω  ¯     normal-¯  ω    \bar{\omega}   are identified with their images in X under the natural ring homomorphism from    ℤ   [   3   ]       ℤ   delimited-[]    3      \mathbb{Z}[\sqrt{3}]   to X which sends    3      3    \sqrt{3}   to T . ↩  Öystein J. R. Ödseth. A note on primality tests for N = h · 2 n − 1 . Department of Mathematics, University of Bergen. ↩  The "Top Ten" Record Primes , The Prime Pages ↩     