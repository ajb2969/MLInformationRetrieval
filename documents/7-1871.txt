   Random permutation statistics      Random permutation statistics   The statistics of random permutations , such as the cycle structure of a random permutation are of fundamental importance in the analysis of algorithms , especially of sorting algorithms, which operate on random permutations. Suppose, for example, that we are using quickselect (a cousin of quicksort ) to select a random element of a random permutation. Quickselect will perform a partial sort on the array, as it partitions the array according to the pivot. Hence a permutation will be less disordered after quickselect has been performed. The amount of disorder that remains may be analysed with generating functions. These generating functions depend in a fundamental way on the generating functions of random permutation statistics. Hence it is of vital importance to compute these generating functions.  The article on random permutations contains an introduction to random permutations.  The fundamental relation  Permutations are sets of labelled cycles. Using the labelled case of the Flajoletâ€“Sedgewick fundamental theorem and writing   ð’«   ð’«   \scriptstyle\mathcal{P}   for the set of permutations and   ð’µ   ð’µ   \scriptstyle\mathcal{Z}   for the singleton set, we have        ð”“   (   â„­   (  ð’µ  )    )    =  ð’«   .        ð”“    â„­  ð’µ    ð’«    \mathfrak{P}(\mathfrak{C}(\mathcal{Z}))=\mathcal{P}.     Translating into exponential generating functions (EGFs), we have       exp   log   1   1  -  z      =   1   1  -  z              1    1  z        1    1  z      \exp\log\frac{1}{1-z}=\frac{1}{1-z}     where we have used the fact that the EGF of the set of permutations (there are n ! permutations of n elements) is         âˆ‘   n  â‰¥  0       n  !    n  !     z  n     =   1   1  -  z     .        subscript     n  0          n     n     superscript  z  n       1    1  z      \sum_{n\geq 0}\frac{n!}{n!}z^{n}=\frac{1}{1-z}.     This one equation will allow us to derive a surprising number of permutation statistics. Firstly, by dropping terms from   ð”“   ð”“   \scriptstyle\mathfrak{P}   , i.e. exp, we may constrain the number of cycles that a permutation contains, e.g. by restricting the EGF to    ð”“  2     subscript  ð”“  2    \scriptstyle\mathfrak{P}_{2}   we obtain permutations containing two cycles. Secondly, note that the EGF of labelled cycles, i.e. of    â„­   (  ð’µ  )       â„­  ð’µ    \scriptstyle\mathfrak{C}(\mathcal{Z})   , is       log   1   1  -  z     =    âˆ‘   k  â‰¥  1      z  k   k            1    1  z       subscript     k  1       superscript  z  k   k      \log\frac{1}{1-z}=\sum_{k\geq 1}\frac{z^{k}}{k}     because there are k !Â / k labelled cycles.  This means that by dropping terms from this generating function, we may constrain the size of the cycles that occur in a permutation and obtain an EGF of the permutations containing only cycles of a given size.  Now instead of removing and selecting cycles, let's put different weights on different size cycles. If     b   (  k  )    :   â„•  â†’  â„      normal-:    b  k    normal-â†’  â„•  â„     \scriptstyle b(k):\mathbb{N}\rightarrow\mathbb{R}   is a weight function that depends only on the size k of the cycle and for brevity we write       b   (  Ïƒ  )    =    âˆ‘   c  âˆˆ  Ïƒ     b   (  c  )           b  Ïƒ     subscript     c  Ïƒ      b  c      b(\sigma)=\sum_{c\in\sigma}b(c)     the value of b for a permutation   Ïƒ   Ïƒ   \sigma   to be the sum of its values on the cycles, then we may mark cycles of length k with u b ( k ) and obtain a bivariate generating function g ( z , u ) that describes the parameter, i.e.       g   (  z  ,  u  )    =   1  +    âˆ‘   n  â‰¥  1      (    âˆ‘   Ïƒ  âˆˆ   S  n      u   b   (  Ïƒ  )      )     z  n    n  !       =   exp    âˆ‘   k  â‰¥  1      u   b   (  k  )       z  k   k              g   z  u      1    subscript     n  1        subscript     Ïƒ   subscript  S  n      superscript  u    b  Ïƒ        superscript  z  n     n                 subscript     k  1       superscript  u    b  k       superscript  z  k   k         g(z,u)=1+\sum_{n\geq 1}\left(\sum_{\sigma\in S_{n}}u^{b(\sigma)}\right)\frac{z%
 ^{n}}{n!}=\exp\sum_{k\geq 1}u^{b(k)}\frac{z^{k}}{k}     This is a mixed generating function which is exponential in the permutation size and ordinary in the secondary parameter u. Differentiating and evaluating at u =Â 1, we have          âˆ‚   âˆ‚  u    g   (  z  ,  u  )    |    u  =  1    =    1   1  -  z      âˆ‘   k  â‰¥  1     b   (  k  )     z  k   k      =    âˆ‘   n  â‰¥  1      (    âˆ‘   Ïƒ  âˆˆ   S  n      b   (  Ïƒ  )     )     z  n    n  !             evaluated-at         u    g   z  u      u  1        1    1  z      subscript     k  1      b  k     superscript  z  k   k             subscript     n  1        subscript     Ïƒ   subscript  S  n       b  Ïƒ       superscript  z  n     n         \frac{\partial}{\partial u}g(z,u)\Bigg|_{u=1}=\frac{1}{1-z}\sum_{k\geq 1}b(k)%
 \frac{z^{k}}{k}=\sum_{n\geq 1}\left(\sum_{\sigma\in S_{n}}b(\sigma)\right)%
 \frac{z^{n}}{n!}     i.e. the EGF of the sum of b over all permutations, or alternatively, the OGF, or more precisely, PGF (probability generating function) of the expectation of b .  This article uses the coefficient extraction operator [ z n ], documented on the page for formal power series .  Number of permutations that are involutions  An involution is a permutation Ïƒ so that Ïƒ 2 = 1 under permutation composition. It follows that Ïƒ may only contain cycles of length one or two, i.e. the EGF g ( z ) of these permutations is        g   (  z  )    =   exp   (   z  +    1  2    z  2     )     .        g  z       z      1  2    superscript  z  2        g(z)=\exp\left(z+\frac{1}{2}z^{2}\right).     This gives the explicit formula for the total number    I   (  n  )       I  n    I(n)   of involutions among the permutations ÏƒÂ âˆˆ S n :        I   (  n  )    =    n  !    [   z  n   ]   g   (  z  )    =    n  !     âˆ‘    a  +   2  b    =  n     1    a  !     2  b     b  !       =    n  !     âˆ‘   b  =  0    âŒŠ   n  /  2   âŒ‹     1     (   n  -   2  b    )   !     2  b     b  !        .          I  n       n    delimited-[]   superscript  z  n    g  z            n     subscript       a    2  b    n      1      a    superscript  2  b     b                n     superscript   subscript     b  0        n  2       1        n    2  b      superscript  2  b     b          I(n)=n![z^{n}]g(z)=n!\sum_{a+2b=n}\frac{1}{a!\;2^{b}\;b!}=n!\sum_{b=0}^{%
 \lfloor n/2\rfloor}\frac{1}{(n-2b)!\;2^{b}\;b!}.     Dividing by n ! yields the probability that a random permutation is an involution. These numbers are known as Telephone numbers .  Number of permutations that are m th roots of unity  This generalizes the concept of an involution. An m th root of unity is a permutation Ïƒ so that Ïƒ m = 1 under permutation composition. Now every time we apply Ïƒ we move one step in parallel along all of its cycles. A cycle of length d applied d times produces the identity permutation on d elements ( d fixed points) and d is the smallest value to do so. Hence m must be a multiple of all cycle sizes d , i.e. the only possible cycles are those whose length d is a divisor of m . It follows that the EGF g ( x ) of these permutations is        g   (  z  )    =   exp   (    âˆ‘   d  âˆ£  m      z  d   d    )     .        g  z       subscript    fragments  d  normal-âˆ£  m       superscript  z  d   d       g(z)=\exp\left(\sum_{d\mid m}\frac{z^{d}}{d}\right).     When m = p , where p is prime, this simplifies to         n  !    [   z  n   ]   g   (  z  )    =    n  !     âˆ‘    a  +   p  b    =  n     1    a  !     p  b     b  !       =    n  !     âˆ‘   b  =  0    âŒŠ   n  /  p   âŒ‹     1     (   n  -   p  b    )   !     p  b     b  !        .            n    delimited-[]   superscript  z  n    g  z       n     subscript       a    p  b    n      1      a    superscript  p  b     b                n     superscript   subscript     b  0        n  p       1        n    p  b      superscript  p  b     b          n![z^{n}]g(z)=n!\sum_{a+pb=n}\frac{1}{a!\;p^{b}\;b!}=n!\sum_{b=0}^{\lfloor n/p%
 \rfloor}\frac{1}{(n-pb)!\;p^{b}\;b!}.     Number of permutations of order exactly k  This one can be done by MÃ¶bius inversion . Working with the same concept as in the previous entry we note that the combinatorial species   ð’¬   ð’¬   \mathcal{Q}   of permutations whose order divides k is given by       ð’¬  =   ð”“   (    âˆ‘   d  âˆ£  k      â„­  d    (  ð’µ  )     )     .      ð’¬    ð”“    subscript    fragments  d  normal-âˆ£  k       subscript  â„­  d   ð’µ       \mathcal{Q}=\mathfrak{P}\left(\sum_{d\mid k}\mathfrak{C}_{d}(\mathcal{Z})%
 \right).   Translation to exponential generating functions we obtain the EGF of permutations whose order divides k , which is         Q  k    (  z  )    =   exp   (    âˆ‘   d  âˆ£  k      z  d   d    )     .         subscript  Q  k   z       subscript    fragments  d  normal-âˆ£  k       superscript  z  d   d       Q_{k}(z)=\exp\left(\sum_{d\mid k}\frac{z^{d}}{d}\right).   Now we can use this generating function to count permutations of order exactly k . Let    p   n  ,  d      subscript  p   n  d     p_{n,d}   be the number of permutations on n whose order is exactly d and    q   n  ,  k      subscript  q   n  k     q_{n,k}   the number of permutations on n the permutation count whose order divides k . Then we have         âˆ‘   d  |  k     p   n  ,  d     =   q   n  ,  k     .        subscript    fragments  d  normal-|  k     subscript  p   n  d      subscript  q   n  k      \sum_{d|k}p_{n,d}=q_{n,k}.   It follows by MÃ¶bius inversion that         âˆ‘   d  |  k       q   n  ,  d    Ã—  Î¼    (   k  /  d   )     =   p   n  ,  k     .        subscript    fragments  d  normal-|  k         subscript  q   n  d    Î¼     k  d      subscript  p   n  k      \sum_{d|k}q_{n,d}\times\mu(k/d)=p_{n,k}.   Therefore we have the EGF        Q   (  z  )    =    âˆ‘   d  âˆ£  k       Î¼   (   k  /  d   )    Ã—   Q  d     (  z  )     =    âˆ‘   d  âˆ£  k     Î¼   (   k  /  d   )    exp   (    âˆ‘   m  âˆ£  d      z  m   m    )       .          Q  z     subscript    fragments  d  normal-âˆ£  k          Î¼    k  d     subscript  Q  d    z           subscript    fragments  d  normal-âˆ£  k      Î¼    k  d       subscript    fragments  m  normal-âˆ£  d       superscript  z  m   m          Q(z)=\sum_{d\mid k}\mu(k/d)\times Q_{d}(z)=\sum_{d\mid k}\mu(k/d)\exp\left(%
 \sum_{m\mid d}\frac{z^{m}}{m}\right).   The desired count is then given by        n  !    [   z  n   ]   Q   (  z  )    .        n    delimited-[]   superscript  z  n    Q  z    n![z^{n}]Q(z).     This formula produces e.g. for k =Â 6 the EGF       Q   (  z  )    =     e  z   -   e   z  +    1  /   2     z  2      -   e   z  +    1  /   3     z  3       +   e   z  +    1  /   2     z  2    +    1  /   3     z  3    +    1  /   6     z  6             Q  z        superscript  normal-e  z    superscript  normal-e    z      1  2    superscript  z  2       superscript  normal-e    z      1  3    superscript  z  3        superscript  normal-e    z      1  2    superscript  z  2        1  3    superscript  z  3        1  6    superscript  z  6         Q(z)={\rm e}^{z}-{\rm e}^{z+1/2\,z^{2}}-{\rm e}^{z+1/3\,z^{3}}+{\rm e}^{z+1/2%
 \,z^{2}+1/3\,z^{3}+1/6\,z^{6}}     with the sequence of values starting at n =Â 5      20  ,  240  ,  1470  ,  10640  ,  83160  ,  584640  ,  4496030  ,  42658440  ,  371762820  ,  3594871280  ,  â€¦     20  240  1470  10640  83160  584640  4496030  42658440  371762820  3594871280  normal-â€¦    20,240,1470,10640,83160,584640,4496030,42658440,371762820,3594871280,\ldots   which is OEIS A061121 .  For k =Â 8 we get the EGF       Q   (  z  )    =    -   e   z  +    1  /   2     z  2    +    1  /   4     z  4       +   e   z  +    1  /   2     z  2    +    1  /   4     z  4    +    1  /   8     z  8             Q  z        superscript  normal-e    z      1  2    superscript  z  2        1  4    superscript  z  4        superscript  normal-e    z      1  2    superscript  z  2        1  4    superscript  z  4        1  8    superscript  z  8         Q(z)=-{\rm e}^{z+1/2\,z^{2}+1/4\,z^{4}}+{\rm e}^{z+1/2\,z^{2}+1/4\,z^{4}+1/8\,%
 z^{8}}   with the sequence of values starting at n =Â 8      5040  ,  45360  ,  453600  ,  3326400  ,  39916800  ,  363242880  ,  3874590720  ,  34767532800  ,  â€¦     5040  45360  453600  3326400  39916800  363242880  3874590720  34767532800  normal-â€¦    5040,45360,453600,3326400,39916800,363242880,3874590720,34767532800,\ldots   which is OEIS A061122 .  Finally for k =Â 12 we get the EGF       Q   (  z  )    =     e   z  +    1  /   2     z  2      -   e   z  +    1  /   2     z  2    +    1  /   4     z  4      -   e   z  +    1  /   2     z  2    +    1  /   3     z  3    +    1  /   6     z  6       +   e   z  +    1  /   2     z  2    +    1  /   3     z  3    +    1  /   4     z  4    +    1  /   6     z  6    +    1  /   12     z  12             Q  z        superscript  normal-e    z      1  2    superscript  z  2       superscript  normal-e    z      1  2    superscript  z  2        1  4    superscript  z  4       superscript  normal-e    z      1  2    superscript  z  2        1  3    superscript  z  3        1  6    superscript  z  6        superscript  normal-e    z      1  2    superscript  z  2        1  3    superscript  z  3        1  4    superscript  z  4        1  6    superscript  z  6        1  12    superscript  z  12         Q(z)={\rm e}^{z+1/2\,z^{2}}-{\rm e}^{z+1/2\,z^{2}+1/4\,z^{4}}-{\rm e}^{z+1/2\,%
 z^{2}+1/3\,{z}^{3}+1/6\,z^{6}}+{\rm e}^{z+1/2\,z^{2}+1/3\,z^{3}+1/4\,z^{4}+1/6%
 \,z^{6}+1/12\,z^{12}}   with the sequence of values starting at n =Â 7      420  ,  3360  ,  30240  ,  403200  ,  4019400  ,  80166240  ,  965284320  ,  12173441280  ,  162850287600  ,  â€¦     420  3360  30240  403200  4019400  80166240  965284320  12173441280  162850287600  normal-â€¦    420,3360,30240,403200,4019400,80166240,965284320,12173441280,162850287600,\ldots   which is OEIS A061125 .  Number of permutations that are derangements  Suppose there are n people at a party, each of whom brought an umbrella. At the end of the party everyone picks an umbrella out of the stack of umbrellas and leaves. What is the probability that no one left with his/her own umbrella? This problem is equivalent to counting permutations with no fixed points, and hence the EGF (subtract out fixed points by removing z ) g ( x ) is        exp   (    -  z   +    âˆ‘   k  â‰¥  1      z  k   k     )    =    e   -  z     1  -  z     .            z     subscript     k  1       superscript  z  k   k         superscript  e    z      1  z      \exp\left(-z+\sum_{k\geq 1}\frac{z^{k}}{k}\right)=\frac{e^{-z}}{1-z}.     Now multiplication by    1  /   (   1  -  z   )       1    1  z     1/(1-z)   just sums coefficients, so that we have the following formula for    D   (  n  )       D  n    D(n)   , the total number of derangements:        D   (  n  )    =    n  !     âˆ‘   k  =  0   n       (   -  1   )   k    k  !       â‰ˆ    n  !   e    .          D  n       n     superscript   subscript     k  0    n      superscript    1   k     k               n   e      D(n)=n!\sum_{k=0}^{n}\frac{(-1)^{k}}{k!}\;\approx\;\frac{n!}{e}.     Hence there are about     n  !   /  e        n   e    n!/e   derangements and the probability that a random permutation is a derangement is     1  /  e   .      1  e    1/e.     This result may also be proved by inclusion-exclusion . Using the sets    A  p     subscript  A  p    A_{p}   where       1  â‰¤  p  â‰¤  n             1  p       n       \begin{matrix}1\leq p\leq n\end{matrix}   to denote the set of permutations that fix p , we have           n  !   -    (      n      1      )     (   n  -  1   )   !     +    (      n      2      )     (   n  -  2   )   !     -    (      n      3      )     (   n  -  3   )   !     +   â‹¯    Â±    (      n      n      )     (   n  -  n   )   !       plus-or-minus            n      binomial  n  1       n  1         binomial  n  2       n  2         binomial  n  3       n  3      normal-â‹¯      binomial  n  n       n  n       n!\;\;-\;\;{n\choose 1}(n-1)!\;\;+\;\;{n\choose 2}(n-2)!\;\;-\;\;{n\choose 3}(%
 n-3)!\;\;+\;\;\cdots\;\;\pm\;\;{n\choose n}(n-n)!     Hence the number of permutations with no fixed point is        n  !    (       1  -   1   1  !     +   1   2  !     -   1   3  !     +  â‹¯   Â±   1   n  !     )    =    n  !     âˆ‘   k  =  0   n      (   -  1   )   k    k  !              n    plus-or-minus          1    1    1       1    2       1    3     normal-â‹¯     1    n          n     superscript   subscript     k  0    n      superscript    1   k     k        n!\left(1-\frac{1}{1!}+\frac{1}{2!}-\frac{1}{3!}+\cdots\pm\frac{1}{n!}\right)=%
 n!\sum_{k=0}^{n}\frac{(-1)^{k}}{k!}     or      D   (  n  ,  m  )       D   n  m     D(n,m)     and we have the claim.  There is a generalization of these numbers, which is known as rencontres numbers , i.e. the number    [  n  ]     delimited-[]  n    [n]   of permutations of    k  =  1      k  1    k=1   containing m fixed points. The corresponding EGF is obtained by marking cycles of size one with the variable u , i.e. choosing b ( k ) equal to one for    g   (  z  ,  u  )       g   z  u     g(z,u)   and zero otherwise, which yields the generating function      g   (  z  ,  u  )    =   exp   (    -  z   +   u  z   +    âˆ‘   k  â‰¥  1      z  k   k     )    =     e   -  z     1  -  z     e   u  z      .          g   z  u          z     u  z     subscript     k  1       superscript  z  k   k                superscript  e    z      1  z     superscript  e    u  z        g(z,u)=\exp\left(-z+uz+\sum_{k\geq 1}\frac{z^{k}}{k}\right)=\frac{e^{-z}}{1-z}%
 e^{uz}.   of the set of permutations by the number of fixed points:        [   u  m   ]   g   (  z  ,  u  )    =     e   -  z     1  -  z      z  m    m  !            delimited-[]   superscript  u  m    g   z  u         superscript  e    z      1  z       superscript  z  m     m       [u^{m}]g(z,u)=\frac{e^{-z}}{1-z}\frac{z^{m}}{m!}     It follows that        D   (  n  ,  m  )    =    n  !    [   z  n   ]    [   u  m   ]   g   (  z  ,  u  )    =     n  !    m  !     [   z   n  -  m    ]     e   -  z     1  -  z     =     n  !    m  !      âˆ‘   k  =  0    n  -  m       (   -  1   )   k    k  !       .          D   n  m        n    delimited-[]   superscript  z  n     delimited-[]   superscript  u  m    g   z  u               n     m     delimited-[]   superscript  z    n  m        superscript  e    z      1  z                n     m      superscript   subscript     k  0      n  m       superscript    1   k     k         D(n,m)=n![z^{n}][u^{m}]g(z,u)=\frac{n!}{m!}[z^{n-m}]\frac{e^{-z}}{1-z}=\frac{n%
 !}{m!}\sum_{k=0}^{n-m}\frac{(-1)^{k}}{k!}.     and hence       D   (  n  ,  m  )    =    (     n      m     )   D   (   n  -  m   ,  0  )    and     D   (  n  ,  m  )     n  !     â‰ˆ    e   -  1     m  !            D   n  m       binomial  n  m   D     n  m   0   and      D   n  m      n             superscript  e    1      m       D(n,m)={n\choose m}D(n-m,0)\;\;\mbox{ and }\;\;\frac{D(n,m)}{n!}\approx\frac{e%
 ^{-1}}{m!}     This immediately implies that       D  0    (  n  )        subscript  D  0   n    D_{0}(n)     for n large, m fixed.  Derangements containing an even and an odd number of cycles  We can use the same construction as in the previous section to compute the number of derangements     D  1    (  n  )        subscript  D  1   n    D_{1}(n)   containing an even number of cycles and the number      g   (  z  ,  u  )    =   exp   (    -   u  z    +   u   log   1   1  -  z       )    =    exp   (   -   u  z    )      (   1   1  -  z    )   u     .          g   z  u            u  z      u      1    1  z                     u  z      superscript    1    1  z    u       g(z,u)=\exp\left(-uz+u\log\frac{1}{1-z}\right)=\exp(-uz)\left(\frac{1}{1-z}%
 \right)^{u}.   containing an odd number of cycles. To do this we need to mark all cycles and subtract fixed points, giving      q   (  z  )       q  z    q(z)     Now some very basic reasoning shows that the EGF     D  0    (  n  )        subscript  D  0   n    D_{0}(n)   of      q   (  z  )    =      1  2   Ã—  g    (  z  ,   -  1   )    +     1  2   Ã—  g    (  z  ,  1  )     =     1  2    exp   (   -  z   )     1   1  -  z     +    1  2    exp   (  z  )     (   1  -  z   )      .          q  z           1  2   g    z    1           1  2   g    z  1                1  2       z      1    1  z         1  2     z     1  z        q(z)=\frac{1}{2}\times g(z,-1)+\frac{1}{2}\times g(z,1)=\frac{1}{2}\exp(-z)%
 \frac{1}{1-z}+\frac{1}{2}\exp(z)(1-z).   is given by        D  0    (  n  )    =    n  !    [   z  n   ]   q   (  z  )    =      1  2    n  !     âˆ‘   k  =  0   n      (   -  1   )   k    k  !      +    1  2    n  !    1   n  !      -    1  2    n  !    1    (   n  -  1   )   !               subscript  D  0   n       n    delimited-[]   superscript  z  n    q  z                1  2     n     superscript   subscript     k  0    n      superscript    1   k     k          1  2     n     1    n          1  2     n     1      n  1          D_{0}(n)=n![z^{n}]q(z)=\frac{1}{2}n!\sum_{k=0}^{n}\frac{(-1)^{k}}{k!}+\frac{1}%
 {2}n!\frac{1}{n!}-\frac{1}{2}n!\frac{1}{(n-1)!}     We thus have          1  2    n  !     âˆ‘   k  =  0   n      (   -  1   )   k    k  !      +    1  2    (   1  -  n   )     âˆ¼     1   2  e     n  !    +    1  2    (   1  -  n   )      .     similar-to        1  2     n     superscript   subscript     k  0    n      superscript    1   k     k          1  2     1  n           1    2  e      n        1  2     1  n       \frac{1}{2}n!\sum_{k=0}^{n}\frac{(-1)^{k}}{k!}+\frac{1}{2}(1-n)\sim\frac{1}{2e%
 }n!+\frac{1}{2}(1-n).   which is       D  0    (  n  )        subscript  D  0   n    D_{0}(n)     Subtracting    D   (  n  )       D  n    D(n)   from       D  1    (  n  )    =     1  2    n  !     âˆ‘   k  =  0   n      (   -  1   )   k    k  !      -    1  2    (   1  -  n   )      .         subscript  D  1   n         1  2     n     superscript   subscript     k  0    n      superscript    1   k     k          1  2     1  n       D_{1}(n)=\frac{1}{2}n!\sum_{k=0}^{n}\frac{(-1)^{k}}{k!}-\frac{1}{2}(1-n).   , we find       D  0    (  n  )        subscript  D  0   n    D_{0}(n)   The difference of these two (     D  1    (  n  )        subscript  D  1   n    D_{1}(n)   and    n  -  1.      n  1.    n-1.   ) is       (    (      99      49      )    (      100      50      )    )   100   =   1   2  100     ,       superscript     binomial  99  49    binomial  100  50    100     1   superscript  2  100      \left(\frac{{99\choose 49}}{{100\choose 50}}\right)^{100}=\frac{1}{2^{100}},     One hundred prisoners  A prison warden wants to make room in his prison and is considering liberating one hundred prisoners, thereby freeing one hundred cells. He therefore assembles one hundred prisoners and asks them to play the following game: he lines up one hundred urns in a row, each containing the name of one prisoner, where every prisoner's name occurs exactly once. The game is played as follows: every prisoner is allowed to look inside fifty urns. If he or she does not find his or her name in one of the fifty urns, all prisoners will immediately be executed, otherwise the game continues. The prisoners have a few moments to decide on a strategy, knowing that once the game has begun, they will not be able to communicate with each other, mark the urns in any way or move the urns or the names inside them. Choosing urns at random, their chances of survival are almost zero, but there is a strategy giving them a 30% chance of survival, assuming that the names are assigned to urns randomly â€“ what is it?  First of all, the survival probability using random choices is      2  n      2  n    2n   so this is definitely not a practical strategy.  The 30% survival strategy is to consider the contents of the urns to be a permutation of the prisoners, and traverse cycles. To keep the notation simple, assign a number to each prisoner, for example by sorting their names alphabetically. The urns may thereafter be considered to contain numbers rather than names. Now clearly the contents of the urns define a permutation. The first prisoner opens the first urn. If he finds his name, he has finished and survives. Otherwise he opens the urn with the number he found in the first urn. The process repeats: the prisoner opens an urn and survives if he finds his name, otherwise he opens the urn with the number just retrieved, up to a limit of fifty urns. The second prisoner starts with urn number two, the third with urn number three, and so on. This strategy is precisely equivalent to a traversal of the cycles of the permutation represented by the urns. Every prisoner starts with the urn bearing his number and keeps on traversing his cycle up to a limit of fifty urns. The number of the urn that contains his number is the pre-image of that number under the permutation. Hence the prisoners survive if all cycles of the permutation contain at most fifty elements. We have to show that this probability is at least 30%.  Note that this assumes that the warden chooses the permutation randomly; if the warden anticipates this strategy, he can simply choose a permutation with a cycle of length 51. To overcome this, the prisoners may agree in advance on a random permutation of their names.  We consider the general case of   n   n   n   prisoners and   n   n   n   urns being opened. We first calculate the complementary probability, i.e. that there is a cycle of more than     g   (  z  ,  u  )    =   exp   (   z  +    z  2   2   +    z  3   3   +  â‹¯  +   u    z   n  +  1     n  +  1     +   u    z   n  +  2     n  +  2     +  â‹¯   )          g   z  u        z     superscript  z  2   2      superscript  z  3   3   normal-â‹¯    u     superscript  z    n  1      n  1       u     superscript  z    n  2      n  2     normal-â‹¯      g(z,u)=\exp\left(z+\frac{z^{2}}{2}+\frac{z^{3}}{3}+\cdots+u\frac{z^{n+1}}{n+1}%
 +u\frac{z^{n+2}}{n+2}+\cdots\right)   elements. With this in mind, we introduce        1   1  -  z     exp   (    (   u  -  1   )    (     z   n  +  1     n  +  1    +    z   n  +  2     n  +  2    +  â‹¯   )    )     ,        1    1  z          u  1        superscript  z    n  1      n  1       superscript  z    n  2      n  2    normal-â‹¯       \frac{1}{1-z}\exp\left((u-1)\left(\frac{z^{n+1}}{n+1}+\frac{z^{n+2}}{n+2}+%
 \cdots\right)\right),   or        [   z   2  n    ]    [  u  ]   g   (  z  ,  u  )    ,       delimited-[]   superscript  z    2  n      delimited-[]  u   g   z  u     [z^{2n}][u]g(z,u),\,   so that the desired probability is     n   n   n   because the cycle of more than     2   (   n  +  1   )    >   2  n         2    n  1      2  n     2(n+1)>2n   elements will necessarily be unique. Using the fact that       [   z   2  n    ]    [  u  ]   g   (  z  ,  u  )    =    [   z   2  n    ]    [  u  ]    1   1  -  z     (   1  +    (   u  -  1   )    (     z   n  +  1     n  +  1    +    z   n  +  2     n  +  2    +  â‹¯   )     )     ,         delimited-[]   superscript  z    2  n      delimited-[]  u   g   z  u       delimited-[]   superscript  z    2  n      delimited-[]  u     1    1  z      1      u  1        superscript  z    n  1      n  1       superscript  z    n  2      n  2    normal-â‹¯        [z^{2n}][u]g(z,u)=[z^{2n}][u]\frac{1}{1-z}\left(1+(u-1)\left(\frac{z^{n+1}}{n+%
 1}+\frac{z^{n+2}}{n+2}+\cdots\right)\right),   , we find that         [   z   2  n    ]    [  u  ]   g   (  z  ,  u  )    =    [   z   2  n    ]    1   1  -  z     (     z   n  +  1     n  +  1    +    z   n  +  2     n  +  2    +  â‹¯   )    =    âˆ‘   k  =   n  +  1     2  n     1  k    =    H   2  n    -   H  n     .           delimited-[]   superscript  z    2  n      delimited-[]  u   g   z  u       delimited-[]   superscript  z    2  n       1    1  z         superscript  z    n  1      n  1       superscript  z    n  2      n  2    normal-â‹¯           superscript   subscript     k    n  1       2  n      1  k            subscript  H    2  n     subscript  H  n       [z^{2n}][u]g(z,u)=[z^{2n}]\frac{1}{1-z}\left(\frac{z^{n+1}}{n+1}+\frac{z^{n+2}%
 }{n+2}+\cdots\right)=\sum_{k=n+1}^{2n}\frac{1}{k}=H_{2n}-H_{n}.   which yields         H   2  n    -   H  n    âˆ¼         log  2   -   1   4  n     +   1   16   n  2      -   1   128   n  4      +   1   256   n  6      -   17   4096   n  8      +  â‹¯    ,     similar-to     subscript  H    2  n     subscript  H  n                  2     1    4  n       1    16   superscript  n  2        1    128   superscript  n  4        1    256   superscript  n  6        17    4096   superscript  n  8      normal-â‹¯     H_{2n}-H_{n}\sim\log 2-\frac{1}{4n}+\frac{1}{16n^{2}}-\frac{1}{128n^{4}}+\frac%
 {1}{256n^{6}}-\frac{17}{4096n^{8}}+\cdots,     Finally, using an integral estimate such as Eulerâ€“MacLaurin summation , or the asymptotic expansion of the n th harmonic number , we obtain          [   z   2  n    ]    [  u  ]   g   (  z  ,  u  )    <    log  2   and      1  -    [   z   2  n    ]    [  u  ]   g   (  z  ,  u  )     >   1  -   log  2    =  0.30685281    ,     formulae-sequence       delimited-[]   superscript  z    2  n      delimited-[]  u   g   z  u       2   and          1     delimited-[]   superscript  z    2  n      delimited-[]  u   g   z  u       1    2         0.30685281      [z^{2n}][u]g(z,u)<\log 2\quad\mbox{and}\quad 1-[z^{2n}][u]g(z,u)>1-\log 2=0.30%
 685281,   so that      2  n      2  n    2n   or at least 30%, as claimed.  A related result is that asymptotically, the expected length of the longest cycle is Î»n, where Î» is the Golombâ€“Dickman constant , approximately 0.62.  This example is due to Anna GÃ¡l and Peter Bro Miltersen; consult the paper by Peter Winkler for more information, and see the discussion on Les-Mathematiques.net . Consult the references on 100 prisoners for links to these references.  The above computation may be performed in a more simple and direct way, as follows: first note that a permutation of   n   n   n   elements contains at most one cycle of length strictly greater than      p  k   =   Pr   [   there is a cycle of length  k   ]     ,       subscript  p  k    Pr    there is a cycle of length  k      p_{k}=\Pr[\mbox{there is a cycle of length }k],   . Thus, if we denote        Pr   [   there is a cycle of length  >  n   ]    =    âˆ‘   k  =   n  +  1     2  n     p  k     .       Pr    there is a cycle of length  n      superscript   subscript     k    n  1       2  n     subscript  p  k      \Pr[\mbox{there is a cycle of length}>n]=\sum_{k=n+1}^{2n}p_{k}.   then      k  >  n      k  n    k>n     For   k   k   k   , the number of permutations that contain a cycle of length exactly      (      2  n       k     )   â‹…    k  !   k   â‹…    (    2  n   -  k   )   !    .     normal-â‹…   binomial    2  n   k       k   k         2  n   k      {{2n}\choose k}\cdot\frac{k!}{k}\cdot(2n-k)!.   is      (       2  n       k      )     binomial    2  n   k    {{2n}\choose k}   Explanation:   k   k   k   is the number of ways of choosing the     k  !   k        k   k    \frac{k!}{k}   elements that comprise the cycle;   k   k   k   is the number of ways of arranging     (    2  n   -  k   )   !          2  n   k     (2n-k)!   items in a cycle; and      p  k   =     (       2  n       k      )   â‹…    k  !   k   â‹…    (    2  n   -  k   )   !      (   2  n   )   !    =   1  k    .         subscript  p  k      normal-â‹…   binomial    2  n   k       k   k         2  n   k         2  n            1  k      p_{k}=\frac{{{2n}\choose k}\cdot\frac{k!}{k}\cdot(2n-k)!}{(2n)!}=\frac{1}{k}.   is the number of ways to permute the remaining elements. Thus,        Pr   [   there is a cycle of length  >  n   ]    =    âˆ‘   k  =   n  +  1     2  n     1  k    =    H   2  n    -   H  n     .         Pr    there is a cycle of length  n      superscript   subscript     k    n  1       2  n      1  k            subscript  H    2  n     subscript  H  n       \Pr[\mbox{there is a cycle of length}>n]=\sum_{k=n+1}^{2n}\frac{1}{k}=H_{2n}-H%
 _{n}.     We conclude that     ð’¬   ð’¬   \mathcal{Q}     A variation on the 100 prisoners problem (keys and boxes)  There is a closely related problem that fits the method presented here quite nicely. Say you have n ordered boxes. Every box contains a key to some other box or possibly itself giving a permutation of the keys. You are allowed to select k of these n boxes all at once and break them open simultaneously, gaining access to k keys. What is the probability that using these keys you can open all n boxes, where you use a found key to open the box it belongs to and repeat.  The mathematical statement of this problem is as follows: pick a random permutation on n elements and k values from the range 1 to n , also at random, call these marks. What is the probability that there is at least one mark on every cycle of the permutation? The claim is this probability is k/n .  The species     ð’¬  =   ð”“   (    âˆ‘   q  â‰¥  1       â„­    =  q     (  ð’µ  )    Ã—    âˆ‘   p  =  1   q     (     q      p     )    ð’°  p       )     .      ð’¬    ð”“    subscript     q  1         subscript  â„­    absent  q    ð’µ     superscript   subscript     p  1    q      binomial  q  p    superscript  ð’°  p          \mathcal{Q}=\mathfrak{P}\left(\sum_{q\geq 1}\mathfrak{C}_{=q}(\mathcal{Z})%
 \times\sum_{p=1}^{q}{q\choose p}\mathcal{U}^{p}\right).   of permutations by cycles with some non-empty subset of every cycle being marked has the specification        G   (  z  ,  u  )    =   exp   (    âˆ‘   q  â‰¥  1       z  q   q     âˆ‘   p  =  1   q     (     q      p     )    u  p       )     .        G   z  u        subscript     q  1         superscript  z  q   q     superscript   subscript     p  1    q      binomial  q  p    superscript  u  p          G(z,u)=\exp\left(\sum_{q\geq 1}\frac{z^{q}}{q}\sum_{p=1}^{q}{q\choose p}u^{p}%
 \right).     The index in the inner sum starts at one because we must have at least one mark on every cycle.  Translating the specification to generating functions we obtain the bivariate generating function      exp   (     âˆ‘   q  â‰¥  1       z  q   q     (   u  +  1   )   q     -    âˆ‘   q  â‰¥  1      z  q   q     )           subscript     q  1         superscript  z  q   q    superscript    u  1   q       subscript     q  1       superscript  z  q   q       \exp\left(\sum_{q\geq 1}\frac{z^{q}}{q}(u+1)^{q}-\sum_{q\geq 1}\frac{z^{q}}{q}\right)     This simplifies to        exp   (    log   1   1  -    (   u  +  1   )   z      -   log   1   1  -  z      )    =    1  -  z    1  -    (   u  +  1   )   z      .              1    1      u  1   z          1    1  z           1  z     1      u  1   z       \exp\left(\log\frac{1}{1-(u+1)z}-\log\frac{1}{1-z}\right)=\frac{1-z}{1-(u+1)z}.   or        (   1  -  z   )     âˆ‘   q  â‰¥  0       (   u  +  1   )   q    z  q      .        1  z     subscript     q  0       superscript    u  1   q    superscript  z  q       (1-z)\sum_{q\geq 0}(u+1)^{q}z^{q}.   In order to extract coefficients from this re-write like so        [   z  n   ]   G   (  z  ,  u  )    =     (   u  +  1   )   n   -    (   u  +  1   )    n  -  1            delimited-[]   superscript  z  n    G   z  u       superscript    u  1   n    superscript    u  1     n  1       [z^{n}]G(z,u)=(u+1)^{n}-(u+1)^{n-1}   It now follows that         [   u  k   ]    [   z  n   ]   G   (  z  ,  u  )    =    (     n      k     )   -   (      n  -  1       k     )     .         delimited-[]   superscript  u  k     delimited-[]   superscript  z  n    G   z  u       binomial  n  k    binomial    n  1   k      [u^{k}][z^{n}]G(z,u)={n\choose k}-{n-1\choose k}.   and hence      (      n      k      )     binomial  n  k    {n\choose k}     Divide by      1  -      (   n  -  1   )   !     k  !     (   n  -  1  -  k   )   !        k  !     (   n  -  k   )   !     n  !      =   1  -    n  -  k   n    =   k  n    .          1          n  1        k       n  1  k            k       n  k       n        1      n  k   n           k  n      1-\frac{(n-1)!}{k!(n-1-k)!}\frac{k!(n-k)!}{n!}=1-\frac{n-k}{n}=\frac{k}{n}.   to obtain      G   (  z  ,  u  )       G   z  u     G(z,u)   We do not need to divide by n! because    G  =   S  m       G   subscript  S  m     G=S_{m}   is exponential in z .  Number of permutations containing m cycles  Applying the Flajoletâ€“Sedgewick fundamental theorem , i.e. the labelled enumeration theorem with     ð”“  m    (   â„­   (  ð’µ  )    )        subscript  ð”“  m     â„­  ð’µ     \mathfrak{P}_{m}(\mathfrak{C}(\mathcal{Z}))   , to the set         g  m    (  z  )    =    1   |   S  m   |      (   log   1   1  -  z     )   m    =    1   m  !      (   log   1   1  -  z     )   m     .           subscript  g  m   z       1     subscript  S  m      superscript      1    1  z     m             1    m     superscript      1    1  z     m       g_{m}(z)=\frac{1}{|S_{m}|}\left(\log\frac{1}{1-z}\right)^{m}=\frac{1}{m!}\left%
 (\log\frac{1}{1-z}\right)^{m}.     we obtain the generating function         (   -  1   )    n  +  m     n  !    [   z  n   ]    g  m    (  z  )    =   s   (  n  ,  m  )           superscript    1     n  m      n    delimited-[]   superscript  z  n     subscript  g  m   z     s   n  m      (-1)^{n+m}n!\;[z^{n}]g_{m}(z)=s(n,m)     The term       g  m    (  z  )        subscript  g  m   z    g_{m}(z)     yields the signed Stirling numbers of the first kind , and       n  !    [   z  n   ]    g  m    (  z  )    =   [     n      m     ]    .          n    delimited-[]   superscript  z  n     subscript  g  m   z    delimited-[]    n    m       n![z^{n}]g_{m}(z)=\left[\begin{matrix}n\\
 m\end{matrix}\right].   is the EGF of the unsigned Stirling numbers of the first kind, i.e.         s  n    (  w  )    =    âˆ‘   m  =  0   n    s   (  n  ,  m  )    w  m      .         subscript  s  n   w     superscript   subscript     m  0    n     s   n  m    superscript  w  m       s_{n}(w)=\sum_{m=0}^{n}s(n,m)w^{m}.     We can compute the OGF of the signed Stirling numbers for n fixed, i.e.        g  m    (  z  )    =    âˆ‘   n  â‰¥  m        (   -  1   )    n  +  m     n  !    s   (  n  ,  m  )    z  n            subscript  g  m   z     subscript     n  m         superscript    1     n  m      n    s   n  m    superscript  z  n       g_{m}(z)=\sum_{n\geq m}\frac{(-1)^{n+m}}{n!}s(n,m)z^{n}     Start with          (   -  1   )   m    g  m    (  z  )    w  m    =    âˆ‘   n  â‰¥  m        (   -  1   )   n    n  !    s   (  n  ,  m  )    w  m    z  n      .         superscript    1   m    subscript  g  m   z   superscript  w  m      subscript     n  m         superscript    1   n     n    s   n  m    superscript  w  m    superscript  z  n       (-1)^{m}g_{m}(z)w^{m}=\sum_{n\geq m}\frac{(-1)^{n}}{n!}s(n,m)w^{m}z^{n}.     which yields         âˆ‘   m  â‰¥  0       (   -  1   )   m    g  m    (  z  )    w  m     =    âˆ‘   m  â‰¥  0      âˆ‘   n  â‰¥  m        (   -  1   )   n    n  !    s   (  n  ,  m  )    w  m    z  n      =    âˆ‘   n  â‰¥  0        (   -  1   )   n    n  !     z  n     âˆ‘   m  =  0   n    s   (  n  ,  m  )    w  m        .          subscript     m  0       superscript    1   m    subscript  g  m   z   superscript  w  m       subscript     m  0      subscript     n  m         superscript    1   n     n    s   n  m    superscript  w  m    superscript  z  n             subscript     n  0         superscript    1   n     n     superscript  z  n     superscript   subscript     m  0    n     s   n  m    superscript  w  m          \sum_{m\geq 0}(-1)^{m}g_{m}(z)w^{m}=\sum_{m\geq 0}\sum_{n\geq m}\frac{(-1)^{n}%
 }{n!}s(n,m)w^{m}z^{n}=\sum_{n\geq 0}\frac{(-1)^{n}}{n!}z^{n}\sum_{m=0}^{n}s(n,%
 m)w^{m}.     Summing this, we obtain       g  m    (  z  )        subscript  g  m   z    g_{m}(z)     Using the formula involving the logarithm for     s  n    (  w  )        subscript  s  n   w    s_{n}(w)   on the left, the definition of       (   1  -  z   )   w   =    âˆ‘   n  â‰¥  0      (     w      n     )     (   -  1   )   n    z  n     =    âˆ‘   n  â‰¥  0        (   -  1   )   n    n  !     s  n    (  w  )    z  n      .         superscript    1  z   w     subscript     n  0       binomial  w  n    superscript    1   n    superscript  z  n            subscript     n  0         superscript    1   n     n     subscript  s  n   w   superscript  z  n        (1-z)^{w}=\sum_{n\geq 0}{w\choose n}(-1)^{n}z^{n}=\sum_{n\geq 0}\frac{(-1)^{n}%
 }{n!}s_{n}(w)z^{n}.   on the right, and the binomial theorem , we obtain      z  n     superscript  z  n    z^{n}     Comparing the coefficients of       s  n    (  w  )    =    w    (   w  -  1   )    (   w  -  2   )    â‹¯    (   w  -   (   n  -  1   )    )    =    (  w  )   n    ,           subscript  s  n   w     w    w  1     w  2   normal-â‹¯    w    n  1           subscript  w  n      s_{n}(w)=w\;(w-1)\;(w-2)\;\cdots\;(w-(n-1))=(w)_{n},   , and using the definition of the binomial coefficient , we finally have          âˆ‚   âˆ‚  u    g   (  z  ,  u  )    |    u  =  1    =    1   1  -  z      âˆ‘   k  â‰¥  1     b   (  k  )     z  k   k      =    1   1  -  z      z  m   m           evaluated-at         u    g   z  u      u  1        1    1  z      subscript     k  1      b  k     superscript  z  k   k               1    1  z       superscript  z  m   m       \frac{\partial}{\partial u}g(z,u)\Bigg|_{u=1}=\frac{1}{1-z}\sum_{k\geq 1}b(k)%
 \frac{z^{k}}{k}=\frac{1}{1-z}\frac{z^{m}}{m}     a falling factorial . The computation of the OGF of the unsigned Stirling numbers of the first kind works in a similar way.  Expected number of cycles of a given size m  In this problem we use a bivariate generating function g ( z , u ) as described in the introduction. The value of b for a cycle not of size m is zero, and one for a cycle of size m . We have        1  m     z  m     +    1  m     z   m  +  1      +    1  m     z   m  +  2      +  â‹¯          1  m    superscript  z  m        1  m    superscript  z    m  1         1  m    superscript  z    m  2     normal-â‹¯    \frac{1}{m}z^{m}\;+\;\frac{1}{m}z^{m+1}\;+\;\frac{1}{m}z^{m+2}\;+\;\cdots     or        1   1  -  z      âˆ‘   k  =  1   m      z  k   k   and   [   z  n   ]    1   1  -  z      âˆ‘   k  =  1   m     z  k   k       =    H  m   for  n   â‰¥  m            1    1  z      superscript   subscript     k  1    m        superscript  z  k   k   and   delimited-[]   superscript  z  n      1    1  z      superscript   subscript     k  1    m      superscript  z  k   k          subscript  H  m   for  n        m     \frac{1}{1-z}\sum_{k=1}^{m}\frac{z^{k}}{k}\mbox{ and }[z^{n}]\frac{1}{1-z}\sum%
 _{k=1}^{m}\frac{z^{k}}{k}=H_{m}\mbox{ for }n\geq m     This means that the expected number of cycles of size m in a permutation of length n less than m is zero (obviously). A random permutation of length at least m contains on average 1/ m cycles of length m . In particular, a random permutation contains about one fixed point.  The OGF of the expected number of cycles of length less than or equal to m is therefore      g   (  z  ,  u  )       g   z  u     g(z,u)     where H m is the m th harmonic number . Hence the expected number of cycles of length at most m in a random permutation is about ln m .  Moments of fixed points  The mixed GF      g   (  z  ,  u  )    =   exp   (    -  z   +   u  z   +   log   1   1  -  z      )    =    1   1  -  z     exp   (    -  z   +   u  z    )      .          g   z  u          z     u  z       1    1  z                1    1  z          z     u  z         g(z,u)=\exp\left(-z+uz+\log\frac{1}{1-z}\right)=\frac{1}{1-z}\exp(-z+uz).   of the set of permutations by the number of fixed points is        E   (   X  m   )    =   E   (    âˆ‘   k  =  0   m     {     m      k     }     (  X  )   k     )    =    âˆ‘   k  =  0   m     {     m      k     }   E   (    (  X  )   k   )      ,          E   superscript  X  m      E    superscript   subscript     k  0    m        m    k      subscript  X  k             superscript   subscript     k  0    m        m    k     E   subscript  X  k        E(X^{m})=E\left(\sum_{k=0}^{m}\left\{\begin{matrix}m\\
 k\end{matrix}\right\}(X)_{k}\right)=\sum_{k=0}^{m}\left\{\begin{matrix}m\\
 k\end{matrix}\right\}E((X)_{k}),     Let the random variable X be the number of fixed points of a random permutation. Using Stirling numbers of the second kind , we have the following formula for the m th moment of X :       (  X  )   k     subscript  X  k    (X)_{k}     where    g   (  z  ,  u  )       g   z  u     g(z,u)   is a falling factorial . Using      E   (    (  X  )   k   )    =      [   z  n   ]     (   d   d  u    )   k   g   (  z  ,  u  )    |    u  =  1    =      [   z  n   ]     z  k    1  -  z     exp   (    -  z   +   u  z    )     |    u  =  1    =    [   z  n   ]     z  k    1  -  z      ,          E   subscript  X  k     evaluated-at     delimited-[]   superscript  z  n     superscript    d    d  u    k   g   z  u      u  1          evaluated-at     delimited-[]   superscript  z  n       superscript  z  k     1  z          z     u  z        u  1            delimited-[]   superscript  z  n       superscript  z  k     1  z        E((X)_{k})=[z^{n}]\left(\frac{d}{du}\right)^{k}g(z,u)\Bigg|_{u=1}=[z^{n}]\frac%
 {z^{k}}{1-z}\exp(-z+uz)\Bigg|_{u=1}=[z^{n}]\frac{z^{k}}{1-z},   , we have      k  >  n      k  n    k>n     which is zero when    k  â‰¤  n      k  n    k<=n   , and one otherwise. Hence only terms with      E   (   X  m   )    =    âˆ‘   k  =  0   n    {     m      k     }     .        E   superscript  X  m      superscript   subscript     k  0    n      m    k        E(X^{m})=\sum_{k=0}^{n}\left\{\begin{matrix}m\\
 k\end{matrix}\right\}.   contribute to the sum. This yields     Ïƒ   Ïƒ   \sigma     Expected number of fixed points in random permutation raised to some power k  Suppose you pick a random permutation   k   k   k   and raise it to some power   k   k   k   , with    E   [   F  k   ]       E   delimited-[]   subscript  F  k      E[F_{k}]   a positive integer and ask about the expected number of fixed points in the result. Denote this value by   d   d   d   .  For every divisor   k   k   k   of   d   d   d   a cycle of length   d   d   d   splits into    k  .    k   k.   fixed points when raised to the power     u  d   .     superscript  u  d    u^{d}.   Hence we need to mark these cycles with     E   [   F  6   ]    .      E   delimited-[]   subscript  F  6      E[F_{6}].   To illustrate this consider     g   (  z  ,  u  )    =   exp   (           u  z   -  z   +    u  2     z  2   2     -    z  2   2    +    u  3     z  3   3     -    z  3   3    +    u  6     z  6   6     -    z  6   6    +   log   1   1  -  z      )          g   z  u                        u  z   z      superscript  u  2      superscript  z  2   2        superscript  z  2   2       superscript  u  3      superscript  z  3   3        superscript  z  3   3       superscript  u  6      superscript  z  6   6        superscript  z  6   6        1    1  z         g(z,u)=\exp\left(uz-z+u^{2}\frac{z^{2}}{2}-\frac{z^{2}}{2}+u^{3}\frac{z^{3}}{3%
 }-\frac{z^{3}}{3}+u^{6}\frac{z^{6}}{6}-\frac{z^{6}}{6}+\log\frac{1}{1-z}\right)     We get        1   1  -  z     exp   (          u  z   -  z   +    u  2     z  2   2     -    z  2   2    +    u  3     z  3   3     -    z  3   3    +    u  6     z  6   6     -    z  6   6    )     .        1    1  z                      u  z   z      superscript  u  2      superscript  z  2   2        superscript  z  2   2       superscript  u  3      superscript  z  3   3        superscript  z  3   3       superscript  u  6      superscript  z  6   6        superscript  z  6   6       \frac{1}{1-z}\exp\left(uz-z+u^{2}\frac{z^{2}}{2}-\frac{z^{2}}{2}+u^{3}\frac{z^%
 {3}}{3}-\frac{z^{3}}{3}+u^{6}\frac{z^{6}}{6}-\frac{z^{6}}{6}\right).     which is          âˆ‚   âˆ‚  u    g   (  z  ,  u  )    |    u  =  1    =       z  +   z  2   +   z  3   +   z  6     1  -  z     exp   (          u  z   -  z   +    u  2     z  2   2     -    z  2   2    +    u  3     z  3   3     -    z  3   3    +    u  6     z  6   6     -    z  6   6    )     |    u  =  1         evaluated-at         u    g   z  u      u  1     evaluated-at        z   superscript  z  2    superscript  z  3    superscript  z  6      1  z                      u  z   z      superscript  u  2      superscript  z  2   2        superscript  z  2   2       superscript  u  3      superscript  z  3   3        superscript  z  3   3       superscript  u  6      superscript  z  6   6        superscript  z  6   6        u  1      \left.\frac{\partial}{\partial u}g(z,u)\right|_{u=1}=\left.\frac{z+z^{2}+z^{3}%
 +z^{6}}{1-z}\exp\left(uz-z+u^{2}\frac{z^{2}}{2}-\frac{z^{2}}{2}+u^{3}\frac{z^{%
 3}}{3}-\frac{z^{3}}{3}+u^{6}\frac{z^{6}}{6}-\frac{z^{6}}{6}\right)\right|_{u=1}     Once more continuing as described in the introduction, we find        z  +   z  2   +   z  3   +   z  6     1  -  z    .        z   superscript  z  2    superscript  z  3    superscript  z  6      1  z     \frac{z+z^{2}+z^{3}+z^{6}}{1-z}.     which is       E   [   F  6   ]    =  4        E   delimited-[]   subscript  F  6     4    E[F_{6}]=4   The conclusion is that    n  â‰¥  6      n  6    n\geq 6   for      g   (  z  ,  u  )    =   exp   (     âˆ‘   d  âˆ£  k     (     u  d     z  d   d    -    z  d   d    )    +   log   1   1  -  z      )    =    1   1  -  z     exp   (    âˆ‘   d  âˆ£  k     (     u  d     z  d   d    -    z  d   d    )    )      .          g   z  u          subscript    fragments  d  normal-âˆ£  k         superscript  u  d      superscript  z  d   d       superscript  z  d   d         1    1  z                1    1  z        subscript    fragments  d  normal-âˆ£  k         superscript  u  d      superscript  z  d   d       superscript  z  d   d          g(z,u)=\exp\left(\sum_{d\mid k}\left(u^{d}\frac{z^{d}}{d}-\frac{z^{d}}{d}%
 \right)+\log\frac{1}{1-z}\right)=\frac{1}{1-z}\exp\left(\sum_{d\mid k}\left(u^%
 {d}\frac{z^{d}}{d}-\frac{z^{d}}{d}\right)\right).   and there are four fixed points on average.  The general procedure is           âˆ‚   âˆ‚  u    g   (  z  ,  u  )    |    u  =  1    =        âˆ‘   d  âˆ£  k     z  d     1  -  z     exp   (    âˆ‘   d  âˆ£  k     (     u  d     z  d   d    -    z  d   d    )    )     |    u  =  1    =     âˆ‘   d  âˆ£  k     z  d     1  -  z     .         evaluated-at         u    g   z  u      u  1     evaluated-at        subscript    fragments  d  normal-âˆ£  k     superscript  z  d      1  z        subscript    fragments  d  normal-âˆ£  k         superscript  u  d      superscript  z  d   d       superscript  z  d   d         u  1             subscript    fragments  d  normal-âˆ£  k     superscript  z  d      1  z       \left.\frac{\partial}{\partial u}g(z,u)\right|_{u=1}=\left.\frac{\sum_{d\mid k%
 }z^{d}}{1-z}\exp\left(\sum_{d\mid k}\left(u^{d}\frac{z^{d}}{d}-\frac{z^{d}}{d}%
 \right)\right)\right|_{u=1}=\frac{\sum_{d\mid k}z^{d}}{1-z}.   Once more continuing as before, we find      E   [   F  k   ]       E   delimited-[]   subscript  F  k      E[F_{k}]   We have shown that the value of    Ï„   (  k  )       Ï„  k    \tau(k)   is equal to   k   k   k   (the number of divisors of     n  â‰¥  k   .      n  k    n\geq k.   ) as soon as   1   1   1   It starts out at    n  =  1      n  1    n=1   for   n   n   n   and increases by one every time   k   k   k   hits a divisor of   k   k   k   up to and including    g   (  z  ,  u  )       g   z  u     g(z,u)   itself.  Expected number of cycles of any length of a random permutation  We construct the bivariate generating function    b   (  k  )       b  k    b(k)   using    b   (  k  )       b  k    b(k)   , where    g   (  z  ,  u  )       g   z  u     g(z,u)   is one for all cycles (every cycle contributes one to the total number of cycles).  Note that     g   (  z  ,  u  )    =    (   1   1  -  z    )   u         g   z  u     superscript    1    1  z    u     g(z,u)=\left(\frac{1}{1-z}\right)^{u}   has the closed form           âˆ‚   âˆ‚  u    g   (  z  ,  u  )    |    u  =  1    =    1   1  -  z      âˆ‘   k  â‰¥  1     b   (  k  )     z  k   k      =    1   1  -  z      âˆ‘   k  â‰¥  1      z  k   k     =    1   1  -  z     log   1   1  -  z       .         evaluated-at         u    g   z  u      u  1        1    1  z      subscript     k  1      b  k     superscript  z  k   k               1    1  z      subscript     k  1       superscript  z  k   k              1    1  z        1    1  z         \frac{\partial}{\partial u}g(z,u)\Bigg|_{u=1}=\frac{1}{1-z}\sum_{k\geq 1}b(k)%
 \frac{z^{k}}{k}=\frac{1}{1-z}\sum_{k\geq 1}\frac{z^{k}}{k}=\frac{1}{1-z}\log%
 \frac{1}{1-z}.     and generates the unsigned Stirling numbers of the first kind .  We have      H  n     subscript  H  n    H_{n}     Hence the expected number of cycles is    log  n      n    \log n   , or about    g   (  z  ,  u  )       g   z  u     g(z,u)   .  Number of permutations with a cycle of length larger than n /2  (Note that Section One hundred prisoners contains exactly the same problem with a very similar calculation, plus also a simpler elementary proof.)  Once more, start with the exponential generating function   ð’«   ð’«   \mathcal{P}   , this time of the class    n  /  2      n  2    n/2   of permutations according to size where cycles of length more than   u   u   u   are marked with the variable      g   (  z  ,  u  )    =   exp   (    u    âˆ‘   k  >   âŒŠ   n  2   âŒ‹    âˆž     z  k   k     +    âˆ‘   k  =  1    âŒŠ   n  2   âŒ‹      z  k   k     )     .        g   z  u          u    superscript   subscript     k      n  2           superscript  z  k   k       superscript   subscript     k  1        n  2        superscript  z  k   k        g(z,u)=\exp\left(u\sum_{k>\lfloor\frac{n}{2}\rfloor}^{\infty}\frac{z^{k}}{k}+%
 \sum_{k=1}^{\lfloor\frac{n}{2}\rfloor}\frac{z^{k}}{k}\right).   :      n  2      n  2    \frac{n}{2}     There can only be one cycle of length more than      n  !    [   u   z  n    ]   g   (  z  ,  u  )    =    n  !    [   z  n   ]    exp   (    âˆ‘   k  =  1    âŒŠ   n  2   âŒ‹      z  k   k    )      âˆ‘   k  >   âŒŠ   n  2   âŒ‹    âˆž     z  k   k             n    delimited-[]    u   superscript  z  n     g   z  u        n    delimited-[]   superscript  z  n        superscript   subscript     k  1        n  2        superscript  z  k   k       superscript   subscript     k      n  2           superscript  z  k   k       n![uz^{n}]g(z,u)=n![z^{n}]\exp\left(\sum_{k=1}^{\lfloor\frac{n}{2}\rfloor}%
 \frac{z^{k}}{k}\right)\sum_{k>\lfloor\frac{n}{2}\rfloor}^{\infty}\frac{z^{k}}{k}   , hence the answer to the question is given by       n  !    [   z  n   ]    exp   (    log   1   1  -  z     -    âˆ‘   k  >   âŒŠ   n  2   âŒ‹    âˆž     z  k   k     )      âˆ‘   k  >   âŒŠ   n  2   âŒ‹    âˆž     z  k   k          n    delimited-[]   superscript  z  n            1    1  z       superscript   subscript     k      n  2           superscript  z  k   k        superscript   subscript     k      n  2           superscript  z  k   k      n![z^{n}]\exp\left(\log\frac{1}{1-z}-\sum_{k>\lfloor\frac{n}{2}\rfloor}^{%
 \infty}\frac{z^{k}}{k}\right)\sum_{k>\lfloor\frac{n}{2}\rfloor}^{\infty}\frac{%
 z^{k}}{k}   or        n  !    [   z  n   ]    1   1  -  z     exp   (   -    âˆ‘   k  >   âŒŠ   n  2   âŒ‹    âˆž     z  k   k     )      âˆ‘   k  >   âŒŠ   n  2   âŒ‹    âˆž     z  k   k     =    n  !    [   z  n   ]    1   1  -  z      âˆ‘   m  =  0   âˆž       (   -  1   )   m    m  !      (    âˆ‘   k  >   âŒŠ   n  2   âŒ‹    âˆž     z  k   k    )    m  +  1               n    delimited-[]   superscript  z  n      1    1  z          superscript   subscript     k      n  2           superscript  z  k   k        superscript   subscript     k      n  2           superscript  z  k   k         n    delimited-[]   superscript  z  n      1    1  z      superscript   subscript     m  0           superscript    1   m     m     superscript    superscript   subscript     k      n  2           superscript  z  k   k      m  1         n![z^{n}]\frac{1}{1-z}\exp\left(-\sum_{k>\lfloor\frac{n}{2}\rfloor}^{\infty}%
 \frac{z^{k}}{k}\right)\sum_{k>\lfloor\frac{n}{2}\rfloor}^{\infty}\frac{z^{k}}{%
 k}=n![z^{n}]\frac{1}{1-z}\sum_{m=0}^{\infty}\frac{(-1)^{m}}{m!}\left(\sum_{k>%
 \lfloor\frac{n}{2}\rfloor}^{\infty}\frac{z^{k}}{k}\right)^{m+1}   which is     z   z   z     The exponent of    m  +  1      m  1    m+1   in the term being raised to the power    âŒŠ   n  2   âŒ‹        n  2     \lfloor\frac{n}{2}\rfloor   is larger than    m  >  0      m  0    m>0   and hence no value for     [   z  n   ]   .     delimited-[]   superscript  z  n     [z^{n}].   can possibly contribute to       n  !    [   z  n   ]    1   1  -  z      âˆ‘   k  >   âŒŠ   n  2   âŒ‹    âˆž     z  k   k     =    n  !     âˆ‘   k  =    âŒŠ   n  2   âŒ‹   +  1    n    1  k      .          n    delimited-[]   superscript  z  n      1    1  z      superscript   subscript     k      n  2           superscript  z  k   k         n     superscript   subscript     k        n  2    1     n     1  k       n![z^{n}]\frac{1}{1-z}\sum_{k>\lfloor\frac{n}{2}\rfloor}^{\infty}\frac{z^{k}}{%
 k}=n!\sum_{k=\lfloor\frac{n}{2}\rfloor+1}^{n}\frac{1}{k}.     It follows that the answer is         âˆ‘   k  =  1   n    1  k    -    âˆ‘   k  =  1    âŒŠ   n  2   âŒ‹     1  k     =     âˆ‘   k  =  1   n    1  k    -   2    âˆ‘   k  =  1    âŒŠ   n  2   âŒ‹     1   2  k       =     âˆ‘       k  =  1         k   even       n     (   1  -  2   )    1  k     +    âˆ‘       k  =  1         k   odd       n    1  k               superscript   subscript     k  1    n     1  k      superscript   subscript     k  1        n  2       1  k         superscript   subscript     k  1    n     1  k      2    superscript   subscript     k  1        n  2       1    2  k                superscript   subscript    STACKED    k  1     k  even     n       1  2     1  k       superscript   subscript    STACKED    k  1     k  odd     n     1  k        \sum_{k=1}^{n}\frac{1}{k}-\sum_{k=1}^{\lfloor\frac{n}{2}\rfloor}\frac{1}{k}=%
 \sum_{k=1}^{n}\frac{1}{k}-2\sum_{k=1}^{\lfloor\frac{n}{2}\rfloor}\frac{1}{2k}=%
 \sum_{k=1\atop k\;\text{even}}^{n}(1-2)\frac{1}{k}+\sum_{k=1\atop k\;\text{odd%
 }}^{n}\frac{1}{k}     The sum has an alternate representation that one encounters e.g. in the OEIS (A024167) .        n  !     âˆ‘   k  =  1   n      (   -  1   )    k  +  1    k     âˆ¼    n  !    log  2.       similar-to      n     superscript   subscript     k  1    n      superscript    1     k  1    k         n     2.      n!\sum_{k=1}^{n}\frac{(-1)^{k+1}}{k}\sim n!\log 2.   finally giving      (  1â€„2â€„34  )    1â€„2â€„34   (1\;2\;34)\,     Expected number of transpositions of a random permutation  We can use the disjoint cycle decomposition of a permutation to factorize it as a product of transpositions by replacing a cycle of length k by k âˆ’Â 1 transpositions. E.g. the cycle     (  1â€„2  )    (  2â€„3  )    (  3â€„4  )       1â€„2  2â€„3  3â€„4    (1\;2)\;(2\;3)\;(3\;4)   factors as    b   (  k  )       b  k    b(k)   . The function    k  -  1      k  1    k-1   for cycles is equal to     g   (  z  ,  u  )    =    (   1   1  -   u  z     )    1  /  u          g   z  u     superscript    1    1    u  z       1  u      g(z,u)=\left(\frac{1}{1-uz}\right)^{1/u}   and we obtain           âˆ‚   âˆ‚  u    g   (  z  ,  u  )    |    u  =  1    =    1   1  -  z      âˆ‘   k  â‰¥  1      (   k  -  1   )     z  k   k      =    z    (   1  -  z   )   2    -    1   1  -  z     log   1   1  -  z        .         evaluated-at         u    g   z  u      u  1        1    1  z      subscript     k  1        k  1      superscript  z  k   k               z   superscript    1  z   2        1    1  z        1    1  z          \frac{\partial}{\partial u}g(z,u)\Bigg|_{u=1}=\frac{1}{1-z}\sum_{k\geq 1}(k-1)%
 \frac{z^{k}}{k}=\frac{z}{(1-z)^{2}}-\frac{1}{1-z}\log\frac{1}{1-z}.     and      T   (  n  )       T  n    T(n)     Hence the expected number of transpositions      T   (  n  )    =   n  -   H  n     .        T  n     n   subscript  H  n      T(n)=n-H_{n}.\,   is      log   n       n    \log n\,     We could also have obtained this formula by noting that the number of transpositions is obtained by adding the lengths of all cycles (which gives n ) and subtracting one for every cycle (which gives    g   (  z  ,  u  )       g   z  u     g(z,u)   by the previous section).  Note that       (   -  1   )   m    n  !    [   z  n   ]    [   u  m   ]   g   (  z  ,  u  )    =   [     n       n  -  m      ]          superscript    1   m     n    delimited-[]   superscript  z  n     delimited-[]   superscript  u  m    g   z  u     delimited-[]    n      n  m        (-1)^{m}n!\;[z^{n}][u^{m}]g(z,u)=\left[\begin{matrix}n\\
 n-m\end{matrix}\right]   again generates the unsigned Stirling numbers of the first kind , but in reverse order. More precisely, we have             (   -  1   )    n  +  m     n  !    [   z  n   ]    [   u  m   ]   g   (  z  ,  u  )    |    u  =   1  /  u     |    z  =   u  z     =   [     n      m     ]        evaluated-at   evaluated-at     superscript    1     n  m      n    delimited-[]   superscript  z  n     delimited-[]   superscript  u  m    g   z  u      u    1  u       z    u  z      delimited-[]    n    m       (-1)^{n+m}n!\;[z^{n}][u^{m}]g(z,u)|_{u=1/u}|_{z=uz}=\left[\begin{matrix}n\\
 m\end{matrix}\right]     To see this, note that the above is equivalent to             [   u  m   ]   g   (  z  ,  u  )    |    u  =   1  /  u     |    z  =   u  z     =    [   u  m   ]     (   1   1  -  z    )   u    =    1   m  !      (   log   1   1  -  z     )   m     ,         evaluated-at   evaluated-at     delimited-[]   superscript  u  m    g   z  u      u    1  u       z    u  z        delimited-[]   superscript  u  m     superscript    1    1  z    u             1    m     superscript      1    1  z     m       [u^{m}]g(z,u)|_{u=1/u}|_{z=uz}=[u^{m}]\left(\frac{1}{1-z}\right)^{u}=\frac{1}{%
 m!}\left(\log\frac{1}{1-z}\right)^{m},     and that     Ïƒ   Ïƒ   \sigma     which we saw to be the EGF of the unsigned Stirling numbers of the first kind in the section on permutations consisting of precisely m cycles.  Expected cycle size of a random element  We select a random element q of a random permutation    b   (  k  )       b  k    b(k)   and ask about the expected size of the cycle that contains q . Here the function    k  2     superscript  k  2    k^{2}   is equal to         âˆ‚   âˆ‚  u    g   (  z  ,  u  )    |    u  =  1    =    1   1  -  z      âˆ‘   k  â‰¥  1      k  2     z  k   k      =    1   1  -  z     z    (   1  -  z   )   2     =   z    (   1  -  z   )   3     .         evaluated-at         u    g   z  u      u  1        1    1  z      subscript     k  1       superscript  k  2      superscript  z  k   k               1    1  z      z   superscript    1  z   2            z   superscript    1  z   3       \frac{\partial}{\partial u}g(z,u)\Bigg|_{u=1}=\frac{1}{1-z}\sum_{k\geq 1}k^{2}%
 \frac{z^{k}}{k}=\frac{1}{1-z}\frac{z}{(1-z)^{2}}=\frac{z}{(1-z)^{3}}.   , because a cycle of length k contributes k elements that are on cycles of length k . Note that unlike the previous computations, we need to average out this parameter after we extract it from the generating function (divide by n ). We have         1  n    [   z  n   ]    z    (   1  -  z   )   3     =    1  n    1  2   n   (   n  +  1   )    =    1  2    (   n  +  1   )     .            1  n    delimited-[]   superscript  z  n      z   superscript    1  z   3         1  n     1  2   n    n  1             1  2     n  1       \frac{1}{n}[z^{n}]\frac{z}{(1-z)^{3}}=\frac{1}{n}\frac{1}{2}n(n+1)=\frac{1}{2}%
 (n+1).     Hence the expected length of the cycle that contains q is      [  n  ]     delimited-[]  n    [n]     Probability that a random element lies on a cycle of size m  This average parameter represents the probability that if we again select a random element of    b   (  k  )       b  k    b(k)   of a random permutation, the element lies on a cycle of size m . The function   m   m   m   is equal to    m  =  k      m  k    m=k   for         âˆ‚   âˆ‚  u    g   (  z  ,  u  )    |    u  =  1    =    1   1  -  z      âˆ‘   k  â‰¥  1     b   (  k  )     z  k   k      =     1   1  -  z      m     z  m   m    =    z  m    1  -  z     .         evaluated-at         u    g   z  u      u  1        1    1  z      subscript     k  1      b  k     superscript  z  k   k               1    1  z    m     superscript  z  m   m            superscript  z  m     1  z       \frac{\partial}{\partial u}g(z,u)\Bigg|_{u=1}=\frac{1}{1-z}\sum_{k\geq 1}b(k)%
 \frac{z^{k}}{k}=\frac{1}{1-z}\;m\;\frac{z^{m}}{m}=\frac{z^{m}}{1-z}.   and zero otherwise, because only cycles of length m contribute, namely m elements that lie on a cycle of length m . We have        1  n    [   z  n   ]     z  m    1  -  z     =   {        1  n    ,       if  n   â‰¥  m        0  ,     otherwise.              1  n    delimited-[]   superscript  z  n       superscript  z  m     1  z      cases    1  n       if  n   m   0  otherwise.     \frac{1}{n}[z^{n}]\frac{z^{m}}{1-z}=\begin{cases}\frac{1}{n},&\mbox{if }n\geq m%
 \\
 0,&\mbox{otherwise.}\end{cases}     It follows that the probability that a random element lies on a cycle of length m is         (      k      m      )          binomial  k  m      \begin{matrix}{k\choose m}\end{matrix}     Probability that a random subset of [ n ] lies on the same cycle  Select a random subset Q of [ n ] containing m elements and a random permutation, and ask about the probability that all elements of Q lie on the same cycle. This is another average parameter. The function b ( k ) is equal to       (      k      m      )          binomial  k  m      \begin{matrix}{k\choose m}\end{matrix}   , because a cycle of length k contributes        (      k      m      )   =  0            binomial  k  m   0      \begin{matrix}{k\choose m}=0\end{matrix}   subsets of size m , where         âˆ‚   âˆ‚  u    g   (  z  ,  u  )    |    u  =  1    =    1   1  -  z      âˆ‘   k  â‰¥  m      (     k      m     )     z  k   k      =    1   1  -  z     1  m     z  m     (   1  -  z   )   m     =    1  m     z  m     (   1  -  z   )    m  +  1       .         evaluated-at         u    g   z  u      u  1        1    1  z      subscript     k  m       binomial  k  m      superscript  z  k   k               1    1  z      1  m      superscript  z  m    superscript    1  z   m              1  m      superscript  z  m    superscript    1  z     m  1         \frac{\partial}{\partial u}g(z,u)\Bigg|_{u=1}=\frac{1}{1-z}\sum_{k\geq m}{k%
 \choose m}\frac{z^{k}}{k}=\frac{1}{1-z}\frac{1}{m}\frac{z^{m}}{(1-z)^{m}}=%
 \frac{1}{m}\frac{z^{m}}{(1-z)^{m+1}}.   for . This yields         (     n      m     )    -  1     [   z  n   ]    1  m     z  m     (   1  -  z   )    m  +  1      =     (     n      m     )    -  1     1  m    [   z   n  -  m    ]    1    (   1  -  z   )    m  +  1             superscript   binomial  n  m     1     delimited-[]   superscript  z  n      1  m      superscript  z  m    superscript    1  z     m  1         superscript   binomial  n  m     1      1  m    delimited-[]   superscript  z    n  m       1   superscript    1  z     m  1        {n\choose m}^{-1}[z^{n}]\frac{1}{m}\frac{z^{m}}{(1-z)^{m+1}}={n\choose m}^{-1}%
 \frac{1}{m}[z^{n-m}]\frac{1}{(1-z)^{m+1}}     Averaging out we obtain that the probability of the elements of Q being on the same cycle is         1  m     (     n      m     )    -  1     (       (   n  -  m   )   +  m       m     )    =   1  m    .          1  m    superscript   binomial  n  m     1     binomial      n  m   m   m      1  m     \frac{1}{m}{n\choose m}^{-1}{(n-m)\;+\;m\choose m}=\frac{1}{m}.     or       ð”“   (    â„­  odd    (  ð’µ  )    )    ð”“  even    (    â„­  even    (  ð’µ  )    )    .      ð”“     subscript  â„­  odd   ð’µ    subscript  ð”“  even      subscript  â„­  even   ð’µ     \mathfrak{P}(\mathfrak{C}_{\operatorname{odd}}(\mathcal{Z}))\mathfrak{P}_{%
 \operatorname{even}}(\mathfrak{C}_{\operatorname{even}}(\mathcal{Z})).     In particular, the probability that two elements  are on the same cycle is 1/2.  Number of permutations containing an even number of even cycles  We may use the Flajoletâ€“Sedgewick fundamental theorem directly and compute more advanced permutation statistics. (Check that page for an explanation of how the operators we will use are computed.) For example, the set of permutations containing an even number of even cycles is given by       exp   (    1  2    log    1  +  z    1  -  z      )     cosh   (    1  2    log   1   1  -   z  2       )              1  2         1  z     1  z             1  2       1    1   superscript  z  2          \exp\left(\frac{1}{2}\log\frac{1+z}{1-z}\right)\cosh\left(\frac{1}{2}\log\frac%
 {1}{1-z^{2}}\right)     Translating to exponential generating functions (EGFs), we obtain         1  2    exp   (    1  2    (    log    1  +  z    1  -  z     +   log   1   1  -   z  2       )    )     +    1  2    exp   (    1  2    (    log    1  +  z    1  -  z     -   log   1   1  -   z  2       )    )      .          1  2         1  2           1  z     1  z         1    1   superscript  z  2              1  2         1  2           1  z     1  z         1    1   superscript  z  2            \frac{1}{2}\exp\left(\frac{1}{2}\left(\log\frac{1+z}{1-z}+\log\frac{1}{1-z^{2}%
 }\right)\right)+\frac{1}{2}\exp\left(\frac{1}{2}\left(\log\frac{1+z}{1-z}-\log%
 \frac{1}{1-z^{2}}\right)\right).     or       1  2   exp   (   1  2   log   1    (   1  -  z   )   2    )   +   1  2   exp   (   1  2   log    (  1  +  z  )   2   )      fragments    1  2     fragments  normal-(    1  2      1   superscript    1  z   2    normal-)      1  2     fragments  normal-(    1  2     superscript   fragments  normal-(  1   z  normal-)   2   normal-)     \frac{1}{2}\exp\left(\frac{1}{2}\log\frac{1}{(1-z)^{2}}\right)+\frac{1}{2}\exp%
 \left(\frac{1}{2}\log(1+z)^{2}\right)     This simplifies to          1  2    1   1  -  z     +    1  2    (   1  +  z   )     =   1  +  z  +    1  2     z  2    1  -  z       .            1  2     1    1  z         1  2     1  z       1  z      1  2      superscript  z  2     1  z        \frac{1}{2}\frac{1}{1-z}+\frac{1}{2}(1+z)=1+z+\frac{1}{2}\frac{z^{2}}{1-z}.     or      n  â‰¥  2      n  2    n\geq 2     This says that there is one permutation of size zero containing an even number of even cycles (the empty permutation, which contains zero cycles of even length), one such permutation of size one (the fixed point, which also contains zero cycles of even length), and that for     n  !   /   2         n   2    n!/2\,   , there are    (  1â€„8â€„9â€„11â€„13  )    1â€„8â€„9â€„11â€„13   (1\;8\;9\;11\;13)   such permutations.  Permutations that are squares  Consider what happens when we square a permutation. Fixed points are mapped to fixed points. Odd cycles are mapped to odd cycles in a one-to-one correspondence, e.g.    (  1â€„9â€„13â€„8â€„11  )    1â€„9â€„13â€„8â€„11   (1\;9\;13\;8\;11)   turns into    (  5â€„13â€„6â€„9  )    5â€„13â€„6â€„9   (5\;13\;6\;9)   . Even cycles split in two and produce a pair of cycles of half the size of the original cycle, e.g.     (  5â€„6  )    (  9â€„13  )       5â€„6  9â€„13    (5\;6)\;(9\;13)   turns into    ð”“   (    â„­  odd    (  ð’µ  )    )    ð”“  even    (    â„­  2    (  ð’µ  )    )    ð”“  even    (    â„­  4    (  ð’µ  )    )    ð”“  even    (    â„­  6    (  ð’µ  )    )   â‹¯      ð”“     subscript  â„­  odd   ð’µ    subscript  ð”“  even      subscript  â„­  2   ð’µ    subscript  ð”“  even      subscript  â„­  4   ð’µ    subscript  ð”“  even      subscript  â„­  6   ð’µ   normal-â‹¯    \mathfrak{P}(\mathfrak{C}_{\operatorname{odd}}(\mathcal{Z}))\mathfrak{P}_{%
 \operatorname{even}}(\mathfrak{C}_{2}(\mathcal{Z}))\mathfrak{P}_{\operatorname%
 {even}}(\mathfrak{C}_{4}(\mathcal{Z}))\mathfrak{P}_{\operatorname{even}}(%
 \mathfrak{C}_{6}(\mathcal{Z}))\cdots   . Hence permutations that are squares may contain any number of odd cycles, and an even number of cycles of size two, an even number of cycles of size four etc., and are given by         exp   (    1  2    log    1  +  z    1  -  z      )      âˆ   m  â‰¥  1     cosh    z   2  m     2  m       =      1  +  z    1  -  z       âˆ   m  â‰¥  1     cosh    z   2  m     2  m        .              1  2         1  z     1  z         subscript  product    m  1         superscript  z    2  m      2  m               1  z     1  z       subscript  product    m  1         superscript  z    2  m      2  m         \exp\left(\frac{1}{2}\log\frac{1+z}{1-z}\right)\prod_{m\geq 1}\cosh\frac{z^{2m%
 }}{2m}=\sqrt{\frac{1+z}{1-z}}\prod_{m\geq 1}\cosh\frac{z^{2m}}{2m}.     which yields the EGF      ð”“   (    â„­  odd    (  ð’µ  )    )    (     ð”“  3    (    â„­  2    (  ð’µ  )    )    +    â„­  2    (  ð’µ  )    â„­  4    (  ð’µ  )    +    â„­  6    (  ð’µ  )     )       ð”“     subscript  â„­  odd   ð’µ        subscript  ð”“  3      subscript  â„­  2   ð’µ       subscript  â„­  2   ð’µ   subscript  â„­  4   ð’µ      subscript  â„­  6   ð’µ      \mathfrak{P}(\mathfrak{C}_{\operatorname{odd}}(\mathcal{Z}))\left(\mathfrak{P}%
 _{3}(\mathfrak{C}_{2}(\mathcal{Z}))+\mathfrak{C}_{2}(\mathcal{Z})\mathfrak{C}_%
 {4}(\mathcal{Z})+\mathfrak{C}_{6}(\mathcal{Z})\right)     Odd cycle invariants  The types of permutations presented in the preceding two sections, i.e. permutations containing an even number of even cycles and permutations that are squares, are examples of so-called odd cycle invariants , studied by Sung and Zhang (see external links ). The term odd cycle invariant simply means that membership in the respective combinatorial class is independent of the size and number of odd cycles occurring in the permutation. In fact we can prove that all odd cycle invariants obey a simple recurrence, which we will derive. First, here are some more examples of odd cycle invariants.  Permutations where the sum of the lengths of the even cycles is six  This class has the specification           1  +  z    1  -  z      (     1  6     (    z  2   2   )   3    +     z  2   2     z  4   4    +    z  6   6    )    =    5  16    z  6      1  +  z    1  -  z       .              1  z     1  z           1  6    superscript     superscript  z  2   2   3         superscript  z  2   2      superscript  z  4   4       superscript  z  6   6         5  16    superscript  z  6         1  z     1  z        \sqrt{\frac{1+z}{1-z}}\left(\frac{1}{6}\left(\frac{z^{2}}{2}\right)^{3}+\frac{%
 z^{2}}{2}\frac{z^{4}}{4}+\frac{z^{6}}{6}\right)=\frac{5}{16}z^{6}\sqrt{\frac{1%
 +z}{1-z}}.     and the generating function      0  ,  0  ,  0  ,  0  ,  0  ,  225  ,  1575  ,  6300  ,  56700  ,  425250  ,  4677750  ,  46777500  ,  608107500  ,  â€¦     0  0  0  0  0  225  1575  6300  56700  425250  4677750  46777500  608107500  normal-â€¦    0,0,0,0,0,225,1575,6300,56700,425250,4677750,46777500,608107500,\ldots     The first few values are      ð”“   (    â„­  odd    (  ð’µ  )    )    (     ð”“    â‰¥  1     (    â„­  2    (  ð’µ  )    )    +    ð”“    â‰¥  1     (    â„­  4    (  ð’µ  )    )    +    ð”“    â‰¥  1     (    â„­  6    (  ð’µ  )    )    +  â‹¯   )       ð”“     subscript  â„­  odd   ð’µ        subscript  ð”“    absent  1       subscript  â„­  2   ð’µ       subscript  ð”“    absent  1       subscript  â„­  4   ð’µ       subscript  ð”“    absent  1       subscript  â„­  6   ð’µ    normal-â‹¯     \mathfrak{P}(\mathfrak{C}_{\operatorname{odd}}(\mathcal{Z}))\left(\mathfrak{P}%
 _{\geq 1}(\mathfrak{C}_{2}(\mathcal{Z}))+\mathfrak{P}_{\geq 1}(\mathfrak{C}_{4%
 }(\mathcal{Z}))+\mathfrak{P}_{\geq 1}(\mathfrak{C}_{6}(\mathcal{Z}))+\cdots\right)     Permutations where all even cycles have the same length  This class has the specification          1  +  z    1  -  z      (         exp   (    z  2   2   )    -   1    +   exp   (    z  4   4   )     -   1    +   exp   (    z  6   6   )     -   1    +  â‹¯   )    .            1  z     1  z                      superscript  z  2   2    1        superscript  z  4   4     1        superscript  z  6   6     1   normal-â‹¯     \sqrt{\frac{1+z}{1-z}}\left(\exp\left(\frac{z^{2}}{2}\right)-1\,+\,\exp\left(%
 \frac{z^{4}}{4}\right)-1\,+\,\exp\left(\frac{z^{6}}{6}\right)-1\,+\,\cdots%
 \right).     and the generating function      0  ,  1  ,  3  ,  15  ,  75  ,  405  ,  2835  ,  22155  ,  199395  ,  1828575  ,  â€¦     0  1  3  15  75  405  2835  22155  199395  1828575  normal-â€¦    0,1,3,15,75,405,2835,22155,199395,1828575,\ldots     There is a semantic nuance here. We could consider permutations containing no even cycles as belonging to this class, since zero is even . The first few values are      ð”“   (    â„­  odd    (  ð’µ  )    )   ð”“   (     â„­  2    (  ð’µ  )    +    â„­  4    (  ð’µ  )     )       ð”“     subscript  â„­  odd   ð’µ   ð”“       subscript  â„­  2   ð’µ      subscript  â„­  4   ð’µ      \mathfrak{P}(\mathfrak{C}_{\operatorname{odd}}(\mathcal{Z}))\mathfrak{P}(%
 \mathfrak{C}_{2}(\mathcal{Z})+\mathfrak{C}_{4}(\mathcal{Z}))     Permutations where the maximum length of an even cycle is four  This class has the specification          1  +  z    1  -  z      exp   (     z  2   2   +    z  4   4    )     .            1  z     1  z            superscript  z  2   2      superscript  z  4   4       \sqrt{\frac{1+z}{1-z}}\exp\left(\frac{z^{2}}{2}+\frac{z^{4}}{4}\right).     and the generating function      1  ,  2  ,  6  ,  24  ,  120  ,  600  ,  4200  ,  28560  ,  257040  ,  2207520  ,  24282720  ,  258128640  ,  â€¦     1  2  6  24  120  600  4200  28560  257040  2207520  24282720  258128640  normal-â€¦    1,2,6,24,120,600,4200,28560,257040,2207520,24282720,258128640,\ldots     The first few values are     ð’µ   ð’µ   \mathcal{Z}     The recurrence  Observe carefully how the specifications of the even cycle component are constructed. It is best to think of them in terms of parse trees. These trees have three levels. The nodes at the lowest level represent sums of products of even-length cycles of the singleton      g   (  z  )    =   h   (  z  )      1  +  z    1  -  z       ,        g  z     h  z        1  z     1  z        g(z)=h(z)\sqrt{\frac{1+z}{1-z}},   . The nodes at the middle level represent restrictions of the set operator. Finally the node at the top level sums products of contributions from the middle level. Note that restrictions of the set operator, when applied to a generating function that is even, will preserve this feature, i.e. produce another even generating function. But all the inputs to the set operators are even since they arise from even-length cycles. The result is that all generating functions involved have the form      h   (  z  )       h  z    h(z)     where       1   1  +  z     g   (  z  )    =   h   (  z  )    1    1  -   z  2               1    1  z    g  z     h  z    1      1   superscript  z  2         \frac{1}{1+z}\;g(z)=h(z)\;\frac{1}{\sqrt{1-z^{2}}}   is an even function. This means that           1   1  +  z     g   (  z  )    =      1   1  -  z     g   (   -  z   )    or       (   1  -  z   )   g   (  z  )    =    (   1  +  z   )   g   (   -  z   )      .     formulae-sequence        1    1  z    g  z        1    1  z    g    z    or          1  z   g  z       1  z   g    z       \frac{1}{1+z}\;g(z)=\frac{1}{1-z}\;g(-z)\quad\mbox{ or }\quad(1-z)\;g(z)=(1+z)%
 \;g(-z).     is even, too, and hence       g  n   =    [   z  n   ]   g   (  z  )         subscript  g  n      delimited-[]   superscript  z  n    g  z     g_{n}=[z^{n}]g(z)\,     Letting        g    2  m   +  1      (    2  m   +  1   )   !    -    g   2  m      (   2  m   )   !     =     -    g    2  m   +  1      (    2  m   +  1   )   !     +    g   2  m      (   2  m   )   !     or      2    g    2  m   +  1      (    2  m   +  1   )   !     =   2    g   2  m      (   2  m   )   !         formulae-sequence         subscript  g      2  m   1          2  m   1        subscript  g    2  m        2  m              subscript  g      2  m   1          2  m   1         subscript  g    2  m        2  m      or        2     subscript  g      2  m   1          2  m   1        2     subscript  g    2  m        2  m         \frac{g_{2m+1}}{(2m+1)!}-\frac{g_{2m}}{(2m)!}=-\frac{g_{2m+1}}{(2m+1)!}+\frac{%
 g_{2m}}{(2m)!}\quad\mbox{ or }\quad 2\frac{g_{2m+1}}{(2m+1)!}=2\frac{g_{2m}}{(%
 2m)!}   and extracting coefficients, we find that        g    2  m   +  1    =    (    2  m   +  1   )     g   2  m       .       subscript  g      2  m   1          2  m   1    subscript  g    2  m       g_{2m+1}=(2m+1)g_{2m}\,.     which yields the recurrence         âˆ‘   Ï€  âˆˆ   S  n       Ïƒ   (  Ï€  )      Î½   (  Ï€  )    +  1     =     (   -  1   )    n  +  1     n   n  +  1      ,        subscript     Ï€   subscript  S  n         Ïƒ  Ï€       Î½  Ï€   1        superscript    1     n  1      n    n  1       \sum_{\pi\in S_{n}}\frac{\sigma(\pi)}{\nu(\pi)+1}=(-1)^{n+1}\frac{n}{n+1},     A problem from the 2005 Putnam competition  A link to the Putnam competition website appears in the section External links . The problem asks for a proof that      n  !      n    n!     where the sum is over all    [  n  ]     delimited-[]  n    [n]   permutations of    Ïƒ   (  Ï€  )       Ïƒ  Ï€    \sigma(\pi)   ,   Ï€   Ï€   \pi   is the sign of     Ïƒ   (  Ï€  )    =  1        Ïƒ  Ï€   1    \sigma(\pi)=1   , i.e.   Ï€   Ï€   \pi   if     Ïƒ   (  Ï€  )    =   -  1         Ïƒ  Ï€     1     \sigma(\pi)=-1   is even and   Ï€   Ï€   \pi   if    Î½   (  Ï€  )       Î½  Ï€    \nu(\pi)   is odd, and   Ï€   Ï€   \pi   is the number of fixed points of   Ï€   Ï€   \pi   .  Now the sign of      Ïƒ   (  Ï€  )    =    âˆ   c  âˆˆ  Ï€      (   -  1   )     |  c  |   -  1      ,        Ïƒ  Ï€     subscript  product    c  Ï€     superscript    1       c   1       \sigma(\pi)=\prod_{c\in\pi}(-1)^{|c|-1},   is given by     Ï€   Ï€   \pi     where the product is over all cycles c of    ð”“   (    -  ð’µ   +   ð’±  ð’µ   +    â„­  1    (  ð’µ  )    +   ð’°   â„­  2    (  ð’µ  )    +    ð’°  2    â„­  3    (  ð’µ  )    +    ð’°  3    â„­  4    (  ð’µ  )    +  â‹¯   )       ð”“      ð’µ     ð’±  ð’µ      subscript  â„­  1   ð’µ     ð’°   subscript  â„­  2   ð’µ      superscript  ð’°  2    subscript  â„­  3   ð’µ      superscript  ð’°  3    subscript  â„­  4   ð’µ   normal-â‹¯     \mathfrak{P}(-\mathcal{Z}+\mathcal{V}\mathcal{Z}+\mathfrak{C}_{1}(\mathcal{Z})%
 +\mathcal{U}\mathfrak{C}_{2}(\mathcal{Z})+\mathcal{U}^{2}\mathfrak{C}_{3}(%
 \mathcal{Z})+\mathcal{U}^{3}\mathfrak{C}_{4}(\mathcal{Z})+\cdots)   , as explained e.g. on the page on even and odd permutations .  Hence we consider the combinatorial class     ð’°   ð’°   \mathcal{U}     where   ð’±   ð’±   \mathcal{V}   marks one minus the length of a contributing cycle, and     g   (  z  ,  u  ,  v  )    =   exp   (    -  z   +   v  z   +    âˆ‘   k  â‰¥  1      u   k  -  1      z  k   k      )          g   z  u  v          z     v  z     subscript     k  1       superscript  u    k  1       superscript  z  k   k         g(z,u,v)=\exp\left(-z+vz+\sum_{k\geq 1}u^{k-1}\frac{z^{k}}{k}\right)   marks fixed points. Translating to generating functions, we obtain        exp   (    -  z   +   v  z   +    1  u    log   1   1  -   u  z        )    =    exp   (    -  z   +   v  z    )      (   1   1  -   u  z     )    1  /  u      .            z     v  z       1  u       1    1    u  z                 z     v  z      superscript    1    1    u  z       1  u       \exp\left(-z+vz+\frac{1}{u}\log\frac{1}{1-uz}\right)=\exp(-z+vz)\left(\frac{1}%
 {1-uz}\right)^{1/u}.   or        n  !    [   z  n   ]   g   (  z  ,   -  1   ,  v  )    =    n  !    [   z  n   ]    exp   (    -  z   +   v  z    )     (   1  +  z   )    =    âˆ‘   Ï€  âˆˆ   S  n      Ïƒ   (  Ï€  )    v   Î½   (  Ï€  )                 n    delimited-[]   superscript  z  n    g   z    1   v        n    delimited-[]   superscript  z  n          z     v  z       1  z           subscript     Ï€   subscript  S  n       Ïƒ  Ï€   superscript  v    Î½  Ï€         n![z^{n}]g(z,-1,v)=n![z^{n}]\exp(-z+vz)(1+z)=\sum_{\pi\in S_{n}}\sigma(\pi)v^{%
 \nu(\pi)}     Now we have         n  !    [   z  n   ]     âˆ«  0  1    g   (  z  ,   -  1   ,  v  )   d  v     =    âˆ‘   Ï€  âˆˆ   S  n       Ïƒ   (  Ï€  )      Î½   (  Ï€  )    +  1      .          n    delimited-[]   superscript  z  n      superscript   subscript   0   1     g   z    1   v   d  v       subscript     Ï€   subscript  S  n         Ïƒ  Ï€       Î½  Ï€   1       n![z^{n}]\int_{0}^{1}g(z,-1,v)dv=\sum_{\pi\in S_{n}}\frac{\sigma(\pi)}{\nu(\pi%
 )+1}.     and hence the desired quantity is given by        âˆ«  0  1    g   (  z  ,   -  1   ,  v  )   d  v    =    exp   (   -  z   )     (   1  +  z   )    (     1  z    exp   (  z  )     -   1  z    )          superscript   subscript   0   1     g   z    1   v   d  v          z      1  z         1  z     z      1  z       \int_{0}^{1}g(z,-1,v)dv=\exp(-z)(1+z)\left(\frac{1}{z}\exp(z)-\frac{1}{z}\right)     Doing the computation, we obtain         (    1  z   +  1   )    (   1  -   exp   (   -  z   )     )    =     1  z   +  1   -   exp   (   -  z   )    -    1  z    exp   (   -  z   )       .            1  z   1     1      z            1  z   1       z        1  z       z        \left(\frac{1}{z}+1\right)\left(1-\exp(-z)\right)=\frac{1}{z}+1-\exp(-z)-\frac%
 {1}{z}\exp(-z).     or      1  /  z      1  z    1/z     Extracting coefficients, we find that the coefficient of   n   n   n   is zero. The constant is one, which does not agree with the formula (should be zero). For      n  !    [   z  n   ]    (    -   exp   (   -  z   )     -    1  z    exp   (   -  z   )      )    =    n  !    (    -     (   -  1   )   n    1   n  !      -     (   -  1   )    n  +  1     1    (   n  +  1   )   !      )            n    delimited-[]   superscript  z  n            z         1  z       z           n          superscript    1   n     1    n         superscript    1     n  1      1      n  1          n![z^{n}]\left(-\exp(-z)-\frac{1}{z}\exp(-z)\right)=n!\left(-(-1)^{n}\frac{1}{%
 n!}-(-1)^{n+1}\frac{1}{(n+1)!}\right)   positive, however, we obtain          (   -  1   )    n  +  1     (   1  -   1   n  +  1     )    =     (   -  1   )    n  +  1     n   n  +  1      ,         superscript    1     n  1      1    1    n  1         superscript    1     n  1      n    n  1       (-1)^{n+1}\left(1-\frac{1}{n+1}\right)=(-1)^{n+1}\frac{n}{n+1},     or      g   (  z  ,  u  ,  v  )       g   z  u  v     g(z,u,v)     which is the desired result.  As an interesting aside, we observe that    n  Ã—  n      n  n    n\times n   may be used to evaluate the following determinant of an      d   (  n  )    =   det   (   A  n   )    =   |     a       b       b       â‹¯       b      b       a       b       â‹¯       b      b       b       a       â‹¯       b      â‹®       â‹®       â‹®       â‹±       â‹®      b       b       b       â‹¯       a     |    .          d  n      subscript  A  n             a  absent  b  absent  b  absent  normal-â‹¯  absent  b    b  absent  a  absent  b  absent  normal-â‹¯  absent  b    b  absent  b  absent  a  absent  normal-â‹¯  absent  b    normal-â‹®  absent  normal-â‹®  absent  normal-â‹®  absent  normal-â‹±  absent  normal-â‹®    b  absent  b  absent  b  absent  normal-â‹¯  absent  a        d(n)=\det(A_{n})=\begin{vmatrix}a&&b&&b&&\cdots&&b\\
 b&&a&&b&&\cdots&&b\\
 b&&b&&a&&\cdots&&b\\
 \vdots&&\vdots&&\vdots&&\ddots&&\vdots\\
 b&&b&&b&&\cdots&&a\end{vmatrix}.   matrix:       a  ,  b   â‰   0       a  b   0    a,b\neq 0     where      det   (  A  )    =    âˆ‘   Ï€  âˆˆ   S  n      Ïƒ   (  Ï€  )     âˆ   i  =  1   n    A   i  ,   Ï€   (  i  )          .        A     subscript     Ï€   subscript  S  n       Ïƒ  Ï€    superscript   subscript  product    i  1    n    subscript  A   i    Ï€  i          \det(A)=\sum_{\pi\in S_{n}}\sigma(\pi)\prod_{i=1}^{n}A_{i,\pi(i)}.   . Recall the formula for the determinant:     Ï€   Ï€   \pi     Now the value of the product on the right for a permutation     a  f     b   n  -  f          superscript  a  f    superscript  b    n  f      a^{f}b^{n-f}\,   is   Ï€   Ï€   \pi   , where f is the number of fixed points of     d   (  n  )    =    b  n    n  !    [   z  n   ]   g   (  z  ,   -  1   ,   a  b   )    =    b  n    n  !    [   z  n   ]    exp   (     a  -  b   b   z   )     (   1  +  z   )            d  n      superscript  b  n     n    delimited-[]   superscript  z  n    g   z    1     a  b             superscript  b  n     n    delimited-[]   superscript  z  n            a  b   b   z      1  z       d(n)=b^{n}n![z^{n}]g\left(z,-1,\frac{a}{b}\right)=b^{n}n![z^{n}]\exp\left(%
 \frac{a-b}{b}z\right)(1+z)   . Hence         b  n     (    a  -  b   b   )   n    +    b  n   n    (    a  -  b   b   )    n  -  1      =     (   a  -  b   )   n   +   n  b    (   a  -  b   )    n  -  1               superscript  b  n    superscript      a  b   b   n       superscript  b  n   n   superscript      a  b   b     n  1         superscript    a  b   n     n  b   superscript    a  b     n  1        b^{n}\left(\frac{a-b}{b}\right)^{n}+b^{n}n\left(\frac{a-b}{b}\right)^{n-1}=(a-%
 b)^{n}+nb(a-b)^{n-1}     which yields        d   (  n  )    =    (   a  +    (   n  -  1   )   b    )      (   a  -  b   )    n  -  1       .        d  n       a      n  1   b     superscript    a  b     n  1       d(n)=(a+(n-1)b)(a-b)^{n-1}\,.     and finally        (   -  1   )   n     (   n  -  2   )   !        superscript    1   n       n  2      (-1)^{n}(n-2)!     The difference between the number of cycles in even and odd permutations  Here we seek to show that this difference is given by      Ïƒ   (  Ï€  )       Ïƒ  Ï€    \sigma(\pi)     Recall that the sign   Ï€   Ï€   \pi   of a permutation     Ïƒ   (  Ï€  )    =    âˆ   c  âˆˆ  Ï€      (   -  1   )     |  c  |   -  1           Ïƒ  Ï€     subscript  product    c  Ï€     superscript    1       c   1       \sigma(\pi)=\prod_{c\in\pi}(-1)^{|c|-1}   is given by     Ï€   Ï€   \pi   where the product ranges over the cycles c from the disjoint cycle composition of   ð’¬   ð’¬   \mathcal{Q}   .  It follows that the combinatorial species    ð’¬  =  ð”“   (  ð’±   â„­  1    (  ð’µ  )   +  ð’°  ð’±   â„­  2    (  ð’µ  )   )   +   ð’°  2   ð’±   â„­  3    (  ð’µ  )   +   ð’°  3   ð’±   â„­  4    (  ð’µ  )   +   ð’°  4   ð’±   â„­  5    (  ð’µ  )   +  â‹¯  )     fragments  Q   P   fragments  normal-(  V   subscript  â„­  1    fragments  normal-(  Z  normal-)    U  V   subscript  â„­  2    fragments  normal-(  Z  normal-)   normal-)     superscript  ð’°  2   V   subscript  â„­  3    fragments  normal-(  Z  normal-)     superscript  ð’°  3   V   subscript  â„­  4    fragments  normal-(  Z  normal-)     superscript  ð’°  4   V   subscript  â„­  5    fragments  normal-(  Z  normal-)    normal-â‹¯  normal-)    \mathcal{Q}=\mathfrak{P}(\mathcal{V}\mathfrak{C}_{1}(\mathcal{Z})+\mathcal{U}%
 \mathcal{V}\mathfrak{C}_{2}(\mathcal{Z}))+\mathcal{U}^{2}\mathcal{V}\mathfrak{%
 C}_{3}(\mathcal{Z})+\mathcal{U}^{3}\mathcal{V}\mathfrak{C}_{4}(\mathcal{Z})+%
 \mathcal{U}^{4}\mathcal{V}\mathfrak{C}_{5}(\mathcal{Z})+\cdots)   that reflects the signs and the cycle count of the set of permutations is given by     ð’°   ð’°   \mathcal{U}   where we have used   ð’±   ð’±   \mathcal{V}   to mark signs and      Q   (  z  ,  u  ,  v  )    =   exp   (    v   z  1    +   v  u    z  2   2    +   v   u  2     z  3   3    +   v   u  3     z  4   4    +   v   u  4     z  5   5    +  â‹¯   )     .        Q   z  u  v          v    z  1      v  u     superscript  z  2   2      v   superscript  u  2      superscript  z  3   3      v   superscript  u  3      superscript  z  4   4      v   superscript  u  4      superscript  z  5   5    normal-â‹¯      Q(z,u,v)=\exp\left(v\frac{z}{1}+vu\frac{z^{2}}{2}+vu^{2}\frac{z^{3}}{3}+vu^{3}%
 \frac{z^{4}}{4}+vu^{4}\frac{z^{5}}{5}+\cdots\right).   for the cycle count.  Translating to generating functions we have       Q   (  z  ,  u  ,  v  )    =   exp   (    v  u    (     z  u   1   +     z  2    u  2    2   +     z  3    u  3    3   +     z  4    u  4    4   +     z  5    u  5    5   +  â‹¯   )    )          Q   z  u  v          v  u         z  u   1        superscript  z  2    superscript  u  2    2        superscript  z  3    superscript  u  3    3        superscript  z  4    superscript  u  4    4        superscript  z  5    superscript  u  5    5   normal-â‹¯       Q(z,u,v)=\exp\left(\frac{v}{u}\left(\frac{zu}{1}+\frac{z^{2}u^{2}}{2}+\frac{z^%
 {3}u^{3}}{3}+\frac{z^{4}u^{4}}{4}+\frac{z^{5}u^{5}}{5}+\cdots\right)\right)   This simplifies to        exp   (    v  u    log   1   1  -   u  z       )    =    (   1   1  -   u  z     )    v  u     .            v  u       1    1    u  z         superscript    1    1    u  z       v  u      \exp\left(\frac{v}{u}\log\frac{1}{1-uz}\right)=\left(\frac{1}{1-uz}\right)^{%
 \frac{v}{u}}.   which is       Q  1    (  z  ,  v  )        subscript  Q  1    z  v     Q_{1}(z,v)     Now the two generating functions     Q  2    (  z  ,  v  )        subscript  Q  2    z  v     Q_{2}(z,v)   and      Q  1    (  z  ,  v  )    =     1  2   Q   (  z  ,   +  1   ,  v  )    +    1  2   Q   (  z  ,   -  1   ,  v  )     =     1  2     (   1   1  -  z    )   v    +    1  2     (   1   1  +  z    )    -  v               subscript  Q  1    z  v          1  2   Q   z    1   v        1  2   Q   z    1   v                1  2    superscript    1    1  z    v        1  2    superscript    1    1  z      v         Q_{1}(z,v)=\frac{1}{2}Q(z,+1,v)+\frac{1}{2}Q(z,-1,v)=\frac{1}{2}\left(\frac{1}%
 {1-z}\right)^{v}+\frac{1}{2}\left(\frac{1}{1+z}\right)^{-v}   of even and odd permutations by cycle count are given by         Q  2    (  z  ,  v  )    =     1  2   Q   (  z  ,   +  1   ,  v  )    -    1  2   Q   (  z  ,   -  1   ,  v  )     =     1  2     (   1   1  -  z    )   v    -    1  2     (   1   1  +  z    )    -  v       .           subscript  Q  2    z  v          1  2   Q   z    1   v        1  2   Q   z    1   v                1  2    superscript    1    1  z    v        1  2    superscript    1    1  z      v         Q_{2}(z,v)=\frac{1}{2}Q(z,+1,v)-\frac{1}{2}Q(z,-1,v)=\frac{1}{2}\left(\frac{1}%
 {1-z}\right)^{v}-\frac{1}{2}\left(\frac{1}{1+z}\right)^{-v}.   and       G   (  z  ,  v  )    =      d   d  v     (     Q  1    (  z  ,  v  )    -    Q  2    (  z  ,  v  )     )    |    v  =  1          G   z  v     evaluated-at      d    d  v         subscript  Q  1    z  v       subscript  Q  2    z  v        v  1      G(z,v)=\left.\frac{d}{dv}(Q_{1}(z,v)-Q_{2}(z,v))\right|_{v=1}     We require the quantity           d   d  v      (   1   1  +  z    )    -  v     |    v  =  1    =   -      log   1   1  +  z       (   1   1  +  z    )    -  v     |    v  =  1     =   -    (   1  +  z   )    log   1   1  +  z        .         evaluated-at      d    d  v     superscript    1    1  z      v       v  1       evaluated-at        1    1  z      superscript    1    1  z      v       v  1                1  z       1    1  z          \left.\frac{d}{dv}\left(\frac{1}{1+z}\right)^{-v}\right|_{v=1}=-\left.\log%
 \frac{1}{1+z}\left(\frac{1}{1+z}\right)^{-v}\right|_{v=1}=-(1+z)\log\frac{1}{1%
 +z}.   which is       -    n  !    [   z  n   ]    (   1  +  z   )    log   1   1  +  z       =   -    n  !    (      (   -  1   )   n   n   +     (   -  1   )    n  -  1     n  -  1     )               n    delimited-[]   superscript  z  n      1  z       1    1  z             n        superscript    1   n   n      superscript    1     n  1      n  1         -n![z^{n}](1+z)\log\frac{1}{1+z}=-n!\left(\frac{(-1)^{n}}{n}+\frac{(-1)^{n-1}}%
 {n-1}\right)     Finally extracting coeffcients from this generating function we obtain       -    n  !     (   -  1   )    n  -  1     (    -   1  n    +   1   n  -  1     )     =    n  !     (   -  1   )   n     n  -   (   n  -  1   )     n   (   n  -  1   )                n    superscript    1     n  1          1  n      1    n  1           n    superscript    1   n       n    n  1      n    n  1        -n!(-1)^{n-1}\left(-\frac{1}{n}+\frac{1}{n-1}\right)=n!(-1)^{n}\frac{n-(n-1)}{%
 n(n-1)}   which is        n  !     (   -  1   )   n    1   n   (   n  -  1   )      =     (   -  1   )   n     (   n  -  2   )   !            n    superscript    1   n     1    n    n  1         superscript    1   n       n  2       n!(-1)^{n}\frac{1}{n(n-1)}=(-1)^{n}(n-2)!   which is in turn  $$n! (-1)^n \frac{1}{n(n-1)} = (-1)^n (n-2)!$$ This concludes the proof.  See also   Golombâ€“Dickman constant   External links      Marko Riedel et al., The difference of number of cycles of even and odd permutations  Marko Riedel et al., Keys inside closed boxes, a question on probability   100 prisoners   Anna GÃ¡l, Peter Bro Miltersen, The cell probe complexity of succinct data structures  Various authors, Permutations with a cycle > n/2  Various authors, A property of derangements  Various authors, Expected number of fixed points  Peter Winkler, Seven puzzles you think you must not have heard correctly  Various authors, Les-Mathematiques.net . Cent prisonniers    "  Category:Combinatorics   