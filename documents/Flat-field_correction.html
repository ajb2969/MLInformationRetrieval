<html lang="en">
<head>
<meta charset="utf-8"/>
<title offset="1897">Flat-field correction</title>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG.js" type="text/javascript">
</script>
</head>
<body>
<h1>Flat-field correction</h1>
<hr/>
<dl>
<dd><em>Not to be confused with <a href="Petzval_field_curvature" title="wikilink">Petzval field curvature</a>, which refers to focus uniformity.</em>
</dd>
</dl>

<p><a href="image:Woy_Woy_Channel_-_Vignetted.jpg" title="wikilink">thumb|210px|The brightness variation due to </a><a class="uri" href="vignetting" title="wikilink">vignetting</a>, as shown here, can be corrected by selectively brightening the perimeter of the image.</p>

<p><strong>Flat-field correction</strong> is a technique used to improve quality in <a href="digital_imaging" title="wikilink">digital imaging</a>. The goal is to remove artifacts from 2-D images that are caused by variations in the pixel-to-pixel sensitivity of the detector and/or by distortions in the optical path. It is a standard calibration procedure in everything from pocket <a href="digital_camera" title="wikilink">digital cameras</a> to giant telescopes.</p>

<p>Flat fielding refers to the process of compensating for different <a href="gain" title="wikilink">gains</a> and <a href="dark_current_(physics)" title="wikilink">dark currents</a> in a detector. Once a detector has been appropriately flat-fielded, a uniform signal will create a uniform output (hence flat-field). This then means any further signal is due to the phenomenon being detected and not a <a href="systematic_error" title="wikilink">systematic error</a>.</p>

<p>A flat-field consists of two numbers for each pixel, the pixel's gain and its dark current (or <a href="dark_frame" title="wikilink">dark frame</a>). The pixel's gain is how the amount of signal given by the detector varies as a function of the amount of light (or equivalent). The gain is almost always a linear variable, as such the gain is given simply as the ratio of the input and output signals. The dark-current is the amount of signal given out by the detector when there is no incident light (hence dark frame). In many detectors this can also be a function of time, for example in astronomical telescopes it is common to take a dark-frame of the same time as the planned light exposure. The gain and dark-frame for optical systems can also be established by using a series of <a href="neutral_density_filter" title="wikilink">neutral density filters</a> to give input/output signal information and applying a least squares fit to obtain the values for the dark current and gain. 

<math display="inline" id="Flat-field_correction:0">
 <semantics>
  <mrow>
   <mi>C</mi>
   <mo>=</mo>
   <mfrac>
    <mrow>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <mi>R</mi>
       <mo>-</mo>
       <mi>D</mi>
      </mrow>
      <mo stretchy="false">)</mo>
     </mrow>
     <mo>*</mo>
     <mi>m</mi>
    </mrow>
    <mrow>
     <mo stretchy="false">(</mo>
     <mrow>
      <mi>F</mi>
      <mo>-</mo>
      <mi>D</mi>
     </mrow>
     <mo stretchy="false">)</mo>
    </mrow>
   </mfrac>
   <mo>=</mo>
   <mrow>
    <mrow>
     <mo stretchy="false">(</mo>
     <mrow>
      <mi>R</mi>
      <mo>-</mo>
      <mi>D</mi>
     </mrow>
     <mo stretchy="false">)</mo>
    </mrow>
    <mo>*</mo>
    <mi>G</mi>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <and></and>
    <apply>
     <eq></eq>
     <ci>C</ci>
     <apply>
      <divide></divide>
      <apply>
       <times></times>
       <apply>
        <minus></minus>
        <ci>R</ci>
        <ci>D</ci>
       </apply>
       <ci>m</ci>
      </apply>
      <apply>
       <minus></minus>
       <ci>F</ci>
       <ci>D</ci>
      </apply>
     </apply>
    </apply>
    <apply>
     <eq></eq>
     <share href="#.cmml">
     </share>
     <apply>
      <times></times>
      <apply>
       <minus></minus>
       <ci>R</ci>
       <ci>D</ci>
      </apply>
      <ci>G</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C={{(R-D)*m}\over{(F-D)}}={(R-D)*G}
  </annotation>
 </semantics>
</math>

</p>

<p>where:</p>
<ul>
<li>C = corrected image</li>
</ul>
<ul>
<li>R = raw image</li>
<li>F = flat field image</li>
<li>D = dark field or dark frame</li>
<li>m = average value of (F-D)</li>
<li>G = Gain = 

<math display="inline" id="Flat-field_correction:1">
 <semantics>
  <mfrac>
   <mi>m</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mrow>
     <mi>F</mi>
     <mo>-</mo>
     <mi>D</mi>
    </mrow>
    <mo stretchy="false">)</mo>
   </mrow>
  </mfrac>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <divide></divide>
    <ci>m</ci>
    <apply>
     <minus></minus>
     <ci>F</ci>
     <ci>D</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   m\over(F-D)
  </annotation>
 </semantics>
</math>

<a class="footnoteRef" href="#fn1" id="fnref1"><sup>1</sup></a></li>
</ul>

<p>In this equation, capital letters are 2D matrices, and lowercase letters are scalars. All matrix operations are performed element-by-element.</p>

<p>In order for an astrophotographer to capture a light frame, he or she must place a light source over the imaging instrument's objective lens such that the light source emanates evenly through the users optics. The photographer must then adjust the exposure of their imaging device (CCD or DSLR camera) so that when the histogram of the image is viewed, a peak reaching about 40–70% of the dynamic range (Maximum range of values for a changeable quantity. In this case its pixel value) of the imaging device is seen. The photographer typically takes 15–20 light frames and performs median stacking. Once the desired light frames are acquired, the objective lens is covered so that no light is allowed in, then 15–20 dark frames are taken, each of equal exposure time as a light frame. These are called Dark-Flat frames.</p>
<h2 id="see-also">See also</h2>
<ul>
<li><a href="Bias_frame" title="wikilink">Bias frame</a></li>
<li><a href="Dark_frame" title="wikilink">Dark frame</a></li>
<li><a href="Fixed-pattern_noise" title="wikilink">Fixed-pattern noise</a></li>
<li><a class="uri" href="Vignetting" title="wikilink">Vignetting</a></li>
</ul>
<h2 id="references">References</h2>
<ul>
<li>Olsen, Doug.; Dou, Changyong.; Zhang, Xiaodong.; Hu, Lianbo.; Kim, Hojin.; Hildum, Edward. <a href="http://www.mdpi.com/2072-4292/2/2/464/pdf">Radiometric Calibration for AgCam</a>; Remote Sens. 2010, 2, 464-477</li>
</ul>
<h2 id="external-links">External links</h2>
<ul>
<li><a href="http://frigg.physastro.mnsu.edu/spect_flat.html">Flat-Field Correction</a></li>
</ul>

<p>"</p>

<p><a class="uri" href="Category:Optics" title="wikilink">Category:Optics</a> <a href="Category:Computer_graphic_techniques" title="wikilink">Category:Computer graphic techniques</a> <a class="uri" href="Category:Astrophotography" title="wikilink">Category:Astrophotography</a> <a href="Category:Image_processing" title="wikilink">Category:Image processing</a></p>
<section class="footnotes">
<hr/>
<ol>
<li id="fn1"><a class="uri" href="http://www.princetoninstruments.com/cms/index.php/ccd-primer/152-flat-field-correction">http://www.princetoninstruments.com/cms/index.php/ccd-primer/152-flat-field-correction</a><a href="#fnref1">↩</a></li>
</ol>
</section>
</body>
</html>
