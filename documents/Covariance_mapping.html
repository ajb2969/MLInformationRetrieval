<html lang="en">
<head>
<meta charset="utf-8"/>
<title offset="986">Covariance mapping</title>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG.js" type="text/javascript">
</script>
</head>
<body>
<h1>Covariance mapping</h1>
<hr/>

<p>In <a class="uri" href="statistics" title="wikilink">statistics</a>, <strong>covariance mapping</strong> is an extension of the <a class="uri" href="covariance" title="wikilink">covariance</a> concept from <a href="random_variables" title="wikilink">random variables</a> to <a href="random_function" title="wikilink">random functions</a>. Normal covariance is a scalar (a single number) that measures statistical relation between two random variables. Covariance maps are matrices (arrays of numbers) that show statistical relations between different regions of random functions. Statistically independent regions of the functions show up on the map as zero-level flatland, while positive or negative correlations show up, respectively, as hills or valleys.</p>
<h2 id="simple-covariance-mapping">Simple covariance mapping</h2>

<p>Covariance mapping can be applied to any repetitive, fluctuating signal to reveal information hidden in the fluctuations. This technique was first used to analyse <a href="mass_spectra" title="wikilink">mass spectra</a> of molecules <a href="ionization" title="wikilink">ionised</a> and fragmented by intense laser pulses.<a class="footnoteRef" href="#fn1" id="fnref1"><sup>1</sup></a></p>

<p> Covariance mapping is particularly well suited to <a href="free-electron_laser" title="wikilink">free-electron laser</a> (FEL) research, where the x-ray intensity is so high that the large number of photoelectron and photoions produced at each pulse overwhelms simpler <a href="Photoelectron_photoion_coincidence_spectroscopy" title="wikilink">coincidence techniques</a>. Figure 1 shows a typical experiment.<a class="footnoteRef" href="#fn2" id="fnref2"><sup>2</sup></a> X-ray pulses are focused on neon atoms and <a href="ionization" title="wikilink">ionise</a> them. The kinetic energy spectra of the photoelectrons ejected from neon are recorded at each laser shot using a suitable spectrometer (here a <a href="Time-of-flight_mass_spectrometry" title="wikilink">time-of-flight spectrometer</a>). The single-shot spectra are sent to a computer, which calculates and displays the covariance map.</p>
<h3 id="the-need-for-correlations">The need for correlations</h3>

<p> Even in a relatively simple system, such as the neon atom, intense x-rays induce a plethora of ionisation processes (see Fig. 2). As the kinetic energies of the electrons ejected in different processes largely overlap, it is impossible to identify these processes using simple <a href="Photoemission_spectroscopy" title="wikilink">photoelectron spectrometry</a>. To do so, one needs to correlate the kinetic energies of the electrons ejected in a given process. Covariance mapping is a method of revealing such correlations.</p>
<h3 id="the-principle">The principle</h3>

<p>Consider a <a href="random_function" title="wikilink">random function</a> 

<math display="inline" id="Covariance_mapping:0">
 <semantics>
  <mrow>
   <msub>
    <mi>X</mi>
    <mi>n</mi>
   </msub>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>E</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>X</ci>
     <ci>n</ci>
    </apply>
    <ci>E</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   X_{n}(E)
  </annotation>
 </semantics>
</math>

, where index 

<math display="inline" id="Covariance_mapping:1">
 <semantics>
  <mi>n</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>n</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   n
  </annotation>
 </semantics>
</math>

 labels a particular instance of the function and 

<math display="inline" id="Covariance_mapping:2">
 <semantics>
  <mi>E</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>E</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   E
  </annotation>
 </semantics>
</math>

 is the independent variable. In the context of the FEL experiment, 

<math display="inline" id="Covariance_mapping:3">
 <semantics>
  <mrow>
   <msub>
    <mi>X</mi>
    <mi>n</mi>
   </msub>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>E</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>X</ci>
     <ci>n</ci>
    </apply>
    <ci>E</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   X_{n}(E)
  </annotation>
 </semantics>
</math>


 is a digitized electron energy spectrum produced by laser shot 

<math display="inline" id="Covariance_mapping:4">
 <semantics>
  <mi>n</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>n</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   n
  </annotation>
 </semantics>
</math>

. As the electron energy 

<math display="inline" id="Covariance_mapping:5">
 <semantics>
  <mi>E</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>E</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   E
  </annotation>
 </semantics>
</math>

 takes a range of discrete values 

<math display="inline" id="Covariance_mapping:6">
 <semantics>
  <msub>
   <mi>E</mi>
   <mi>i</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>E</ci>
    <ci>i</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   E_{i}
  </annotation>
 </semantics>
</math>

 in places where the spectrum is sampled, the spectra can be regarded as <a href="row_vector" title="wikilink">row vectors</a> of experimental data:</p>

<p>

<math display="block" id="Covariance_mapping:7">
 <semantics>
  <mrow>
   <mrow>
    <mi>ğ—</mi>
    <mo>=</mo>
    <msub>
     <mi>ğ—</mi>
     <mi>n</mi>
    </msub>
    <mo>=</mo>
    <mrow>
     <mo stretchy="false">[</mo>
     <mrow>
      <msub>
       <mi>X</mi>
       <mi>n</mi>
      </msub>
      <mrow>
       <mo stretchy="false">(</mo>
       <msub>
        <mi>E</mi>
        <mn>1</mn>
       </msub>
       <mo stretchy="false">)</mo>
      </mrow>
     </mrow>
     <mo>,</mo>
     <mrow>
      <msub>
       <mi>X</mi>
       <mi>n</mi>
      </msub>
      <mrow>
       <mo stretchy="false">(</mo>
       <msub>
        <mi>E</mi>
        <mn>2</mn>
       </msub>
       <mo stretchy="false">)</mo>
      </mrow>
     </mrow>
     <mo>,</mo>
     <mrow>
      <msub>
       <mi>X</mi>
       <mi>n</mi>
      </msub>
      <mrow>
       <mo stretchy="false">(</mo>
       <msub>
        <mi>E</mi>
        <mn>3</mn>
       </msub>
       <mo stretchy="false">)</mo>
      </mrow>
     </mrow>
     <mo rspace="7.5pt">,</mo>
     <mrow>
      <mi mathvariant="normal">â€¦</mi>
      <mtext>up to the last sample</mtext>
     </mrow>
     <mo stretchy="false">]</mo>
    </mrow>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <and></and>
    <apply>
     <eq></eq>
     <ci>ğ—</ci>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>ğ—</ci>
      <ci>n</ci>
     </apply>
    </apply>
    <apply>
     <eq></eq>
     <share href="#.cmml">
     </share>
     <list>
      <apply>
       <times></times>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>X</ci>
        <ci>n</ci>
       </apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>E</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
      <apply>
       <times></times>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>X</ci>
        <ci>n</ci>
       </apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>E</ci>
        <cn type="integer">2</cn>
       </apply>
      </apply>
      <apply>
       <times></times>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>X</ci>
        <ci>n</ci>
       </apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>E</ci>
        <cn type="integer">3</cn>
       </apply>
      </apply>
      <apply>
       <times></times>
       <ci>normal-â€¦</ci>
       <mtext>up to the last sample</mtext>
      </apply>
     </list>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{X}=\mathbf{X}_{n}=[X_{n}(E_{1}),X_{n}(E_{2}),X_{n}(E_{3}),\ \ldots%
\text{ up to the last sample}].
  </annotation>
 </semantics>
</math>

</p>

<p>The simplest way to analyse the data is to average the spectra over 

<math display="inline" id="Covariance_mapping:8">
 <semantics>
  <mi>N</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>N</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   N
  </annotation>
 </semantics>
</math>


 laser shots:</p>

<p>

<math display="block" id="Covariance_mapping:9">
 <semantics>
  <mrow>
   <mrow>
    <mrow>
     <mo stretchy="false">âŸ¨</mo>
     <mi>ğ—</mi>
     <mo stretchy="false">âŸ©</mo>
    </mrow>
    <mo>=</mo>
    <mrow>
     <mfrac>
      <mn>1</mn>
      <mi>N</mi>
     </mfrac>
     <mrow>
      <munderover>
       <mo largeop="true" movablelimits="false" symmetric="true">âˆ‘</mo>
       <mrow>
        <mi>n</mi>
        <mo>=</mo>
        <mn>1</mn>
       </mrow>
       <mi>N</mi>
      </munderover>
      <msub>
       <mi>ğ—</mi>
       <mi>n</mi>
      </msub>
     </mrow>
    </mrow>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="latexml">delimited-âŸ¨âŸ©</csymbol>
     <ci>ğ—</ci>
    </apply>
    <apply>
     <times></times>
     <apply>
      <divide></divide>
      <cn type="integer">1</cn>
      <ci>N</ci>
     </apply>
     <apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <sum></sum>
        <ci>N</ci>
       </apply>
       <apply>
        <eq></eq>
        <ci>n</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>ğ—</ci>
       <ci>n</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \langle\mathbf{X}\rangle=\frac{1}{N}\sum^{N}_{n=1}\mathbf{X}_{n}.
  </annotation>
 </semantics>
</math>

</p>

<p>Such spectra show kinetic energies of individual electrons but the correlations between the electrons are lost in the process of averaging. To reveal the correlations we need to calculate the covariance map:</p>

<p>

<math display="block" id="Covariance_mapping:10">
 <semantics>
  <mrow>
   <mrow>
    <mrow>
     <mi>ğœğ¨ğ¯</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mi>ğ˜</mi>
      <mo>,</mo>
      <mi>ğ—</mi>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
    <mo>=</mo>
    <mrow>
     <mrow>
      <mo stretchy="false">âŸ¨</mo>
      <mi>ğ˜ğ—</mi>
      <mo stretchy="false">âŸ©</mo>
     </mrow>
     <mo>-</mo>
     <mrow>
      <mrow>
       <mo stretchy="false">âŸ¨</mo>
       <mi>ğ˜</mi>
       <mo stretchy="false">âŸ©</mo>
      </mrow>
      <mrow>
       <mo stretchy="false">âŸ¨</mo>
       <mi>ğ—</mi>
       <mo stretchy="false">âŸ©</mo>
      </mrow>
     </mrow>
    </mrow>
   </mrow>
   <mo>,</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <ci>ğœğ¨ğ¯</ci>
     <interval closure="open">
      <ci>ğ˜</ci>
      <ci>ğ—</ci>
     </interval>
    </apply>
    <apply>
     <minus></minus>
     <apply>
      <csymbol cd="latexml">delimited-âŸ¨âŸ©</csymbol>
      <ci>ğ˜ğ—</ci>
     </apply>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="latexml">delimited-âŸ¨âŸ©</csymbol>
       <ci>ğ˜</ci>
      </apply>
      <apply>
       <csymbol cd="latexml">delimited-âŸ¨âŸ©</csymbol>
       <ci>ğ—</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{cov}(\mathbf{Y},\mathbf{X})=\langle\mathbf{YX}\rangle-\langle\mathbf{Y%
}\rangle\langle\mathbf{X}\rangle,
  </annotation>
 </semantics>
</math>

</p>

<p>where vector 

<math display="inline" id="Covariance_mapping:11">
 <semantics>
  <mi>ğ˜</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>ğ˜</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{Y}
  </annotation>
 </semantics>
</math>

 is the <a class="uri" href="transpose" title="wikilink">transpose</a> of vector 

<math display="inline" id="Covariance_mapping:12">
 <semantics>
  <mi>ğ—</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>ğ—</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{X}
  </annotation>
 </semantics>
</math>

 and the angular brackets denote averaging over many laser shots as before. Note that the ordering of the vectors (a column followed by a row) ensures that <a href="Matrix_multiplication" title="wikilink">their multiplication</a> gives a matrix. It is convenient to display the matrix as a false-colour map.</p>
<h3 id="how-to-read-the-map">How to read the map</h3>

<p> The covariance map obtained in the FEL experiment<a class="footnoteRef" href="#fn3" id="fnref3"><sup>3</sup></a> is shown in Fig. 3. Along the <em>x</em> and <em>y</em> axes the averaged spectra 

<math display="inline" id="Covariance_mapping:13">
 <semantics>
  <mrow>
   <mo stretchy="false">âŸ¨</mo>
   <mi>ğ—</mi>
   <mo stretchy="false">âŸ©</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="latexml">delimited-âŸ¨âŸ©</csymbol>
    <ci>ğ—</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \langle\mathbf{X}\rangle
  </annotation>
 </semantics>
</math>


 and 

<math display="inline" id="Covariance_mapping:14">
 <semantics>
  <mrow>
   <mo stretchy="false">âŸ¨</mo>
   <mi>ğ˜</mi>
   <mo stretchy="false">âŸ©</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="latexml">delimited-âŸ¨âŸ©</csymbol>
    <ci>ğ˜</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \langle\mathbf{Y}\rangle
  </annotation>
 </semantics>
</math>

 are shown. These spectra are resolved on the map into pairwise correlations between energies of electrons coming from the same process. For example, if the process is the first process depicted in Fig. 2 (PP), then two low-energy electrons are ejected from the Ne core giving a positive island in the bottom-left corner of the map (one of the white ones). The island is positive because if one of the electrons is detected, there is higher than average probability of detecting also the other electron and the covariance of the signals at the two energies takes a positive value.</p>

<p>The volumes of the islands are directly proportional to the relative probabilities of the ionisation processes.<a class="footnoteRef" href="#fn4" id="fnref4"><sup>4</sup></a> This useful quality of the map follows from a property of the <a href="Poisson_distribution" title="wikilink">Poisson distribution</a>, which governs the number of neon atoms in the focal volume and the number of electrons produced at a particular energy, 

<math display="inline" id="Covariance_mapping:15">
 <semantics>
  <mrow>
   <msub>
    <mi>X</mi>
    <mi>n</mi>
   </msub>
   <mrow>
    <mo stretchy="false">(</mo>
    <msub>
     <mi>E</mi>
     <mi>i</mi>
    </msub>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>X</ci>
     <ci>n</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>E</ci>
     <ci>i</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   X_{n}(E_{i})
  </annotation>
 </semantics>
</math>

. The property employed here is that the <a class="uri" href="variance" title="wikilink">variance</a> of a Poisson distribution is equal to its <a class="uri" href="mean" title="wikilink">mean</a> and this property is also inherited by covariance. Therefore the covariance plotted on the map is proportional to the number of neon atoms that produce pairs of electrons of particular energies. This makes covariance much more suitable for particle counting experiments than other bivariate estimators, such as <a href="Pearson's_correlation_coefficient" title="wikilink">Pearson's correlation coefficient</a>.</p>

<p>On the diagonal of the map there is an autocorrelation line. It is present there because the same spectra are used for the <em>x</em> and <em>y</em> axes. Thus, if an electron pulse is present at a particular energy on one axis, it is also present on the other axis giving the variance signal along the 

<math display="inline" id="Covariance_mapping:16">
 <semantics>
  <mrow>
   <msub>
    <mi>E</mi>
    <mi>x</mi>
   </msub>
   <mo>=</mo>
   <msub>
    <mi>E</mi>
    <mi>y</mi>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>E</ci>
     <ci>x</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>E</ci>
     <ci>y</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   E_{x}=E_{y}
  </annotation>
 </semantics>
</math>

 line, which is usually stronger than the neighbouring covariance islands. The mirror symmetry of the map with respect to this line has the same origin. The autocorrelation line and the mirror symmetry are not present if two different detectors are used for the <em>x</em> and <em>y</em> signals, for example where one detector is used to detect ions and another to detect electrons.<a class="footnoteRef" href="#fn5" id="fnref5"><sup>5</sup></a></p>

<p> Much more information is present on the map than on the averaged, 1D spectrum. The single, often broad and indistinct peaks on the 1D spectrum are resolved into several islands on the map. Fig. 4 shows magnified core-core and core-valence regions with several ionisation sequences identified unambiguously. In the D<sub>KV</sub> process the two electrons ejected share arbitrarily the energy available from a single proton producing a conspicuous line <em>E<sub>x</sub></em> + <em>E<sub>y</sub></em> = const in the left panel of Fig. 4. Impurities, such as water vapour or nitrogen, give islands usually away from the islands of the species studied (see Fig. 3b,e,f).</p>
<h2 id="partial-covariance-mapping">Partial covariance mapping</h2>

<p>Covariance maps expose all kinds of correlations, including indirect ones that are induced by a fluctuating common parameter. Such common-mode correlations are often uninteresting and they obscure the interesting ones. For example, in the laser experiments the pulse intensity may fluctuate from shot to shot. These fluctuations correlate every electron with every other electron, simply because a more intense pulse produces more electrons of every energy.</p>
<h3 id="removal-of-uninteresting-correlations">Removal of uninteresting correlations</h3>

<p>The influence of such uninteresting correlations can be removed using partial covariance mapping. This method exposes only a part of the correlations, the part that is independent of the fluctuating parameter 

<math display="inline" id="Covariance_mapping:17">
 <semantics>
  <mi>I</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>I</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   I
  </annotation>
 </semantics>
</math>

, which has to be measured at every laser shot. The formula for partial covariance<a class="footnoteRef" href="#fn6" id="fnref6"><sup>6</sup></a> is</p>

<p>

<math display="block" id="Covariance_mapping:18">
 <semantics>
  <mrow>
   <mrow>
    <mrow>
     <mi>ğ©ğœğ¨ğ¯</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mi>ğ˜</mi>
      <mo>,</mo>
      <mi>ğ—</mi>
      <mo>;</mo>
      <mi>I</mi>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
    <mo>=</mo>
    <mrow>
     <mrow>
      <mi>ğœğ¨ğ¯</mi>
      <mrow>
       <mo stretchy="false">(</mo>
       <mi>ğ˜</mi>
       <mo>,</mo>
       <mi>ğ—</mi>
       <mo stretchy="false">)</mo>
      </mrow>
     </mrow>
     <mo>-</mo>
     <mrow>
      <mrow>
       <mi>ğœğ¨ğ¯</mi>
       <mrow>
        <mo stretchy="false">(</mo>
        <mi>ğ˜</mi>
        <mo>,</mo>
        <mi>I</mi>
        <mo stretchy="false">)</mo>
       </mrow>
       <mi>ğœğ¨ğ¯</mi>
       <mrow>
        <mo stretchy="false">(</mo>
        <mi>I</mi>
        <mo>,</mo>
        <mi>ğ—</mi>
        <mo stretchy="false">)</mo>
       </mrow>
      </mrow>
      <mo>/</mo>
      <mrow>
       <mo>cov</mo>
       <mrow>
        <mo stretchy="false">(</mo>
        <mi>I</mi>
        <mo>,</mo>
        <mi>I</mi>
        <mo stretchy="false">)</mo>
       </mrow>
      </mrow>
     </mrow>
    </mrow>
   </mrow>
   <mo>,</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <ci>ğ©ğœğ¨ğ¯</ci>
     <vector>
      <ci>ğ˜</ci>
      <ci>ğ—</ci>
      <ci>I</ci>
     </vector>
    </apply>
    <apply>
     <minus></minus>
     <apply>
      <times></times>
      <ci>ğœğ¨ğ¯</ci>
      <interval closure="open">
       <ci>ğ˜</ci>
       <ci>ğ—</ci>
      </interval>
     </apply>
     <apply>
      <divide></divide>
      <apply>
       <times></times>
       <ci>ğœğ¨ğ¯</ci>
       <interval closure="open">
        <ci>ğ˜</ci>
        <ci>I</ci>
       </interval>
       <ci>ğœğ¨ğ¯</ci>
       <interval closure="open">
        <ci>I</ci>
        <ci>ğ—</ci>
       </interval>
      </apply>
      <apply>
       <ci>cov</ci>
       <ci>I</ci>
       <ci>I</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{pcov}(\mathbf{Y},\mathbf{X};I)=\mathbf{cov}(\mathbf{Y},\mathbf{X})-%
\mathbf{cov}(\mathbf{Y},I)\mathbf{cov}(I,\mathbf{X})/\operatorname{cov}(I,I),
  </annotation>
 </semantics>
</math>

</p>

<p>where 

<math display="inline" id="Covariance_mapping:19">
 <semantics>
  <mrow>
   <mo>cov</mo>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>I</mi>
    <mo>,</mo>
    <mi>I</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>cov</ci>
    <ci>I</ci>
    <ci>I</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \operatorname{cov}(I,I)
  </annotation>
 </semantics>
</math>

 is the variance of the fluctuating parameter.</p>
<h3 id="stages-of-partial-covariance-mapping">Stages of partial covariance mapping</h3>

<p> It is instructive to see how this formula works on an example of another experiment performed at the <a href="DESY#FLASH" title="wikilink">FLASH</a> FEL in Hamburg. (In fact this method was also used to analyse the LCLS experiment described above, but to keep the Wikipedia description simple the partial covariance was not mentioned.) The FLASH experimental setup was very similar to the LCLS setup shown in Fig. 1, except molecular nitrogen was studied and its ions rather than electrons were detected.<a class="footnoteRef" href="#fn7" id="fnref7"><sup>7</sup></a> Fig. 5a shows the correlated product 

<math display="inline" id="Covariance_mapping:20">
 <semantics>
  <mrow>
   <mo stretchy="false">âŸ¨</mo>
   <mi>ğ˜ğ—</mi>
   <mo stretchy="false">âŸ©</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="latexml">delimited-âŸ¨âŸ©</csymbol>
    <ci>ğ˜ğ—</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \langle\mathbf{YX}\rangle
  </annotation>
 </semantics>
</math>

 and Fig. 5b shows the uncorrelated product 

<math display="inline" id="Covariance_mapping:21">
 <semantics>
  <mrow>
   <mrow>
    <mo stretchy="false">âŸ¨</mo>
    <mi>ğ˜</mi>
    <mo stretchy="false">âŸ©</mo>
   </mrow>
   <mrow>
    <mo stretchy="false">âŸ¨</mo>
    <mi>ğ—</mi>
    <mo stretchy="false">âŸ©</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <csymbol cd="latexml">delimited-âŸ¨âŸ©</csymbol>
     <ci>ğ˜</ci>
    </apply>
    <apply>
     <csymbol cd="latexml">delimited-âŸ¨âŸ©</csymbol>
     <ci>ğ—</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \langle\mathbf{Y}\rangle\langle\mathbf{X}\rangle
  </annotation>
 </semantics>
</math>

. Their difference gives the simple covariance map (c). The momentum correlation lines start to be visible (note a change in the colour scale) but the map is overwhelmed by correlations induced by FEL intensity fluctuations. These correlations are calculated in panel (d) and the correction is subtracted from map (c) giving map (e). The momentum correlation lines are now clearly visible but some residual common-mode background is still present, which is likely to be induced by other fluctuating parameters, such as the sample density or the FEL pulse duration. As these parameters were not monitored, simply an excess of the correction (d) was subtracted from map (e) giving map (f). This crude, <em>ad hoc</em> method significantly suppresses the residual common-mode background in the region of interest but the overcorrection introduces negative regions (magenta) at long time of flights. The detailed algorithm of partial covariance mapping is given in the Supplemental Material of the LCLS paper.<a class="footnoteRef" href="#fn8" id="fnref8"><sup>8</sup></a></p>
<h2 id="see-also">See also</h2>
<ul>
<li><a href="Photoelectron_photoion_coincidence_spectroscopy" title="wikilink">Photoelectron photoion coincidence spectroscopy</a></li>
</ul>
<h2 id="references">References</h2>

<p>"</p>

<p><a href="Category:Covariance_and_correlation" title="wikilink">Category:Covariance and correlation</a> <a href="Category:Fields_of_application_of_statistics" title="wikilink">Category:Fields of application of statistics</a> <a href="Category:Signal_processing" title="wikilink">Category:Signal processing</a> <a href="Category:Molecular_physics" title="wikilink">Category:Molecular physics</a> <a href="Category:Quantum_chemistry" title="wikilink">Category:Quantum chemistry</a> <a class="uri" href="Category:Photochemistry" title="wikilink">Category:Photochemistry</a></p>
<section class="footnotes">
<hr/>
<ol>
<li id="fn1">L J Frasinski, K Codling and P A Hatherly "Covariance Mapping: A Correlation Method Applied to Multiphoton Multiple Ionisation" <em>Science</em> <strong>246</strong> 1029â€“1031 (1989), <a href="http://hdl.handle.net/10044/1/14241">open access</a><a href="#fnref1">â†©</a></li>
<li id="fn2">L J Frasinski, V Zhaunerchyk, M Mucke, R J Squibb, M Siano, J H D Eland, P Linusson, P v.d. Meulen, P SalÃ©n, R D Thomas, M Larsson, L Foucar, J Ullrich, K Motomura, S Mondal, K Ueda, T Osipov, L Fang, B F Murphy, N Berrah, C Bostedt, J D Bozek, S Schorb, M Messerschmidt, J M Glownia, J P Cryan, R Coffee, O Takahashi, S Wada, M N Piancastelli, R Richter, K C Prince, and R Feifel "Dynamics of Hollow Atom Formation in Intense X-ray Pulses Probed by Partial Covariance Mapping" <em>Phys. Rev. Lett.</em> <strong>111</strong> 073002 (2013), <a href="http://hdl.handle.net/10044/1/11746">open access</a><a href="#fnref2">â†©</a></li>
<li id="fn3"></li>
<li id="fn4"></li>
<li id="fn5">L J Frasinski, M Stankiewicz, P A Hatherly, G M Cross and K Codling â€œMolecular H<sub>2</sub> in intense laser fields probed by electron-electron electron-ion and ion-ion covariance techniquesâ€ <em>Phys. Rev. A</em> <strong>46</strong> R6789â€“R6792 (1992), <a href="http://hdl.handle.net/10044/1/11612">open access</a><a href="#fnref5">â†©</a></li>
<li id="fn6">W J Krzanowski "Principles of Multivariate Analysis" (Oxford University Press, New York, 1988), Chap. 14.4; K V Mardia, J T Kent and J M Bibby "Multivariate Analysis (Academic Press, London, 1997), Chap. 6.5.3; T W Anderson "An Introduction to Multivariate Statistical Analysis" (Wiley, New York, 2003), 3rd ed., Chaps. 2.5.1 and 4.3.1.<a href="#fnref6">â†©</a></li>
<li id="fn7">O Kornilov, M Eckstein, M Rosenblatt, C P Schulz, K Motomura, A RouzÃ©e, J Klei, L Foucar, M Siano, A LÃ¼bcke, F. Schapper, P Johnsson, D M P Holland, T Schlatholter, T Marchenko, S DÃ¼sterer, K Ueda, M J J Vrakking and L J Frasinski "Coulomb explosion of diatomic molecules in intense XUV fields mapped by partial covariance" <em>J. Phys. B: At. Mol. Opt. Phys.</em> <strong>46</strong> 164028 (2013), <a href="http://hdl.handle.net/10044/1/12267">open access</a><a href="#fnref7">â†©</a></li>
<li id="fn8"></li>
</ol>
</section>
</body>
</html>
