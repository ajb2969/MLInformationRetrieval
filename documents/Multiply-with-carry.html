<html lang="en">
<head>
<meta charset="utf-8"/>
<title offset="1475">Multiply-with-carry</title>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG.js" type="text/javascript">
</script>
</head>
<body>
<h1>Multiply-with-carry</h1>
<style>
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
<style>
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
</body></html>
<body>
<hr/>

<p>In <a href="computer_science" title="wikilink">computer science</a>, <strong>multiply-with-carry</strong> (MWC) is a method invented by <a href="George_Marsaglia" title="wikilink">George Marsaglia</a> for generating sequences of random integers based on an initial set from two to many thousands of randomly chosen seed values. The main advantages of the MWC method are that it invokes simple computer integer arithmetic and leads to very fast generation of sequences of random numbers with immense periods, ranging from around 2<sup>60</sup> to 2<sup>2000000</sup>.</p>

<p>As with most <a href="pseudorandom_number_generator" title="wikilink">pseudorandom number generators</a>, the resulting sequences are functions of the randomly chosen seed values.</p>
<h2 id="general-theory">General theory</h2>

<p>A MWC sequence is based on arithmetic modulo a base <em>b</em>, usually <em>b</em> = 2<sup>32</sup>, because arithmetic modulo of that <em>b</em> is automatic in most computers. However, sometimes a base such as <em>b</em> = 2<sup>32</sup> − 1 is used, because arithmetic for modulus 2<sup>32</sup> − 1 requires only a simple adjustment from that for 2<sup>32</sup>, and theory for MWC sequences based on modulus 2<sup>32</sup> has some nagging difficulties avoided by using <em>b</em> = 2<sup>32</sup> − 1.</p>

<p>In its most common form, a <strong>lag-r</strong> MWC generator requires a <strong>base</strong> <em>b</em>, a <strong>multiplier</strong> <em>a</em>, and a set of <em>r+1</em> random <strong>seed</strong> values, consisting of <em>r</em> residues of <em>b</em>,</p>
<dl>
<dd><em>x</em><sub>0</sub>, <em>x</em><sub>1</sub>, <em>x</em><sub>2</sub>,..., <em>x</em><sub><em>r</em>−1</sub>,
</dd>
</dl>

<p>and an initial <strong>carry</strong> <em>c<sub><em>r</em>−1</sub></em> <em>n</em>, <em>c</em><sub><em>n</em></sub> determined by</p>

<p>

<math display="block" id="Multiply-with-carry:0">
 <semantics>
  <mrow>
   <mrow>
    <mrow>
     <msub>
      <mi>x</mi>
      <mi>n</mi>
     </msub>
     <mo>=</mo>
     <mrow>
      <mrow>
       <mo stretchy="false">(</mo>
       <mrow>
        <mrow>
         <mi>a</mi>
         <msub>
          <mi>x</mi>
          <mrow>
           <mi>n</mi>
           <mo>-</mo>
           <mi>r</mi>
          </mrow>
         </msub>
        </mrow>
        <mo>+</mo>
        <msub>
         <mi>c</mi>
         <mrow>
          <mi>n</mi>
          <mo>-</mo>
          <mn>1</mn>
         </mrow>
        </msub>
       </mrow>
       <mo rspace="4.2pt" stretchy="false">)</mo>
      </mrow>
      <mo lspace="2.5pt" rspace="4.2pt">mod</mo>
      <mi>b</mi>
     </mrow>
    </mrow>
    <mo rspace="7.5pt">,</mo>
    <mrow>
     <mrow>
      <msub>
       <mi>c</mi>
       <mi>n</mi>
      </msub>
      <mo>=</mo>
      <mrow>
       <mo>⌊</mo>
       <mfrac>
        <mrow>
         <mrow>
          <mi>a</mi>
          <msub>
           <mi>x</mi>
           <mrow>
            <mi>n</mi>
            <mo>-</mo>
            <mi>r</mi>
           </mrow>
          </msub>
         </mrow>
         <mo>+</mo>
         <msub>
          <mi>c</mi>
          <mrow>
           <mi>n</mi>
           <mo>-</mo>
           <mn>1</mn>
          </mrow>
         </msub>
        </mrow>
        <mi>b</mi>
       </mfrac>
       <mo>⌋</mo>
      </mrow>
     </mrow>
     <mo rspace="7.5pt">,</mo>
     <mrow>
      <mi>n</mi>
      <mo>≥</mo>
      <mi>r</mi>
     </mrow>
    </mrow>
   </mrow>
   <mo>,</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">formulae-sequence</csymbol>
    <apply>
     <eq></eq>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>x</ci>
      <ci>n</ci>
     </apply>
     <apply>
      <csymbol cd="latexml">modulo</csymbol>
      <apply>
       <plus></plus>
       <apply>
        <times></times>
        <ci>a</ci>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>x</ci>
         <apply>
          <minus></minus>
          <ci>n</ci>
          <ci>r</ci>
         </apply>
        </apply>
       </apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>c</ci>
        <apply>
         <minus></minus>
         <ci>n</ci>
         <cn type="integer">1</cn>
        </apply>
       </apply>
      </apply>
      <ci>b</ci>
     </apply>
    </apply>
    <apply>
     <csymbol cd="ambiguous">formulae-sequence</csymbol>
     <apply>
      <eq></eq>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>c</ci>
       <ci>n</ci>
      </apply>
      <apply>
       <floor></floor>
       <apply>
        <divide></divide>
        <apply>
         <plus></plus>
         <apply>
          <times></times>
          <ci>a</ci>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>x</ci>
           <apply>
            <minus></minus>
            <ci>n</ci>
            <ci>r</ci>
           </apply>
          </apply>
         </apply>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>c</ci>
          <apply>
           <minus></minus>
           <ci>n</ci>
           <cn type="integer">1</cn>
          </apply>
         </apply>
        </apply>
        <ci>b</ci>
       </apply>
      </apply>
     </apply>
     <apply>
      <geq></geq>
      <ci>n</ci>
      <ci>r</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   x_{n}=(ax_{n-r}+c_{n-1})\,\bmod\,b,\ c_{n}=\left\lfloor\frac{ax_{n-r}+c_{n-1}}%
{b}\right\rfloor,\ n\geq r,
  </annotation>
 </semantics>
</math>

</p>

<p>and the MWC generator output is the sequence of <em>x</em>'s,</p>
<dl>
<dd><em>x</em><sub><em>r</em></sub> , <em>x</em><sub><em>r</em>+1</sub> , <em>x</em><sub><em>r</em>+2</sub>, ...
</dd>
</dl>

<p>The period of a lag-<em>r</em> MWC generator is the order of <em>b</em> in the multiplicative group of numbers modulo <em>ab<sup>r</sup></em> − 1. It is customary to choose <em>a</em>'s so that <em>p = ab<sup>r</sup></em> − 1 is a prime for which the order of <em>b</em> can be determined. Because 2 is a <a href="quadratic_residue" title="wikilink">quadratic residue</a> of numbers of the form <em>8k±1</em>, <em>b</em> = 2<sup>32</sup> cannot be a primitive root of <em>p = ab<sup>r</sup></em> − 1. Therefore there are no MWC generators for base 2<sup>32</sup> that have the maximum possible period, one of the difficulties that use of <em>b</em> = 2<sup>32</sup> − 1 overcomes.</p>

<p>A theoretical problem with MWC generators, pointed out by Couture and l'Ecuyer (1997) is that the most significant bits are slightly biased; <a href="#Complementary-multiply-with-carry_generators" title="wikilink">complementary-multiply-with-carry</a> generators do not share this problem: "We shall see that, for the complementary MWC, each bit of the output value is fair, that is, the two binary digits will appear equally often in a full period, a property not shared by MWC generators." They do not appear to elaborate further as to the extent of the bias. Complementary-multiply-with-carry generators also require slightly more computation time per iteration, so there is a tradeoff to evaluate depending on implementation requirements.</p>
<h2 id="comparisons-with-linear-congruential-generators">Comparisons with linear congruential generators</h2>

<p><a href="Linear_congruential_generator" title="wikilink">Linear congruential generators</a> are implemented as</p>

<p>

<math display="block" id="Multiply-with-carry:1">
 <semantics>
  <mrow>
   <mrow>
    <msub>
     <mi>x</mi>
     <mrow>
      <mi>n</mi>
      <mo>+</mo>
      <mn>1</mn>
     </mrow>
    </msub>
    <mo>=</mo>
    <mrow>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <mrow>
        <mi>a</mi>
        <msub>
         <mi>x</mi>
         <mi>n</mi>
        </msub>
       </mrow>
       <mo>+</mo>
       <mi>c</mi>
      </mrow>
      <mo rspace="7.5pt" stretchy="false">)</mo>
     </mrow>
     <mo lspace="2.5pt" rspace="2.5pt">mod</mo>
     <msup>
      <mn>2</mn>
      <mn>32</mn>
     </msup>
    </mrow>
   </mrow>
   <mo>,</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>x</ci>
     <apply>
      <plus></plus>
      <ci>n</ci>
      <cn type="integer">1</cn>
     </apply>
    </apply>
    <apply>
     <csymbol cd="latexml">modulo</csymbol>
     <apply>
      <plus></plus>
      <apply>
       <times></times>
       <ci>a</ci>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>x</ci>
        <ci>n</ci>
       </apply>
      </apply>
      <ci>c</ci>
     </apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <cn type="float">2</cn>
      <cn type="integer">32</cn>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   x_{n+1}=(ax_{n}+c)\ \bmod\,2^{32},
  </annotation>
 </semantics>
</math>

 because most arithmetic processors are able to put the multiplier <em>a</em> and the current <em>x</em> in 32-bit registers, form the 64-bit product in adjoining registers, and take the lower 32 bits as the product, that is, form</p>

<p>

<math display="block" id="Multiply-with-carry:2">
 <semantics>
  <mrow>
   <mrow>
    <mi>a</mi>
    <mo>×</mo>
    <mpadded width="+5pt">
     <mi>x</mi>
    </mpadded>
   </mrow>
   <mo lspace="2.5pt" rspace="2.5pt">mod</mo>
   <msup>
    <mn>2</mn>
    <mn>32</mn>
   </msup>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="latexml">modulo</csymbol>
    <apply>
     <times></times>
     <ci>a</ci>
     <ci>x</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <cn type="float">2</cn>
     <cn type="integer">32</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   a\times x\ \bmod\,2^{32}
  </annotation>
 </semantics>
</math>

. Adding the 32-bit <em>c</em> to that lower half then provides (<em>ax</em>+<em>c</em>) mod 2<sup>32</sup>. If <em>a</em> mod 8 is 1 or 5 and <em>c</em> is odd, the resulting base 2<sup>32</sup> congruential sequence will have period 2<sup>32</sup>.</p>

<p>A lag-1 multiply-with-carry generator allows us to make the period nearly 2<sup>63</sup> by using those same computer operations, except that this time the top half of the 64-bit product is used rather than ignored after the 64 bits are formed. It is used as a <strong>new</strong> carry value <em>c</em> rather than the fixed carry value of the standard congruential sequence: Get <em>ax</em>+<em>c</em> in 64-bits, then form a new <em>c</em> as the top half of those 64 bits, and the new <em>x</em> as the bottom half.</p>

<p>With multiplier <em>a</em> specified, each pair of input values <em>x</em>, <em>c</em> is converted to a new pair,</p>

<p>

<math display="block" id="Multiply-with-carry:3">
 <semantics>
  <mrow>
   <mrow>
    <mrow>
     <mi>x</mi>
     <mo>←</mo>
     <mrow>
      <mrow>
       <mo stretchy="false">(</mo>
       <mrow>
        <mrow>
         <mi>a</mi>
         <mi>x</mi>
        </mrow>
        <mo>+</mo>
        <mi>c</mi>
       </mrow>
       <mo rspace="4.2pt" stretchy="false">)</mo>
      </mrow>
      <mo lspace="2.5pt" rspace="2.5pt">mod</mo>
      <msup>
       <mn>2</mn>
       <mn>32</mn>
      </msup>
     </mrow>
    </mrow>
    <mo rspace="12.5pt">,</mo>
    <mrow>
     <mi>c</mi>
     <mo>←</mo>
     <mrow>
      <mo>⌊</mo>
      <mfrac>
       <mrow>
        <mrow>
         <mi>a</mi>
         <mi>x</mi>
        </mrow>
        <mo>+</mo>
        <mi>c</mi>
       </mrow>
       <msup>
        <mn>2</mn>
        <mn>32</mn>
       </msup>
      </mfrac>
      <mo>⌋</mo>
     </mrow>
    </mrow>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">formulae-sequence</csymbol>
    <apply>
     <ci>normal-←</ci>
     <ci>x</ci>
     <apply>
      <csymbol cd="latexml">modulo</csymbol>
      <apply>
       <plus></plus>
       <apply>
        <times></times>
        <ci>a</ci>
        <ci>x</ci>
       </apply>
       <ci>c</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <cn type="float">2</cn>
       <cn type="integer">32</cn>
      </apply>
     </apply>
    </apply>
    <apply>
     <ci>normal-←</ci>
     <ci>c</ci>
     <apply>
      <floor></floor>
      <apply>
       <divide></divide>
       <apply>
        <plus></plus>
        <apply>
         <times></times>
         <ci>a</ci>
         <ci>x</ci>
        </apply>
        <ci>c</ci>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <cn type="integer">2</cn>
        <cn type="integer">32</cn>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   x\leftarrow(ax+c)\,\bmod\,2^{32},\ \ c\leftarrow\left\lfloor\frac{ax+c}{2^{32}%
}\right\rfloor.
  </annotation>
 </semantics>
</math>

</p>

<p>If <em>x</em> and <em>c</em> are not both zero, then the period of the resulting multiply-with-carry sequence will be the order of <em>b</em> = 2<sup>32</sup> in the multiplicative group of residues modulo <em>ab</em> − 1, that is, the smallest <em>n</em> such that <em>b</em><sup><em>n</em></sup> = 1 mod (<em>ab</em> − 1). If we choose an <em>a</em> of 28 to 31 bits such that <em>ab</em>−1 is a "<a href="safe_prime" title="wikilink">safe prime</a>", that is both <em>ab</em> − 1 and <em>ab</em>/2 − 1 are prime, then the period will be <em>ab</em>/2 − 1, approaching 2<sup>63</sup>, which in practice may be an acceptably large subset of the number of possible 32-bit pairs (<em>x</em>, <em>c</em>).</p>

<p>Following are some maximal values of <em>a</em> for computer applications which satisfy the above safe prime condition:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">
<p>Bits in <em>a</em></p></th>
<th style="text-align: left;">
<p><em>b</em></p></th>
<th style="text-align: left;">
<p>Maximum <em>a</em> Such That <em>ab</em>−1 is a Safe Prime</p></th>
<th style="text-align: left;">
<p>Period</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">
<p>15</p></td>
<td style="text-align: left;">
<p>2<sup>16</sup></p></td>
<td style="text-align: left;">
<p>2<sup>15</sup>−50 = 32,718</p></td>
<td style="text-align: left;">
<p>1,072,103,423</p></td>
</tr>
<tr class="even">
<td style="text-align: left;">
<p>16</p></td>
<td style="text-align: left;">
<p>2<sup>16</sup></p></td>
<td style="text-align: left;">
<p>2<sup>16</sup>−352 = 65,184</p></td>
<td style="text-align: left;">
<p>2,135,949,311</p></td>
</tr>
<tr class="odd">
<td style="text-align: left;">
<p>31</p></td>
<td style="text-align: left;">
<p>2<sup>32</sup></p></td>
<td style="text-align: left;">
<p>2<sup>31</sup>−563 = 2,147,483,085</p></td>
<td style="text-align: left;">
<p>4,611,684,809,394,094,079</p></td>
</tr>
<tr class="even">
<td style="text-align: left;">
<p>32</p></td>
<td style="text-align: left;">
<p>2<sup>32</sup></p></td>
<td style="text-align: left;">
<p>2<sup>32</sup>−178 = 4,294,967,118</p></td>
<td style="text-align: left;">
<p>9,223,371,654,602,686,463</p></td>
</tr>
<tr class="odd">
<td style="text-align: left;">
<p>64</p></td>
<td style="text-align: left;">
<p>2<sup>64</sup></p></td>
<td style="text-align: left;">
<p>2<sup>64</sup>−742 = 18,446,744,073,709,550,874</p></td>
<td style="text-align: left;">
<p>170,141,183,460,469,224,887,945,252,369,640,456,191</p></td>
</tr>
<tr class="even">
<td style="text-align: left;">
<p>128</p></td>
<td style="text-align: left;">
<p>2<sup>128</sup></p></td>
<td style="text-align: left;">
<p>2<sup>128</sup>−10,408</p></td>
<td style="text-align: left;">
<p>2<sup>127</sup>(2<sup>128</sup>−10,408)−1</p></td>
</tr>
<tr class="odd">
<td style="text-align: left;">
<p>256</p></td>
<td style="text-align: left;">
<p>2<sup>256</sup></p></td>
<td style="text-align: left;">
<p>2<sup>256</sup>−9166</p></td>
<td style="text-align: left;">
<p>2<sup>255</sup>(2<sup>256</sup>−9166)−1</p></td>
</tr>
<tr class="even">
<td style="text-align: left;">
<p>512</p></td>
<td style="text-align: left;">
<p>2<sup>512</sup></p></td>
<td style="text-align: left;">
<p>2<sup>512</sup>−150,736</p></td>
<td style="text-align: left;">
<p>2<sup>511</sup>(2<sup>512</sup>−150,736)-1</p></td>
</tr>
</tbody>
</table>

<p>However, as being a safe prime does not affect the randomness of the sequence, one may instead simply choose <em>a</em> such that the order of <em>b</em> is <em>ab</em>/2 − 1. The following are again maximum values of <em>a</em> of various sizes.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">
<p>Bits in <em>a</em></p></th>
<th style="text-align: left;">
<p><em>b</em></p></th>
<th style="text-align: left;">
<p>Maximum <em>a</em> Such that <em>b</em> has order <em>ab</em>/2−1</p></th>
<th style="text-align: left;">
<p>Period</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">
<p>15</p></td>
<td style="text-align: left;">
<p>2<sup>16</sup></p></td>
<td style="text-align: left;">
<p>2<sup>15</sup>−29 = 32,739</p></td>
<td style="text-align: left;">
<p>1,072,791,551</p></td>
</tr>
<tr class="even">
<td style="text-align: left;">
<p>16</p></td>
<td style="text-align: left;">
<p>2<sup>16</sup></p></td>
<td style="text-align: left;">
<p>2<sup>16</sup>−22 = 65,514</p></td>
<td style="text-align: left;">
<p>2,146,762,751</p></td>
</tr>
<tr class="odd">
<td style="text-align: left;">
<p>31</p></td>
<td style="text-align: left;">
<p>2<sup>32</sup></p></td>
<td style="text-align: left;">
<p>2<sup>31</sup>−68 = 2,147,483,580</p></td>
<td style="text-align: left;">
<p>4,611,685,872,398,499,839</p></td>
</tr>
<tr class="even">
<td style="text-align: left;">
<p>32</p></td>
<td style="text-align: left;">
<p>2<sup>32</sup></p></td>
<td style="text-align: left;">
<p>2<sup>32</sup>−76 = 4,294,967,220</p></td>
<td style="text-align: left;">
<p>9,223,371,873,646,018,559</p></td>
</tr>
<tr class="odd">
<td style="text-align: left;">
<p>63</p></td>
<td style="text-align: left;">
<p>2<sup>64</sup></p></td>
<td style="text-align: left;">
<p>2<sup>63</sup>−140 = 9,223,372,036,854,775,668</p></td>
<td style="text-align: left;">
<p>85,070,591,730,234,614,574,571,566,698,273,439,743</p></td>
</tr>
<tr class="even">
<td style="text-align: left;">
<p>64</p></td>
<td style="text-align: left;">
<p>2<sup>64</sup></p></td>
<td style="text-align: left;">
<p>2<sup>64</sup>−116 = 18,446,744,073,709,551,500</p></td>
<td style="text-align: left;">
<p>170,141,183,460,469,230,661,776,147,440,730,111,999</p></td>
</tr>
</tbody>
</table>

<p>Here is a comparison of congruential and MWC sequences for the simple case of arithmetic modulo 10; here the "registers" are a single digit, adjoining registers are two digits:</p>

<p>Starting with 

<math display="inline" id="Multiply-with-carry:4">
 <semantics>
  <mrow>
   <msub>
    <mi>x</mi>
    <mn>0</mn>
   </msub>
   <mo>=</mo>
   <mn>1</mn>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>x</ci>
     <cn type="integer">0</cn>
    </apply>
    <cn type="integer">1</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   x_{0}=1
  </annotation>
 </semantics>
</math>

, the congruential sequence</p>

<p>

<math display="block" id="Multiply-with-carry:5">
 <semantics>
  <mrow>
   <mrow>
    <msub>
     <mi>x</mi>
     <mi>n</mi>
    </msub>
    <mo>=</mo>
    <mrow>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <mrow>
        <mn>7</mn>
        <msub>
         <mi>x</mi>
         <mrow>
          <mi>n</mi>
          <mo>-</mo>
          <mn>1</mn>
         </mrow>
        </msub>
       </mrow>
       <mo>+</mo>
       <mn>3</mn>
      </mrow>
      <mo rspace="4.2pt" stretchy="false">)</mo>
     </mrow>
     <mo lspace="2.5pt" rspace="2.5pt">mod</mo>
     <mn>10</mn>
    </mrow>
   </mrow>
   <mo>,</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>x</ci>
     <ci>n</ci>
    </apply>
    <apply>
     <csymbol cd="latexml">modulo</csymbol>
     <apply>
      <plus></plus>
      <apply>
       <times></times>
       <cn type="integer">7</cn>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>x</ci>
        <apply>
         <minus></minus>
         <ci>n</ci>
         <cn type="integer">1</cn>
        </apply>
       </apply>
      </apply>
      <cn type="integer">3</cn>
     </apply>
     <cn type="float">10</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   x_{n}=(7x_{n-1}+3)\,\bmod\,10,
  </annotation>
 </semantics>
</math>

</p>

<p>has this sequence of adjoining registers:</p>

<p>

<math display="block" id="Multiply-with-carry:6">
 <semantics>
  <mrow>
   <mrow>
    <mn>10</mn>
    <mo>,</mo>
    <mn>03</mn>
    <mo>,</mo>
    <mn>24</mn>
    <mo>,</mo>
    <mn>31</mn>
    <mo>,</mo>
    <mn>10</mn>
    <mo>,</mo>
    <mn>03</mn>
    <mo>,</mo>
    <mn>24</mn>
    <mo>,</mo>
    <mn>31</mn>
    <mo>,</mo>
    <mn>10</mn>
    <mo>,</mo>
    <mi mathvariant="normal">…</mi>
   </mrow>
   <mo>,</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <list>
    <cn type="integer">10</cn>
    <cn type="integer">03</cn>
    <cn type="integer">24</cn>
    <cn type="integer">31</cn>
    <cn type="integer">10</cn>
    <cn type="integer">03</cn>
    <cn type="integer">24</cn>
    <cn type="integer">31</cn>
    <cn type="integer">10</cn>
    <ci>normal-…</ci>
   </list>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   10,03,24,31,10,03,24,31,10,\ldots,
  </annotation>
 </semantics>
</math>

</p>

<p>and the output sequence of <em>x</em>'s, (the rightmost register), has period 4:</p>

<p>

<math display="block" id="Multiply-with-carry:7">
 <semantics>
  <mrow>
   <mn>0</mn>
   <mo>,</mo>
   <mn>3</mn>
   <mo>,</mo>
   <mn>4</mn>
   <mo>,</mo>
   <mn>1</mn>
   <mo>,</mo>
   <mn>0</mn>
   <mo>,</mo>
   <mn>3</mn>
   <mo>,</mo>
   <mn>4</mn>
   <mo>,</mo>
   <mn>1</mn>
   <mo>,</mo>
   <mn>0</mn>
   <mo>,</mo>
   <mn>3</mn>
   <mo>,</mo>
   <mn>4</mn>
   <mo>,</mo>
   <mn>1</mn>
   <mo>,</mo>
   <mi mathvariant="normal">…</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <list>
    <cn type="integer">0</cn>
    <cn type="integer">3</cn>
    <cn type="integer">4</cn>
    <cn type="integer">1</cn>
    <cn type="integer">0</cn>
    <cn type="integer">3</cn>
    <cn type="integer">4</cn>
    <cn type="integer">1</cn>
    <cn type="integer">0</cn>
    <cn type="integer">3</cn>
    <cn type="integer">4</cn>
    <cn type="integer">1</cn>
    <ci>normal-…</ci>
   </list>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   0,3,4,1,0,3,4,1,0,3,4,1,\ldots
  </annotation>
 </semantics>
</math>

</p>

<p>Starting with 

<math display="inline" id="Multiply-with-carry:8">
 <semantics>
  <mrow>
   <mrow>
    <msub>
     <mi>x</mi>
     <mn>0</mn>
    </msub>
    <mo>=</mo>
    <mn>1</mn>
   </mrow>
   <mo>,</mo>
   <mrow>
    <msub>
     <mi>c</mi>
     <mn>0</mn>
    </msub>
    <mo>=</mo>
    <mn>3</mn>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">formulae-sequence</csymbol>
    <apply>
     <eq></eq>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>x</ci>
      <cn type="integer">0</cn>
     </apply>
     <cn type="integer">1</cn>
    </apply>
    <apply>
     <eq></eq>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>c</ci>
      <cn type="integer">0</cn>
     </apply>
     <cn type="integer">3</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   x_{0}=1,c_{0}=3
  </annotation>
 </semantics>
</math>

, the MWC sequence</p>

<p>

<math display="block" id="Multiply-with-carry:9">
 <semantics>
  <mrow>
   <mrow>
    <mrow>
     <msub>
      <mi>x</mi>
      <mi>n</mi>
     </msub>
     <mo>=</mo>
     <mrow>
      <mrow>
       <mo stretchy="false">(</mo>
       <mrow>
        <mrow>
         <mn>7</mn>
         <msub>
          <mi>x</mi>
          <mrow>
           <mi>n</mi>
           <mo>-</mo>
           <mn>1</mn>
          </mrow>
         </msub>
        </mrow>
        <mo>+</mo>
        <msub>
         <mi>c</mi>
         <mrow>
          <mi>n</mi>
          <mo>-</mo>
          <mn>1</mn>
         </mrow>
        </msub>
       </mrow>
       <mo rspace="4.2pt" stretchy="false">)</mo>
      </mrow>
      <mo lspace="2.5pt" rspace="2.5pt">mod</mo>
      <mn>10</mn>
     </mrow>
    </mrow>
    <mo rspace="7.5pt">,</mo>
    <mrow>
     <msub>
      <mi>c</mi>
      <mi>n</mi>
     </msub>
     <mo>=</mo>
     <mrow>
      <mo>⌊</mo>
      <mfrac>
       <mrow>
        <mrow>
         <mn>7</mn>
         <msub>
          <mi>x</mi>
          <mrow>
           <mi>n</mi>
           <mo>-</mo>
           <mn>1</mn>
          </mrow>
         </msub>
        </mrow>
        <mo>+</mo>
        <msub>
         <mi>c</mi>
         <mrow>
          <mi>n</mi>
          <mo>-</mo>
          <mn>1</mn>
         </mrow>
        </msub>
       </mrow>
       <mn>10</mn>
      </mfrac>
      <mo>⌋</mo>
     </mrow>
    </mrow>
   </mrow>
   <mo>,</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">formulae-sequence</csymbol>
    <apply>
     <eq></eq>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>x</ci>
      <ci>n</ci>
     </apply>
     <apply>
      <csymbol cd="latexml">modulo</csymbol>
      <apply>
       <plus></plus>
       <apply>
        <times></times>
        <cn type="integer">7</cn>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>x</ci>
         <apply>
          <minus></minus>
          <ci>n</ci>
          <cn type="integer">1</cn>
         </apply>
        </apply>
       </apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>c</ci>
        <apply>
         <minus></minus>
         <ci>n</ci>
         <cn type="integer">1</cn>
        </apply>
       </apply>
      </apply>
      <cn type="float">10</cn>
     </apply>
    </apply>
    <apply>
     <eq></eq>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>c</ci>
      <ci>n</ci>
     </apply>
     <apply>
      <floor></floor>
      <apply>
       <divide></divide>
       <apply>
        <plus></plus>
        <apply>
         <times></times>
         <cn type="integer">7</cn>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>x</ci>
          <apply>
           <minus></minus>
           <ci>n</ci>
           <cn type="integer">1</cn>
          </apply>
         </apply>
        </apply>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>c</ci>
         <apply>
          <minus></minus>
          <ci>n</ci>
          <cn type="integer">1</cn>
         </apply>
        </apply>
       </apply>
       <cn type="integer">10</cn>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   x_{n}=(7x_{n-1}+c_{n-1})\,\bmod\,10,\ c_{n}=\left\lfloor\frac{7x_{n-1}+c_{n-1}%
}{10}\right\rfloor,
  </annotation>
 </semantics>
</math>

</p>

<p>has this sequence of adjoining registers</p>
<dl>
<dd>10,01,07,49,67,55,40,04,28,58,61,13,22,16,43,25,37,52,19,64,34,31 10,01,07,...
</dd>
</dl>

<p>with output sequence of <em>x</em>'s having period 22:</p>
<dl>
<dd>0,1,7,9,7,5,0,4,8,8,1,3,2,6,3,5,7,2,9,4,4,1 0,1,7,9,7,5,0,...
</dd>
</dl>

<p>Notice that if those repeated segments of <em>x</em> values are put in reverse order starting from a 

<math display="inline" id="Multiply-with-carry:10">
 <semantics>
  <msub>
   <mi>x</mi>
   <mrow>
    <mrow>
     <mn>22</mn>
     <mi>n</mi>
    </mrow>
    <mo>+</mo>
    <mn>20</mn>
   </mrow>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>x</ci>
    <apply>
     <plus></plus>
     <apply>
      <times></times>
      <cn type="integer">22</cn>
      <ci>n</ci>
     </apply>
     <cn type="integer">20</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   x_{22n+20}
  </annotation>
 </semantics>
</math>

,</p>

<p>

<math display="block" id="Multiply-with-carry:11">
 <semantics>
  <mrow>
   <mn>449275</mn>
   <mi mathvariant="normal">⋯</mi>
   <mn>97101 449275</mn>
   <mi mathvariant="normal">⋯</mi>
   <mn>9710144</mn>
   <mi mathvariant="normal">⋯</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <cn type="integer">449275</cn>
    <ci>normal-⋯</ci>
    <cn type="float">97101 449275</cn>
    <ci>normal-⋯</ci>
    <cn type="integer">9710144</cn>
    <ci>normal-⋯</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   449275\cdots 97101\,449275\cdots 9710144\cdots
  </annotation>
 </semantics>
</math>

 we get the expansion <em>j</em>/(<em>ab</em>−1) with <em>a</em>=7, <em>b</em>=10, <em>j=31</em>:</p>

<p>

<math display="block" id="Multiply-with-carry:12">
 <semantics>
  <mrow>
   <mfrac>
    <mn>31</mn>
    <mn>69</mn>
   </mfrac>
   <mo>=</mo>
   <mrow>
    <mn>.4492753623188405797101 4492753623</mn>
    <mi mathvariant="normal">…</mi>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <divide></divide>
     <cn type="integer">31</cn>
     <cn type="integer">69</cn>
    </apply>
    <apply>
     <times></times>
     <cn type="float">.4492753623188405797101 4492753623</cn>
     <ci>normal-…</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \frac{31}{69}=.4492753623188405797101\,4492753623\ldots
  </annotation>
 </semantics>
</math>

</p>

<p>This is true in general: The sequence of <em>x</em>'s produced by a lag-<em>r</em> MWC generator:</p>

<p>

<math display="block" id="Multiply-with-carry:13">
 <semantics>
  <mrow>
   <mrow>
    <mrow>
     <msub>
      <mi>x</mi>
      <mi>n</mi>
     </msub>
     <mo>=</mo>
     <mrow>
      <mrow>
       <mo stretchy="false">(</mo>
       <mrow>
        <mrow>
         <mi>a</mi>
         <msub>
          <mi>x</mi>
          <mrow>
           <mi>n</mi>
           <mo>-</mo>
           <mi>r</mi>
          </mrow>
         </msub>
        </mrow>
        <mo>+</mo>
        <msub>
         <mi>c</mi>
         <mrow>
          <mi>n</mi>
          <mo>-</mo>
          <mn>1</mn>
         </mrow>
        </msub>
       </mrow>
       <mo stretchy="false">)</mo>
      </mrow>
      <mo lspace="2.5pt" rspace="4.2pt">mod</mo>
      <mpadded width="+1.7pt">
       <mi>b</mi>
      </mpadded>
     </mrow>
    </mrow>
    <mo rspace="12.5pt">,</mo>
    <mrow>
     <msub>
      <mi>c</mi>
      <mi>n</mi>
     </msub>
     <mo>=</mo>
     <mrow>
      <mo>⌊</mo>
      <mfrac>
       <mrow>
        <mrow>
         <mi>a</mi>
         <msub>
          <mi>x</mi>
          <mrow>
           <mi>n</mi>
           <mo>-</mo>
           <mi>r</mi>
          </mrow>
         </msub>
        </mrow>
        <mo>+</mo>
        <msub>
         <mi>c</mi>
         <mrow>
          <mi>n</mi>
          <mo>-</mo>
          <mn>1</mn>
         </mrow>
        </msub>
       </mrow>
       <mi>b</mi>
      </mfrac>
      <mo>⌋</mo>
     </mrow>
    </mrow>
   </mrow>
   <mo>,</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">formulae-sequence</csymbol>
    <apply>
     <eq></eq>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>x</ci>
      <ci>n</ci>
     </apply>
     <apply>
      <csymbol cd="latexml">modulo</csymbol>
      <apply>
       <plus></plus>
       <apply>
        <times></times>
        <ci>a</ci>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>x</ci>
         <apply>
          <minus></minus>
          <ci>n</ci>
          <ci>r</ci>
         </apply>
        </apply>
       </apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>c</ci>
        <apply>
         <minus></minus>
         <ci>n</ci>
         <cn type="integer">1</cn>
        </apply>
       </apply>
      </apply>
      <ci>b</ci>
     </apply>
    </apply>
    <apply>
     <eq></eq>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>c</ci>
      <ci>n</ci>
     </apply>
     <apply>
      <floor></floor>
      <apply>
       <divide></divide>
       <apply>
        <plus></plus>
        <apply>
         <times></times>
         <ci>a</ci>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>x</ci>
          <apply>
           <minus></minus>
           <ci>n</ci>
           <ci>r</ci>
          </apply>
         </apply>
        </apply>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>c</ci>
         <apply>
          <minus></minus>
          <ci>n</ci>
          <cn type="integer">1</cn>
         </apply>
        </apply>
       </apply>
       <ci>b</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   x_{n}=(ax_{n-r}+c_{n-1})\bmod\,b\,,\ \ c_{n}=\left\lfloor\frac{ax_{n-r}+c_{n-1%
}}{b}\right\rfloor,
  </annotation>
 </semantics>
</math>

</p>

<p>when put in reverse order, will be the base-<em>b</em> expansion of a rational <em>j</em>/(<em>ab</em><sup><em>r</em></sup> − 1) for some 0 <em>r</em>.</p>

<p>Also notice that if, starting with 

<math display="inline" id="Multiply-with-carry:14">
 <semantics>
  <mrow>
   <msub>
    <mi>x</mi>
    <mn>0</mn>
   </msub>
   <mo>=</mo>
   <mn>34</mn>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>x</ci>
     <cn type="integer">0</cn>
    </apply>
    <cn type="integer">34</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   x_{0}=34
  </annotation>
 </semantics>
</math>

, we generate the ordinary congruential sequence</p>

<p>

<math display="block" id="Multiply-with-carry:15">
 <semantics>
  <mrow>
   <msub>
    <mi>x</mi>
    <mi>n</mi>
   </msub>
   <mo>=</mo>
   <mrow>
    <mrow>
     <mn>7</mn>
     <mpadded width="+1.7pt">
      <msub>
       <mi>x</mi>
       <mrow>
        <mi>n</mi>
        <mo>-</mo>
        <mn>1</mn>
       </mrow>
      </msub>
     </mpadded>
    </mrow>
    <mo lspace="2.5pt" rspace="2.5pt">mod</mo>
    <mn>69</mn>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>x</ci>
     <ci>n</ci>
    </apply>
    <apply>
     <csymbol cd="latexml">modulo</csymbol>
     <apply>
      <times></times>
      <cn type="integer">7</cn>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>x</ci>
       <apply>
        <minus></minus>
        <ci>n</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
     </apply>
     <cn type="float">69</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   x_{n}=7x_{n-1}\,\bmod\,69
  </annotation>
 </semantics>
</math>

, we get the period 22 sequence</p>
<dl>
<dd>31,10,1,7,49,67,55,40,4,28,58,61,13,22,16,43,25,37,52,19,64,34, 31,10,1,7,...
</dd>
</dl>

<p>and that sequence, reduced mod 10, is</p>
<dl>
<dd>1,0,1,7,9,7,5,0,4,8,8,1,3,2,6,3,5,7,2,9,4,4, 1,0,1,7,9,7,5,0,...
</dd>
</dl>

<p>the same sequence of <em>x</em>'s resulting from the MWC sequence.</p>

<p>This is true in general, (but apparently only for lag-1 MWC sequences):</p>

<p>Given initial values 

<math display="inline" id="Multiply-with-carry:16">
 <semantics>
  <mrow>
   <msub>
    <mi>x</mi>
    <mn>0</mn>
   </msub>
   <mo>,</mo>
   <msub>
    <mi>c</mi>
    <mn>0</mn>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <list>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>x</ci>
     <cn type="integer">0</cn>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>c</ci>
     <cn type="integer">0</cn>
    </apply>
   </list>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   x_{0},c_{0}
  </annotation>
 </semantics>
</math>

, the sequence 

<math display="inline" id="Multiply-with-carry:17">
 <semantics>
  <mrow>
   <msub>
    <mi>x</mi>
    <mn>1</mn>
   </msub>
   <mo>,</mo>
   <msub>
    <mi>x</mi>
    <mn>2</mn>
   </msub>
   <mo>,</mo>
   <mi mathvariant="normal">…</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <list>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>x</ci>
     <cn type="integer">1</cn>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>x</ci>
     <cn type="integer">2</cn>
    </apply>
    <ci>normal-…</ci>
   </list>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   x_{1},x_{2},\ldots
  </annotation>
 </semantics>
</math>


 resulting from the lag-1 MWC sequence</p>

<p>

<math display="block" id="Multiply-with-carry:18">
 <semantics>
  <mrow>
   <mrow>
    <msub>
     <mi>x</mi>
     <mi>n</mi>
    </msub>
    <mo>=</mo>
    <mrow>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <mrow>
        <mi>a</mi>
        <msub>
         <mi>x</mi>
         <mrow>
          <mi>n</mi>
          <mo>-</mo>
          <mn>1</mn>
         </mrow>
        </msub>
       </mrow>
       <mo>+</mo>
       <msub>
        <mi>c</mi>
        <mrow>
         <mi>n</mi>
         <mo>-</mo>
         <mn>1</mn>
        </mrow>
       </msub>
      </mrow>
      <mo rspace="4.2pt" stretchy="false">)</mo>
     </mrow>
     <mo lspace="2.5pt" rspace="2.5pt">mod</mo>
     <mpadded width="+1.7pt">
      <mi>b</mi>
     </mpadded>
    </mrow>
   </mrow>
   <mo rspace="12.5pt">,</mo>
   <mrow>
    <msub>
     <mi>c</mi>
     <mi>n</mi>
    </msub>
    <mo>=</mo>
    <mrow>
     <mo>⌊</mo>
     <mfrac>
      <mrow>
       <mrow>
        <mi>a</mi>
        <msub>
         <mi>x</mi>
         <mrow>
          <mi>n</mi>
          <mo>-</mo>
          <mn>1</mn>
         </mrow>
        </msub>
       </mrow>
       <mo>+</mo>
       <msub>
        <mi>c</mi>
        <mrow>
         <mi>n</mi>
         <mo>-</mo>
         <mn>1</mn>
        </mrow>
       </msub>
      </mrow>
      <mi>b</mi>
     </mfrac>
     <mo>⌋</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">formulae-sequence</csymbol>
    <apply>
     <eq></eq>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>x</ci>
      <ci>n</ci>
     </apply>
     <apply>
      <csymbol cd="latexml">modulo</csymbol>
      <apply>
       <plus></plus>
       <apply>
        <times></times>
        <ci>a</ci>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>x</ci>
         <apply>
          <minus></minus>
          <ci>n</ci>
          <cn type="integer">1</cn>
         </apply>
        </apply>
       </apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>c</ci>
        <apply>
         <minus></minus>
         <ci>n</ci>
         <cn type="integer">1</cn>
        </apply>
       </apply>
      </apply>
      <ci>b</ci>
     </apply>
    </apply>
    <apply>
     <eq></eq>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>c</ci>
      <ci>n</ci>
     </apply>
     <apply>
      <floor></floor>
      <apply>
       <divide></divide>
       <apply>
        <plus></plus>
        <apply>
         <times></times>
         <ci>a</ci>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>x</ci>
          <apply>
           <minus></minus>
           <ci>n</ci>
           <cn type="integer">1</cn>
          </apply>
         </apply>
        </apply>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>c</ci>
         <apply>
          <minus></minus>
          <ci>n</ci>
          <cn type="integer">1</cn>
         </apply>
        </apply>
       </apply>
       <ci>b</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   x_{n}=(ax_{n-1}+c_{n-1})\,\bmod b\,,\ \ c_{n}=\left\lfloor\frac{ax_{n-1}+c_{n-%
1}}{b}\right\rfloor
  </annotation>
 </semantics>
</math>

</p>

<p>is exactly the congruential sequence <em>y</em><sub><em>n</em></sub> = <em>ay</em><sub><em>n</em> − 1</sub> mod(<em>ab</em> − 1), reduced modulo <em>b</em>.</p>

<p>Choice of initial value <em>y</em><sub>0</sub> merely rotates the cycle of <em>x</em>'s.</p>
<h2 id="complementary-multiply-with-carry-generators">Complementary-multiply-with-carry generators</h2>

<p>Establishing the period of a lag-<em>r</em> MWC generator usually entails choosing multiplier <em>a</em> so that <em>p</em>=<em>ab</em><sup><em>r</em></sup> − 1 is prime. If <em>p</em> is a <a href="safe_prime" title="wikilink">safe prime</a>, then the order of <em>b</em> will be <em>p</em> − 1 or (<em>p</em> − 1)/2. Otherwise, it is likely that <em>p</em> − 1 will have to be factored in order to find the order of <em>b</em> mod <em>p</em>, and <em>p</em> = <em>ab</em><sup><em>r</em></sup> − 1 may be difficult to factor.</p>

<p>But a prime of the form <em>p</em> = <em>ab</em><sup><em>r</em></sup> + 1 will make <em>p</em>−1 easy to factor, so a version of multiply-with-carry that involves the order of <em>b</em> for a prime <em>p</em> = <em>ab</em><sup><em>r</em></sup> + 1 would reduce considerably the computational number theory required to establish the period of a MWC sequence.</p>

<p>Fortunately, a slight modification of the MWC procedure leads to primes of the form <em>ab</em><sup><em>r</em></sup> + 1. The new procedure is called complementary-multiply-with-carry (CMWC),</p>

<p>and the setup is the same as that for lag-<em>r</em> MWC: <strong>multiplier</strong> <em>a</em>, <strong>base</strong> <em>b</em>, <em>r</em> + 1 seeds</p>
<dl>
<dd><em>x</em><sub>0</sub>, <em>x</em><sub>1</sub>, <em>x</em><sub>2</sub>, ..., <em>x</em><sub><em>r</em>−1</sub>, and <em>c</em><sub><em>r</em> − 1</sub>.
</dd>
</dl>

<p>There is a slight change in the generation of a new pair (<em>x</em>, <em>c</em>): 

<math display="inline" id="Multiply-with-carry:19">
 <semantics>
  <mrow>
   <mrow>
    <mrow>
     <msub>
      <mi>x</mi>
      <mi>n</mi>
     </msub>
     <mo>=</mo>
     <mrow>
      <mrow>
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mi>b</mi>
         <mo>-</mo>
         <mn>1</mn>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
       <mo>-</mo>
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mrow>
          <mi>a</mi>
          <msub>
           <mi>x</mi>
           <mrow>
            <mi>n</mi>
            <mo>-</mo>
            <mi>r</mi>
           </mrow>
          </msub>
         </mrow>
         <mo>+</mo>
         <msub>
          <mi>c</mi>
          <mrow>
           <mi>n</mi>
           <mo>-</mo>
           <mn>1</mn>
          </mrow>
         </msub>
        </mrow>
        <mo rspace="4.2pt" stretchy="false">)</mo>
       </mrow>
      </mrow>
      <mo lspace="2.5pt" rspace="4.2pt">mod</mo>
      <mi>b</mi>
     </mrow>
    </mrow>
    <mo rspace="7.5pt">,</mo>
    <mrow>
     <msub>
      <mi>c</mi>
      <mi>n</mi>
     </msub>
     <mo>=</mo>
     <mrow>
      <mo>⌊</mo>
      <mfrac>
       <mrow>
        <mrow>
         <mi>a</mi>
         <msub>
          <mi>x</mi>
          <mrow>
           <mi>n</mi>
           <mo>-</mo>
           <mi>r</mi>
          </mrow>
         </msub>
        </mrow>
        <mo>+</mo>
        <msub>
         <mi>c</mi>
         <mrow>
          <mi>n</mi>
          <mo>-</mo>
          <mn>1</mn>
         </mrow>
        </msub>
       </mrow>
       <mi>b</mi>
      </mfrac>
      <mo>⌋</mo>
     </mrow>
    </mrow>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">formulae-sequence</csymbol>
    <apply>
     <eq></eq>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>x</ci>
      <ci>n</ci>
     </apply>
     <apply>
      <csymbol cd="latexml">modulo</csymbol>
      <apply>
       <minus></minus>
       <apply>
        <minus></minus>
        <ci>b</ci>
        <cn type="integer">1</cn>
       </apply>
       <apply>
        <plus></plus>
        <apply>
         <times></times>
         <ci>a</ci>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>x</ci>
          <apply>
           <minus></minus>
           <ci>n</ci>
           <ci>r</ci>
          </apply>
         </apply>
        </apply>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>c</ci>
         <apply>
          <minus></minus>
          <ci>n</ci>
          <cn type="integer">1</cn>
         </apply>
        </apply>
       </apply>
      </apply>
      <ci>b</ci>
     </apply>
    </apply>
    <apply>
     <eq></eq>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>c</ci>
      <ci>n</ci>
     </apply>
     <apply>
      <floor></floor>
      <apply>
       <divide></divide>
       <apply>
        <plus></plus>
        <apply>
         <times></times>
         <ci>a</ci>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>x</ci>
          <apply>
           <minus></minus>
           <ci>n</ci>
           <ci>r</ci>
          </apply>
         </apply>
        </apply>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>c</ci>
         <apply>
          <minus></minus>
          <ci>n</ci>
          <cn type="integer">1</cn>
         </apply>
        </apply>
       </apply>
       <ci>b</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   x_{n}=(b-1)-(ax_{n-r}+c_{n-1})\,\bmod\,b,\ c_{n}=\left\lfloor\frac{ax_{n-r}+c_%
{n-1}}{b}\right\rfloor.
  </annotation>
 </semantics>
</math>

</p>

<p>That is, take the complement, (<em>b</em>−1)−<em>x</em>, when forming the new <em>x</em>.</p>

<p>The resulting sequence of <em>x</em>'s produced by the CMWC RNG will have period the order of <em>b</em> in the multiplicative group of residues modulo <em>ab</em><sup><em>r</em></sup>+1, and the output <em>x</em>'s, in reverse order, will form the base <em>b</em> expansion of <em>j</em>/(<em>ab</em><sup><em>r</em></sup>+1) for some 0<em>r</em>.</p>

<p>Use of lag-<em>r</em> CMWC makes it much easier to find periods for <em>r</em>'s as large as 512, 1024, 2048, etc. (Making <em>r</em> a power of 2 makes it slightly easier (and faster) to access elements in the array containing the <em>r</em> most recent <em>x</em>'s.)</p>

<p>Some examples: With <em>b</em>=2<sup>32</sup>, the period of the lag-1024 CMWC</p>

<p>

<math display="block" id="Multiply-with-carry:20">
 <semantics>
  <mrow>
   <mrow>
    <mrow>
     <msub>
      <mi>x</mi>
      <mi>n</mi>
     </msub>
     <mo>=</mo>
     <mrow>
      <mrow>
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mi>b</mi>
         <mo>-</mo>
         <mn>1</mn>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
       <mo>-</mo>
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mrow>
          <mi>a</mi>
          <msub>
           <mi>x</mi>
           <mrow>
            <mi>n</mi>
            <mo>-</mo>
            <mn>1024</mn>
           </mrow>
          </msub>
         </mrow>
         <mo>+</mo>
         <msub>
          <mi>c</mi>
          <mrow>
           <mi>n</mi>
           <mo>-</mo>
           <mn>1</mn>
          </mrow>
         </msub>
        </mrow>
        <mo rspace="4.2pt" stretchy="false">)</mo>
       </mrow>
      </mrow>
      <mo lspace="2.5pt" rspace="4.2pt">mod</mo>
      <mi>b</mi>
     </mrow>
    </mrow>
    <mo rspace="7.5pt">,</mo>
    <mrow>
     <msub>
      <mi>c</mi>
      <mi>n</mi>
     </msub>
     <mo>=</mo>
     <mrow>
      <mo>⌊</mo>
      <mfrac>
       <mrow>
        <mrow>
         <mi>a</mi>
         <msub>
          <mi>x</mi>
          <mrow>
           <mi>n</mi>
           <mo>-</mo>
           <mn>1024</mn>
          </mrow>
         </msub>
        </mrow>
        <mo>+</mo>
        <msub>
         <mi>c</mi>
         <mrow>
          <mi>n</mi>
          <mo>-</mo>
          <mn>1</mn>
         </mrow>
        </msub>
       </mrow>
       <mi>b</mi>
      </mfrac>
      <mo>⌋</mo>
     </mrow>
    </mrow>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">formulae-sequence</csymbol>
    <apply>
     <eq></eq>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>x</ci>
      <ci>n</ci>
     </apply>
     <apply>
      <csymbol cd="latexml">modulo</csymbol>
      <apply>
       <minus></minus>
       <apply>
        <minus></minus>
        <ci>b</ci>
        <cn type="integer">1</cn>
       </apply>
       <apply>
        <plus></plus>
        <apply>
         <times></times>
         <ci>a</ci>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>x</ci>
          <apply>
           <minus></minus>
           <ci>n</ci>
           <cn type="integer">1024</cn>
          </apply>
         </apply>
        </apply>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>c</ci>
         <apply>
          <minus></minus>
          <ci>n</ci>
          <cn type="integer">1</cn>
         </apply>
        </apply>
       </apply>
      </apply>
      <ci>b</ci>
     </apply>
    </apply>
    <apply>
     <eq></eq>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>c</ci>
      <ci>n</ci>
     </apply>
     <apply>
      <floor></floor>
      <apply>
       <divide></divide>
       <apply>
        <plus></plus>
        <apply>
         <times></times>
         <ci>a</ci>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>x</ci>
          <apply>
           <minus></minus>
           <ci>n</ci>
           <cn type="integer">1024</cn>
          </apply>
         </apply>
        </apply>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>c</ci>
         <apply>
          <minus></minus>
          <ci>n</ci>
          <cn type="integer">1</cn>
         </apply>
        </apply>
       </apply>
       <ci>b</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   x_{n}=(b-1)-(ax_{n-1024}+c_{n-1})\,\bmod\,b,\ c_{n}=\left\lfloor\frac{ax_{n-10%
24}+c_{n-1}}{b}\right\rfloor.
  </annotation>
 </semantics>
</math>

</p>

<p>will be <em>a</em>

<math display="inline" id="Multiply-with-carry:21">
 <semantics>
  <mo>⋅</mo>
  <annotation-xml encoding="MathML-Content">
   <ci>normal-⋅</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \cdot
  </annotation>
 </semantics>
</math>

2<sup>32762</sup>, about 10<sup>9867</sup> for these three <em>a</em>s: 109111 or 108798 or 108517.</p>

<p>With <em>b</em> = 2<sup>32</sup> and <em>a</em> = 3636507990, <em>p</em> = <em>ab</em><sup>1359</sup> − 1 is a safe prime, so the MWC sequence based on that <em>a</em> has period 3636507990

<math display="inline" id="Multiply-with-carry:22">
 <semantics>
  <mo>⋅</mo>
  <annotation-xml encoding="MathML-Content">
   <ci>normal-⋅</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \cdot
  </annotation>
 </semantics>
</math>


2<sup>43487</sup> 

<math display="inline" id="Multiply-with-carry:23">
 <semantics>
  <mo>≈</mo>
  <annotation-xml encoding="MathML-Content">
   <approx></approx>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \approx
  </annotation>
 </semantics>
</math>

10<sup>13101</sup>.</p>

<p>With <em>b</em> = 2<sup>32</sup>, a CMWC RNG with near record period may be based on the prime <em>p</em> = 15455296<em>b</em><sup>42658</sup> + 1. The order of <em>b</em> for that prime is 241489*2<sup>1365056</sup>, about 10<sup>410928</sup>.</p>
<h2 id="implementation">Implementation</h2>

<p>The following is an implementation of the CMWC algorithm in the <a href="C_(programming_language)" title="wikilink">C programming language</a>. Also, included in the program is a sample initialization function. In this implementation the lag <em>r</em>=4096. The period of the resulting generator is about 

<math display="inline" id="Multiply-with-carry:24">
 <semantics>
  <msup>
   <mn>2</mn>
   <mn>131104</mn>
  </msup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <cn type="integer">2</cn>
    <cn type="integer">131104</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   2^{131104}
  </annotation>
 </semantics>
</math>

.</p>
<div class="sourceCode"><pre class="sourceCode c"><code class="sourceCode c"><span class="co">/* Example showing Complementary-multiply-with-carry random number generator */</span>

<span class="ot">#include <stdint.h></stdint.h></span>
<span class="ot">#include <stdio.h></stdio.h></span>
 
<span class="dt">static</span> <span class="dt">uint32_t</span> x[<span class="dv">4096</span>], c = <span class="dv">362</span>, a = <span class="dv">18705</span>;
 
<span class="dt">void</span> init_rand(<span class="dt">uint32_t</span> seed)
{
    <span class="dt">int</span> i;
    
    <span class="co">/* Initialize random seed: */</span>
    srand(seed);
    <span class="kw">for</span> (i = <span class="dv">0</span>; i &lt; <span class="dv">4096</span>; i++)
        x[i] = rand();
}
 
<span class="dt">uint32_t</span> rand_cmwc(<span class="dt">void</span>)
{
    <span class="dt">static</span> <span class="dt">uint32_t</span> i = <span class="dv">4095</span>;
    <span class="dt">uint64_t</span> t;
 
    i = (i + <span class="dv">1</span>) &amp; <span class="dv">4095</span>;
    t = a * x[i];
    c = (t + c) &gt;&gt; <span class="dv">32</span>;
    x[i] = <span class="bn">0xffffffff</span> - (<span class="dt">uint32_t</span>)t;
 
    <span class="kw">return</span> x[i];
}

<span class="dt">int</span> main()
{
    <span class="dt">uint32_t</span> j;
    
    init_rand(<span class="dv">2567</span>);
    <span class="kw">for</span> (j = <span class="dv">0</span>; j &lt; <span class="dv">5000</span>; j++)
        printf(<span class="st">"%u</span><span class="ch">\n</span><span class="st">"</span>, rand_cmwc());
        
    <span class="kw">return</span> <span class="dv">0</span>;
}
</code></pre></div></body>
<h2 id="see-also">See also</h2>
<ul>
<li><a href="Pseudorandom_number_generator" title="wikilink">Pseudorandom number generator</a></li>
</ul>
<h2 id="references">References</h2>
<ul>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
</ul>

<p>"</p>

<p><a href="Category:Pseudorandom_number_generators" title="wikilink">Category:Pseudorandom number generators</a></p>


