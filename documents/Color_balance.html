<html lang="en">
<head>
<meta charset="utf-8"/>
<title offset="938">Color balance</title>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG.js" type="text/javascript">
</script>
</head>
<body>
<h1>Color balance</h1>
<hr/>
<figure><b>(Figure)</b>
<figcaption>The left half shows the photo as it came from the digital camera. The right half shows the photo adjusted to make a gray surface neutral in the same light.</figcaption>
</figure>

<p>In <a class="uri" href="photography" title="wikilink">photography</a> and <a href="image_processing" title="wikilink">image processing</a>, <strong>color balance</strong> is the global adjustment of the intensities of the colors (typically red, green, and blue <a href="primary_colors" title="wikilink">primary colors</a>). An important goal of this adjustment is to render specific colors – particularly neutral colors – correctly; hence, the general method is sometimes called <strong>gray balance</strong>, <strong>neutral balance</strong>, or <strong>white balance</strong>. Color balance changes the overall mixture of colors in an image and is used for <a href="color_correction" title="wikilink">color correction</a>; generalized versions of color balance are used to get colors other than neutrals to also appear correct or pleasing.</p>

<p>Image data acquired by sensors – either <a href="photographic_film" title="wikilink">film</a> or electronic <a href="image_sensor" title="wikilink">image sensors</a> – must be transformed from the acquired values to new values that are appropriate for color reproduction or display. Several aspects of the acquisition and display process make such color correction essential – including the fact that the acquisition sensors do not match the sensors in the human eye, that the properties of the display medium must be accounted for, and that the ambient viewing conditions of the acquisition differ from the display viewing conditions.</p>

<p>The color balance operations in popular <a href="image_editing" title="wikilink">image editing</a> applications usually operate directly on the red, green, and blue channel <a class="uri" href="pixel" title="wikilink">pixel</a> values,<a class="footnoteRef" href="#fn1" id="fnref1"><sup>1</sup></a><a class="footnoteRef" href="#fn2" id="fnref2"><sup>2</sup></a> without respect to any color sensing or reproduction model. In shooting film, color balance is typically achieved by using <a href="color_correction_filter" title="wikilink">color correction filters</a> over the lights or on the camera lens.<a class="footnoteRef" href="#fn3" id="fnref3"><sup>3</sup></a></p>
<h2 id="generalized-color-balance">Generalized color balance</h2>

<p> Sometimes the adjustment to keep neutrals neutral is called <em>white balance</em>, and the phrase <em>color balance</em> refers to the adjustment that in addition makes other colors in a displayed image appear to have the same general appearance as the colors in an original scene.<a class="footnoteRef" href="#fn4" id="fnref4"><sup>4</sup></a> It is particularly important that neutral (gray, neutral, white) colors in a scene appear neutral in the reproduction. Hence, the special case of balancing the neutral colors (sometimes <em>gray balance</em>, <em>neutral balance</em>, or <em>white balance</em>) is a particularly important – perhaps dominant – element of color balancing.</p>

<p>Normally, one would not use the phrase <em>color balance</em> to describe the adjustments needed to account for differences between the sensors and the human eye, or the details of the display primaries. <em>Color balance</em> is normally reserved to refer to correction for differences in the ambient illumination conditions. However, the algorithms for transforming the data do not always clearly separate out the different elements of the correction. Hence, it can be difficult to assign color balance to a specific step in the color correction process. Moreover, there can be significant differences in the color balancing goal. Some applications are created to produce an accurate rendering – as suggested above. In other applications, the goal of color balancing is to produce a pleasing rendering. This difference also creates difficulty in defining the color balancing processing operations.</p>
<h2 id="illuminant-estimation-and-adaptation">Illuminant estimation and adaptation</h2>

<p>     Most digital cameras have a means to select a color correction based on the type of scene illumination, using either manual illuminant selection, or automatic white balance (AWB), or custom white balance. The algorithm that performs this analysis performs generalized color balancing, known as illuminant adaptation or <a href="chromatic_adaptation" title="wikilink">chromatic adaptation</a>.</p>

<p>Many methods are used to achieve color balancing. Setting a button on a camera is a way for the user to indicate to the processor the nature of the scene lighting. Another option on some cameras is a button which one may press when the camera is pointed at a <a href="gray_card" title="wikilink">gray card</a> or other neutral object. This "custom white balance" step captures an image of the ambient light, and this information is helpful in controlling color balance.</p>

<p>There is a large literature on how one might estimate the ambient illumination from the camera data and then use this information to transform the image data. A variety of algorithms have been proposed, and the quality of these have been debated. A few examples and examination of the references therein will lead the reader to many others. Examples are <a class="uri" href="Retinex" title="wikilink">Retinex</a>, an <a href="artificial_neural_network" title="wikilink">artificial neural network</a><a class="footnoteRef" href="#fn5" id="fnref5"><sup>5</sup></a> or a <a href="Bayesian_method" title="wikilink">Bayesian method</a>.<a class="footnoteRef" href="#fn6" id="fnref6"><sup>6</sup></a></p>
<h2 id="color-balance-and-chromatic-colors">Color balance and chromatic colors</h2>

<p>Color balancing an image affects not only the neutrals, but other colors as well. An image that is not color balanced is said to have a color cast, as everything in the image appears to have been shifted towards one color or another.<a class="footnoteRef" href="#fn7" id="fnref7"><sup>7</sup></a> Color balancing may be thought in terms of removing this color cast.</p>

<p>Color balance is also related to <a href="color_constancy" title="wikilink">color constancy</a>. Algorithms and techniques used to attain color constancy are frequently used for color balancing, as well. Color constancy is, in turn, related to <a href="chromatic_adaptation" title="wikilink">chromatic adaptation</a>. Conceptually, color balancing consists of two steps: first, determining the <a href="standard_illuminant" title="wikilink">illuminant</a> under which an image was captured; and second, scaling the components (e.g., R, G, and B) of the image or otherwise transforming the components so they conform to the viewing illuminant.</p>

<p>Viggiano found that white balancing in the camera's native <a class="uri" href="RGB" title="wikilink">RGB</a> tended to produce less color inconstancy (i.e., less distortion of the colors) than in monitor RGB for over 4000 hypothetical sets of camera sensitivities.<a class="footnoteRef" href="#fn8" id="fnref8"><sup>8</sup></a> This difference typically amounted to a factor of more than two in favor of camera RGB. This means that it is advantageous to get color balance right at the time an image is captured, rather than edit later on a monitor. If one must color balance later, balancing the <a href="Raw_image_format" title="wikilink">raw image data</a> will tend to produce less distortion of chromatic colors than balancing in monitor RGB.</p>
<h2 id="mathematics-of-color-balance">Mathematics of color balance</h2>

<p>Color balancing is sometimes performed on a three-component image (e.g., <a href="RGB_color_model" title="wikilink">RGB</a>) using a 3x3 <a href="matrix_(mathematics)" title="wikilink">matrix</a>. This type of transformation is appropriate if the image were captured using the wrong white balance setting on a digital camera, or through a color filter.</p>
<h3 id="scaling-monitor-r-g-and-b">Scaling monitor R, G, and B</h3>

<p>In principle, one wants to scale all relative luminances in an image so that objects which are believed to be <a href="grey" title="wikilink">neutral</a> appear so. If, say, a surface with 

<math display="inline" id="Color_balance:0">
 <semantics>
  <mrow>
   <mi>R</mi>
   <mo>=</mo>
   <mn>240</mn>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>R</ci>
    <cn type="integer">240</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   R=240
  </annotation>
 </semantics>
</math>

 was believed to be a white object, and if 255 is the count which corresponds to white, one could multiply all <a class="uri" href="red" title="wikilink">red</a> values by 255/240. Doing analogously for <a class="uri" href="green" title="wikilink">green</a> and <a class="uri" href="blue" title="wikilink">blue</a> would result, at least in theory, in a color balanced image. In this type of transformation the 3x3 matrix is a <a href="diagonal_matrix" title="wikilink">diagonal matrix</a>.</p>

<p>

<math display="block" id="Color_balance:1">
 <semantics>
  <mrow>
   <mrow>
    <mo>[</mo>
    <mtable displaystyle="true">
     <mtr>
      <mtd columnalign="center">
       <mi>R</mi>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <mi>G</mi>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <mi>B</mi>
      </mtd>
     </mtr>
    </mtable>
    <mo>]</mo>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mrow>
     <mo>[</mo>
     <mtable displaystyle="true">
      <mtr>
       <mtd columnalign="center">
        <mrow>
         <mn>255</mn>
         <mo>/</mo>
         <msubsup>
          <mi>R</mi>
          <mi>w</mi>
          <mo>′</mo>
         </msubsup>
        </mrow>
       </mtd>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
       <mtd columnalign="center">
        <mrow>
         <mn>255</mn>
         <mo>/</mo>
         <msubsup>
          <mi>G</mi>
          <mi>w</mi>
          <mo>′</mo>
         </msubsup>
        </mrow>
       </mtd>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
       <mtd columnalign="center">
        <mrow>
         <mn>255</mn>
         <mo>/</mo>
         <msubsup>
          <mi>B</mi>
          <mi>w</mi>
          <mo>′</mo>
         </msubsup>
        </mrow>
       </mtd>
      </mtr>
     </mtable>
     <mo>]</mo>
    </mrow>
    <mrow>
     <mo>[</mo>
     <mtable displaystyle="true">
      <mtr>
       <mtd columnalign="center">
        <msup>
         <mi>R</mi>
         <mo>′</mo>
        </msup>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <msup>
         <mi>G</mi>
         <mo>′</mo>
        </msup>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <msup>
         <mi>B</mi>
         <mo>′</mo>
        </msup>
       </mtd>
      </mtr>
     </mtable>
     <mo>]</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="latexml">delimited-[]</csymbol>
     <matrix>
      <matrixrow>
       <ci>R</ci>
      </matrixrow>
      <matrixrow>
       <ci>G</ci>
      </matrixrow>
      <matrixrow>
       <ci>B</ci>
      </matrixrow>
     </matrix>
    </apply>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="latexml">delimited-[]</csymbol>
      <matrix>
       <matrixrow>
        <apply>
         <divide></divide>
         <cn type="integer">255</cn>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">superscript</csymbol>
           <ci>R</ci>
           <ci>normal-′</ci>
          </apply>
          <ci>w</ci>
         </apply>
        </apply>
        <cn type="integer">0</cn>
        <cn type="integer">0</cn>
       </matrixrow>
       <matrixrow>
        <cn type="integer">0</cn>
        <apply>
         <divide></divide>
         <cn type="integer">255</cn>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">superscript</csymbol>
           <ci>G</ci>
           <ci>normal-′</ci>
          </apply>
          <ci>w</ci>
         </apply>
        </apply>
        <cn type="integer">0</cn>
       </matrixrow>
       <matrixrow>
        <cn type="integer">0</cn>
        <cn type="integer">0</cn>
        <apply>
         <divide></divide>
         <cn type="integer">255</cn>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">superscript</csymbol>
           <ci>B</ci>
           <ci>normal-′</ci>
          </apply>
          <ci>w</ci>
         </apply>
        </apply>
       </matrixrow>
      </matrix>
     </apply>
     <apply>
      <csymbol cd="latexml">delimited-[]</csymbol>
      <matrix>
       <matrixrow>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>R</ci>
         <ci>normal-′</ci>
        </apply>
       </matrixrow>
       <matrixrow>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>G</ci>
         <ci>normal-′</ci>
        </apply>
       </matrixrow>
       <matrixrow>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>B</ci>
         <ci>normal-′</ci>
        </apply>
       </matrixrow>
      </matrix>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \left[\begin{array}[]{c}R\\
G\\
B\end{array}\right]=\left[\begin{array}[]{ccc}255/R^{\prime}_{w}&0&0\\
0&255/G^{\prime}_{w}&0\\
0&0&255/B^{\prime}_{w}\end{array}\right]\left[\begin{array}[]{c}R^{\prime}\\
G^{\prime}\\
B^{\prime}\end{array}\right]
  </annotation>
 </semantics>
</math>

</p>

<p>where 

<math display="inline" id="Color_balance:2">
 <semantics>
  <mi>R</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>R</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   R
  </annotation>
 </semantics>
</math>

, 

<math display="inline" id="Color_balance:3">
 <semantics>
  <mi>G</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>G</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   G
  </annotation>
 </semantics>
</math>

, and 

<math display="inline" id="Color_balance:4">
 <semantics>
  <mi>B</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>B</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B
  </annotation>
 </semantics>
</math>

 are the color balanced red, green, and blue components of a <a class="uri" href="pixel" title="wikilink">pixel</a> in the image; 

<math display="inline" id="Color_balance:5">
 <semantics>
  <msup>
   <mi>R</mi>
   <mo>′</mo>
  </msup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <ci>R</ci>
    <ci>normal-′</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   R^{\prime}
  </annotation>
 </semantics>
</math>

, 

<math display="inline" id="Color_balance:6">
 <semantics>
  <msup>
   <mi>G</mi>
   <mo>′</mo>
  </msup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <ci>G</ci>
    <ci>normal-′</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   G^{\prime}
  </annotation>
 </semantics>
</math>

, and 

<math display="inline" id="Color_balance:7">
 <semantics>
  <msup>
   <mi>B</mi>
   <mo>′</mo>
  </msup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <ci>B</ci>
    <ci>normal-′</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B^{\prime}
  </annotation>
 </semantics>
</math>

 are the red, green, and blue components of the image before color balancing, and 

<math display="inline" id="Color_balance:8">
 <semantics>
  <msubsup>
   <mi>R</mi>
   <mi>w</mi>
   <mo>′</mo>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>R</ci>
     <ci>normal-′</ci>
    </apply>
    <ci>w</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   R^{\prime}_{w}
  </annotation>
 </semantics>
</math>

, 

<math display="inline" id="Color_balance:9">
 <semantics>
  <msubsup>
   <mi>G</mi>
   <mi>w</mi>
   <mo>′</mo>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>G</ci>
     <ci>normal-′</ci>
    </apply>
    <ci>w</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   G^{\prime}_{w}
  </annotation>
 </semantics>
</math>

, and 

<math display="inline" id="Color_balance:10">
 <semantics>
  <msubsup>
   <mi>B</mi>
   <mi>w</mi>
   <mo>′</mo>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>B</ci>
     <ci>normal-′</ci>
    </apply>
    <ci>w</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B^{\prime}_{w}
  </annotation>
 </semantics>
</math>

 are the red, green, and blue components of a pixel which is believed to be a white surface in the image before color balancing. This is a simple scaling of the red, green, and blue channels, and is why color balance tools in <a class="uri" href="Photoshop" title="wikilink">Photoshop</a> and the <a class="uri" href="GIMP" title="wikilink">GIMP</a> have a white eyedropper tool. It has been demonstrated that performing the white balancing in the phosphor set assumed by <a class="uri" href="sRGB" title="wikilink">sRGB</a> tends to produce large errors in chromatic colors, even though it can render the neutral surfaces perfectly neutral.<a class="footnoteRef" href="#fn9" id="fnref9"><sup>9</sup></a></p>
<h3 id="scaling-x-y-z">Scaling X, Y, Z</h3>

<p>If the image may be transformed into <a href="CIE_1931_color_space" title="wikilink">CIE XYZ tristimulus values</a>, the color balancing may be performed there. This has been termed a “wrong von Kries” transformation.<a class="footnoteRef" href="#fn10" id="fnref10"><sup>10</sup></a><a class="footnoteRef" href="#fn11" id="fnref11"><sup>11</sup></a> Although it has been demonstrated to offer usually poorer results than balancing in monitor RGB, it is mentioned here as a bridge to other things. Mathematically, one computes:</p>

<p>

<math display="block" id="Color_balance:11">
 <semantics>
  <mrow>
   <mrow>
    <mo>[</mo>
    <mtable displaystyle="true">
     <mtr>
      <mtd columnalign="center">
       <mi>X</mi>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <mi>Y</mi>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <mi>Z</mi>
      </mtd>
     </mtr>
    </mtable>
    <mo>]</mo>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mrow>
     <mo>[</mo>
     <mtable displaystyle="true">
      <mtr>
       <mtd columnalign="center">
        <mrow>
         <msub>
          <mi>X</mi>
          <mi>w</mi>
         </msub>
         <mo>/</mo>
         <msubsup>
          <mi>X</mi>
          <mi>w</mi>
          <mo>′</mo>
         </msubsup>
        </mrow>
       </mtd>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
       <mtd columnalign="center">
        <mrow>
         <msub>
          <mi>Y</mi>
          <mi>w</mi>
         </msub>
         <mo>/</mo>
         <msubsup>
          <mi>Y</mi>
          <mi>w</mi>
          <mo>′</mo>
         </msubsup>
        </mrow>
       </mtd>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
       <mtd columnalign="center">
        <mrow>
         <msub>
          <mi>Z</mi>
          <mi>w</mi>
         </msub>
         <mo>/</mo>
         <msubsup>
          <mi>Z</mi>
          <mi>w</mi>
          <mo>′</mo>
         </msubsup>
        </mrow>
       </mtd>
      </mtr>
     </mtable>
     <mo>]</mo>
    </mrow>
    <mrow>
     <mo>[</mo>
     <mtable displaystyle="true">
      <mtr>
       <mtd columnalign="center">
        <msup>
         <mi>X</mi>
         <mo>′</mo>
        </msup>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <msup>
         <mi>Y</mi>
         <mo>′</mo>
        </msup>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <msup>
         <mi>Z</mi>
         <mo>′</mo>
        </msup>
       </mtd>
      </mtr>
     </mtable>
     <mo>]</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="latexml">delimited-[]</csymbol>
     <matrix>
      <matrixrow>
       <ci>X</ci>
      </matrixrow>
      <matrixrow>
       <ci>Y</ci>
      </matrixrow>
      <matrixrow>
       <ci>Z</ci>
      </matrixrow>
     </matrix>
    </apply>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="latexml">delimited-[]</csymbol>
      <matrix>
       <matrixrow>
        <apply>
         <divide></divide>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>X</ci>
          <ci>w</ci>
         </apply>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">superscript</csymbol>
           <ci>X</ci>
           <ci>normal-′</ci>
          </apply>
          <ci>w</ci>
         </apply>
        </apply>
        <cn type="integer">0</cn>
        <cn type="integer">0</cn>
       </matrixrow>
       <matrixrow>
        <cn type="integer">0</cn>
        <apply>
         <divide></divide>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>Y</ci>
          <ci>w</ci>
         </apply>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">superscript</csymbol>
           <ci>Y</ci>
           <ci>normal-′</ci>
          </apply>
          <ci>w</ci>
         </apply>
        </apply>
        <cn type="integer">0</cn>
       </matrixrow>
       <matrixrow>
        <cn type="integer">0</cn>
        <cn type="integer">0</cn>
        <apply>
         <divide></divide>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>Z</ci>
          <ci>w</ci>
         </apply>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">superscript</csymbol>
           <ci>Z</ci>
           <ci>normal-′</ci>
          </apply>
          <ci>w</ci>
         </apply>
        </apply>
       </matrixrow>
      </matrix>
     </apply>
     <apply>
      <csymbol cd="latexml">delimited-[]</csymbol>
      <matrix>
       <matrixrow>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>X</ci>
         <ci>normal-′</ci>
        </apply>
       </matrixrow>
       <matrixrow>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>Y</ci>
         <ci>normal-′</ci>
        </apply>
       </matrixrow>
       <matrixrow>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>Z</ci>
         <ci>normal-′</ci>
        </apply>
       </matrixrow>
      </matrix>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \left[\begin{array}[]{c}X\\
Y\\
Z\end{array}\right]=\left[\begin{array}[]{ccc}X_{w}/X^{\prime}_{w}&0&0\\
0&Y_{w}/Y^{\prime}_{w}&0\\
0&0&Z_{w}/Z^{\prime}_{w}\end{array}\right]\left[\begin{array}[]{c}X^{\prime}\\
Y^{\prime}\\
Z^{\prime}\end{array}\right]
  </annotation>
 </semantics>
</math>

</p>

<p>where 

<math display="inline" id="Color_balance:12">
 <semantics>
  <mi>X</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>X</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   X
  </annotation>
 </semantics>
</math>

, 

<math display="inline" id="Color_balance:13">
 <semantics>
  <mi>Y</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>Y</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   Y
  </annotation>
 </semantics>
</math>

, and 

<math display="inline" id="Color_balance:14">
 <semantics>
  <mi>Z</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>Z</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   Z
  </annotation>
 </semantics>
</math>

 are the color-balanced tristimulus values; 

<math display="inline" id="Color_balance:15">
 <semantics>
  <msub>
   <mi>X</mi>
   <mi>w</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>X</ci>
    <ci>w</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   X_{w}
  </annotation>
 </semantics>
</math>

, 

<math display="inline" id="Color_balance:16">
 <semantics>
  <msub>
   <mi>Y</mi>
   <mi>w</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>Y</ci>
    <ci>w</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   Y_{w}
  </annotation>
 </semantics>
</math>

, and 

<math display="inline" id="Color_balance:17">
 <semantics>
  <msub>
   <mi>Z</mi>
   <mi>w</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>Z</ci>
    <ci>w</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   Z_{w}
  </annotation>
 </semantics>
</math>

 are the tristimulus values of the viewing illuminant (the white point to which the image is being transformed to conform to); 

<math display="inline" id="Color_balance:18">
 <semantics>
  <msubsup>
   <mi>X</mi>
   <mi>w</mi>
   <mo>′</mo>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>X</ci>
     <ci>normal-′</ci>
    </apply>
    <ci>w</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   X^{\prime}_{w}
  </annotation>
 </semantics>
</math>

, 

<math display="inline" id="Color_balance:19">
 <semantics>
  <msubsup>
   <mi>Y</mi>
   <mi>w</mi>
   <mo>′</mo>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>Y</ci>
     <ci>normal-′</ci>
    </apply>
    <ci>w</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   Y^{\prime}_{w}
  </annotation>
 </semantics>
</math>

, and 

<math display="inline" id="Color_balance:20">
 <semantics>
  <msubsup>
   <mi>Z</mi>
   <mi>w</mi>
   <mo>′</mo>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>Z</ci>
     <ci>normal-′</ci>
    </apply>
    <ci>w</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   Z^{\prime}_{w}
  </annotation>
 </semantics>
</math>

 are the tristimulus values of an object believed to be white in the un-color-balanced image, and 

<math display="inline" id="Color_balance:21">
 <semantics>
  <msup>
   <mi>X</mi>
   <mo>′</mo>
  </msup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <ci>X</ci>
    <ci>normal-′</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   X^{\prime}
  </annotation>
 </semantics>
</math>

, 

<math display="inline" id="Color_balance:22">
 <semantics>
  <msup>
   <mi>Y</mi>
   <mo>′</mo>
  </msup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <ci>Y</ci>
    <ci>normal-′</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   Y^{\prime}
  </annotation>
 </semantics>
</math>

, and 

<math display="inline" id="Color_balance:23">
 <semantics>
  <msup>
   <mi>Z</mi>
   <mo>′</mo>
  </msup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <ci>Z</ci>
    <ci>normal-′</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   Z^{\prime}
  </annotation>
 </semantics>
</math>

 are the tristimulus values of a pixel in the un-color-balanced image. If the tristimulus values of the monitor primaries are in a matrix 

<math display="inline" id="Color_balance:24">
 <semantics>
  <mi>𝐏</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>𝐏</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{P}
  </annotation>
 </semantics>
</math>

 so that:</p>

<p>

<math display="block" id="Color_balance:25">
 <semantics>
  <mrow>
   <mrow>
    <mo>[</mo>
    <mtable displaystyle="true">
     <mtr>
      <mtd columnalign="center">
       <mi>X</mi>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <mi>Y</mi>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <mi>Z</mi>
      </mtd>
     </mtr>
    </mtable>
    <mo>]</mo>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mi>𝐏</mi>
    <mrow>
     <mo>[</mo>
     <mtable displaystyle="true">
      <mtr>
       <mtd columnalign="center">
        <msub>
         <mi>L</mi>
         <mi>R</mi>
        </msub>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <msub>
         <mi>L</mi>
         <mi>G</mi>
        </msub>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <msub>
         <mi>L</mi>
         <mi>B</mi>
        </msub>
       </mtd>
      </mtr>
     </mtable>
     <mo>]</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="latexml">delimited-[]</csymbol>
     <matrix>
      <matrixrow>
       <ci>X</ci>
      </matrixrow>
      <matrixrow>
       <ci>Y</ci>
      </matrixrow>
      <matrixrow>
       <ci>Z</ci>
      </matrixrow>
     </matrix>
    </apply>
    <apply>
     <times></times>
     <ci>𝐏</ci>
     <apply>
      <csymbol cd="latexml">delimited-[]</csymbol>
      <matrix>
       <matrixrow>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>L</ci>
         <ci>R</ci>
        </apply>
       </matrixrow>
       <matrixrow>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>L</ci>
         <ci>G</ci>
        </apply>
       </matrixrow>
       <matrixrow>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>L</ci>
         <ci>B</ci>
        </apply>
       </matrixrow>
      </matrix>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \left[\begin{array}[]{c}X\\
Y\\
Z\end{array}\right]=\mathbf{P}\left[\begin{array}[]{c}L_{R}\\
L_{G}\\
L_{B}\end{array}\right]
  </annotation>
 </semantics>
</math>

</p>

<p>where 

<math display="inline" id="Color_balance:26">
 <semantics>
  <msub>
   <mi>L</mi>
   <mi>R</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>L</ci>
    <ci>R</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   L_{R}
  </annotation>
 </semantics>
</math>

, 

<math display="inline" id="Color_balance:27">
 <semantics>
  <msub>
   <mi>L</mi>
   <mi>G</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>L</ci>
    <ci>G</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   L_{G}
  </annotation>
 </semantics>
</math>

, and 

<math display="inline" id="Color_balance:28">
 <semantics>
  <msub>
   <mi>L</mi>
   <mi>B</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>L</ci>
    <ci>B</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   L_{B}
  </annotation>
 </semantics>
</math>

 are the un-<a href="gamma_correction" title="wikilink">gamma corrected</a> monitor RGB, one may use:</p>

<p>

<math display="block" id="Color_balance:29">
 <semantics>
  <mrow>
   <mrow>
    <mo>[</mo>
    <mtable displaystyle="true">
     <mtr>
      <mtd columnalign="center">
       <msub>
        <mi>L</mi>
        <mi>R</mi>
       </msub>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <msub>
        <mi>L</mi>
        <mi>G</mi>
       </msub>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <msub>
        <mi>L</mi>
        <mi>B</mi>
       </msub>
      </mtd>
     </mtr>
    </mtable>
    <mo>]</mo>
   </mrow>
   <mo>=</mo>
   <mrow>
    <msup>
     <mi>𝐏</mi>
     <mrow>
      <mo>-</mo>
      <mn>𝟏</mn>
     </mrow>
    </msup>
    <mrow>
     <mo>[</mo>
     <mtable displaystyle="true">
      <mtr>
       <mtd columnalign="center">
        <mrow>
         <msub>
          <mi>X</mi>
          <mi>w</mi>
         </msub>
         <mo>/</mo>
         <msubsup>
          <mi>X</mi>
          <mi>w</mi>
          <mo>′</mo>
         </msubsup>
        </mrow>
       </mtd>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
       <mtd columnalign="center">
        <mrow>
         <msub>
          <mi>Y</mi>
          <mi>w</mi>
         </msub>
         <mo>/</mo>
         <msubsup>
          <mi>Y</mi>
          <mi>w</mi>
          <mo>′</mo>
         </msubsup>
        </mrow>
       </mtd>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
       <mtd columnalign="center">
        <mrow>
         <msub>
          <mi>Z</mi>
          <mi>w</mi>
         </msub>
         <mo>/</mo>
         <msubsup>
          <mi>Z</mi>
          <mi>w</mi>
          <mo>′</mo>
         </msubsup>
        </mrow>
       </mtd>
      </mtr>
     </mtable>
     <mo>]</mo>
    </mrow>
    <mi>𝐏</mi>
    <mrow>
     <mo>[</mo>
     <mtable displaystyle="true">
      <mtr>
       <mtd columnalign="center">
        <msub>
         <mi>L</mi>
         <msup>
          <mi>R</mi>
          <mo>′</mo>
         </msup>
        </msub>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <msub>
         <mi>L</mi>
         <msup>
          <mi>G</mi>
          <mo>′</mo>
         </msup>
        </msub>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <msub>
         <mi>L</mi>
         <msup>
          <mi>B</mi>
          <mo>′</mo>
         </msup>
        </msub>
       </mtd>
      </mtr>
     </mtable>
     <mo>]</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="latexml">delimited-[]</csymbol>
     <matrix>
      <matrixrow>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>L</ci>
        <ci>R</ci>
       </apply>
      </matrixrow>
      <matrixrow>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>L</ci>
        <ci>G</ci>
       </apply>
      </matrixrow>
      <matrixrow>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>L</ci>
        <ci>B</ci>
       </apply>
      </matrixrow>
     </matrix>
    </apply>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>𝐏</ci>
      <apply>
       <minus></minus>
       <cn type="integer">1</cn>
      </apply>
     </apply>
     <apply>
      <csymbol cd="latexml">delimited-[]</csymbol>
      <matrix>
       <matrixrow>
        <apply>
         <divide></divide>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>X</ci>
          <ci>w</ci>
         </apply>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">superscript</csymbol>
           <ci>X</ci>
           <ci>normal-′</ci>
          </apply>
          <ci>w</ci>
         </apply>
        </apply>
        <cn type="integer">0</cn>
        <cn type="integer">0</cn>
       </matrixrow>
       <matrixrow>
        <cn type="integer">0</cn>
        <apply>
         <divide></divide>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>Y</ci>
          <ci>w</ci>
         </apply>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">superscript</csymbol>
           <ci>Y</ci>
           <ci>normal-′</ci>
          </apply>
          <ci>w</ci>
         </apply>
        </apply>
        <cn type="integer">0</cn>
       </matrixrow>
       <matrixrow>
        <cn type="integer">0</cn>
        <cn type="integer">0</cn>
        <apply>
         <divide></divide>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>Z</ci>
          <ci>w</ci>
         </apply>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">superscript</csymbol>
           <ci>Z</ci>
           <ci>normal-′</ci>
          </apply>
          <ci>w</ci>
         </apply>
        </apply>
       </matrixrow>
      </matrix>
     </apply>
     <ci>𝐏</ci>
     <apply>
      <csymbol cd="latexml">delimited-[]</csymbol>
      <matrix>
       <matrixrow>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>L</ci>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <ci>R</ci>
          <ci>normal-′</ci>
         </apply>
        </apply>
       </matrixrow>
       <matrixrow>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>L</ci>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <ci>G</ci>
          <ci>normal-′</ci>
         </apply>
        </apply>
       </matrixrow>
       <matrixrow>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>L</ci>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <ci>B</ci>
          <ci>normal-′</ci>
         </apply>
        </apply>
       </matrixrow>
      </matrix>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \left[\begin{array}[]{c}L_{R}\\
L_{G}\\
L_{B}\end{array}\right]=\mathbf{P^{-1}}\left[\begin{array}[]{ccc}X_{w}/X^{%
\prime}_{w}&0&0\\
0&Y_{w}/Y^{\prime}_{w}&0\\
0&0&Z_{w}/Z^{\prime}_{w}\end{array}\right]\mathbf{P}\left[\begin{array}[]{c}L_%
{R^{\prime}}\\
L_{G^{\prime}}\\
L_{B^{\prime}}\end{array}\right]
  </annotation>
 </semantics>
</math>

</p>
<h3 id="von-kriess-method">Von Kries's method</h3>

<p><a href="Johannes_von_Kries" title="wikilink">Johannes von Kries</a>, whose theory of <a href="rod_cell" title="wikilink">rods</a> and three color-sensitive <a href="cone_cell" title="wikilink">cone</a> types in the <a class="uri" href="retina" title="wikilink">retina</a> has survived as the dominant explanation of color sensation for over 100 years, motivated the method of converting color to the <a href="LMS_color_space" title="wikilink">LMS color space</a>, representing the effective stimuli for the Long-, Medium-, and Short-wavelength cone types that are modeled as adapting independently. A 3x3 matrix converts RGB or XYZ to LMS, and then the three LMS primary values are scaled to balance the neutral; the color can then be converted back to the desired final <a href="color_space" title="wikilink">color space</a>:<a class="footnoteRef" href="#fn12" id="fnref12"><sup>12</sup></a></p>

<p>

<math display="block" id="Color_balance:30">
 <semantics>
  <mrow>
   <mrow>
    <mo>[</mo>
    <mtable displaystyle="true">
     <mtr>
      <mtd columnalign="center">
       <mi>L</mi>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <mi>M</mi>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <mi>S</mi>
      </mtd>
     </mtr>
    </mtable>
    <mo>]</mo>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mrow>
     <mo>[</mo>
     <mtable displaystyle="true">
      <mtr>
       <mtd columnalign="center">
        <mrow>
         <mn>1</mn>
         <mo>/</mo>
         <msubsup>
          <mi>L</mi>
          <mi>w</mi>
          <mo>′</mo>
         </msubsup>
        </mrow>
       </mtd>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
       <mtd columnalign="center">
        <mrow>
         <mn>1</mn>
         <mo>/</mo>
         <msubsup>
          <mi>M</mi>
          <mi>w</mi>
          <mo>′</mo>
         </msubsup>
        </mrow>
       </mtd>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
       <mtd columnalign="center">
        <mrow>
         <mn>1</mn>
         <mo>/</mo>
         <msubsup>
          <mi>S</mi>
          <mi>w</mi>
          <mo>′</mo>
         </msubsup>
        </mrow>
       </mtd>
      </mtr>
     </mtable>
     <mo>]</mo>
    </mrow>
    <mrow>
     <mo>[</mo>
     <mtable displaystyle="true">
      <mtr>
       <mtd columnalign="center">
        <msup>
         <mi>L</mi>
         <mo>′</mo>
        </msup>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <msup>
         <mi>M</mi>
         <mo>′</mo>
        </msup>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <msup>
         <mi>S</mi>
         <mo>′</mo>
        </msup>
       </mtd>
      </mtr>
     </mtable>
     <mo>]</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="latexml">delimited-[]</csymbol>
     <matrix>
      <matrixrow>
       <ci>L</ci>
      </matrixrow>
      <matrixrow>
       <ci>M</ci>
      </matrixrow>
      <matrixrow>
       <ci>S</ci>
      </matrixrow>
     </matrix>
    </apply>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="latexml">delimited-[]</csymbol>
      <matrix>
       <matrixrow>
        <apply>
         <divide></divide>
         <cn type="integer">1</cn>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">superscript</csymbol>
           <ci>L</ci>
           <ci>normal-′</ci>
          </apply>
          <ci>w</ci>
         </apply>
        </apply>
        <cn type="integer">0</cn>
        <cn type="integer">0</cn>
       </matrixrow>
       <matrixrow>
        <cn type="integer">0</cn>
        <apply>
         <divide></divide>
         <cn type="integer">1</cn>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">superscript</csymbol>
           <ci>M</ci>
           <ci>normal-′</ci>
          </apply>
          <ci>w</ci>
         </apply>
        </apply>
        <cn type="integer">0</cn>
       </matrixrow>
       <matrixrow>
        <cn type="integer">0</cn>
        <cn type="integer">0</cn>
        <apply>
         <divide></divide>
         <cn type="integer">1</cn>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">superscript</csymbol>
           <ci>S</ci>
           <ci>normal-′</ci>
          </apply>
          <ci>w</ci>
         </apply>
        </apply>
       </matrixrow>
      </matrix>
     </apply>
     <apply>
      <csymbol cd="latexml">delimited-[]</csymbol>
      <matrix>
       <matrixrow>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>L</ci>
         <ci>normal-′</ci>
        </apply>
       </matrixrow>
       <matrixrow>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>M</ci>
         <ci>normal-′</ci>
        </apply>
       </matrixrow>
       <matrixrow>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>S</ci>
         <ci>normal-′</ci>
        </apply>
       </matrixrow>
      </matrix>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \left[\begin{array}[]{c}L\\
M\\
S\end{array}\right]=\left[\begin{array}[]{ccc}1/L^{\prime}_{w}&0&0\\
0&1/M^{\prime}_{w}&0\\
0&0&1/S^{\prime}_{w}\end{array}\right]\left[\begin{array}[]{c}L^{\prime}\\
M^{\prime}\\
S^{\prime}\end{array}\right]
  </annotation>
 </semantics>
</math>

</p>

<p>where 

<math display="inline" id="Color_balance:31">
 <semantics>
  <mi>L</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>L</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   L
  </annotation>
 </semantics>
</math>

, 

<math display="inline" id="Color_balance:32">
 <semantics>
  <mi>M</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>M</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   M
  </annotation>
 </semantics>
</math>

, and 

<math display="inline" id="Color_balance:33">
 <semantics>
  <mi>S</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>S</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S
  </annotation>
 </semantics>
</math>

 are the color-balanced LMS cone tristimulus values; 

<math display="inline" id="Color_balance:34">
 <semantics>
  <msubsup>
   <mi>L</mi>
   <mi>w</mi>
   <mo>′</mo>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>L</ci>
     <ci>normal-′</ci>
    </apply>
    <ci>w</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   L^{\prime}_{w}
  </annotation>
 </semantics>
</math>

, 

<math display="inline" id="Color_balance:35">
 <semantics>
  <msubsup>
   <mi>M</mi>
   <mi>w</mi>
   <mo>′</mo>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>M</ci>
     <ci>normal-′</ci>
    </apply>
    <ci>w</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   M^{\prime}_{w}
  </annotation>
 </semantics>
</math>

, and 

<math display="inline" id="Color_balance:36">
 <semantics>
  <msubsup>
   <mi>S</mi>
   <mi>w</mi>
   <mo>′</mo>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>S</ci>
     <ci>normal-′</ci>
    </apply>
    <ci>w</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S^{\prime}_{w}
  </annotation>
 </semantics>
</math>

 are the tristimulus values of an object believed to be white in the un-color-balanced image, and 

<math display="inline" id="Color_balance:37">
 <semantics>
  <msup>
   <mi>L</mi>
   <mo>′</mo>
  </msup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <ci>L</ci>
    <ci>normal-′</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   L^{\prime}
  </annotation>
 </semantics>
</math>

, 

<math display="inline" id="Color_balance:38">
 <semantics>
  <msup>
   <mi>M</mi>
   <mo>′</mo>
  </msup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <ci>M</ci>
    <ci>normal-′</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   M^{\prime}
  </annotation>
 </semantics>
</math>

, and 

<math display="inline" id="Color_balance:39">
 <semantics>
  <msup>
   <mi>S</mi>
   <mo>′</mo>
  </msup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <ci>S</ci>
    <ci>normal-′</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S^{\prime}
  </annotation>
 </semantics>
</math>

 are the tristimulus values of a pixel in the un-color-balanced image.</p>

<p>Matrices to convert to LMS space were not specified by von Kries, but can be derived from CIE color matching functions and LMS color matching functions when the latter are specified; matrices can also be found in reference books.<a class="footnoteRef" href="#fn13" id="fnref13"><sup>13</sup></a></p>
<h3 id="scaling-camera-rgb">Scaling camera RGB</h3>

<p>By Viggiano's measure, and using his model of gaussian camera spectral sensitivities, most camera RGB spaces performed better than either monitor RGB or XYZ.<a class="footnoteRef" href="#fn14" id="fnref14"><sup>14</sup></a> If the camera's raw RGB values are known, one may use the 3x3 diagonal matrix:</p>

<p>

<math display="block" id="Color_balance:40">
 <semantics>
  <mrow>
   <mrow>
    <mo>[</mo>
    <mtable displaystyle="true">
     <mtr>
      <mtd columnalign="center">
       <mi>R</mi>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <mi>G</mi>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <mi>B</mi>
      </mtd>
     </mtr>
    </mtable>
    <mo>]</mo>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mrow>
     <mo>[</mo>
     <mtable displaystyle="true">
      <mtr>
       <mtd columnalign="center">
        <mrow>
         <mn>255</mn>
         <mo>/</mo>
         <msubsup>
          <mi>R</mi>
          <mi>w</mi>
          <mo>′</mo>
         </msubsup>
        </mrow>
       </mtd>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
       <mtd columnalign="center">
        <mrow>
         <mn>255</mn>
         <mo>/</mo>
         <msubsup>
          <mi>G</mi>
          <mi>w</mi>
          <mo>′</mo>
         </msubsup>
        </mrow>
       </mtd>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
       <mtd columnalign="center">
        <mrow>
         <mn>255</mn>
         <mo>/</mo>
         <msubsup>
          <mi>B</mi>
          <mi>w</mi>
          <mo>′</mo>
         </msubsup>
        </mrow>
       </mtd>
      </mtr>
     </mtable>
     <mo>]</mo>
    </mrow>
    <mrow>
     <mo>[</mo>
     <mtable displaystyle="true">
      <mtr>
       <mtd columnalign="center">
        <msup>
         <mi>R</mi>
         <mo>′</mo>
        </msup>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <msup>
         <mi>G</mi>
         <mo>′</mo>
        </msup>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <msup>
         <mi>B</mi>
         <mo>′</mo>
        </msup>
       </mtd>
      </mtr>
     </mtable>
     <mo>]</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="latexml">delimited-[]</csymbol>
     <matrix>
      <matrixrow>
       <ci>R</ci>
      </matrixrow>
      <matrixrow>
       <ci>G</ci>
      </matrixrow>
      <matrixrow>
       <ci>B</ci>
      </matrixrow>
     </matrix>
    </apply>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="latexml">delimited-[]</csymbol>
      <matrix>
       <matrixrow>
        <apply>
         <divide></divide>
         <cn type="integer">255</cn>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">superscript</csymbol>
           <ci>R</ci>
           <ci>normal-′</ci>
          </apply>
          <ci>w</ci>
         </apply>
        </apply>
        <cn type="integer">0</cn>
        <cn type="integer">0</cn>
       </matrixrow>
       <matrixrow>
        <cn type="integer">0</cn>
        <apply>
         <divide></divide>
         <cn type="integer">255</cn>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">superscript</csymbol>
           <ci>G</ci>
           <ci>normal-′</ci>
          </apply>
          <ci>w</ci>
         </apply>
        </apply>
        <cn type="integer">0</cn>
       </matrixrow>
       <matrixrow>
        <cn type="integer">0</cn>
        <cn type="integer">0</cn>
        <apply>
         <divide></divide>
         <cn type="integer">255</cn>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">superscript</csymbol>
           <ci>B</ci>
           <ci>normal-′</ci>
          </apply>
          <ci>w</ci>
         </apply>
        </apply>
       </matrixrow>
      </matrix>
     </apply>
     <apply>
      <csymbol cd="latexml">delimited-[]</csymbol>
      <matrix>
       <matrixrow>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>R</ci>
         <ci>normal-′</ci>
        </apply>
       </matrixrow>
       <matrixrow>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>G</ci>
         <ci>normal-′</ci>
        </apply>
       </matrixrow>
       <matrixrow>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>B</ci>
         <ci>normal-′</ci>
        </apply>
       </matrixrow>
      </matrix>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \left[\begin{array}[]{c}R\\
G\\
B\end{array}\right]=\left[\begin{array}[]{ccc}255/R^{\prime}_{w}&0&0\\
0&255/G^{\prime}_{w}&0\\
0&0&255/B^{\prime}_{w}\end{array}\right]\left[\begin{array}[]{c}R^{\prime}\\
G^{\prime}\\
B^{\prime}\end{array}\right]
  </annotation>
 </semantics>
</math>

</p>

<p>and then convert to a working RGB space such as <a class="uri" href="sRGB" title="wikilink">sRGB</a> or <a href="Adobe_RGB" title="wikilink">Adobe RGB</a> after balancing.</p>
<h3 id="preferred-chromatic-adaptation-spaces">Preferred chromatic adaptation spaces</h3>

<p>Comparisons of images balanced by diagonal transforms in a number of different RGB spaces have identified several such spaces that work better than others, and better than camera or monitor spaces, for chromatic adaptation, as measured by several <a href="color_appearance_model" title="wikilink">color appearance models</a>; the systems that performed statistically as well as the best on the majority of the image test sets used were the "Sharp", "Bradford", "CMCCAT", and "ROMM" spaces.<a class="footnoteRef" href="#fn15" id="fnref15"><sup>15</sup></a></p>
<h3 id="general-illuminant-adaptation">General illuminant adaptation</h3>

<p>The best color matrix for adapting to a change in illuminant is not necessarily a diagonal matrix in a fixed color space. It has long been known that if the space of illuminants can be described as a linear model with <em>N</em> basis terms, the proper color transformation will be the weighted sum of <em>N</em> fixed linear transformations, not necessarily consistently diagonalizable.<a class="footnoteRef" href="#fn16" id="fnref16"><sup>16</sup></a></p>
<h2 id="see-also">See also</h2>
<ul>
<li><a href="Color_cast" title="wikilink">Color cast</a></li>
<li><a href="Color_temperature" title="wikilink">Color temperature</a></li>
<li><a href="Gamma_correction" title="wikilink">Gamma correction</a></li>
<li><a href="White_point" title="wikilink">White point</a></li>
</ul>
<h2 id="references">References</h2>
<h2 id="external-links">External links</h2>
<ul>
<li><a href="http://www.nikondigital.org/articles/white_balance.htm">White Balance</a> - Intro at nikondigital.org</li>
<li><a href="http://www.photoxels.com/tutorial_white-balance.html">Understanding White Balance</a> - Tutorial</li>
<li><a href="http://www.ipol.im/pub/algo/lmps_simplest_color_balance/">Affine color balance with saturation, with code and on-line demonstration</a></li>
<li><a href="http://www.geofflawrence.com/white_balance.html">Getting the White Balance Right for Neutral Colors</a> - Photography Tutorial</li>
</ul>

<p>"</p>

<p><a class="uri" href="Category:Color" title="wikilink">Category:Color</a> <a href="Category:Image_processing" title="wikilink">Category:Image processing</a></p>
<section class="footnotes">
<hr/>
<ol>
<li id="fn1"><a href="#fnref1">↩</a></li>
<li id="fn2"><a href="#fnref2">↩</a></li>
<li id="fn3"><a href="#fnref3">↩</a></li>
<li id="fn4"><a href="#fnref4">↩</a></li>
<li id="fn5">Brian Funt, Vlad Cardei, and Kobus Barnard, "<a href="http://www.cs.sfu.ca/~colour/publications/ARIZONA/arizona_abs.html">Learning color constancy</a>," in <em>Proceedings of the Fourth IS&amp;T;/SID Color Imaging Conference,</em> p 58-60 (1996).<a href="#fnref5">↩</a></li>
<li id="fn6"><a href="#fnref6">↩</a></li>
<li id="fn7">John A C Yule, <em>Principles of Color Reproduction.</em> New York: Wiley, 1967.<a href="#fnref7">↩</a></li>
<li id="fn8"></li>
<li id="fn9">J A Stephen Viggiano, "<a href="http://www.acolyte-color.com/papers/EI_2004.pdf">Comparison of the accuracy of different white balancing options as quantified by their color constancy</a>." <em>Sensors and Camera Systems for Scientific, Industrial, and Digital Photography Applications V: Proceedings of the SPIE,</em> volume 5301. Bellingham, WA: SPIE: the International Society for Optical Engineering, p 323-333 (2004), retrieved online 2008-07-28.<a href="#fnref9">↩</a></li>
<li id="fn10"><a href="#fnref10">↩</a></li>
<li id="fn11">Mark D Fairchild, <em>Color Appearance Models.</em> Reading, MA: Addison-Wesley, 1998.<a href="#fnref11">↩</a></li>
<li id="fn12"><a href="#fnref12">↩</a></li>
<li id="fn13"></li>
<li id="fn14"></li>
<li id="fn15"><a href="#fnref15">↩</a></li>
<li id="fn16"><a href="#fnref16">↩</a></li>
</ol>
</section>
</body>
</html>
