<html lang="en">
<head>
<meta charset="utf-8"/>
<title offset="941">Range mode query</title>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG.js" type="text/javascript">
</script>
</head>
<body>
<h1>Range mode query</h1>
<hr/>

<p>In <a href="data_structure" title="wikilink">data structures</a>, the range mode query problem asks to build a data structure on some input data to efficiently answer queries asking for the <a href="mode_(statistics)" title="wikilink">mode</a> of any consecutive subset of the input.</p>
<h2 id="problem-statement">Problem Statement</h2>

<p>Given an array 

<math display="inline" id="Range_mode_query:0">
 <semantics>
  <mrow>
   <mi>A</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mn>1</mn>
    <mo>:</mo>
    <mi>n</mi>
    <mo stretchy="false">]</mo>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mo stretchy="false">[</mo>
    <msub>
     <mi>a</mi>
     <mn>1</mn>
    </msub>
    <mo>,</mo>
    <msub>
     <mi>a</mi>
     <mn>2</mn>
    </msub>
    <mo>,</mo>
    <mi mathvariant="normal">…</mi>
    <mo>,</mo>
    <msub>
     <mi>a</mi>
     <mi>n</mi>
    </msub>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">A</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <cn type="integer">1</cn>
     <ci>normal-:</ci>
     <csymbol cd="unknown">n</csymbol>
     <ci>normal-]</ci>
    </cerror>
    <eq></eq>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>a</ci>
      <cn type="integer">1</cn>
     </apply>
     <ci>normal-,</ci>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>a</ci>
      <cn type="integer">2</cn>
     </apply>
     <ci>normal-,</ci>
     <ci>normal-…</ci>
     <ci>normal-,</ci>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>a</ci>
      <ci>n</ci>
     </apply>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A[1:n]=[a_{1},a_{2},...,a_{n}]
  </annotation>
 </semantics>
</math>

, we wish to answer queries of the form 

<math display="inline" id="Range_mode_query:1">
 <semantics>
  <mrow>
   <mi>m</mi>
   <mi>o</mi>
   <mi>d</mi>
   <mi>e</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>A</mi>
    <mo>,</mo>
    <mi>i</mi>
    <mo>:</mo>
    <mi>j</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">m</csymbol>
    <csymbol cd="unknown">o</csymbol>
    <csymbol cd="unknown">d</csymbol>
    <csymbol cd="unknown">e</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">A</csymbol>
     <ci>normal-,</ci>
     <csymbol cd="unknown">i</csymbol>
     <ci>normal-:</ci>
     <csymbol cd="unknown">j</csymbol>
     <ci>normal-)</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   mode(A,i:j)
  </annotation>
 </semantics>
</math>

, where 

<math display="inline" id="Range_mode_query:2">
 <semantics>
  <mrow>
   <mn>1</mn>
   <mo>≤</mo>
   <mi>i</mi>
   <mo>≤</mo>
   <mi>j</mi>
   <mo>≤</mo>
   <mi>n</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <and></and>
    <apply>
     <leq></leq>
     <cn type="integer">1</cn>
     <ci>i</ci>
    </apply>
    <apply>
     <leq></leq>
     <share href="#.cmml">
     </share>
     <ci>j</ci>
    </apply>
    <apply>
     <leq></leq>
     <share href="#.cmml">
     </share>
     <ci>n</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   1\leq i\leq j\leq n
  </annotation>
 </semantics>
</math>

. The mode of an array 

<math display="inline" id="Range_mode_query:3">
 <semantics>
  <mrow>
   <mi>S</mi>
   <mo>=</mo>
   <mrow>
    <mo stretchy="false">[</mo>
    <msub>
     <mi>s</mi>
     <mn>1</mn>
    </msub>
    <mo>,</mo>
    <msub>
     <mi>s</mi>
     <mn>2</mn>
    </msub>
    <mo>,</mo>
    <mi mathvariant="normal">…</mi>
    <mo>,</mo>
    <msub>
     <mi>s</mi>
     <mi>n</mi>
    </msub>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>S</ci>
    <list>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>s</ci>
      <cn type="integer">1</cn>
     </apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>s</ci>
      <cn type="integer">2</cn>
     </apply>
     <ci>normal-…</ci>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>s</ci>
      <ci>n</ci>
     </apply>
    </list>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S=[s_{1},s_{2},...,s_{n}]
  </annotation>
 </semantics>
</math>

, 

<math display="inline" id="Range_mode_query:4">
 <semantics>
  <mrow>
   <mi>m</mi>
   <mi>o</mi>
   <mi>d</mi>
   <mi>e</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>S</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>m</ci>
    <ci>o</ci>
    <ci>d</ci>
    <ci>e</ci>
    <ci>S</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   mode(S)
  </annotation>
 </semantics>
</math>

, is an element 

<math display="inline" id="Range_mode_query:5">
 <semantics>
  <msub>
   <mi>s</mi>
   <mi>i</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>s</ci>
    <ci>i</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   s_{i}
  </annotation>
 </semantics>
</math>

 such that the frequency of 

<math display="inline" id="Range_mode_query:6">
 <semantics>
  <msub>
   <mi>s</mi>
   <mi>i</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>s</ci>
    <ci>i</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   s_{i}
  </annotation>
 </semantics>
</math>

 is greater than the frequency of 

<math display="inline" id="Range_mode_query:7">
 <semantics>
  <mrow>
   <mrow>
    <mpadded width="+2.8pt">
     <msub>
      <mi>s</mi>
      <mi>j</mi>
     </msub>
    </mpadded>
    <mrow>
     <mo>∀</mo>
     <mi>j</mi>
    </mrow>
   </mrow>
   <mo>∈</mo>
   <mrow>
    <mo stretchy="false">{</mo>
    <mn>1</mn>
    <mo>,</mo>
    <mi mathvariant="normal">…</mi>
    <mo>,</mo>
    <mi>n</mi>
    <mo stretchy="false">}</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <in></in>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>s</ci>
      <ci>j</ci>
     </apply>
     <apply>
      <csymbol cd="latexml">for-all</csymbol>
      <ci>j</ci>
     </apply>
    </apply>
    <set>
     <cn type="integer">1</cn>
     <ci>normal-…</ci>
     <ci>n</ci>
    </set>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   s_{j}\;\forall j\in\{1,...,n\}
  </annotation>
 </semantics>
</math>

. For example, if 

<math display="inline" id="Range_mode_query:8">
 <semantics>
  <mrow>
   <mi>S</mi>
   <mo>=</mo>
   <mrow>
    <mo stretchy="false">[</mo>
    <mn>1</mn>
    <mo>,</mo>
    <mn>2</mn>
    <mo>,</mo>
    <mn>4</mn>
    <mo>,</mo>
    <mn>2</mn>
    <mo>,</mo>
    <mn>3</mn>
    <mo>,</mo>
    <mn>4</mn>
    <mo>,</mo>
    <mn>2</mn>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>S</ci>
    <list>
     <cn type="integer">1</cn>
     <cn type="integer">2</cn>
     <cn type="integer">4</cn>
     <cn type="integer">2</cn>
     <cn type="integer">3</cn>
     <cn type="integer">4</cn>
     <cn type="integer">2</cn>
    </list>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S=[1,2,4,2,3,4,2]
  </annotation>
 </semantics>
</math>

, 

<math display="inline" id="Range_mode_query:9">
 <semantics>
  <mrow>
   <mrow>
    <mi>m</mi>
    <mi>o</mi>
    <mi>d</mi>
    <mi>e</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>s</mi>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mn>2</mn>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <ci>m</ci>
     <ci>o</ci>
     <ci>d</ci>
     <ci>e</ci>
     <ci>s</ci>
    </apply>
    <cn type="integer">2</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   mode(s)=2
  </annotation>
 </semantics>
</math>

. This definition can be extended to the mode of any subset of the array 

<math display="inline" id="Range_mode_query:10">
 <semantics>
  <mrow>
   <mi>A</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>i</mi>
    <mo>:</mo>
    <mi>j</mi>
    <mo stretchy="false">]</mo>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mo stretchy="false">[</mo>
    <msub>
     <mi>a</mi>
     <mi>i</mi>
    </msub>
    <mo>,</mo>
    <msub>
     <mi>a</mi>
     <mi>i</mi>
    </msub>
    <mo>+</mo>
    <mn>1</mn>
    <mo>,</mo>
    <mi mathvariant="normal">…</mi>
    <mo>,</mo>
    <msub>
     <mi>a</mi>
     <mi>j</mi>
    </msub>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">A</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <csymbol cd="unknown">i</csymbol>
     <ci>normal-:</ci>
     <csymbol cd="unknown">j</csymbol>
     <ci>normal-]</ci>
    </cerror>
    <eq></eq>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>a</ci>
      <ci>i</ci>
     </apply>
     <ci>normal-,</ci>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>a</ci>
      <ci>i</ci>
     </apply>
     <plus></plus>
     <cn type="integer">1</cn>
     <ci>normal-,</ci>
     <ci>normal-…</ci>
     <ci>normal-,</ci>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>a</ci>
      <ci>j</ci>
     </apply>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A[i:j]=[a_{i},a_{i}+1,...,a_{j}]
  </annotation>
 </semantics>
</math>

.</p>
<h3 id="theorem-1">Theorem 1</h3>

<p>Let 

<math display="inline" id="Range_mode_query:11">
 <semantics>
  <mi>A</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>A</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="Range_mode_query:12">
 <semantics>
  <mi>B</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>B</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B
  </annotation>
 </semantics>
</math>

 be any <a href="multiset" title="wikilink">multisets</a>. If 

<math display="inline" id="Range_mode_query:13">
 <semantics>
  <mi>c</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>c</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   c
  </annotation>
 </semantics>
</math>

 is a mode of 

<math display="inline" id="Range_mode_query:14">
 <semantics>
  <mrow>
   <mi>A</mi>
   <mo>∪</mo>
   <mi>B</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <union></union>
    <ci>A</ci>
    <ci>B</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A\cup B
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="Range_mode_query:15">
 <semantics>
  <mrow>
   <mi>c</mi>
   <mo>∉</mo>
   <mi>A</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <notin></notin>
    <ci>c</ci>
    <ci>A</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   c\notin A
  </annotation>
 </semantics>
</math>

, then 

<math display="inline" id="Range_mode_query:16">
 <semantics>
  <mi>c</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>c</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   c
  </annotation>
 </semantics>
</math>

 is a mode of 

<math display="inline" id="Range_mode_query:17">
 <semantics>
  <mi>B</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>B</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B
  </annotation>
 </semantics>
</math>

.</p>
<h3 id="proof">Proof</h3>

<p>Let 

<math display="inline" id="Range_mode_query:18">
 <semantics>
  <mrow>
   <mi>c</mi>
   <mo>∉</mo>
   <mi>A</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <notin></notin>
    <ci>c</ci>
    <ci>A</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   c\notin A
  </annotation>
 </semantics>
</math>

 be a mode of 

<math display="inline" id="Range_mode_query:19">
 <semantics>
  <mrow>
   <mi>C</mi>
   <mo>=</mo>
   <mrow>
    <mi>A</mi>
    <mo>∪</mo>
    <mi>B</mi>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>C</ci>
    <apply>
     <union></union>
     <ci>A</ci>
     <ci>B</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C=A\cup B
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="Range_mode_query:20">
 <semantics>
  <msub>
   <mi>f</mi>
   <mi>c</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>f</ci>
    <ci>c</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f_{c}
  </annotation>
 </semantics>
</math>

 be its frequency in 

<math display="inline" id="Range_mode_query:21">
 <semantics>
  <mi>C</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>C</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C
  </annotation>
 </semantics>
</math>

. Suppose that 

<math display="inline" id="Range_mode_query:22">
 <semantics>
  <mi>c</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>c</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   c
  </annotation>
 </semantics>
</math>

 is not a mode of 

<math display="inline" id="Range_mode_query:23">
 <semantics>
  <mi>B</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>B</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B
  </annotation>
 </semantics>
</math>

. Thus, there exists an element 

<math display="inline" id="Range_mode_query:24">
 <semantics>
  <mi>b</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>b</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   b
  </annotation>
 </semantics>
</math>

 with frequency 

<math display="inline" id="Range_mode_query:25">
 <semantics>
  <msub>
   <mi>f</mi>
   <mi>b</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>f</ci>
    <ci>b</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f_{b}
  </annotation>
 </semantics>
</math>

 that is the mode of 

<math display="inline" id="Range_mode_query:26">
 <semantics>
  <mi>B</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>B</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B
  </annotation>
 </semantics>
</math>

. Since 

<math display="inline" id="Range_mode_query:27">
 <semantics>
  <mi>b</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>b</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   b
  </annotation>
 </semantics>
</math>

 is the mode of 

<math display="inline" id="Range_mode_query:28">
 <semantics>
  <mi>B</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>B</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B
  </annotation>
 </semantics>
</math>

 and that 

<math display="inline" id="Range_mode_query:29">
 <semantics>
  <mrow>
   <mi>c</mi>
   <mo>∉</mo>
   <mi>A</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <notin></notin>
    <ci>c</ci>
    <ci>A</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   c\notin A
  </annotation>
 </semantics>
</math>

, then 

<math display="inline" id="Range_mode_query:30">
 <semantics>
  <mrow>
   <msub>
    <mi>f</mi>
    <mi>b</mi>
   </msub>
   <mo>></mo>
   <msub>
    <mi>f</mi>
    <mi>c</mi>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <gt></gt>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>f</ci>
     <ci>b</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>f</ci>
     <ci>c</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f_{b}>f_{c}
  </annotation>
 </semantics>
</math>

. Thus, 

<math display="inline" id="Range_mode_query:31">
 <semantics>
  <mi>b</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>b</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   b
  </annotation>
 </semantics>
</math>

 should be the mode of 

<math display="inline" id="Range_mode_query:32">
 <semantics>
  <mi>C</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>C</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C
  </annotation>
 </semantics>
</math>

 which is a contradiction.</p>
<h2 id="results">Results</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">
<p>Space</p></th>
<th style="text-align: left;">
<p>Query Time</p></th>
<th style="text-align: left;">
<p>Restrictions</p></th>
<th style="text-align: left;">
<p>Source</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">
<p>

<math display="inline" id="Range_mode_query:33">
 <semantics>
  <mrow>
   <mi>O</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>n</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>O</ci>
    <ci>n</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   O(n)
  </annotation>
 </semantics>
</math>

</p></td>
<td style="text-align: left;">
<p>

<math display="inline" id="Range_mode_query:34">
 <semantics>
  <mrow>
   <mi>O</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <msqrt>
     <mi>n</mi>
    </msqrt>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>O</ci>
    <apply>
     <root></root>
     <ci>n</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   O(\sqrt{n})
  </annotation>
 </semantics>
</math>

</p></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">
<p><a class="footnoteRef" href="#fn1" id="fnref1"><sup>1</sup></a></p></td>
</tr>
<tr class="even">
<td style="text-align: left;">
<p>

<math display="inline" id="Range_mode_query:35">
 <semantics>
  <mrow>
   <mi>O</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>n</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>O</ci>
    <ci>n</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   O(n)
  </annotation>
 </semantics>
</math>

</p></td>
<td style="text-align: left;">
<p>

<math display="inline" id="Range_mode_query:36">
 <semantics>
  <mrow>
   <mi>O</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <msqrt>
     <mrow>
      <mi>n</mi>
      <mo>/</mo>
      <mi>w</mi>
     </mrow>
    </msqrt>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>O</ci>
    <apply>
     <root></root>
     <apply>
      <divide></divide>
      <ci>n</ci>
      <ci>w</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   O(\sqrt{n/w})
  </annotation>
 </semantics>
</math>

</p></td>
<td style="text-align: left;">
<p>

<math display="inline" id="Range_mode_query:37">
 <semantics>
  <mi>w</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>w</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   w
  </annotation>
 </semantics>
</math>

 is the word size</p></td>
<td style="text-align: left;">
<p><a class="footnoteRef" href="#fn2" id="fnref2"><sup>2</sup></a></p></td>
</tr>
<tr class="odd">
<td style="text-align: left;">
<p>

<math display="inline" id="Range_mode_query:38">
 <semantics>
  <mrow>
   <mi>O</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mrow>
     <msup>
      <mi>n</mi>
      <mn>2</mn>
     </msup>
     <mrow>
      <mi>log</mi>
      <mrow>
       <mi>log</mi>
       <mrow>
        <mi>n</mi>
        <mo>/</mo>
        <mrow>
         <mi>log</mi>
         <mi>n</mi>
        </mrow>
       </mrow>
      </mrow>
     </mrow>
    </mrow>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>O</ci>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>n</ci>
      <cn type="integer">2</cn>
     </apply>
     <apply>
      <log></log>
      <apply>
       <log></log>
       <apply>
        <divide></divide>
        <ci>n</ci>
        <apply>
         <log></log>
         <ci>n</ci>
        </apply>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   O(n^{2}\log\log n/\log n)
  </annotation>
 </semantics>
</math>

</p></td>
<td style="text-align: left;">
<p>

<math display="inline" id="Range_mode_query:39">
 <semantics>
  <mrow>
   <mi>O</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mn>1</mn>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>O</ci>
    <cn type="integer">1</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   O(1)
  </annotation>
 </semantics>
</math>

</p></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">
<p><a class="footnoteRef" href="#fn3" id="fnref3"><sup>3</sup></a></p></td>
</tr>
<tr class="even">
<td style="text-align: left;">
<p>

<math display="inline" id="Range_mode_query:40">
 <semantics>
  <mrow>
   <mi>O</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <msup>
     <mi>n</mi>
     <mrow>
      <mn>2</mn>
      <mo>-</mo>
      <mrow>
       <mn>2</mn>
       <mi>ϵ</mi>
      </mrow>
     </mrow>
    </msup>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>O</ci>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>n</ci>
     <apply>
      <minus></minus>
      <cn type="integer">2</cn>
      <apply>
       <times></times>
       <cn type="integer">2</cn>
       <ci>ϵ</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   O(n^{2-2\epsilon})
  </annotation>
 </semantics>
</math>

</p></td>
<td style="text-align: left;">
<p>

<math display="inline" id="Range_mode_query:41">
 <semantics>
  <mrow>
   <mi>O</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mrow>
     <msup>
      <mi>n</mi>
      <mi>ϵ</mi>
     </msup>
     <mrow>
      <mi>log</mi>
      <mi>n</mi>
     </mrow>
    </mrow>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>O</ci>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>n</ci>
      <ci>ϵ</ci>
     </apply>
     <apply>
      <log></log>
      <ci>n</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   O(n^{\epsilon}\log n)
  </annotation>
 </semantics>
</math>

</p></td>
<td style="text-align: left;">
<p>

<math display="inline" id="Range_mode_query:42">
 <semantics>
  <mrow>
   <mn>0</mn>
   <mo>≤</mo>
   <mi>ϵ</mi>
   <mo>≤</mo>
   <mrow>
    <mn>1</mn>
    <mo>/</mo>
    <mn>2</mn>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <and></and>
    <apply>
     <leq></leq>
     <cn type="integer">0</cn>
     <ci>ϵ</ci>
    </apply>
    <apply>
     <leq></leq>
     <share href="#.cmml">
     </share>
     <apply>
      <divide></divide>
      <cn type="integer">1</cn>
      <cn type="integer">2</cn>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   0\leq\epsilon\leq 1/2
  </annotation>
 </semantics>
</math>

</p></td>
<td style="text-align: left;">
<p><a class="footnoteRef" href="#fn4" id="fnref4"><sup>4</sup></a></p></td>
</tr>
<tr class="odd">
</tr>
</tbody>
</table>
<h2 id="lower-bound">Lower bound</h2>

<p>Any data structure using 

<math display="inline" id="Range_mode_query:43">
 <semantics>
  <mi>S</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>S</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S
  </annotation>
 </semantics>
</math>

 cells of 

<math display="inline" id="Range_mode_query:44">
 <semantics>
  <mi>w</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>w</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   w
  </annotation>
 </semantics>
</math>

 bits each needs 

<math display="inline" id="Range_mode_query:45">
 <semantics>
  <mrow>
   <mi mathvariant="normal">Ω</mi>
   <mrow>
    <mo>(</mo>
    <mfrac>
     <mrow>
      <mi>log</mi>
      <mi>n</mi>
     </mrow>
     <mrow>
      <mi>log</mi>
      <mrow>
       <mo stretchy="false">(</mo>
       <mrow>
        <mrow>
         <mi>S</mi>
         <mi>w</mi>
        </mrow>
        <mo>/</mo>
        <mi>n</mi>
       </mrow>
       <mo stretchy="false">)</mo>
      </mrow>
     </mrow>
    </mfrac>
    <mo>)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>normal-Ω</ci>
    <apply>
     <divide></divide>
     <apply>
      <log></log>
      <ci>n</ci>
     </apply>
     <apply>
      <log></log>
      <apply>
       <divide></divide>
       <apply>
        <times></times>
        <ci>S</ci>
        <ci>w</ci>
       </apply>
       <ci>n</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Omega\left(\frac{\log n}{\log(Sw/n)}\right)
  </annotation>
 </semantics>
</math>

 time to answer a range mode query.<a class="footnoteRef" href="#fn5" id="fnref5"><sup>5</sup></a></p>

<p>This contrasts with other range mode problems, such as the range minimum query which have solutions offering constant time query time and linear space. This is due to the hardness of the mode problem, since if we know the mode of 

<math display="inline" id="Range_mode_query:46">
 <semantics>
  <mrow>
   <mi>A</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>i</mi>
    <mo>:</mo>
    <mi>j</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">A</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <csymbol cd="unknown">i</csymbol>
     <ci>normal-:</ci>
     <csymbol cd="unknown">j</csymbol>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A[i:j]
  </annotation>
 </semantics>
</math>

 and the mode of 

<math display="inline" id="Range_mode_query:47">
 <semantics>
  <mrow>
   <mi>A</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>j</mi>
    <mo>+</mo>
    <mi>i</mi>
    <mo>:</mo>
    <mi>k</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">A</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <csymbol cd="unknown">j</csymbol>
     <plus></plus>
     <csymbol cd="unknown">i</csymbol>
     <ci>normal-:</ci>
     <csymbol cd="unknown">k</csymbol>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A[j+i:k]
  </annotation>
 </semantics>
</math>

, there is no simple way of computing the mode of 

<math display="inline" id="Range_mode_query:48">
 <semantics>
  <mrow>
   <mi>A</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>i</mi>
    <mo>:</mo>
    <mi>k</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">A</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <csymbol cd="unknown">i</csymbol>
     <ci>normal-:</ci>
     <csymbol cd="unknown">k</csymbol>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A[i:k]
  </annotation>
 </semantics>
</math>

. Any element of 

<math display="inline" id="Range_mode_query:49">
 <semantics>
  <mrow>
   <mi>A</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>j</mi>
    <mo>+</mo>
    <mi>i</mi>
    <mo>:</mo>
    <mi>k</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">A</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <csymbol cd="unknown">j</csymbol>
     <plus></plus>
     <csymbol cd="unknown">i</csymbol>
     <ci>normal-:</ci>
     <csymbol cd="unknown">k</csymbol>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A[j+i:k]
  </annotation>
 </semantics>
</math>

 or 

<math display="inline" id="Range_mode_query:50">
 <semantics>
  <mrow>
   <mi>A</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>j</mi>
    <mo>+</mo>
    <mi>i</mi>
    <mo>:</mo>
    <mi>k</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">A</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <csymbol cd="unknown">j</csymbol>
     <plus></plus>
     <csymbol cd="unknown">i</csymbol>
     <ci>normal-:</ci>
     <csymbol cd="unknown">k</csymbol>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A[j+i:k]
  </annotation>
 </semantics>
</math>

 could be the mode. For example, if 

<math display="inline" id="Range_mode_query:51">
 <semantics>
  <mrow>
   <mi>m</mi>
   <mi>o</mi>
   <mi>d</mi>
   <mi>e</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>A</mi>
    <mrow>
     <mo stretchy="false">[</mo>
     <mi>i</mi>
     <mo>:</mo>
     <mi>j</mi>
     <mo stretchy="false">]</mo>
    </mrow>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>=</mo>
   <mi>a</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">m</csymbol>
    <csymbol cd="unknown">o</csymbol>
    <csymbol cd="unknown">d</csymbol>
    <csymbol cd="unknown">e</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">A</csymbol>
     <cerror>
      <csymbol cd="ambiguous">fragments</csymbol>
      <ci>normal-[</ci>
      <csymbol cd="unknown">i</csymbol>
      <ci>normal-:</ci>
      <csymbol cd="unknown">j</csymbol>
      <ci>normal-]</ci>
     </cerror>
     <ci>normal-)</ci>
    </cerror>
    <eq></eq>
    <csymbol cd="unknown">a</csymbol>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   mode(A[i:j])=a
  </annotation>
 </semantics>
</math>

 and its frequency is 

<math display="inline" id="Range_mode_query:52">
 <semantics>
  <msub>
   <mi>f</mi>
   <mi>a</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>f</ci>
    <ci>a</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f_{a}
  </annotation>
 </semantics>
</math>

, and 

<math display="inline" id="Range_mode_query:53">
 <semantics>
  <mrow>
   <mi>m</mi>
   <mi>o</mi>
   <mi>d</mi>
   <mi>e</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>A</mi>
    <mrow>
     <mo stretchy="false">[</mo>
     <mi>j</mi>
     <mo>+</mo>
     <mn>1</mn>
     <mo>:</mo>
     <mi>k</mi>
     <mo stretchy="false">]</mo>
    </mrow>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>=</mo>
   <mi>b</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">m</csymbol>
    <csymbol cd="unknown">o</csymbol>
    <csymbol cd="unknown">d</csymbol>
    <csymbol cd="unknown">e</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">A</csymbol>
     <cerror>
      <csymbol cd="ambiguous">fragments</csymbol>
      <ci>normal-[</ci>
      <csymbol cd="unknown">j</csymbol>
      <plus></plus>
      <cn type="integer">1</cn>
      <ci>normal-:</ci>
      <csymbol cd="unknown">k</csymbol>
      <ci>normal-]</ci>
     </cerror>
     <ci>normal-)</ci>
    </cerror>
    <eq></eq>
    <csymbol cd="unknown">b</csymbol>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   mode(A[j+1:k])=b
  </annotation>
 </semantics>
</math>

 and its frequency is also 

<math display="inline" id="Range_mode_query:54">
 <semantics>
  <msub>
   <mi>f</mi>
   <mi>a</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>f</ci>
    <ci>a</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f_{a}
  </annotation>
 </semantics>
</math>

, there could be an element 

<math display="inline" id="Range_mode_query:55">
 <semantics>
  <mi>c</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>c</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   c
  </annotation>
 </semantics>
</math>

 with frequency 

<math display="inline" id="Range_mode_query:56">
 <semantics>
  <mrow>
   <msub>
    <mi>f</mi>
    <mi>a</mi>
   </msub>
   <mo>-</mo>
   <mn>1</mn>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <minus></minus>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>f</ci>
     <ci>a</ci>
    </apply>
    <cn type="integer">1</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f_{a}-1
  </annotation>
 </semantics>
</math>

 in 

<math display="inline" id="Range_mode_query:57">
 <semantics>
  <mrow>
   <mi>A</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>i</mi>
    <mo>:</mo>
    <mi>j</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">A</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <csymbol cd="unknown">i</csymbol>
     <ci>normal-:</ci>
     <csymbol cd="unknown">j</csymbol>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A[i:j]
  </annotation>
 </semantics>
</math>

 and frequency 

<math display="inline" id="Range_mode_query:58">
 <semantics>
  <mrow>
   <msub>
    <mi>f</mi>
    <mi>a</mi>
   </msub>
   <mo>-</mo>
   <mn>1</mn>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <minus></minus>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>f</ci>
     <ci>a</ci>
    </apply>
    <cn type="integer">1</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f_{a}-1
  </annotation>
 </semantics>
</math>

 in 

<math display="inline" id="Range_mode_query:59">
 <semantics>
  <mrow>
   <mi>A</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>j</mi>
    <mo>+</mo>
    <mn>1</mn>
    <mo>:</mo>
    <mi>k</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">A</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <csymbol cd="unknown">j</csymbol>
     <plus></plus>
     <cn type="integer">1</cn>
     <ci>normal-:</ci>
     <csymbol cd="unknown">k</csymbol>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A[j+1:k]
  </annotation>
 </semantics>
</math>

. 

<math display="inline" id="Range_mode_query:60">
 <semantics>
  <mrow>
   <mi>a</mi>
   <mo>≠</mo>
   <mi>c</mi>
   <mo>≠</mo>
   <mi>b</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <and></and>
    <apply>
     <neq></neq>
     <ci>a</ci>
     <ci>c</ci>
    </apply>
    <apply>
     <neq></neq>
     <share href="#.cmml">
     </share>
     <ci>b</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   a\not=c\not=b
  </annotation>
 </semantics>
</math>

, but its frequency in 

<math display="inline" id="Range_mode_query:61">
 <semantics>
  <mrow>
   <mi>A</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>i</mi>
    <mo>:</mo>
    <mi>k</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">A</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <csymbol cd="unknown">i</csymbol>
     <ci>normal-:</ci>
     <csymbol cd="unknown">k</csymbol>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A[i:k]
  </annotation>
 </semantics>
</math>

 is greater than the frequency of 

<math display="inline" id="Range_mode_query:62">
 <semantics>
  <mi>a</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>a</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   a
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="Range_mode_query:63">
 <semantics>
  <mi>b</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>b</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   b
  </annotation>
 </semantics>
</math>

, which makes 

<math display="inline" id="Range_mode_query:64">
 <semantics>
  <mi>c</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>c</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   c
  </annotation>
 </semantics>
</math>

 a better candidate for 

<math display="inline" id="Range_mode_query:65">
 <semantics>
  <mrow>
   <mi>m</mi>
   <mi>o</mi>
   <mi>d</mi>
   <mi>e</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>A</mi>
    <mrow>
     <mo stretchy="false">[</mo>
     <mi>i</mi>
     <mo>:</mo>
     <mi>k</mi>
     <mo stretchy="false">]</mo>
    </mrow>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">m</csymbol>
    <csymbol cd="unknown">o</csymbol>
    <csymbol cd="unknown">d</csymbol>
    <csymbol cd="unknown">e</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">A</csymbol>
     <cerror>
      <csymbol cd="ambiguous">fragments</csymbol>
      <ci>normal-[</ci>
      <csymbol cd="unknown">i</csymbol>
      <ci>normal-:</ci>
      <csymbol cd="unknown">k</csymbol>
      <ci>normal-]</ci>
     </cerror>
     <ci>normal-)</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   mode(A[i:k])
  </annotation>
 </semantics>
</math>

 than 

<math display="inline" id="Range_mode_query:66">
 <semantics>
  <mi>a</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>a</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   a
  </annotation>
 </semantics>
</math>

 or 

<math display="inline" id="Range_mode_query:67">
 <semantics>
  <mi>b</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>b</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   b
  </annotation>
 </semantics>
</math>

.</p>
<h2 id="linear-space-data-structure-with-square-root-query-time">Linear space data structure with square root query time</h2>

<p>This method by Chan et al.<a class="footnoteRef" href="#fn6" id="fnref6"><sup>6</sup></a> uses 

<math display="inline" id="Range_mode_query:68">
 <semantics>
  <mrow>
   <mi>O</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mrow>
     <mi>n</mi>
     <mo>+</mo>
     <msup>
      <mi>s</mi>
      <mn>2</mn>
     </msup>
    </mrow>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>O</ci>
    <apply>
     <plus></plus>
     <ci>n</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>s</ci>
      <cn type="integer">2</cn>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   O(n+s^{2})
  </annotation>
 </semantics>
</math>

 space and 

<math display="inline" id="Range_mode_query:69">
 <semantics>
  <mrow>
   <mi>O</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mrow>
     <mi>n</mi>
     <mo>/</mo>
     <mi>s</mi>
    </mrow>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>O</ci>
    <apply>
     <divide></divide>
     <ci>n</ci>
     <ci>s</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   O(n/s)
  </annotation>
 </semantics>
</math>

 query time. By setting 

<math display="inline" id="Range_mode_query:70">
 <semantics>
  <mrow>
   <mi>s</mi>
   <mo>=</mo>
   <msqrt>
    <mi>n</mi>
   </msqrt>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>s</ci>
    <apply>
     <root></root>
     <ci>n</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   s=\sqrt{n}
  </annotation>
 </semantics>
</math>

, we get 

<math display="inline" id="Range_mode_query:71">
 <semantics>
  <mrow>
   <mi>O</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>n</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>O</ci>
    <ci>n</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   O(n)
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="Range_mode_query:72">
 <semantics>
  <mrow>
   <mi>O</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <msqrt>
     <mi>n</mi>
    </msqrt>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>O</ci>
    <apply>
     <root></root>
     <ci>n</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   O(\sqrt{n})
  </annotation>
 </semantics>
</math>

 bounds for space and query time.</p>
<h3 id="preprocessing">Preprocessing</h3>

<p>Let 

<math display="inline" id="Range_mode_query:73">
 <semantics>
  <mrow>
   <mi>A</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mn>1</mn>
    <mo>:</mo>
    <mi>n</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">A</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <cn type="integer">1</cn>
     <ci>normal-:</ci>
     <csymbol cd="unknown">n</csymbol>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A[1:n]
  </annotation>
 </semantics>
</math>

 be an array, and 

<math display="inline" id="Range_mode_query:74">
 <semantics>
  <mrow>
   <mi>D</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mn>1</mn>
    <mo>:</mo>
    <mi mathvariant="normal">Δ</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">D</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <cn type="integer">1</cn>
     <ci>normal-:</ci>
     <csymbol cd="unknown">Δ</csymbol>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   D[1:\Delta]
  </annotation>
 </semantics>
</math>

 be an array that contains the distinct values of A, where 

<math display="inline" id="Range_mode_query:75">
 <semantics>
  <mi mathvariant="normal">Δ</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>normal-Δ</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Delta
  </annotation>
 </semantics>
</math>

 is the number of distinct elements. We define 

<math display="inline" id="Range_mode_query:76">
 <semantics>
  <mrow>
   <mi>B</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mn>1</mn>
    <mo>:</mo>
    <mi>n</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">B</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <cn type="integer">1</cn>
     <ci>normal-:</ci>
     <csymbol cd="unknown">n</csymbol>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B[1:n]
  </annotation>
 </semantics>
</math>

 to be an array such that, for each 

<math display="inline" id="Range_mode_query:77">
 <semantics>
  <mi>i</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>i</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   i
  </annotation>
 </semantics>
</math>

, 

<math display="inline" id="Range_mode_query:78">
 <semantics>
  <mrow>
   <mi>B</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>i</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>B</ci>
    <apply>
     <csymbol cd="latexml">delimited-[]</csymbol>
     <ci>i</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B[i]
  </annotation>
 </semantics>
</math>

 contains the rank (position) of 

<math display="inline" id="Range_mode_query:79">
 <semantics>
  <mrow>
   <mi>A</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>i</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>A</ci>
    <apply>
     <csymbol cd="latexml">delimited-[]</csymbol>
     <ci>i</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A[i]
  </annotation>
 </semantics>
</math>

 in 

<math display="inline" id="Range_mode_query:80">
 <semantics>
  <mi>D</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>D</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   D
  </annotation>
 </semantics>
</math>

. Arrays 

<math display="inline" id="Range_mode_query:81">
 <semantics>
  <mrow>
   <mi>B</mi>
   <mo>,</mo>
   <mi>D</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <list>
    <ci>B</ci>
    <ci>D</ci>
   </list>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B,D
  </annotation>
 </semantics>
</math>

 can be created by a linear scan of 

<math display="inline" id="Range_mode_query:82">
 <semantics>
  <mi>A</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>A</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A
  </annotation>
 </semantics>
</math>

.</p>

<p>Arrays 

<math display="inline" id="Range_mode_query:83">
 <semantics>
  <mrow>
   <msub>
    <mi>Q</mi>
    <mn>1</mn>
   </msub>
   <mo>,</mo>
   <msub>
    <mi>Q</mi>
    <mn>2</mn>
   </msub>
   <mo>,</mo>
   <mi mathvariant="normal">…</mi>
   <mo>,</mo>
   <msub>
    <mi>Q</mi>
    <mi mathvariant="normal">Δ</mi>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <list>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>Q</ci>
     <cn type="integer">1</cn>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>Q</ci>
     <cn type="integer">2</cn>
    </apply>
    <ci>normal-…</ci>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>Q</ci>
     <ci>normal-Δ</ci>
    </apply>
   </list>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   Q_{1},Q_{2},...,Q_{\Delta}
  </annotation>
 </semantics>
</math>

 are also created, such that, for each 

<math display="inline" id="Range_mode_query:84">
 <semantics>
  <mrow>
   <mi>a</mi>
   <mo>∈</mo>
   <mrow>
    <mo stretchy="false">{</mo>
    <mn>1</mn>
    <mo>,</mo>
    <mi mathvariant="normal">…</mi>
    <mo>,</mo>
    <mi mathvariant="normal">Δ</mi>
    <mo stretchy="false">}</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <in></in>
    <ci>a</ci>
    <set>
     <cn type="integer">1</cn>
     <ci>normal-…</ci>
     <ci>normal-Δ</ci>
    </set>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   a\in\{1,...,\Delta\}
  </annotation>
 </semantics>
</math>

, 

<math display="inline" id="Range_mode_query:85">
 <semantics>
  <mrow>
   <msub>
    <mi>Q</mi>
    <mi>a</mi>
   </msub>
   <mo>=</mo>
   <mrow>
    <mo stretchy="false">{</mo>
    <mpadded width="+2.8pt">
     <mi>b</mi>
    </mpadded>
    <mo rspace="5.3pt" stretchy="false">|</mo>
    <mrow>
     <mrow>
      <mi>B</mi>
      <mrow>
       <mo stretchy="false">[</mo>
       <mi>b</mi>
       <mo stretchy="false">]</mo>
      </mrow>
     </mrow>
     <mo>=</mo>
     <mi>a</mi>
    </mrow>
    <mo stretchy="false">}</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>Q</ci>
     <ci>a</ci>
    </apply>
    <apply>
     <csymbol cd="latexml">conditional-set</csymbol>
     <ci>b</ci>
     <apply>
      <eq></eq>
      <apply>
       <times></times>
       <ci>B</ci>
       <apply>
        <csymbol cd="latexml">delimited-[]</csymbol>
        <ci>b</ci>
       </apply>
      </apply>
      <ci>a</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   Q_{a}=\{b\;|\;B[b]=a\}
  </annotation>
 </semantics>
</math>

. We then create an array 

<math display="inline" id="Range_mode_query:86">
 <semantics>
  <mrow>
   <msup>
    <mi>B</mi>
    <mo>′</mo>
   </msup>
   <mrow>
    <mo stretchy="false">[</mo>
    <mn>1</mn>
    <mo>:</mo>
    <mi>n</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>B</ci>
     <ci>normal-′</ci>
    </apply>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <cn type="integer">1</cn>
     <ci>normal-:</ci>
     <csymbol cd="unknown">n</csymbol>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B^{\prime}[1:n]
  </annotation>
 </semantics>
</math>

, such that, for all 

<math display="inline" id="Range_mode_query:87">
 <semantics>
  <mrow>
   <mi>b</mi>
   <mo>∈</mo>
   <mrow>
    <mo stretchy="false">{</mo>
    <mn>1</mn>
    <mo>,</mo>
    <mi mathvariant="normal">…</mi>
    <mo>,</mo>
    <mi>n</mi>
    <mo stretchy="false">}</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <in></in>
    <ci>b</ci>
    <set>
     <cn type="integer">1</cn>
     <ci>normal-…</ci>
     <ci>n</ci>
    </set>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   b\in\{1,...,n\}
  </annotation>
 </semantics>
</math>

, 

<math display="inline" id="Range_mode_query:88">
 <semantics>
  <mrow>
   <msup>
    <mi>B</mi>
    <mo>′</mo>
   </msup>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>b</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>B</ci>
     <ci>normal-′</ci>
    </apply>
    <apply>
     <csymbol cd="latexml">delimited-[]</csymbol>
     <ci>b</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B^{\prime}[b]
  </annotation>
 </semantics>
</math>

 contains the rank of 

<math display="inline" id="Range_mode_query:89">
 <semantics>
  <mi>b</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>b</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   b
  </annotation>
 </semantics>
</math>

 in 

<math display="inline" id="Range_mode_query:90">
 <semantics>
  <msub>
   <mi>Q</mi>
   <mrow>
    <mi>B</mi>
    <mrow>
     <mo stretchy="false">[</mo>
     <mi>b</mi>
     <mo stretchy="false">]</mo>
    </mrow>
   </mrow>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>Q</ci>
    <apply>
     <times></times>
     <ci>B</ci>
     <apply>
      <csymbol cd="latexml">delimited-[]</csymbol>
      <ci>b</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   Q_{B[b]}
  </annotation>
 </semantics>
</math>

. Again, a linear scan of 

<math display="inline" id="Range_mode_query:91">
 <semantics>
  <mi>B</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>B</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B
  </annotation>
 </semantics>
</math>

 suffices to create arrays 

<math display="inline" id="Range_mode_query:92">
 <semantics>
  <mrow>
   <msub>
    <mi>Q</mi>
    <mn>1</mn>
   </msub>
   <mo>,</mo>
   <msub>
    <mi>Q</mi>
    <mn>2</mn>
   </msub>
   <mo>,</mo>
   <mi mathvariant="normal">…</mi>
   <mo>,</mo>
   <msub>
    <mi>Q</mi>
    <mi mathvariant="normal">Δ</mi>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <list>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>Q</ci>
     <cn type="integer">1</cn>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>Q</ci>
     <cn type="integer">2</cn>
    </apply>
    <ci>normal-…</ci>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>Q</ci>
     <ci>normal-Δ</ci>
    </apply>
   </list>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   Q_{1},Q_{2},...,Q_{\Delta}
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="Range_mode_query:93">
 <semantics>
  <msup>
   <mi>B</mi>
   <mo>′</mo>
  </msup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <ci>B</ci>
    <ci>normal-′</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B^{\prime}
  </annotation>
 </semantics>
</math>

.</p>

<p>It is now possible to answer queries of the form "is the frequency of 

<math display="inline" id="Range_mode_query:94">
 <semantics>
  <mrow>
   <mi>B</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>i</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>B</ci>
    <apply>
     <csymbol cd="latexml">delimited-[]</csymbol>
     <ci>i</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B[i]
  </annotation>
 </semantics>
</math>

 in 

<math display="inline" id="Range_mode_query:95">
 <semantics>
  <mrow>
   <mi>B</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>i</mi>
    <mo>:</mo>
    <mi>j</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">B</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <csymbol cd="unknown">i</csymbol>
     <ci>normal-:</ci>
     <csymbol cd="unknown">j</csymbol>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B[i:j]
  </annotation>
 </semantics>
</math>

 at least 

<math display="inline" id="Range_mode_query:96">
 <semantics>
  <mi>q</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>q</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   q
  </annotation>
 </semantics>
</math>

" in constant time, by checking whether 

<math display="inline" id="Range_mode_query:97">
 <semantics>
  <mrow>
   <mrow>
    <msub>
     <mi>Q</mi>
     <mrow>
      <mi>B</mi>
      <mrow>
       <mo stretchy="false">[</mo>
       <mi>i</mi>
       <mo stretchy="false">]</mo>
      </mrow>
     </mrow>
    </msub>
    <mrow>
     <mo stretchy="false">[</mo>
     <mrow>
      <mrow>
       <mrow>
        <msup>
         <mi>B</mi>
         <mo>′</mo>
        </msup>
        <mrow>
         <mo stretchy="false">[</mo>
         <mi>i</mi>
         <mo stretchy="false">]</mo>
        </mrow>
       </mrow>
       <mo>+</mo>
       <mi>q</mi>
      </mrow>
      <mo>-</mo>
      <mn>1</mn>
     </mrow>
     <mo stretchy="false">]</mo>
    </mrow>
   </mrow>
   <mo>≤</mo>
   <mi>j</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <leq></leq>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>Q</ci>
      <apply>
       <times></times>
       <ci>B</ci>
       <apply>
        <csymbol cd="latexml">delimited-[]</csymbol>
        <ci>i</ci>
       </apply>
      </apply>
     </apply>
     <apply>
      <csymbol cd="latexml">delimited-[]</csymbol>
      <apply>
       <minus></minus>
       <apply>
        <plus></plus>
        <apply>
         <times></times>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <ci>B</ci>
          <ci>normal-′</ci>
         </apply>
         <apply>
          <csymbol cd="latexml">delimited-[]</csymbol>
          <ci>i</ci>
         </apply>
        </apply>
        <ci>q</ci>
       </apply>
       <cn type="integer">1</cn>
      </apply>
     </apply>
    </apply>
    <ci>j</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   Q_{B[i]}[B^{\prime}[i]+q-1]\leq j
  </annotation>
 </semantics>
</math>

.</p>

<p>The array is split B into 

<math display="inline" id="Range_mode_query:98">
 <semantics>
  <mi>s</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>s</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   s
  </annotation>
 </semantics>
</math>

 blocks 

<math display="inline" id="Range_mode_query:99">
 <semantics>
  <mrow>
   <msub>
    <mi>b</mi>
    <mn>1</mn>
   </msub>
   <mo>,</mo>
   <msub>
    <mi>b</mi>
    <mn>2</mn>
   </msub>
   <mo>,</mo>
   <mi mathvariant="normal">…</mi>
   <mo>,</mo>
   <msub>
    <mi>b</mi>
    <mi>s</mi>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <list>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>b</ci>
     <cn type="integer">1</cn>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>b</ci>
     <cn type="integer">2</cn>
    </apply>
    <ci>normal-…</ci>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>b</ci>
     <ci>s</ci>
    </apply>
   </list>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   b_{1},b_{2},...,b_{s}
  </annotation>
 </semantics>
</math>

, each of size 

<math display="inline" id="Range_mode_query:100">
 <semantics>
  <mrow>
   <mi>t</mi>
   <mo>=</mo>
   <mrow>
    <mo stretchy="false">⌈</mo>
    <mrow>
     <mi>n</mi>
     <mo>/</mo>
     <mi>s</mi>
    </mrow>
    <mo stretchy="false">⌉</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>t</ci>
    <apply>
     <ceiling></ceiling>
     <apply>
      <divide></divide>
      <ci>n</ci>
      <ci>s</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   t=\lceil n/s\rceil
  </annotation>
 </semantics>
</math>

. Thus, a block 

<math display="inline" id="Range_mode_query:101">
 <semantics>
  <msub>
   <mi>b</mi>
   <mi>i</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>b</ci>
    <ci>i</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   b_{i}
  </annotation>
 </semantics>
</math>

 spans over 

<math display="inline" id="Range_mode_query:102">
 <semantics>
  <mrow>
   <mi>B</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>i</mi>
    <mo>⋅</mo>
    <mi>t</mi>
    <mo>+</mo>
    <mn>1</mn>
    <mo>:</mo>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>i</mi>
     <mo>+</mo>
     <mn>1</mn>
     <mo stretchy="false">)</mo>
    </mrow>
    <mi>t</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">B</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <csymbol cd="unknown">i</csymbol>
     <ci>normal-⋅</ci>
     <csymbol cd="unknown">t</csymbol>
     <plus></plus>
     <cn type="integer">1</cn>
     <ci>normal-:</ci>
     <cerror>
      <csymbol cd="ambiguous">fragments</csymbol>
      <ci>normal-(</ci>
      <csymbol cd="unknown">i</csymbol>
      <plus></plus>
      <cn type="integer">1</cn>
      <ci>normal-)</ci>
     </cerror>
     <csymbol cd="unknown">t</csymbol>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B[i\cdot t+1:(i+1)t]
  </annotation>
 </semantics>
</math>

. The mode and the frequency of each block or set of consecutive blocks will be pre-computed in two tables 

<math display="inline" id="Range_mode_query:103">
 <semantics>
  <mi>S</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>S</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="Range_mode_query:104">
 <semantics>
  <msup>
   <mi>S</mi>
   <mo>′</mo>
  </msup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <ci>S</ci>
    <ci>normal-′</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S^{\prime}
  </annotation>
 </semantics>
</math>

. 

<math display="inline" id="Range_mode_query:105">
 <semantics>
  <mrow>
   <mi>S</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <msub>
     <mi>b</mi>
     <mi>i</mi>
    </msub>
    <mo>,</mo>
    <msub>
     <mi>b</mi>
     <mi>j</mi>
    </msub>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>S</ci>
    <interval closure="closed">
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>b</ci>
      <ci>i</ci>
     </apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>b</ci>
      <ci>j</ci>
     </apply>
    </interval>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S[b_{i},b_{j}]
  </annotation>
 </semantics>
</math>

 is the mode of 

<math display="inline" id="Range_mode_query:106">
 <semantics>
  <mrow>
   <msub>
    <mi>b</mi>
    <mi>i</mi>
   </msub>
   <mo>∪</mo>
   <msub>
    <mi>b</mi>
    <mrow>
     <mi>i</mi>
     <mo>+</mo>
     <mn>1</mn>
    </mrow>
   </msub>
   <mo>∪</mo>
   <mi mathvariant="normal">…</mi>
   <mo>∪</mo>
   <msub>
    <mi>b</mi>
    <mi>j</mi>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <union></union>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>b</ci>
     <ci>i</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>b</ci>
     <apply>
      <plus></plus>
      <ci>i</ci>
      <cn type="integer">1</cn>
     </apply>
    </apply>
    <ci>normal-…</ci>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>b</ci>
     <ci>j</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   b_{i}\cup b_{i+1}\cup...\cup b_{j}
  </annotation>
 </semantics>
</math>

, or equivalently, the mode of 

<math display="inline" id="Range_mode_query:107">
 <semantics>
  <mrow>
   <mi>B</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <msub>
     <mi>b</mi>
     <mi>i</mi>
    </msub>
    <mi>t</mi>
    <mo>+</mo>
    <mn>1</mn>
    <mo>:</mo>
    <mrow>
     <mo stretchy="false">(</mo>
     <msub>
      <mi>b</mi>
      <mi>j</mi>
     </msub>
     <mo>+</mo>
     <mn>1</mn>
     <mo stretchy="false">)</mo>
    </mrow>
    <mi>t</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">B</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>b</ci>
      <ci>i</ci>
     </apply>
     <csymbol cd="unknown">t</csymbol>
     <plus></plus>
     <cn type="integer">1</cn>
     <ci>normal-:</ci>
     <cerror>
      <csymbol cd="ambiguous">fragments</csymbol>
      <ci>normal-(</ci>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>b</ci>
       <ci>j</ci>
      </apply>
      <plus></plus>
      <cn type="integer">1</cn>
      <ci>normal-)</ci>
     </cerror>
     <csymbol cd="unknown">t</csymbol>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B[b_{i}t+1:(b_{j}+1)t]
  </annotation>
 </semantics>
</math>

, and 

<math display="inline" id="Range_mode_query:108">
 <semantics>
  <msup>
   <mi>S</mi>
   <mo>′</mo>
  </msup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <ci>S</ci>
    <ci>normal-′</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S^{\prime}
  </annotation>
 </semantics>
</math>

 stores the corresponding frequency. These two tables can be stored in 

<math display="inline" id="Range_mode_query:109">
 <semantics>
  <mrow>
   <mi>O</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <msup>
     <mi>s</mi>
     <mn>2</mn>
    </msup>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>O</ci>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>s</ci>
     <cn type="integer">2</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   O(s^{2})
  </annotation>
 </semantics>
</math>

 space, and can be populated in 

<math display="inline" id="Range_mode_query:110">
 <semantics>
  <mrow>
   <mi>O</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mrow>
     <mi>s</mi>
     <mo>⋅</mo>
     <mi>n</mi>
    </mrow>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>O</ci>
    <apply>
     <ci>normal-⋅</ci>
     <ci>s</ci>
     <ci>n</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   O(s\cdot n)
  </annotation>
 </semantics>
</math>

 by scanning 

<math display="inline" id="Range_mode_query:111">
 <semantics>
  <mi>B</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>B</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B
  </annotation>
 </semantics>
</math>

 

<math display="inline" id="Range_mode_query:112">
 <semantics>
  <mi>s</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>s</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   s
  </annotation>
 </semantics>
</math>

 times, computing a row of 

<math display="inline" id="Range_mode_query:113">
 <semantics>
  <mrow>
   <mi>S</mi>
   <mo>,</mo>
   <msup>
    <mi>S</mi>
    <mo>′</mo>
   </msup>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <list>
    <ci>S</ci>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>S</ci>
     <ci>normal-′</ci>
    </apply>
   </list>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S,S^{\prime}
  </annotation>
 </semantics>
</math>

 each time with the following algorithm:</p>

<p><strong><code>algorithm</code></strong><code> computeS_Sprime </code><strong><code>is</code></strong><br/>
<code>   </code><strong><code>input:</code></strong><code> Array </code><em><code>B</code></em><code>=[0:n-1], </code><br/>
<code>          Array </code><em><code>D</code></em><code>=[0:Delta-1], </code><br/>
<code>          Integer </code><em><code>s</code></em><br/>
<code>   </code><strong><code>output:</code></strong><code> Tables </code><em><code>S</code></em><code> and </code><em><code>Sprime</code></em><br/>
<code>   let </code><em><code>S</code></em><code> ← Table(0:s-1,0:s-1)</code><br/>
<code>   let </code><em><code>Sprime</code></em><code> ← Table(0:s-1,0:s-1)</code><br/>
<code>   let </code><em><code>firstOccurence</code></em><code> ← Array(0:Delta-1)</code><br/>
<code>   </code><strong><code>for</code> <code>all</code></strong><code> i </code><em><code>in</code></em><code> {0,...,Delta-1} </code><strong><code>do</code></strong><br/>
<code>       firstOccurence[i] ← -1 </code><br/>
<code>   </code><strong><code>end</code> <code>for</code></strong><br/>
<code>   </code><strong><code>for</code></strong><code> i ← 0:s-1 </code><strong><code>do</code></strong><code>    </code><br/>
<code>       let </code><em><code>j</code></em><code> ← i*t</code><br/>
<code>       let </code><em><code>c</code></em><code> ← 0</code><br/>
<code>       let </code><em><code>fc</code></em><code> ← 0</code><br/>
<code>       let </code><em><code>noBlock</code></em><code> ← i</code><br/>
<code>       let </code><em><code>block_start</code></em><code> ← j</code><br/>
<code>       let </code><em><code>block_end</code></em><code> ← min{(i+1)*t-1, n-1}</code><br/>
<code>       </code><strong><code>while</code></strong><code> j </code><code>B</code><code>. This can be translated to an answer over </code>

<math display="inline" id="Range_mode_query:114">
 <semantics>
  <mi>A</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>A</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A
  </annotation>
 </semantics>
</math>

<code>, since for any </code>

<math display="inline" id="Range_mode_query:115">
 <semantics>
  <mrow>
   <mi>a</mi>
   <mo>,</mo>
   <mi>i</mi>
   <mo>,</mo>
   <mi>j</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <list>
    <ci>a</ci>
    <ci>i</ci>
    <ci>j</ci>
   </list>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   a,i,j
  </annotation>
 </semantics>
</math>

<code>, </code>

<math display="inline" id="Range_mode_query:116">
 <semantics>
  <mrow>
   <mi>B</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>a</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>B</ci>
    <apply>
     <csymbol cd="latexml">delimited-[]</csymbol>
     <ci>a</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B[a]
  </annotation>
 </semantics>
</math>

<code> is a mode for </code>

<math display="inline" id="Range_mode_query:117">
 <semantics>
  <mrow>
   <mi>B</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>i</mi>
    <mo>:</mo>
    <mi>j</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">B</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <csymbol cd="unknown">i</csymbol>
     <ci>normal-:</ci>
     <csymbol cd="unknown">j</csymbol>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B[i:j]
  </annotation>
 </semantics>
</math>

<code> if and only if </code>

<math display="inline" id="Range_mode_query:118">
 <semantics>
  <mrow>
   <mi>A</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>a</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>A</ci>
    <apply>
     <csymbol cd="latexml">delimited-[]</csymbol>
     <ci>a</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A[a]
  </annotation>
 </semantics>
</math>

<code> is a mode for </code>

<math display="inline" id="Range_mode_query:119">
 <semantics>
  <mrow>
   <mi>A</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>i</mi>
    <mo>:</mo>
    <mi>j</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">A</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <csymbol cd="unknown">i</csymbol>
     <ci>normal-:</ci>
     <csymbol cd="unknown">j</csymbol>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A[i:j]
  </annotation>
 </semantics>
</math>

<code>. We can convert an answer for </code>

<math display="inline" id="Range_mode_query:120">
 <semantics>
  <mi>B</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>B</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B
  </annotation>
 </semantics>
</math>

<code> to an answer for </code>

<math display="inline" id="Range_mode_query:121">
 <semantics>
  <mi>A</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>A</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A
  </annotation>
 </semantics>
</math>

<code> in constant time by looking in </code>

<math display="inline" id="Range_mode_query:122">
 <semantics>
  <mi>A</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>A</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A
  </annotation>
 </semantics>
</math>

<code> or </code>

<math display="inline" id="Range_mode_query:123">
 <semantics>
  <mi>B</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>B</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B
  </annotation>
 </semantics>
</math>

<code> at the corresponding index.</code></p>

<p>Given a query 

<math display="inline" id="Range_mode_query:124">
 <semantics>
  <mrow>
   <mi>m</mi>
   <mi>o</mi>
   <mi>d</mi>
   <mi>e</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>B</mi>
    <mo>,</mo>
    <mi>i</mi>
    <mo>,</mo>
    <mi>j</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>m</ci>
    <ci>o</ci>
    <ci>d</ci>
    <ci>e</ci>
    <vector>
     <ci>B</ci>
     <ci>i</ci>
     <ci>j</ci>
    </vector>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   mode(B,i,j)
  </annotation>
 </semantics>
</math>

, the query is split in three parts: the prefix, the span and the suffix. Let 

<math display="inline" id="Range_mode_query:125">
 <semantics>
  <mrow>
   <msub>
    <mi>b</mi>
    <mi>i</mi>
   </msub>
   <mo>=</mo>
   <mrow>
    <mo stretchy="false">⌈</mo>
    <mrow>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <mi>i</mi>
       <mo>-</mo>
       <mn>1</mn>
      </mrow>
      <mo stretchy="false">)</mo>
     </mrow>
     <mo>/</mo>
     <mi>t</mi>
    </mrow>
    <mo stretchy="false">⌉</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>b</ci>
     <ci>i</ci>
    </apply>
    <apply>
     <ceiling></ceiling>
     <apply>
      <divide></divide>
      <apply>
       <minus></minus>
       <ci>i</ci>
       <cn type="integer">1</cn>
      </apply>
      <ci>t</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   b_{i}=\lceil(i-1)/t\rceil
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="Range_mode_query:126">
 <semantics>
  <mrow>
   <msub>
    <mi>b</mi>
    <mi>j</mi>
   </msub>
   <mo>=</mo>
   <mrow>
    <mrow>
     <mo stretchy="false">⌊</mo>
     <mrow>
      <mi>j</mi>
      <mo>/</mo>
      <mi>t</mi>
     </mrow>
     <mo stretchy="false">⌋</mo>
    </mrow>
    <mo>-</mo>
    <mn>1</mn>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>b</ci>
     <ci>j</ci>
    </apply>
    <apply>
     <minus></minus>
     <apply>
      <floor></floor>
      <apply>
       <divide></divide>
       <ci>j</ci>
       <ci>t</ci>
      </apply>
     </apply>
     <cn type="integer">1</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   b_{j}=\lfloor j/t\rfloor-1
  </annotation>
 </semantics>
</math>

. These denote the indices of the first and last block that are completely contained in 

<math display="inline" id="Range_mode_query:127">
 <semantics>
  <mi>B</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>B</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B
  </annotation>
 </semantics>
</math>

. The range of these blocks is called the span. The prefix is then 

<math display="inline" id="Range_mode_query:128">
 <semantics>
  <mrow>
   <mi>B</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>i</mi>
    <mo>:</mo>
    <mi>m</mi>
    <mi>i</mi>
    <mi>n</mi>
    <mrow>
     <mo stretchy="false">{</mo>
     <msub>
      <mi>b</mi>
      <mi>i</mi>
     </msub>
     <mi>t</mi>
     <mo>,</mo>
     <mi>j</mi>
     <mo stretchy="false">}</mo>
    </mrow>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">B</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <csymbol cd="unknown">i</csymbol>
     <ci>normal-:</ci>
     <csymbol cd="unknown">m</csymbol>
     <csymbol cd="unknown">i</csymbol>
     <csymbol cd="unknown">n</csymbol>
     <cerror>
      <csymbol cd="ambiguous">fragments</csymbol>
      <ci>normal-{</ci>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>b</ci>
       <ci>i</ci>
      </apply>
      <csymbol cd="unknown">t</csymbol>
      <ci>normal-,</ci>
      <csymbol cd="unknown">j</csymbol>
      <ci>normal-}</ci>
     </cerror>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B[i:min\{b_{i}t,j\}]
  </annotation>
 </semantics>
</math>

 (the set of indices before the span), and the suffix is 

<math display="inline" id="Range_mode_query:129">
 <semantics>
  <mrow>
   <mi>B</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>m</mi>
    <mi>a</mi>
    <mi>x</mi>
    <mrow>
     <mo stretchy="false">{</mo>
     <mrow>
      <mo stretchy="false">(</mo>
      <msub>
       <mi>b</mi>
       <mi>j</mi>
      </msub>
      <mo>+</mo>
      <mn>1</mn>
      <mo stretchy="false">)</mo>
     </mrow>
     <mi>t</mi>
     <mo>+</mo>
     <mn>1</mn>
     <mo>,</mo>
     <mi>i</mi>
     <mo stretchy="false">}</mo>
    </mrow>
    <mo>:</mo>
    <mi>j</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">B</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <csymbol cd="unknown">m</csymbol>
     <csymbol cd="unknown">a</csymbol>
     <csymbol cd="unknown">x</csymbol>
     <cerror>
      <csymbol cd="ambiguous">fragments</csymbol>
      <ci>normal-{</ci>
      <cerror>
       <csymbol cd="ambiguous">fragments</csymbol>
       <ci>normal-(</ci>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>b</ci>
        <ci>j</ci>
       </apply>
       <plus></plus>
       <cn type="integer">1</cn>
       <ci>normal-)</ci>
      </cerror>
      <csymbol cd="unknown">t</csymbol>
      <plus></plus>
      <cn type="integer">1</cn>
      <ci>normal-,</ci>
      <csymbol cd="unknown">i</csymbol>
      <ci>normal-}</ci>
     </cerror>
     <ci>normal-:</ci>
     <csymbol cd="unknown">j</csymbol>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B[max\{(b_{j}+1)t+1,i\}:j]
  </annotation>
 </semantics>
</math>

 (the set of indices after the span). The prefix, suffix or span can be empty, the latter is if 

<math display="inline" id="Range_mode_query:130">
 <semantics>
  <mrow>
   <msub>
    <mi>b</mi>
    <mi>j</mi>
   </msub>
   <mo><</mo>
   <msub>
    <mi>b</mi>
    <mi>i</mi>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <lt></lt>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>b</ci>
     <ci>j</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>b</ci>
     <ci>i</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   b_{j}<b_{i}
  </annotation>
 </semantics>
</math>

.</p>

<p>For the span, the mode 

<math display="inline" id="Range_mode_query:131">
 <semantics>
  <mi>c</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>c</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   c
  </annotation>
 </semantics>
</math>

 is already stored in 

<math display="inline" id="Range_mode_query:132">
 <semantics>
  <mrow>
   <mi>S</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <msub>
     <mi>b</mi>
     <mi>i</mi>
    </msub>
    <mo>,</mo>
    <msub>
     <mi>b</mi>
     <mi>j</mi>
    </msub>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>S</ci>
    <interval closure="closed">
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>b</ci>
      <ci>i</ci>
     </apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>b</ci>
      <ci>j</ci>
     </apply>
    </interval>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S[b_{i},b_{j}]
  </annotation>
 </semantics>
</math>

. Let 

<math display="inline" id="Range_mode_query:133">
 <semantics>
  <msub>
   <mi>f</mi>
   <mi>c</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>f</ci>
    <ci>c</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f_{c}
  </annotation>
 </semantics>
</math>

 be the frequency of the mode, which is stored in 

<math display="inline" id="Range_mode_query:134">
 <semantics>
  <mrow>
   <msup>
    <mi>S</mi>
    <mo>′</mo>
   </msup>
   <mrow>
    <mo stretchy="false">[</mo>
    <msub>
     <mi>b</mi>
     <mi>i</mi>
    </msub>
    <mo>,</mo>
    <msub>
     <mi>b</mi>
     <mi>j</mi>
    </msub>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>S</ci>
     <ci>normal-′</ci>
    </apply>
    <interval closure="closed">
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>b</ci>
      <ci>i</ci>
     </apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>b</ci>
      <ci>j</ci>
     </apply>
    </interval>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S^{\prime}[b_{i},b_{j}]
  </annotation>
 </semantics>
</math>

. If the span is empty, let 

<math display="inline" id="Range_mode_query:135">
 <semantics>
  <mrow>
   <msub>
    <mi>f</mi>
    <mi>c</mi>
   </msub>
   <mo>=</mo>
   <mn>0</mn>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>f</ci>
     <ci>c</ci>
    </apply>
    <cn type="integer">0</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f_{c}=0
  </annotation>
 </semantics>
</math>

. Recall that, by Theorem 1, the mode of 

<math display="inline" id="Range_mode_query:136">
 <semantics>
  <mrow>
   <mi>B</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>i</mi>
    <mo>:</mo>
    <mi>j</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">B</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <csymbol cd="unknown">i</csymbol>
     <ci>normal-:</ci>
     <csymbol cd="unknown">j</csymbol>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B[i:j]
  </annotation>
 </semantics>
</math>

 is either an element of the prefix, span or suffix</p>

<p>. A linear scan is performed over each element in the prefix and in the suffix to check if its frequency is greater than the current candidate 

<math display="inline" id="Range_mode_query:137">
 <semantics>
  <mi>c</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>c</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   c
  </annotation>
 </semantics>
</math>

, in which case 

<math display="inline" id="Range_mode_query:138">
 <semantics>
  <mi>c</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>c</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   c
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="Range_mode_query:139">
 <semantics>
  <msub>
   <mi>f</mi>
   <mi>c</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>f</ci>
    <ci>c</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f_{c}
  </annotation>
 </semantics>
</math>

 are updated to the new value. At the end of the scan, 

<math display="inline" id="Range_mode_query:140">
 <semantics>
  <mi>c</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>c</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   c
  </annotation>
 </semantics>
</math>

 contains the mode of 

<math display="inline" id="Range_mode_query:141">
 <semantics>
  <mrow>
   <mi>B</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>i</mi>
    <mo>:</mo>
    <mi>j</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">B</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <csymbol cd="unknown">i</csymbol>
     <ci>normal-:</ci>
     <csymbol cd="unknown">j</csymbol>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B[i:j]
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="Range_mode_query:142">
 <semantics>
  <msub>
   <mi>f</mi>
   <mi>c</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>f</ci>
    <ci>c</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f_{c}
  </annotation>
 </semantics>
</math>

 its frequency.</p>
<h4 id="scanning-procedure">Scanning procedure</h4>

<p>The procedure is similar for both prefix and suffix, so it suffice to run this procedure for both:</p>

<p>Let 

<math display="inline" id="Range_mode_query:143">
 <semantics>
  <mi>x</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>x</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   x
  </annotation>
 </semantics>
</math>

 be the index of the current element. There are three cases:</p>
<ol>
<li>If 

<math display="inline" id="Range_mode_query:144">
 <semantics>
  <mrow>
   <mrow>
    <msub>
     <mi>Q</mi>
     <mrow>
      <mi>B</mi>
      <mrow>
       <mo stretchy="false">[</mo>
       <mi>x</mi>
       <mo stretchy="false">]</mo>
      </mrow>
     </mrow>
    </msub>
    <mrow>
     <mo stretchy="false">[</mo>
     <mrow>
      <mrow>
       <msup>
        <mi>B</mi>
        <mo>′</mo>
       </msup>
       <mrow>
        <mo stretchy="false">[</mo>
        <mi>x</mi>
        <mo stretchy="false">]</mo>
       </mrow>
      </mrow>
      <mo>-</mo>
      <mn>1</mn>
     </mrow>
     <mo stretchy="false">]</mo>
    </mrow>
   </mrow>
   <mo>≥</mo>
   <mi>i</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <geq></geq>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>Q</ci>
      <apply>
       <times></times>
       <ci>B</ci>
       <apply>
        <csymbol cd="latexml">delimited-[]</csymbol>
        <ci>x</ci>
       </apply>
      </apply>
     </apply>
     <apply>
      <csymbol cd="latexml">delimited-[]</csymbol>
      <apply>
       <minus></minus>
       <apply>
        <times></times>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>B</ci>
         <ci>normal-′</ci>
        </apply>
        <apply>
         <csymbol cd="latexml">delimited-[]</csymbol>
         <ci>x</ci>
        </apply>
       </apply>
       <cn type="integer">1</cn>
      </apply>
     </apply>
    </apply>
    <ci>i</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   Q_{B[x]}[B^{\prime}[x]-1]\geq i
  </annotation>
 </semantics>
</math>

, then it was present in 

<math display="inline" id="Range_mode_query:145">
 <semantics>
  <mrow>
   <mi>B</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>i</mi>
    <mo>:</mo>
    <mi>x</mi>
    <mo>-</mo>
    <mn>1</mn>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">B</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <csymbol cd="unknown">i</csymbol>
     <ci>normal-:</ci>
     <csymbol cd="unknown">x</csymbol>
     <minus></minus>
     <cn type="integer">1</cn>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B[i:x-1]
  </annotation>
 </semantics>
</math>

 and its frequency has already been counted. Pass to the next element.</li>
<li>Otherwise, check if the frequency of 

<math display="inline" id="Range_mode_query:146">
 <semantics>
  <mrow>
   <mi>B</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>x</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>B</ci>
    <apply>
     <csymbol cd="latexml">delimited-[]</csymbol>
     <ci>x</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B[x]
  </annotation>
 </semantics>
</math>

 in 

<math display="inline" id="Range_mode_query:147">
 <semantics>
  <mrow>
   <mi>B</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>i</mi>
    <mo>:</mo>
    <mi>j</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">B</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <csymbol cd="unknown">i</csymbol>
     <ci>normal-:</ci>
     <csymbol cd="unknown">j</csymbol>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B[i:j]
  </annotation>
 </semantics>
</math>

 is at least 

<math display="inline" id="Range_mode_query:148">
 <semantics>
  <msub>
   <mi>f</mi>
   <mi>c</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>f</ci>
    <ci>c</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f_{c}
  </annotation>
 </semantics>
</math>

 (this can be done in constant time since it is the equivalent of checking it for 

<math display="inline" id="Range_mode_query:149">
 <semantics>
  <mrow>
   <mi>B</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>x</mi>
    <mo>:</mo>
    <mi>j</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">B</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <csymbol cd="unknown">x</csymbol>
     <ci>normal-:</ci>
     <csymbol cd="unknown">j</csymbol>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B[x:j]
  </annotation>
 </semantics>
</math>

).
<ol>
<li>If it is not, then pass to the next element.</li>
<li>If it is, then compute the actual frequency 

<math display="inline" id="Range_mode_query:150">
 <semantics>
  <msub>
   <mi>f</mi>
   <mi>x</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>f</ci>
    <ci>x</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f_{x}
  </annotation>
 </semantics>
</math>

 of 

<math display="inline" id="Range_mode_query:151">
 <semantics>
  <mrow>
   <mi>B</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>x</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>B</ci>
    <apply>
     <csymbol cd="latexml">delimited-[]</csymbol>
     <ci>x</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B[x]
  </annotation>
 </semantics>
</math>

 in 

<math display="inline" id="Range_mode_query:152">
 <semantics>
  <mrow>
   <mi>B</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>i</mi>
    <mo>:</mo>
    <mi>j</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">B</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <csymbol cd="unknown">i</csymbol>
     <ci>normal-:</ci>
     <csymbol cd="unknown">j</csymbol>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B[i:j]
  </annotation>
 </semantics>
</math>

 by a linear scan (starting at index 

<math display="inline" id="Range_mode_query:153">
 <semantics>
  <mrow>
   <mrow>
    <mrow>
     <msup>
      <mi>B</mi>
      <mo>′</mo>
     </msup>
     <mrow>
      <mo stretchy="false">[</mo>
      <mi>x</mi>
      <mo stretchy="false">]</mo>
     </mrow>
    </mrow>
    <mo>+</mo>
    <msub>
     <mi>f</mi>
     <mi>c</mi>
    </msub>
   </mrow>
   <mo>-</mo>
   <mn>1</mn>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <minus></minus>
    <apply>
     <plus></plus>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>B</ci>
       <ci>normal-′</ci>
      </apply>
      <apply>
       <csymbol cd="latexml">delimited-[]</csymbol>
       <ci>x</ci>
      </apply>
     </apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>f</ci>
      <ci>c</ci>
     </apply>
    </apply>
    <cn type="integer">1</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B^{\prime}[x]+f_{c}-1
  </annotation>
 </semantics>
</math>

) or a binary search in 

<math display="inline" id="Range_mode_query:154">
 <semantics>
  <msub>
   <mi>Q</mi>
   <mrow>
    <mi>B</mi>
    <mrow>
     <mo stretchy="false">[</mo>
     <mi>x</mi>
     <mo stretchy="false">]</mo>
    </mrow>
   </mrow>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>Q</ci>
    <apply>
     <times></times>
     <ci>B</ci>
     <apply>
      <csymbol cd="latexml">delimited-[]</csymbol>
      <ci>x</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   Q_{B[x]}
  </annotation>
 </semantics>
</math>

. Set 

<math display="inline" id="Range_mode_query:155">
 <semantics>
  <mrow>
   <mi>c</mi>
   <mo>:=</mo>
   <mrow>
    <mi>B</mi>
    <mrow>
     <mo stretchy="false">[</mo>
     <mi>x</mi>
     <mo stretchy="false">]</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="latexml">assign</csymbol>
    <ci>c</ci>
    <apply>
     <times></times>
     <ci>B</ci>
     <apply>
      <csymbol cd="latexml">delimited-[]</csymbol>
      <ci>x</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   c:=B[x]
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="Range_mode_query:156">
 <semantics>
  <mrow>
   <msub>
    <mi>f</mi>
    <mi>c</mi>
   </msub>
   <mo>:=</mo>
   <msub>
    <mi>f</mi>
    <mi>x</mi>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="latexml">assign</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>f</ci>
     <ci>c</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>f</ci>
     <ci>x</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f_{c}:=f_{x}
  </annotation>
 </semantics>
</math>

.</li>
</ol></li>
</ol>

<p>This linear scan (excluding the frequency computations) is bounded by the block size 

<math display="inline" id="Range_mode_query:157">
 <semantics>
  <mi>t</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>t</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   t
  </annotation>
 </semantics>
</math>

, since neither the prefix or the suffix can be greater than 

<math display="inline" id="Range_mode_query:158">
 <semantics>
  <mi>t</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>t</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   t
  </annotation>
 </semantics>
</math>

. A further analysis of the linear scans done for frequency computations shows that it is also bounded by the block size.<a class="footnoteRef" href="#fn7" id="fnref7"><sup>7</sup></a> Thus, the query time is 

<math display="inline" id="Range_mode_query:159">
 <semantics>
  <mrow>
   <mrow>
    <mi>O</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>t</mi>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mi>O</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mrow>
      <mi>n</mi>
      <mo>/</mo>
      <mi>s</mi>
     </mrow>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <ci>O</ci>
     <ci>t</ci>
    </apply>
    <apply>
     <times></times>
     <ci>O</ci>
     <apply>
      <divide></divide>
      <ci>n</ci>
      <ci>s</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   O(t)=O(n/s)
  </annotation>
 </semantics>
</math>

.</p>
<h2 id="subquadratic-space-data-structure-with-constant-query-time">Subquadratic space data structure with constant query time</h2>

<p>This method by <a class="footnoteRef" href="#fn8" id="fnref8"><sup>8</sup></a> uses 

<math display="inline" id="Range_mode_query:160">
 <semantics>
  <mrow>
   <mi>O</mi>
   <mrow>
    <mo>(</mo>
    <mfrac>
     <mrow>
      <msup>
       <mi>n</mi>
       <mn>2</mn>
      </msup>
      <mrow>
       <mi>log</mi>
       <mrow>
        <mi>log</mi>
        <mi>n</mi>
       </mrow>
      </mrow>
     </mrow>
     <mrow>
      <mi>log</mi>
      <mi>n</mi>
     </mrow>
    </mfrac>
    <mo>)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>O</ci>
    <apply>
     <divide></divide>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>n</ci>
       <cn type="integer">2</cn>
      </apply>
      <apply>
       <log></log>
       <apply>
        <log></log>
        <ci>n</ci>
       </apply>
      </apply>
     </apply>
     <apply>
      <log></log>
      <ci>n</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   O\left(\frac{n^{2}\log{\log{n}}}{\log{n}}\right)
  </annotation>
 </semantics>
</math>

 space for a constant time query. We can observe that, if a constant query time is desired, this is a better solution than the one proposed by Chan et al.,<a class="footnoteRef" href="#fn9" id="fnref9"><sup>9</sup></a> as the latter gives a space of 

<math display="inline" id="Range_mode_query:161">
 <semantics>
  <mrow>
   <mi>O</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <msup>
     <mi>n</mi>
     <mn>2</mn>
    </msup>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>O</ci>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>n</ci>
     <cn type="integer">2</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   O(n^{2})
  </annotation>
 </semantics>
</math>

 for constant query time if 

<math display="inline" id="Range_mode_query:162">
 <semantics>
  <mrow>
   <mi>s</mi>
   <mo>=</mo>
   <mi>n</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>s</ci>
    <ci>n</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   s=n
  </annotation>
 </semantics>
</math>

.</p>
<h3 id="preprocessing-1">Preprocessing</h3>

<p>Let 

<math display="inline" id="Range_mode_query:163">
 <semantics>
  <mrow>
   <mi>A</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mn>1</mn>
    <mo>:</mo>
    <mi>n</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">A</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <cn type="integer">1</cn>
     <ci>normal-:</ci>
     <csymbol cd="unknown">n</csymbol>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A[1:n]
  </annotation>
 </semantics>
</math>

 be an array. The preprocessing is done in three steps:</p>
<ol>
<li>Split the array 

<math display="inline" id="Range_mode_query:164">
 <semantics>
  <mi>A</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>A</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A
  </annotation>
 </semantics>
</math>

 in 

<math display="inline" id="Range_mode_query:165">
 <semantics>
  <mi>s</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>s</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   s
  </annotation>
 </semantics>
</math>

 blocks 

<math display="inline" id="Range_mode_query:166">
 <semantics>
  <mrow>
   <msub>
    <mi>b</mi>
    <mn>1</mn>
   </msub>
   <mo>,</mo>
   <msub>
    <mi>b</mi>
    <mn>2</mn>
   </msub>
   <mo>,</mo>
   <mi mathvariant="normal">…</mi>
   <mo>,</mo>
   <msub>
    <mi>b</mi>
    <mi>s</mi>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <list>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>b</ci>
     <cn type="integer">1</cn>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>b</ci>
     <cn type="integer">2</cn>
    </apply>
    <ci>normal-…</ci>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>b</ci>
     <ci>s</ci>
    </apply>
   </list>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   b_{1},b_{2},...,b_{s}
  </annotation>
 </semantics>
</math>

, where the size of each block is 

<math display="inline" id="Range_mode_query:167">
 <semantics>
  <mrow>
   <mi>t</mi>
   <mo>=</mo>
   <mrow>
    <mo stretchy="false">⌈</mo>
    <mrow>
     <mi>n</mi>
     <mo>/</mo>
     <mi>s</mi>
    </mrow>
    <mo stretchy="false">⌉</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>t</ci>
    <apply>
     <ceiling></ceiling>
     <apply>
      <divide></divide>
      <ci>n</ci>
      <ci>s</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   t=\lceil n/s\rceil
  </annotation>
 </semantics>
</math>

. Build a table 

<math display="inline" id="Range_mode_query:168">
 <semantics>
  <mi>S</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>S</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S
  </annotation>
 </semantics>
</math>

 of size 

<math display="inline" id="Range_mode_query:169">
 <semantics>
  <mrow>
   <mi>s</mi>
   <mo>×</mo>
   <mi>s</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>s</ci>
    <ci>s</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   s\times s
  </annotation>
 </semantics>
</math>

 where 

<math display="inline" id="Range_mode_query:170">
 <semantics>
  <mrow>
   <mi>S</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>i</mi>
    <mo>,</mo>
    <mi>j</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>S</ci>
    <interval closure="closed">
     <ci>i</ci>
     <ci>j</ci>
    </interval>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S[i,j]
  </annotation>
 </semantics>
</math>

 is the mode of 

<math display="inline" id="Range_mode_query:171">
 <semantics>
  <mrow>
   <msub>
    <mi>b</mi>
    <mi>i</mi>
   </msub>
   <mo>∪</mo>
   <msub>
    <mi>b</mi>
    <mrow>
     <mi>i</mi>
     <mo>+</mo>
     <mn>1</mn>
    </mrow>
   </msub>
   <mo>∪</mo>
   <mi mathvariant="normal">…</mi>
   <mo>∪</mo>
   <msub>
    <mi>b</mi>
    <mi>j</mi>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <union></union>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>b</ci>
     <ci>i</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>b</ci>
     <apply>
      <plus></plus>
      <ci>i</ci>
      <cn type="integer">1</cn>
     </apply>
    </apply>
    <ci>normal-…</ci>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>b</ci>
     <ci>j</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   b_{i}\cup b_{i+1}\cup...\cup b_{j}
  </annotation>
 </semantics>
</math>

. The total space for this step is 

<math display="inline" id="Range_mode_query:172">
 <semantics>
  <mrow>
   <mi>O</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <msup>
     <mi>s</mi>
     <mn>2</mn>
    </msup>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>O</ci>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>s</ci>
     <cn type="integer">2</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   O(s^{2})
  </annotation>
 </semantics>
</math>

</li>
<li>For any query 

<math display="inline" id="Range_mode_query:173">
 <semantics>
  <mrow>
   <mi>m</mi>
   <mi>o</mi>
   <mi>d</mi>
   <mi>e</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>A</mi>
    <mo>,</mo>
    <mi>i</mi>
    <mo>,</mo>
    <mi>j</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>m</ci>
    <ci>o</ci>
    <ci>d</ci>
    <ci>e</ci>
    <vector>
     <ci>A</ci>
     <ci>i</ci>
     <ci>j</ci>
    </vector>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   mode(A,i,j)
  </annotation>
 </semantics>
</math>

, let 

<math display="inline" id="Range_mode_query:174">
 <semantics>
  <msub>
   <mi>b</mi>
   <msup>
    <mi>i</mi>
    <mo>′</mo>
   </msup>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>b</ci>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>i</ci>
     <ci>normal-′</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   b_{i^{\prime}}
  </annotation>
 </semantics>
</math>

 be the block that contains 

<math display="inline" id="Range_mode_query:175">
 <semantics>
  <mi>i</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>i</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   i
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="Range_mode_query:176">
 <semantics>
  <msub>
   <mi>b</mi>
   <msup>
    <mi>j</mi>
    <mo>′</mo>
   </msup>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>b</ci>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>j</ci>
     <ci>normal-′</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   b_{j^{\prime}}
  </annotation>
 </semantics>
</math>

 be the block that contains 

<math display="inline" id="Range_mode_query:177">
 <semantics>
  <mi>j</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>j</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   j
  </annotation>
 </semantics>
</math>

. Let the span be the set of blocks completely contained in 

<math display="inline" id="Range_mode_query:178">
 <semantics>
  <mrow>
   <mi>A</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>i</mi>
    <mo>:</mo>
    <mi>j</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">A</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <csymbol cd="unknown">i</csymbol>
     <ci>normal-:</ci>
     <csymbol cd="unknown">j</csymbol>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A[i:j]
  </annotation>
 </semantics>
</math>

. The mode 

<math display="inline" id="Range_mode_query:179">
 <semantics>
  <mi>c</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>c</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   c
  </annotation>
 </semantics>
</math>

 of the block can be retrieved from 

<math display="inline" id="Range_mode_query:180">
 <semantics>
  <mi>S</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>S</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S
  </annotation>
 </semantics>
</math>

. By Theorem 1, the mode can be either the mode of the prefix (indices of 

<math display="inline" id="Range_mode_query:181">
 <semantics>
  <mrow>
   <mi>A</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>i</mi>
    <mo>:</mo>
    <mi>j</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">A</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <csymbol cd="unknown">i</csymbol>
     <ci>normal-:</ci>
     <csymbol cd="unknown">j</csymbol>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A[i:j]
  </annotation>
 </semantics>
</math>

 before the start of the span), the mode of the suffix (indices of 

<math display="inline" id="Range_mode_query:182">
 <semantics>
  <mrow>
   <mi>A</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <mi>i</mi>
    <mo>:</mo>
    <mi>j</mi>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">A</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <csymbol cd="unknown">i</csymbol>
     <ci>normal-:</ci>
     <csymbol cd="unknown">j</csymbol>
     <ci>normal-]</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A[i:j]
  </annotation>
 </semantics>
</math>

 after the end of the span), or 

<math display="inline" id="Range_mode_query:183">
 <semantics>
  <mi>c</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>c</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   c
  </annotation>
 </semantics>
</math>

. The size of the prefix plus the size of the suffix is bounded by 

<math display="inline" id="Range_mode_query:184">
 <semantics>
  <mrow>
   <mn>2</mn>
   <mi>t</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <cn type="integer">2</cn>
    <ci>t</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   2t
  </annotation>
 </semantics>
</math>

, thus the position of the mode isstored as an integer ranging from 

<math display="inline" id="Range_mode_query:185">
 <semantics>
  <mn>0</mn>
  <annotation-xml encoding="MathML-Content">
   <cn type="integer">0</cn>
  </annotation-xml>
 </semantics>
</math>

 to 

<math display="inline" id="Range_mode_query:186">
 <semantics>
  <mrow>
   <mn>2</mn>
   <mi>t</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <cn type="integer">2</cn>
    <ci>t</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   2t
  </annotation>
 </semantics>
</math>

, where 

<math display="inline" id="Range_mode_query:187">
 <semantics>
  <mrow>
   <mo stretchy="false">[</mo>
   <mrow>
    <mn>0</mn>
    <mo>:</mo>
    <mrow>
     <mrow>
      <mn>2</mn>
      <mi>t</mi>
     </mrow>
     <mo>-</mo>
     <mn>1</mn>
    </mrow>
   </mrow>
   <mo stretchy="false">]</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="latexml">delimited-[]</csymbol>
    <apply>
     <ci>normal-:</ci>
     <cn type="integer">0</cn>
     <apply>
      <minus></minus>
      <apply>
       <times></times>
       <cn type="integer">2</cn>
       <ci>t</ci>
      </apply>
      <cn type="integer">1</cn>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   [0:2t-1]
  </annotation>
 </semantics>
</math>

indicates a position in the prefix/suffix and 

<math display="inline" id="Range_mode_query:188">
 <semantics>
  <mrow>
   <mn>2</mn>
   <mi>t</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <cn type="integer">2</cn>
    <ci>t</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   2t
  </annotation>
 </semantics>
</math>

 indicates that the mode is the mode of the span. There are 

<math display="inline" id="Range_mode_query:189">
 <semantics>
  <mrow>
   <mo>(</mo>
   <mstyle scriptlevel="+1">
    <mtable columnspacing="0.4em" rowspacing="0.2ex">
     <mtr>
      <mtd>
       <mi>t</mi>
      </mtd>
     </mtr>
     <mtr>
      <mtd>
       <mn>2</mn>
      </mtd>
     </mtr>
    </mtable>
   </mstyle>
   <mo>)</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="latexml">binomial</csymbol>
    <ci>t</ci>
    <cn type="integer">2</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   {\left({{t}\atop{2}}\right)}
  </annotation>
 </semantics>
</math>

 possible queries involving blocks 

<math display="inline" id="Range_mode_query:190">
 <semantics>
  <msub>
   <mi>b</mi>
   <msup>
    <mi>i</mi>
    <mo>′</mo>
   </msup>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>b</ci>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>i</ci>
     <ci>normal-′</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   b_{i^{\prime}}
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="Range_mode_query:191">
 <semantics>
  <msub>
   <mi>b</mi>
   <msup>
    <mi>j</mi>
    <mo>′</mo>
   </msup>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>b</ci>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>j</ci>
     <ci>normal-′</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   b_{j^{\prime}}
  </annotation>
 </semantics>
</math>

, so these values are stored in a table of size 

<math display="inline" id="Range_mode_query:192">
 <semantics>
  <msup>
   <mi>t</mi>
   <mn>2</mn>
  </msup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <ci>t</ci>
    <cn type="integer">2</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   t^{2}
  </annotation>
 </semantics>
</math>

. Furthermore, there are 

<math display="inline" id="Range_mode_query:193">
 <semantics>
  <msup>
   <mrow>
    <mo stretchy="false">(</mo>
    <mrow>
     <mrow>
      <mn>2</mn>
      <mi>t</mi>
     </mrow>
     <mo>+</mo>
     <mn>1</mn>
    </mrow>
    <mo stretchy="false">)</mo>
   </mrow>
   <msup>
    <mi>t</mi>
    <mn>2</mn>
   </msup>
  </msup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <plus></plus>
     <apply>
      <times></times>
      <cn type="integer">2</cn>
      <ci>t</ci>
     </apply>
     <cn type="integer">1</cn>
    </apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>t</ci>
     <cn type="integer">2</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   (2t+1)^{t^{2}}
  </annotation>
 </semantics>
</math>

 such tables, so the total space required for this step is 

<math display="inline" id="Range_mode_query:194">
 <semantics>
  <mrow>
   <mi>O</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mrow>
     <msup>
      <mi>t</mi>
      <mn>2</mn>
     </msup>
     <msup>
      <mrow>
       <mo stretchy="false">(</mo>
       <mrow>
        <mrow>
         <mn>2</mn>
         <mi>t</mi>
        </mrow>
        <mo>+</mo>
        <mn>1</mn>
       </mrow>
       <mo stretchy="false">)</mo>
      </mrow>
      <msup>
       <mi>t</mi>
       <mn>2</mn>
      </msup>
     </msup>
    </mrow>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>O</ci>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>t</ci>
      <cn type="integer">2</cn>
     </apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <plus></plus>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>t</ci>
       </apply>
       <cn type="integer">1</cn>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>t</ci>
       <cn type="integer">2</cn>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   O(t^{2}(2t+1)^{t^{2}})
  </annotation>
 </semantics>
</math>

. To access those tables, a pointer is added in addition to the mode in the table 

<math display="inline" id="Range_mode_query:195">
 <semantics>
  <mi>S</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>S</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S
  </annotation>
 </semantics>
</math>

 for each pair of blocks.</li>
<li>To handle queries 

<math display="inline" id="Range_mode_query:196">
 <semantics>
  <mrow>
   <mi>m</mi>
   <mi>o</mi>
   <mi>d</mi>
   <mi>e</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>A</mi>
    <mo>,</mo>
    <mi>i</mi>
    <mo>,</mo>
    <mi>j</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>m</ci>
    <ci>o</ci>
    <ci>d</ci>
    <ci>e</ci>
    <vector>
     <ci>A</ci>
     <ci>i</ci>
     <ci>j</ci>
    </vector>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   mode(A,i,j)
  </annotation>
 </semantics>
</math>

 where 

<math display="inline" id="Range_mode_query:197">
 <semantics>
  <mi>i</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>i</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   i
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="Range_mode_query:198">
 <semantics>
  <mi>j</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>j</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   j
  </annotation>
 </semantics>
</math>

 are in the same block, all such solutions are precomputed. There are 

<math display="inline" id="Range_mode_query:199">
 <semantics>
  <mrow>
   <mi>O</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mrow>
     <mi>s</mi>
     <msup>
      <mi>t</mi>
      <mn>2</mn>
     </msup>
    </mrow>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>O</ci>
    <apply>
     <times></times>
     <ci>s</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>t</ci>
      <cn type="integer">2</cn>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   O(st^{2})
  </annotation>
 </semantics>
</math>

 of them, they are stored in a three dimensional table 

<math display="inline" id="Range_mode_query:200">
 <semantics>
  <mi>T</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>T</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   T
  </annotation>
 </semantics>
</math>

 of this size.</li>
</ol>

<p>The total space used by this data structure is 

<math display="inline" id="Range_mode_query:201">
 <semantics>
  <mrow>
   <mi>O</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mrow>
     <msup>
      <mi>s</mi>
      <mn>2</mn>
     </msup>
     <mo>+</mo>
     <mrow>
      <msup>
       <mi>t</mi>
       <mn>2</mn>
      </msup>
      <msup>
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mrow>
          <mn>2</mn>
          <mi>t</mi>
         </mrow>
         <mo>+</mo>
         <mn>1</mn>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
       <msup>
        <mi>t</mi>
        <mn>2</mn>
       </msup>
      </msup>
     </mrow>
     <mo>+</mo>
     <mrow>
      <mi>s</mi>
      <msup>
       <mi>t</mi>
       <mn>2</mn>
      </msup>
     </mrow>
    </mrow>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>O</ci>
    <apply>
     <plus></plus>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>s</ci>
      <cn type="integer">2</cn>
     </apply>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>t</ci>
       <cn type="integer">2</cn>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <plus></plus>
        <apply>
         <times></times>
         <cn type="integer">2</cn>
         <ci>t</ci>
        </apply>
        <cn type="integer">1</cn>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>t</ci>
        <cn type="integer">2</cn>
       </apply>
      </apply>
     </apply>
     <apply>
      <times></times>
      <ci>s</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>t</ci>
       <cn type="integer">2</cn>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   O(s^{2}+t^{2}(2t+1)^{t^{2}}+st^{2})
  </annotation>
 </semantics>
</math>

, which reduces to 

<math display="inline" id="Range_mode_query:202">
 <semantics>
  <mrow>
   <mi>O</mi>
   <mrow>
    <mo>(</mo>
    <mfrac>
     <mrow>
      <msup>
       <mi>n</mi>
       <mn>2</mn>
      </msup>
      <mrow>
       <mi>log</mi>
       <mrow>
        <mi>log</mi>
        <mi>n</mi>
       </mrow>
      </mrow>
     </mrow>
     <mrow>
      <mi>log</mi>
      <mi>n</mi>
     </mrow>
    </mfrac>
    <mo>)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>O</ci>
    <apply>
     <divide></divide>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>n</ci>
       <cn type="integer">2</cn>
      </apply>
      <apply>
       <log></log>
       <apply>
        <log></log>
        <ci>n</ci>
       </apply>
      </apply>
     </apply>
     <apply>
      <log></log>
      <ci>n</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   O\left(\frac{n^{2}\log{\log{n}}}{\log{n}}\right)
  </annotation>
 </semantics>
</math>

 if we take 

<math display="inline" id="Range_mode_query:203">
 <semantics>
  <mrow>
   <mi>t</mi>
   <mo>=</mo>
   <msqrt>
    <mrow>
     <mi>log</mi>
     <mrow>
      <mi>n</mi>
      <mo>/</mo>
      <mrow>
       <mi>log</mi>
       <mrow>
        <mi>log</mi>
        <mi>n</mi>
       </mrow>
      </mrow>
     </mrow>
    </mrow>
   </msqrt>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>t</ci>
    <apply>
     <root></root>
     <apply>
      <log></log>
      <apply>
       <divide></divide>
       <ci>n</ci>
       <apply>
        <log></log>
        <apply>
         <log></log>
         <ci>n</ci>
        </apply>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   t=\sqrt{\log{n}/\log{\log{n}}}
  </annotation>
 </semantics>
</math>

.</p>
<h3 id="query">Query</h3>

<p>Given a query 

<math display="inline" id="Range_mode_query:204">
 <semantics>
  <mrow>
   <mi>m</mi>
   <mi>o</mi>
   <mi>d</mi>
   <mi>e</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>A</mi>
    <mo>,</mo>
    <mi>i</mi>
    <mo>,</mo>
    <mi>j</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>m</ci>
    <ci>o</ci>
    <ci>d</ci>
    <ci>e</ci>
    <vector>
     <ci>A</ci>
     <ci>i</ci>
     <ci>j</ci>
    </vector>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   mode(A,i,j)
  </annotation>
 </semantics>
</math>

, check if it is completely contained inside a block, in which case the answer is stored in table 

<math display="inline" id="Range_mode_query:205">
 <semantics>
  <mi>T</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>T</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   T
  </annotation>
 </semantics>
</math>

. If the query spans exactly one or more blocks, then the answer is found in table 

<math display="inline" id="Range_mode_query:206">
 <semantics>
  <mi>S</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>S</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S
  </annotation>
 </semantics>
</math>

. Otherwise, use the pointer stored in table 

<math display="inline" id="Range_mode_query:207">
 <semantics>
  <mi>S</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>S</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S
  </annotation>
 </semantics>
</math>

 at position 

<math display="inline" id="Range_mode_query:208">
 <semantics>
  <mrow>
   <mi>S</mi>
   <mrow>
    <mo stretchy="false">[</mo>
    <msub>
     <mi>b</mi>
     <msup>
      <mi>i</mi>
      <mo>′</mo>
     </msup>
    </msub>
    <mo>,</mo>
    <msub>
     <mi>b</mi>
     <msup>
      <mi>j</mi>
      <mo>′</mo>
     </msup>
    </msub>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>S</ci>
    <interval closure="closed">
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>b</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>i</ci>
       <ci>normal-′</ci>
      </apply>
     </apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>b</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>j</ci>
       <ci>normal-′</ci>
      </apply>
     </apply>
    </interval>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S[b_{i^{\prime}},b_{j^{\prime}}]
  </annotation>
 </semantics>
</math>

, where 

<math display="inline" id="Range_mode_query:209">
 <semantics>
  <mrow>
   <msub>
    <mi>b</mi>
    <msup>
     <mi>i</mi>
     <mo>′</mo>
    </msup>
   </msub>
   <mo>,</mo>
   <msub>
    <mi>b</mi>
    <msup>
     <mi>j</mi>
     <mo>′</mo>
    </msup>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <list>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>b</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>i</ci>
      <ci>normal-′</ci>
     </apply>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>b</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>j</ci>
      <ci>normal-′</ci>
     </apply>
    </apply>
   </list>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   b_{i^{\prime}},b_{j^{\prime}}
  </annotation>
 </semantics>
</math>

 are the indices of the blocks that contain respectively 

<math display="inline" id="Range_mode_query:210">
 <semantics>
  <mi>i</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>i</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   i
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="Range_mode_query:211">
 <semantics>
  <mi>j</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>j</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   j
  </annotation>
 </semantics>
</math>

, to find the table 

<math display="inline" id="Range_mode_query:212">
 <semantics>
  <msub>
   <mi>U</mi>
   <mrow>
    <msub>
     <mi>b</mi>
     <msup>
      <mi>i</mi>
      <mo>′</mo>
     </msup>
    </msub>
    <mo>,</mo>
    <msub>
     <mi>b</mi>
     <msup>
      <mi>j</mi>
      <mo>′</mo>
     </msup>
    </msub>
   </mrow>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>U</ci>
    <list>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>b</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>i</ci>
       <ci>normal-′</ci>
      </apply>
     </apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>b</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>j</ci>
       <ci>normal-′</ci>
      </apply>
     </apply>
    </list>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   U_{b_{i^{\prime}},b_{j^{\prime}}}
  </annotation>
 </semantics>
</math>

 that contains the positions of the mode for these blocks and use the position to find the mode in 

<math display="inline" id="Range_mode_query:213">
 <semantics>
  <mi>A</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>A</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A
  </annotation>
 </semantics>
</math>

. This can be done in constant time.</p>
<h2 id="references">References</h2>

<p>"</p>

<p><a class="uri" href="Category:Arrays" title="wikilink">Category:Arrays</a></p>
<section class="footnotes">
<hr/>
<ol>
<li id="fn1"><a href="#fnref1">↩</a></li>
<li id="fn2"></li>
<li id="fn3"></li>
<li id="fn4"><a href="#fnref4">↩</a></li>
<li id="fn5"><a href="#fnref5">↩</a></li>
<li id="fn6"></li>
<li id="fn7"></li>
<li id="fn8"></li>
<li id="fn9"></li>
</ol>
</section>
</body>
</html>
