<html lang="en">
<head>
<meta charset="utf-8"/>
<title offset="1732">Kelly criterion</title>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG.js" type="text/javascript">
</script>
</head>
<body>
<h1>Kelly criterion</h1>
<hr>In [[probability theory]] and [[intertemporal portfolio choice]], the '''Kelly criterion''', '''Kelly strategy''', '''Kelly formula''', or '''Kelly bet''', is a [[formula]] used to determine the optimal size of a series of bets. In most gambling scenarios, and some investing scenarios under some simplifying assumptions, the Kelly strategy will do better than any essentially different strategy in the long run (that is, over a span of time in which the observed fraction of bets that are successful equals the probability that any given bet will be successful). It<style>
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
<style>
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
</hr></body></html>
<body>

<p><code>was described by </code><a href="John_Larry_Kelly,_Jr" title="wikilink"><code>J.</code> <code>L.</code> <code>Kelly,</code> <code>Jr</code></a><code> in 1956.</code><a class="footnoteRef" href="#fn1" id="fnref1"><sup>1</sup></a><code> The practical use of the formula has been demonstrated.</code><a class="footnoteRef" href="#fn2" id="fnref2"><sup>2</sup></a><a class="footnoteRef" href="#fn3" id="fnref3"><sup>3</sup></a><a class="footnoteRef" href="#fn4" id="fnref4"><sup>4</sup></a></p>

<p>Although the Kelly strategy's promise of doing better than any other strategy in the long run seems compelling, some economists have argued strenuously against it, mainly because an individual's specific investing constraints may override the desire for optimal growth rate.<a class="footnoteRef" href="#fn5" id="fnref5"><sup>5</sup></a> The conventional alternative is <a href="expected_utility" title="wikilink">expected utility</a> theory which says bets should be sized to <a href="Optimization_(mathematics)" title="wikilink">maximize</a> the <a href="Expectation-maximization_algorithm" title="wikilink">expected</a> utility of the outcome (to an individual with <a href="logarithm" title="wikilink">logarithmic</a> utility, the Kelly bet maximizes expected utility, so there is no conflict; moreover, Kelly's original paper clearly states the need for a utility function in the case of gambling games which are played finitely many times<a class="footnoteRef" href="#fn6" id="fnref6"><sup>6</sup></a>). Even Kelly supporters usually argue for fractional Kelly (betting a fixed fraction of the amount recommended by Kelly) for a variety of practical reasons, such as wishing to reduce volatility, or protecting against non-deterministic errors in their advantage (edge) calculations.<a class="footnoteRef" href="#fn7" id="fnref7"><sup>7</sup></a></p>

<p>In recent years, Kelly has become a part of mainstream investment theory<a class="footnoteRef" href="#fn8" id="fnref8"><sup>8</sup></a> and the claim has been made that well-known successful investors including <a href="Warren_Buffett" title="wikilink">Warren Buffett</a><a class="footnoteRef" href="#fn9" id="fnref9"><sup>9</sup></a> and <a href="William_H._Gross" title="wikilink">Bill Gross</a><a class="footnoteRef" href="#fn10" id="fnref10"><sup>10</sup></a> use Kelly methods. <a href="William_Poundstone" title="wikilink">William Poundstone</a> wrote an extensive popular account of the history of Kelly betting.<a class="footnoteRef" href="#fn11" id="fnref11"><sup>11</sup></a></p>
<h2 id="statement">Statement</h2>

<p>For simple bets with two outcomes, one involving losing the entire amount bet, and the other involving winning the bet amount multiplied by the payoff <a class="uri" href="odds" title="wikilink">odds</a>, the Kelly bet is:</p>

<p>

<math display="block" id="Kelly_criterion:0">
 <semantics>
  <mrow>
   <mrow>
    <msup>
     <mi>f</mi>
     <mo>*</mo>
    </msup>
    <mo>=</mo>
    <mfrac>
     <mrow>
      <mrow>
       <mi>b</mi>
       <mi>p</mi>
      </mrow>
      <mo>-</mo>
      <mi>q</mi>
     </mrow>
     <mi>b</mi>
    </mfrac>
    <mo>=</mo>
    <mfrac>
     <mrow>
      <mrow>
       <mi>p</mi>
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mi>b</mi>
         <mo>+</mo>
         <mn>1</mn>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
      </mrow>
      <mo>-</mo>
      <mn>1</mn>
     </mrow>
     <mi>b</mi>
    </mfrac>
   </mrow>
   <mo>,</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <and></and>
    <apply>
     <eq></eq>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>f</ci>
      <times></times>
     </apply>
     <apply>
      <divide></divide>
      <apply>
       <minus></minus>
       <apply>
        <times></times>
        <ci>b</ci>
        <ci>p</ci>
       </apply>
       <ci>q</ci>
      </apply>
      <ci>b</ci>
     </apply>
    </apply>
    <apply>
     <eq></eq>
     <share href="#.cmml">
     </share>
     <apply>
      <divide></divide>
      <apply>
       <minus></minus>
       <apply>
        <times></times>
        <ci>p</ci>
        <apply>
         <plus></plus>
         <ci>b</ci>
         <cn type="integer">1</cn>
        </apply>
       </apply>
       <cn type="integer">1</cn>
      </apply>
      <ci>b</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f^{*}=\frac{bp-q}{b}=\frac{p(b+1)-1}{b},\!
  </annotation>
 </semantics>
</math>

</p>

<p>where:</p>
<ul>
<li><em>f</em>* is the fraction of the current bankroll to wager, i.e. how much to bet;</li>
<li><em>b</em> is the net odds received on the wager ("<em>b</em> to 1"); that is, you could win $b (on top of getting back your $1 wagered) for a $1 bet</li>
<li><em>p</em> is the probability of winning;</li>
<li><em>q</em> is the probability of losing, which is 1 − <em>p</em>.</li>
</ul>

<p>As an example, if a gamble has a 60% chance of winning (<em>p</em> = 0.60, <em>q</em> = 0.40), and the gambler receives 1-to-1 odds on a winning bet (<em>b</em> = 1), then the gambler should bet 20% of his bankroll at each opportunity (<em>f</em>* = 0.20), in order to maximize the long-run growth rate of the bankroll.</p>

<p>If the gambler has zero edge, i.e. if <em>b</em> = <em>q</em> / <em>p</em>, then the criterion recommends the gambler bets nothing.</p>

<p>If the edge is negative (<em>b</em>  f^{*} = \frac{\text{expected net winnings}}{\text{net winnings if you win}} \! </p>

<p>For even-money bets (i.e. when <em>b</em> = 1), the first formula can be simplified to:</p>

<p>

<math display="block" id="Kelly_criterion:1">
 <semantics>
  <mrow>
   <mrow>
    <msup>
     <mi>f</mi>
     <mo>*</mo>
    </msup>
    <mo>=</mo>
    <mrow>
     <mi>p</mi>
     <mo>-</mo>
     <mi>q</mi>
    </mrow>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>f</ci>
     <times></times>
    </apply>
    <apply>
     <minus></minus>
     <ci>p</ci>
     <ci>q</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f^{*}=p-q.\!
  </annotation>
 </semantics>
</math>

 Since q = 1-p, this simplifies further to</p>

<p>

<math display="block" id="Kelly_criterion:2">
 <semantics>
  <mrow>
   <msup>
    <mi>f</mi>
    <mo>*</mo>
   </msup>
   <mo>=</mo>
   <mrow>
    <mrow>
     <mn>2</mn>
     <mi>p</mi>
    </mrow>
    <mo>-</mo>
    <mpadded width="-1.7pt">
     <mn>1.</mn>
    </mpadded>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>f</ci>
     <times></times>
    </apply>
    <apply>
     <minus></minus>
     <apply>
      <times></times>
      <cn type="integer">2</cn>
      <ci>p</ci>
     </apply>
     <cn type="float">1.</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f^{*}=2p-1.\!
  </annotation>
 </semantics>
</math>

</p>

<p>A more general problem relevant for investment decisions is the following:</p>

<p>1. The probability of success is 

<math display="inline" id="Kelly_criterion:3">
 <semantics>
  <mi>p</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>p</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   p
  </annotation>
 </semantics>
</math>

.</p>

<p>2. If you succeed, the value of your investment increases from 

<math display="inline" id="Kelly_criterion:4">
 <semantics>
  <mn>1</mn>
  <annotation-xml encoding="MathML-Content">
   <cn type="integer">1</cn>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   1
  </annotation>
 </semantics>
</math>

 to 

<math display="inline" id="Kelly_criterion:5">
 <semantics>
  <mrow>
   <mn>1</mn>
   <mo>+</mo>
   <mi>b</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <plus></plus>
    <cn type="integer">1</cn>
    <ci>b</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   1+b
  </annotation>
 </semantics>
</math>

.</p>

<p>3. If you fail (for which the probability is 

<math display="inline" id="Kelly_criterion:6">
 <semantics>
  <mrow>
   <mi>q</mi>
   <mo>=</mo>
   <mrow>
    <mn>1</mn>
    <mo>-</mo>
    <mi>p</mi>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>q</ci>
    <apply>
     <minus></minus>
     <cn type="integer">1</cn>
     <ci>p</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   q=1-p
  </annotation>
 </semantics>
</math>

) the value of your investment decreases from 

<math display="inline" id="Kelly_criterion:7">
 <semantics>
  <mn>1</mn>
  <annotation-xml encoding="MathML-Content">
   <cn type="integer">1</cn>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   1
  </annotation>
 </semantics>
</math>

 to 

<math display="inline" id="Kelly_criterion:8">
 <semantics>
  <mrow>
   <mn>1</mn>
   <mo>-</mo>
   <mi>a</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <minus></minus>
    <cn type="integer">1</cn>
    <ci>a</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   1-a
  </annotation>
 </semantics>
</math>

. (Note that the previous description above assumes that a is 1).</p>

<p>In this case, the Kelly criterion turns out to be the relatively simple expression</p>

<p>

<math display="block" id="Kelly_criterion:9">
 <semantics>
  <mrow>
   <mrow>
    <msup>
     <mi>f</mi>
     <mo>*</mo>
    </msup>
    <mo>=</mo>
    <mrow>
     <mrow>
      <mi>p</mi>
      <mo>/</mo>
      <mi>a</mi>
     </mrow>
     <mo>-</mo>
     <mrow>
      <mi>q</mi>
      <mo>/</mo>
      <mi>b</mi>
     </mrow>
    </mrow>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>f</ci>
     <times></times>
    </apply>
    <apply>
     <minus></minus>
     <apply>
      <divide></divide>
      <ci>p</ci>
      <ci>a</ci>
     </apply>
     <apply>
      <divide></divide>
      <ci>q</ci>
      <ci>b</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f^{*}=p/a-q/b.\!
  </annotation>
 </semantics>
</math>

</p>

<p>Note that this reduces to the original expression for the special case above (

<math display="inline" id="Kelly_criterion:10">
 <semantics>
  <mrow>
   <msup>
    <mi>f</mi>
    <mo>*</mo>
   </msup>
   <mo>=</mo>
   <mrow>
    <mi>p</mi>
    <mo>-</mo>
    <mi>q</mi>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>f</ci>
     <times></times>
    </apply>
    <apply>
     <minus></minus>
     <ci>p</ci>
     <ci>q</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f^{*}=p-q
  </annotation>
 </semantics>
</math>

) for 

<math display="inline" id="Kelly_criterion:11">
 <semantics>
  <mrow>
   <mi>b</mi>
   <mo>=</mo>
   <mi>a</mi>
   <mo>=</mo>
   <mn>1</mn>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <and></and>
    <apply>
     <eq></eq>
     <ci>b</ci>
     <ci>a</ci>
    </apply>
    <apply>
     <eq></eq>
     <share href="#.cmml">
     </share>
     <cn type="integer">1</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   b=a=1
  </annotation>
 </semantics>
</math>

.</p>

<p>Clearly, in order to decide in favor of investing at least a small amount 

<math display="inline" id="Kelly_criterion:12">
 <semantics>
  <mrow>
   <mo stretchy="false">(</mo>
   <mrow>
    <msup>
     <mi>f</mi>
     <mo>*</mo>
    </msup>
    <mo>></mo>
    <mn>0</mn>
   </mrow>
   <mo stretchy="false">)</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <gt></gt>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>f</ci>
     <times></times>
    </apply>
    <cn type="integer">0</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   (f^{*}>0)
  </annotation>
 </semantics>
</math>

, you must have</p>

<p>

<math display="block" id="Kelly_criterion:13">
 <semantics>
  <mrow>
   <mrow>
    <mrow>
     <mi>p</mi>
     <mi>b</mi>
    </mrow>
    <mo>></mo>
    <mrow>
     <mi>q</mi>
     <mi>a</mi>
    </mrow>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <gt></gt>
    <apply>
     <times></times>
     <ci>p</ci>
     <ci>b</ci>
    </apply>
    <apply>
     <times></times>
     <ci>q</ci>
     <ci>a</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   pb>qa.\!
  </annotation>
 </semantics>
</math>

</p>

<p>which obviously is nothing more than the fact that your expected profit must exceed the expected loss for the investment to make any sense.</p>

<p>The general result clarifies why leveraging (taking a loan to invest) decreases the optimal fraction to be invested, as in that case 

<math display="inline" id="Kelly_criterion:14">
 <semantics>
  <mrow>
   <mi>a</mi>
   <mo>></mo>
   <mn>1</mn>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <gt></gt>
    <ci>a</ci>
    <cn type="integer">1</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   a>1
  </annotation>
 </semantics>
</math>

. Obviously, no matter how large the probability of success, 

<math display="inline" id="Kelly_criterion:15">
 <semantics>
  <mi>p</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>p</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   p
  </annotation>
 </semantics>
</math>

, is, if 

<math display="inline" id="Kelly_criterion:16">
 <semantics>
  <mi>a</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>a</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   a
  </annotation>
 </semantics>
</math>

 is sufficiently large, the optimal fraction to invest is zero. Thus, using too much margin is not a good investment strategy, no matter how good an investor you are.</p>
<h2 id="proof">Proof</h2>

<p>Heuristic proofs of the Kelly criterion are straightforward.<a class="footnoteRef" href="#fn12" id="fnref12"><sup>12</sup></a> For a symbolic verification with <a href="Python_(programming_language)" title="wikilink">Python</a> and <a class="uri" href="SymPy" title="wikilink">SymPy</a> one would set the derivative y'(x) of the expected value of the logarithmic bankroll y(x) to 0 and solve for <em>x</em>:</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> sympy <span class="im">import</span> <span class="op">*</span>
<span class="op">&gt;&gt;&gt;</span> x,b,p <span class="op">=</span> symbols(<span class="st">'x b p'</span>)
<span class="op">&gt;&gt;&gt;</span> y <span class="op">=</span> p<span class="op">*</span>log(<span class="dv">1</span><span class="op">+</span>b<span class="op">*</span>x) <span class="op">+</span> (<span class="dv">1</span><span class="op">-</span>p)<span class="op">*</span>log(<span class="dv">1</span><span class="op">-</span>x)
<span class="op">&gt;&gt;&gt;</span> solve(diff(y,x), x)
[<span class="op">-</span>(<span class="dv">1</span> <span class="op">-</span> p <span class="op">-</span> b<span class="op">*</span>p)<span class="op">/</span>b]</code></pre></div>

<p>For a rigorous and general proof, see <a href="John_Larry_Kelly,_Jr" title="wikilink">Kelly's</a> original paper<a class="footnoteRef" href="#fn13" id="fnref13"><sup>13</sup></a> or some of the other references listed below. Some corrections have been published.<a class="footnoteRef" href="#fn14" id="fnref14"><sup>14</sup></a></p>

<p>We give the following non-rigorous argument for the case b = 1 (a 50:50 "even money" bet) to show the general idea and provide some insights.<a class="footnoteRef" href="#fn15" id="fnref15"><sup>15</sup></a></p>

<p>When <em>b</em> = 1, the Kelly bettor bets 2<em>p</em> - 1 times initial wealth, <em>W</em>, as shown above. If he wins, he has 2<em>pW</em>. If he loses, he has 2(1 - <em>p</em>)<em>W</em>. Suppose he makes <em>N</em> bets like this, and wins <em>K</em> of them. The order of the wins and losses doesn't matter, he will have:</p>

<p>

<math display="block" id="Kelly_criterion:17">
 <semantics>
  <mrow>
   <mrow>
    <msup>
     <mn>2</mn>
     <mi>N</mi>
    </msup>
    <msup>
     <mi>p</mi>
     <mi>K</mi>
    </msup>
    <msup>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <mn>1</mn>
       <mo>-</mo>
       <mi>p</mi>
      </mrow>
      <mo stretchy="false">)</mo>
     </mrow>
     <mrow>
      <mi>N</mi>
      <mo>-</mo>
      <mi>K</mi>
     </mrow>
    </msup>
    <mpadded width="-1.7pt">
     <mi>W</mi>
    </mpadded>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <cn type="integer">2</cn>
     <ci>N</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>p</ci>
     <ci>K</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <minus></minus>
      <cn type="integer">1</cn>
      <ci>p</ci>
     </apply>
     <apply>
      <minus></minus>
      <ci>N</ci>
      <ci>K</ci>
     </apply>
    </apply>
    <ci>W</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   2^{N}p^{K}(1-p)^{N-K}W\!.
  </annotation>
 </semantics>
</math>

</p>

<p>Suppose another bettor bets a different amount, (2<em>p</em> - 1 + 

<math display="inline" id="Kelly_criterion:18">
 <semantics>
  <mi mathvariant="normal">Δ</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>normal-Δ</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Delta
  </annotation>
 </semantics>
</math>

)W for some positive or negative 

<math display="inline" id="Kelly_criterion:19">
 <semantics>
  <mi mathvariant="normal">Δ</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>normal-Δ</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Delta
  </annotation>
 </semantics>
</math>

. He will have (2p + 

<math display="inline" id="Kelly_criterion:20">
 <semantics>
  <mi mathvariant="normal">Δ</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>normal-Δ</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Delta
  </annotation>
 </semantics>
</math>

)<em>W</em> after a win and [2(1 - <em>p</em>)- 

<math display="inline" id="Kelly_criterion:21">
 <semantics>
  <mi mathvariant="normal">Δ</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>normal-Δ</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Delta
  </annotation>
 </semantics>
</math>

]<em>W</em> after a loss. After the same wins and losses as the Kelly bettor, he will have:</p>

<p>

<math display="block" id="Kelly_criterion:22">
 <semantics>
  <mrow>
   <msup>
    <mrow>
     <mo stretchy="false">(</mo>
     <mrow>
      <mrow>
       <mn>2</mn>
       <mi>p</mi>
      </mrow>
      <mo>+</mo>
      <mi mathvariant="normal">Δ</mi>
     </mrow>
     <mo stretchy="false">)</mo>
    </mrow>
    <mi>K</mi>
   </msup>
   <msup>
    <mrow>
     <mo stretchy="false">[</mo>
     <mrow>
      <mrow>
       <mn>2</mn>
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mn>1</mn>
         <mo>-</mo>
         <mi>p</mi>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
      </mrow>
      <mo>-</mo>
      <mi mathvariant="normal">Δ</mi>
     </mrow>
     <mo stretchy="false">]</mo>
    </mrow>
    <mrow>
     <mi>N</mi>
     <mo>-</mo>
     <mi>K</mi>
    </mrow>
   </msup>
   <mpadded width="-1.7pt">
    <mi>W</mi>
   </mpadded>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <plus></plus>
      <apply>
       <times></times>
       <cn type="integer">2</cn>
       <ci>p</ci>
      </apply>
      <ci>normal-Δ</ci>
     </apply>
     <ci>K</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="latexml">delimited-[]</csymbol>
      <apply>
       <minus></minus>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <apply>
         <minus></minus>
         <cn type="integer">1</cn>
         <ci>p</ci>
        </apply>
       </apply>
       <ci>normal-Δ</ci>
      </apply>
     </apply>
     <apply>
      <minus></minus>
      <ci>N</ci>
      <ci>K</ci>
     </apply>
    </apply>
    <ci>W</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   (2p+\Delta)^{K}[2(1-p)-\Delta]^{N-K}W\!
  </annotation>
 </semantics>
</math>

</p>

<p>Take the derivative of this with respect to 

<math display="inline" id="Kelly_criterion:23">
 <semantics>
  <mi mathvariant="normal">Δ</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>normal-Δ</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Delta
  </annotation>
 </semantics>
</math>

 and get:</p>

<p>

<math display="block" id="Kelly_criterion:24">
 <semantics>
  <mrow>
   <mrow>
    <mi>K</mi>
    <msup>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <mrow>
        <mn>2</mn>
        <mi>p</mi>
       </mrow>
       <mo>+</mo>
       <mi mathvariant="normal">Δ</mi>
      </mrow>
      <mo stretchy="false">)</mo>
     </mrow>
     <mrow>
      <mi>K</mi>
      <mo>-</mo>
      <mn>1</mn>
     </mrow>
    </msup>
    <msup>
     <mrow>
      <mo stretchy="false">[</mo>
      <mrow>
       <mrow>
        <mn>2</mn>
        <mrow>
         <mo stretchy="false">(</mo>
         <mrow>
          <mn>1</mn>
          <mo>-</mo>
          <mi>p</mi>
         </mrow>
         <mo stretchy="false">)</mo>
        </mrow>
       </mrow>
       <mo>-</mo>
       <mi mathvariant="normal">Δ</mi>
      </mrow>
      <mo stretchy="false">]</mo>
     </mrow>
     <mrow>
      <mi>N</mi>
      <mo>-</mo>
      <mi>K</mi>
     </mrow>
    </msup>
    <mi>W</mi>
   </mrow>
   <mo>-</mo>
   <mrow>
    <mrow>
     <mo stretchy="false">(</mo>
     <mrow>
      <mi>N</mi>
      <mo>-</mo>
      <mi>K</mi>
     </mrow>
     <mo stretchy="false">)</mo>
    </mrow>
    <msup>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <mrow>
        <mn>2</mn>
        <mi>p</mi>
       </mrow>
       <mo>+</mo>
       <mi mathvariant="normal">Δ</mi>
      </mrow>
      <mo stretchy="false">)</mo>
     </mrow>
     <mi>K</mi>
    </msup>
    <msup>
     <mrow>
      <mo stretchy="false">[</mo>
      <mrow>
       <mrow>
        <mn>2</mn>
        <mrow>
         <mo stretchy="false">(</mo>
         <mrow>
          <mn>1</mn>
          <mo>-</mo>
          <mi>p</mi>
         </mrow>
         <mo stretchy="false">)</mo>
        </mrow>
       </mrow>
       <mo>-</mo>
       <mi mathvariant="normal">Δ</mi>
      </mrow>
      <mo stretchy="false">]</mo>
     </mrow>
     <mrow>
      <mi>N</mi>
      <mo>-</mo>
      <mi>K</mi>
      <mo>-</mo>
      <mn>1</mn>
     </mrow>
    </msup>
    <mpadded width="-1.7pt">
     <mi>W</mi>
    </mpadded>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <minus></minus>
    <apply>
     <times></times>
     <ci>K</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <plus></plus>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>p</ci>
       </apply>
       <ci>normal-Δ</ci>
      </apply>
      <apply>
       <minus></minus>
       <ci>K</ci>
       <cn type="integer">1</cn>
      </apply>
     </apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <csymbol cd="latexml">delimited-[]</csymbol>
       <apply>
        <minus></minus>
        <apply>
         <times></times>
         <cn type="integer">2</cn>
         <apply>
          <minus></minus>
          <cn type="integer">1</cn>
          <ci>p</ci>
         </apply>
        </apply>
        <ci>normal-Δ</ci>
       </apply>
      </apply>
      <apply>
       <minus></minus>
       <ci>N</ci>
       <ci>K</ci>
      </apply>
     </apply>
     <ci>W</ci>
    </apply>
    <apply>
     <times></times>
     <apply>
      <minus></minus>
      <ci>N</ci>
      <ci>K</ci>
     </apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <plus></plus>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>p</ci>
       </apply>
       <ci>normal-Δ</ci>
      </apply>
      <ci>K</ci>
     </apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <csymbol cd="latexml">delimited-[]</csymbol>
       <apply>
        <minus></minus>
        <apply>
         <times></times>
         <cn type="integer">2</cn>
         <apply>
          <minus></minus>
          <cn type="integer">1</cn>
          <ci>p</ci>
         </apply>
        </apply>
        <ci>normal-Δ</ci>
       </apply>
      </apply>
      <apply>
       <minus></minus>
       <ci>N</ci>
       <ci>K</ci>
       <cn type="integer">1</cn>
      </apply>
     </apply>
     <ci>W</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   K(2p+\Delta)^{K-1}[2(1-p)-\Delta]^{N-K}W-(N-K)(2p+\Delta)^{K}[2(1-p)-\Delta]^{%
N-K-1}W\!
  </annotation>
 </semantics>
</math>

</p>

<p>The turning point of the original function occurs when this derivative equals zero, which occurs at:</p>

<p>

<math display="block" id="Kelly_criterion:25">
 <semantics>
  <mrow>
   <mrow>
    <mi>K</mi>
    <mrow>
     <mo stretchy="false">[</mo>
     <mrow>
      <mrow>
       <mn>2</mn>
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mn>1</mn>
         <mo>-</mo>
         <mi>p</mi>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
      </mrow>
      <mo>-</mo>
      <mi mathvariant="normal">Δ</mi>
     </mrow>
     <mo stretchy="false">]</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mrow>
     <mo stretchy="false">(</mo>
     <mrow>
      <mi>N</mi>
      <mo>-</mo>
      <mi>K</mi>
     </mrow>
     <mo stretchy="false">)</mo>
    </mrow>
    <mrow>
     <mo stretchy="false">(</mo>
     <mrow>
      <mrow>
       <mn>2</mn>
       <mi>p</mi>
      </mrow>
      <mo>+</mo>
      <mi mathvariant="normal">Δ</mi>
     </mrow>
     <mo rspace="0.8pt" stretchy="false">)</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <ci>K</ci>
     <apply>
      <csymbol cd="latexml">delimited-[]</csymbol>
      <apply>
       <minus></minus>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <apply>
         <minus></minus>
         <cn type="integer">1</cn>
         <ci>p</ci>
        </apply>
       </apply>
       <ci>normal-Δ</ci>
      </apply>
     </apply>
    </apply>
    <apply>
     <times></times>
     <apply>
      <minus></minus>
      <ci>N</ci>
      <ci>K</ci>
     </apply>
     <apply>
      <plus></plus>
      <apply>
       <times></times>
       <cn type="integer">2</cn>
       <ci>p</ci>
      </apply>
      <ci>normal-Δ</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   K[2(1-p)-\Delta]=(N-K)(2p+\Delta)\!
  </annotation>
 </semantics>
</math>

</p>

<p>which implies:</p>

<p>

<math display="block" id="Kelly_criterion:26">
 <semantics>
  <mrow>
   <mi mathvariant="normal">Δ</mi>
   <mo>=</mo>
   <mrow>
    <mn>2</mn>
    <mrow>
     <mo stretchy="false">(</mo>
     <mrow>
      <mfrac>
       <mi>K</mi>
       <mi>N</mi>
      </mfrac>
      <mo>-</mo>
      <mi>p</mi>
     </mrow>
     <mo rspace="0.8pt" stretchy="false">)</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>normal-Δ</ci>
    <apply>
     <times></times>
     <cn type="integer">2</cn>
     <apply>
      <minus></minus>
      <apply>
       <divide></divide>
       <ci>K</ci>
       <ci>N</ci>
      </apply>
      <ci>p</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Delta=2(\frac{K}{N}-p)\!
  </annotation>
 </semantics>
</math>

</p>

<p>but:</p>

<p>

<math display="block" id="Kelly_criterion:27">
 <semantics>
  <mrow>
   <mrow>
    <munder>
     <mo movablelimits="false">lim</mo>
     <mrow>
      <mi>N</mi>
      <mo>→</mo>
      <mrow>
       <mo>+</mo>
       <mi mathvariant="normal">∞</mi>
      </mrow>
     </mrow>
    </munder>
    <mfrac>
     <mi>K</mi>
     <mi>N</mi>
    </mfrac>
   </mrow>
   <mo>=</mo>
   <mpadded width="-1.7pt">
    <mi>p</mi>
   </mpadded>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <limit></limit>
      <apply>
       <ci>normal-→</ci>
       <ci>N</ci>
       <apply>
        <plus></plus>
        <infinity></infinity>
       </apply>
      </apply>
     </apply>
     <apply>
      <divide></divide>
      <ci>K</ci>
      <ci>N</ci>
     </apply>
    </apply>
    <ci>p</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \lim_{N\to+\infty}\frac{K}{N}=p\!
  </annotation>
 </semantics>
</math>

</p>

<p>so in the long run, final wealth is maximized by setting 

<math display="inline" id="Kelly_criterion:28">
 <semantics>
  <mi mathvariant="normal">Δ</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>normal-Δ</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Delta
  </annotation>
 </semantics>
</math>

 to zero, which means following the Kelly strategy.</p>

<p>This illustrates that Kelly has both a deterministic and a stochastic component. If one knows K and N and wishes to pick a constant fraction of wealth to bet each time (otherwise one could cheat and, for example, bet zero after the K<sup>th</sup> win knowing that the rest of the bets will lose), one will end up with the most money if one bets:</p>

<p>

<math display="block" id="Kelly_criterion:29">
 <semantics>
  <mrow>
   <mrow>
    <mo>(</mo>
    <mrow>
     <mrow>
      <mn>2</mn>
      <mfrac>
       <mi>K</mi>
       <mi>N</mi>
      </mfrac>
     </mrow>
     <mo>-</mo>
     <mn>1</mn>
    </mrow>
    <mo>)</mo>
   </mrow>
   <mpadded width="-1.7pt">
    <mi>W</mi>
   </mpadded>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <minus></minus>
     <apply>
      <times></times>
      <cn type="integer">2</cn>
      <apply>
       <divide></divide>
       <ci>K</ci>
       <ci>N</ci>
      </apply>
     </apply>
     <cn type="integer">1</cn>
    </apply>
    <ci>W</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \left(2\frac{K}{N}-1\right)W\!
  </annotation>
 </semantics>
</math>

</p>

<p>each time. This is true whether <em>N</em> is small or large. The "long run" part of Kelly is necessary because K is not known in advance, just that as <em>N</em> gets large, <em>K</em> will approach <em>pN</em>. Someone who bets more than Kelly can do better if  for a stretch; someone who bets less than Kelly can do better if  for a stretch, but in the long run, Kelly always wins.</p>

<p>The heuristic proof for the general case proceeds as follows.</p>

<p>In a single trial, if you invest the fraction 

<math display="inline" id="Kelly_criterion:30">
 <semantics>
  <mi>f</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>f</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f
  </annotation>
 </semantics>
</math>

 of your capital, if your strategy succeeds, your capital at the end of the trial increases by the factor 

<math display="inline" id="Kelly_criterion:31">
 <semantics>
  <mrow>
   <mrow>
    <mrow>
     <mn>1</mn>
     <mo>-</mo>
     <mi>f</mi>
    </mrow>
    <mo>+</mo>
    <mrow>
     <mi>f</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <mn>1</mn>
       <mo>+</mo>
       <mi>b</mi>
      </mrow>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mn>1</mn>
    <mo>+</mo>
    <mrow>
     <mi>f</mi>
     <mi>b</mi>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <plus></plus>
     <apply>
      <minus></minus>
      <cn type="integer">1</cn>
      <ci>f</ci>
     </apply>
     <apply>
      <times></times>
      <ci>f</ci>
      <apply>
       <plus></plus>
       <cn type="integer">1</cn>
       <ci>b</ci>
      </apply>
     </apply>
    </apply>
    <apply>
     <plus></plus>
     <cn type="integer">1</cn>
     <apply>
      <times></times>
      <ci>f</ci>
      <ci>b</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   1-f+f(1+b)=1+fb
  </annotation>
 </semantics>
</math>

, and, likewise, if the strategy fails, you end up having your capital decreased by the factor 

<math display="inline" id="Kelly_criterion:32">
 <semantics>
  <mrow>
   <mn>1</mn>
   <mo>-</mo>
   <mrow>
    <mi>f</mi>
    <mi>a</mi>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <minus></minus>
    <cn type="integer">1</cn>
    <apply>
     <times></times>
     <ci>f</ci>
     <ci>a</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   1-fa
  </annotation>
 </semantics>
</math>

. Thus at the end of 

<math display="inline" id="Kelly_criterion:33">
 <semantics>
  <mi>N</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>N</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   N
  </annotation>
 </semantics>
</math>

 trials (with 

<math display="inline" id="Kelly_criterion:34">
 <semantics>
  <mrow>
   <mi>p</mi>
   <mi>N</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>p</ci>
    <ci>N</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   pN
  </annotation>
 </semantics>
</math>

 successes and 

<math display="inline" id="Kelly_criterion:35">
 <semantics>
  <mrow>
   <mi>q</mi>
   <mi>N</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>q</ci>
    <ci>N</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   qN
  </annotation>
 </semantics>
</math>

 failures ), the starting capital of $1 yields</p>

<p>

<math display="block" id="Kelly_criterion:36">
 <semantics>
  <mrow>
   <mrow>
    <msub>
     <mi>C</mi>
     <mi>N</mi>
    </msub>
    <mo>=</mo>
    <mrow>
     <msup>
      <mrow>
       <mo stretchy="false">(</mo>
       <mrow>
        <mn>1</mn>
        <mo>+</mo>
        <mrow>
         <mi>f</mi>
         <mi>b</mi>
        </mrow>
       </mrow>
       <mo stretchy="false">)</mo>
      </mrow>
      <mrow>
       <mi>p</mi>
       <mi>N</mi>
      </mrow>
     </msup>
     <msup>
      <mrow>
       <mo stretchy="false">(</mo>
       <mrow>
        <mn>1</mn>
        <mo>-</mo>
        <mrow>
         <mi>f</mi>
         <mi>a</mi>
        </mrow>
       </mrow>
       <mo stretchy="false">)</mo>
      </mrow>
      <mrow>
       <mi>q</mi>
       <mi>N</mi>
      </mrow>
     </msup>
    </mrow>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>C</ci>
     <ci>N</ci>
    </apply>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <plus></plus>
       <cn type="integer">1</cn>
       <apply>
        <times></times>
        <ci>f</ci>
        <ci>b</ci>
       </apply>
      </apply>
      <apply>
       <times></times>
       <ci>p</ci>
       <ci>N</ci>
      </apply>
     </apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <minus></minus>
       <cn type="integer">1</cn>
       <apply>
        <times></times>
        <ci>f</ci>
        <ci>a</ci>
       </apply>
      </apply>
      <apply>
       <times></times>
       <ci>q</ci>
       <ci>N</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C_{N}=(1+fb)^{pN}(1-fa)^{qN}.
  </annotation>
 </semantics>
</math>

</p>

<p>Maximizing 

<math display="inline" id="Kelly_criterion:37">
 <semantics>
  <mrow>
   <mrow>
    <mi>log</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <msub>
      <mi>C</mi>
      <mi>N</mi>
     </msub>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>/</mo>
   <mi>N</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <divide></divide>
    <apply>
     <log></log>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>C</ci>
      <ci>N</ci>
     </apply>
    </apply>
    <ci>N</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \log(C_{N})/N
  </annotation>
 </semantics>
</math>

, and consequently 

<math display="inline" id="Kelly_criterion:38">
 <semantics>
  <msub>
   <mi>C</mi>
   <mi>N</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>C</ci>
    <ci>N</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C_{N}
  </annotation>
 </semantics>
</math>

, with respect to 

<math display="inline" id="Kelly_criterion:39">
 <semantics>
  <mi>f</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>f</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f
  </annotation>
 </semantics>
</math>

 leads to the desired result</p>

<p>

<math display="block" id="Kelly_criterion:40">
 <semantics>
  <mrow>
   <mrow>
    <msup>
     <mi>f</mi>
     <mo>*</mo>
    </msup>
    <mo>=</mo>
    <mrow>
     <mrow>
      <mi>p</mi>
      <mo>/</mo>
      <mi>a</mi>
     </mrow>
     <mo>-</mo>
     <mrow>
      <mi>q</mi>
      <mo>/</mo>
      <mi>b</mi>
     </mrow>
    </mrow>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>f</ci>
     <times></times>
    </apply>
    <apply>
     <minus></minus>
     <apply>
      <divide></divide>
      <ci>p</ci>
      <ci>a</ci>
     </apply>
     <apply>
      <divide></divide>
      <ci>q</ci>
      <ci>b</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f^{*}=p/a-q/b.
  </annotation>
 </semantics>
</math>

</p>

<p>For a more detailed discussion of this formula for the general case, see <a class="uri" href="http://www.bjmath.com/bjmath/thorp/ch2.pdf">http://www.bjmath.com/bjmath/thorp/ch2.pdf</a>. There, it can be seen that the substitution of 

<math display="inline" id="Kelly_criterion:41">
 <semantics>
  <mi>p</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>p</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   p
  </annotation>
 </semantics>
</math>

 for the ratio of the number of "successes" to the number of trials implies that the number of trials must be very large, since 

<math display="inline" id="Kelly_criterion:42">
 <semantics>
  <mi>p</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>p</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   p
  </annotation>
 </semantics>
</math>

 is defined as the limit of this ratio as the number of trials goes to infinity. In brief, betting 

<math display="inline" id="Kelly_criterion:43">
 <semantics>
  <msup>
   <mi>f</mi>
   <mo>*</mo>
  </msup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <ci>f</ci>
    <times></times>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f^{*}
  </annotation>
 </semantics>
</math>

 each time will likely maximize the wealth growth rate only in the case where the number of trials is very large, and 

<math display="inline" id="Kelly_criterion:44">
 <semantics>
  <mi>p</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>p</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   p
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="Kelly_criterion:45">
 <semantics>
  <mi>b</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>b</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   b
  </annotation>
 </semantics>
</math>

 are the same for each trial. In practice, this is a matter of playing the same game over and over, where the probability of winning and the payoff odds are always the same. In the heuristic proof above, 

<math display="inline" id="Kelly_criterion:46">
 <semantics>
  <mrow>
   <mi>p</mi>
   <mi>N</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>p</ci>
    <ci>N</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   pN
  </annotation>
 </semantics>
</math>

 successes and 

<math display="inline" id="Kelly_criterion:47">
 <semantics>
  <mrow>
   <mi>q</mi>
   <mi>N</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>q</ci>
    <ci>N</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   qN
  </annotation>
 </semantics>
</math>

 failures are highly likely only for very large 

<math display="inline" id="Kelly_criterion:48">
 <semantics>
  <mi>N</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>N</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   N
  </annotation>
 </semantics>
</math>

.</p>
<h2 id="bernoulli">Bernoulli</h2>

<p>In a 1738 article, <a href="Daniel_Bernoulli" title="wikilink">Daniel Bernoulli</a> suggested that, when one has a choice of bets or investments, one should choose that with the highest <a href="geometric_mean" title="wikilink">geometric mean</a> of outcomes. This is mathematically equivalent to the Kelly criterion, although the motivation is entirely different (Bernoulli wanted to resolve the <a href="St._Petersburg_paradox" title="wikilink">St. Petersburg paradox</a>).</p>

<p>The Bernoulli article was not translated into <a href="English_(language)" title="wikilink">English</a> until 1956,<a class="footnoteRef" href="#fn16" id="fnref16"><sup>16</sup></a> but the work was well-known among mathematicians and economists.</p>
<h2 id="many-horses">Many horses</h2>

<p>Kelly's criterion may be generalized <a class="footnoteRef" href="#fn17" id="fnref17"><sup>17</sup></a> on gambling on many mutually exclusive outcomes, like in horse races. Suppose there are several mutually exclusive outcomes. The probability that the k-th horse wins the race is 

<math display="inline" id="Kelly_criterion:49">
 <semantics>
  <msub>
   <mi>p</mi>
   <mi>k</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>p</ci>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   p_{k}
  </annotation>
 </semantics>
</math>

, the total amount of bets placed on k-th horse is 

<math display="inline" id="Kelly_criterion:50">
 <semantics>
  <msub>
   <mi>B</mi>
   <mi>k</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>B</ci>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B_{k}
  </annotation>
 </semantics>
</math>

, and</p>

<p>

<math display="block" id="Kelly_criterion:51">
 <semantics>
  <mrow>
   <mrow>
    <msub>
     <mi>β</mi>
     <mi>k</mi>
    </msub>
    <mo>=</mo>
    <mfrac>
     <msub>
      <mi>B</mi>
      <mi>k</mi>
     </msub>
     <mrow>
      <msub>
       <mo largeop="true" symmetric="true">∑</mo>
       <mi>i</mi>
      </msub>
      <msub>
       <mi>B</mi>
       <mi>i</mi>
      </msub>
     </mrow>
    </mfrac>
    <mo>=</mo>
    <mfrac>
     <mn>1</mn>
     <mrow>
      <mn>1</mn>
      <mo>+</mo>
      <msub>
       <mi>Q</mi>
       <mi>k</mi>
      </msub>
     </mrow>
    </mfrac>
   </mrow>
   <mo>,</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <and></and>
    <apply>
     <eq></eq>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>β</ci>
      <ci>k</ci>
     </apply>
     <apply>
      <divide></divide>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>B</ci>
       <ci>k</ci>
      </apply>
      <apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <sum></sum>
        <ci>i</ci>
       </apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>B</ci>
        <ci>i</ci>
       </apply>
      </apply>
     </apply>
    </apply>
    <apply>
     <eq></eq>
     <share href="#.cmml">
     </share>
     <apply>
      <divide></divide>
      <cn type="integer">1</cn>
      <apply>
       <plus></plus>
       <cn type="integer">1</cn>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>Q</ci>
        <ci>k</ci>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \beta_{k}=\frac{B_{k}}{\sum_{i}B_{i}}=\frac{1}{1+Q_{k}},
  </annotation>
 </semantics>
</math>

 where 

<math display="inline" id="Kelly_criterion:52">
 <semantics>
  <msub>
   <mi>Q</mi>
   <mi>k</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>Q</ci>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   Q_{k}
  </annotation>
 </semantics>
</math>

 are the pay-off odds. 

<math display="inline" id="Kelly_criterion:53">
 <semantics>
  <mrow>
   <mi>D</mi>
   <mo>=</mo>
   <mrow>
    <mn>1</mn>
    <mo>-</mo>
    <mrow>
     <mi>t</mi>
     <mi>t</mi>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>D</ci>
    <apply>
     <minus></minus>
     <cn type="integer">1</cn>
     <apply>
      <times></times>
      <ci>t</ci>
      <ci>t</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   D=1-tt
  </annotation>
 </semantics>
</math>

, is the dividend rate where 

<math display="inline" id="Kelly_criterion:54">
 <semantics>
  <mrow>
   <mi>t</mi>
   <mi>t</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>t</ci>
    <ci>t</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   tt
  </annotation>
 </semantics>
</math>

 is the track take or tax, 

<math display="inline" id="Kelly_criterion:55">
 <semantics>
  <mfrac>
   <mi>D</mi>
   <msub>
    <mi>β</mi>
    <mi>k</mi>
   </msub>
  </mfrac>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <divide></divide>
    <ci>D</ci>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>β</ci>
     <ci>k</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \frac{D}{\beta_{k}}
  </annotation>
 </semantics>
</math>

 is the revenue rate after deduction of the track take when k-th horse wins. The fraction of the bettor's funds to bet on k-th horse is 

<math display="inline" id="Kelly_criterion:56">
 <semantics>
  <msub>
   <mi>f</mi>
   <mi>k</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>f</ci>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f_{k}
  </annotation>
 </semantics>
</math>

. Kelly's criterion for gambling with multiple mutually exclusive outcomes gives an algorithm for finding the optimal set 

<math display="inline" id="Kelly_criterion:57">
 <semantics>
  <msup>
   <mi>S</mi>
   <mi>o</mi>
  </msup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <ci>S</ci>
    <ci>o</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S^{o}
  </annotation>
 </semantics>
</math>

 of outcomes on which it is reasonable to bet and it gives explicit formula for finding the optimal fractions 

<math display="inline" id="Kelly_criterion:58">
 <semantics>
  <msubsup>
   <mi>f</mi>
   <mi>k</mi>
   <mi>o</mi>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>f</ci>
     <ci>o</ci>
    </apply>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f^{o}_{k}
  </annotation>
 </semantics>
</math>

 of bettor's wealth to be bet on the outcomes included in the optimal set 

<math display="inline" id="Kelly_criterion:59">
 <semantics>
  <msup>
   <mi>S</mi>
   <mi>o</mi>
  </msup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <ci>S</ci>
    <ci>o</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S^{o}
  </annotation>
 </semantics>
</math>

. The algorithm for the optimal set of outcomes consists of four steps.<a class="footnoteRef" href="#fn18" id="fnref18"><sup>18</sup></a></p>

<p>Step 1 Calculate the expected revenue rate for all possible (or only for several of the most promising) outcomes: 

<math display="inline" id="Kelly_criterion:60">
 <semantics>
  <mrow>
   <mrow>
    <mrow>
     <mi>e</mi>
     <msub>
      <mi>r</mi>
      <mi>k</mi>
     </msub>
    </mrow>
    <mo>=</mo>
    <mrow>
     <mfrac>
      <mi>D</mi>
      <msub>
       <mi>β</mi>
       <mi>k</mi>
      </msub>
     </mfrac>
     <msub>
      <mi>p</mi>
      <mi>k</mi>
     </msub>
    </mrow>
    <mo>=</mo>
    <mrow>
     <mi>D</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <mn>1</mn>
       <mo>+</mo>
       <msub>
        <mi>Q</mi>
        <mi>k</mi>
       </msub>
      </mrow>
      <mo stretchy="false">)</mo>
     </mrow>
     <msub>
      <mi>p</mi>
      <mi>k</mi>
     </msub>
    </mrow>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <and></and>
    <apply>
     <eq></eq>
     <apply>
      <times></times>
      <ci>e</ci>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>r</ci>
       <ci>k</ci>
      </apply>
     </apply>
     <apply>
      <times></times>
      <apply>
       <divide></divide>
       <ci>D</ci>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>β</ci>
        <ci>k</ci>
       </apply>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>p</ci>
       <ci>k</ci>
      </apply>
     </apply>
    </apply>
    <apply>
     <eq></eq>
     <share href="#.cmml">
     </share>
     <apply>
      <times></times>
      <ci>D</ci>
      <apply>
       <plus></plus>
       <cn type="integer">1</cn>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>Q</ci>
        <ci>k</ci>
       </apply>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>p</ci>
       <ci>k</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   er_{k}=\frac{D}{\beta_{k}}p_{k}=D(1+Q_{k})p_{k}.
  </annotation>
 </semantics>
</math>

</p>

<p>Step 2 Reorder the outcomes so that the new sequence 

<math display="inline" id="Kelly_criterion:61">
 <semantics>
  <mrow>
   <mi>e</mi>
   <msub>
    <mi>r</mi>
    <mi>k</mi>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>e</ci>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>r</ci>
     <ci>k</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   er_{k}
  </annotation>
 </semantics>
</math>

 is non-increasing. Thus 

<math display="inline" id="Kelly_criterion:62">
 <semantics>
  <mrow>
   <mi>e</mi>
   <msub>
    <mi>r</mi>
    <mn>1</mn>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>e</ci>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>r</ci>
     <cn type="integer">1</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   er_{1}
  </annotation>
 </semantics>
</math>

 will be the best bet.</p>

<p>Step 3 Set 

<math display="inline" id="Kelly_criterion:63">
 <semantics>
  <mrow>
   <mi>S</mi>
   <mo>=</mo>
   <mi mathvariant="normal">∅</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>S</ci>
    <emptyset></emptyset>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S=\varnothing
  </annotation>
 </semantics>
</math>

 (the empty set), 

<math display="inline" id="Kelly_criterion:64">
 <semantics>
  <mrow>
   <mi>k</mi>
   <mo>=</mo>
   <mn>1</mn>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>k</ci>
    <cn type="integer">1</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   k=1
  </annotation>
 </semantics>
</math>

, 

<math display="inline" id="Kelly_criterion:65">
 <semantics>
  <mrow>
   <mrow>
    <mi>R</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>S</mi>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mn>1</mn>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <ci>R</ci>
     <ci>S</ci>
    </apply>
    <cn type="integer">1</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   R(S)=1
  </annotation>
 </semantics>
</math>

. Thus the best bet 

<math display="inline" id="Kelly_criterion:66">
 <semantics>
  <mrow>
   <mrow>
    <mi>e</mi>
    <msub>
     <mi>r</mi>
     <mi>k</mi>
    </msub>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mi>e</mi>
    <msub>
     <mi>r</mi>
     <mn>1</mn>
    </msub>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <ci>e</ci>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>r</ci>
      <ci>k</ci>
     </apply>
    </apply>
    <apply>
     <times></times>
     <ci>e</ci>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>r</ci>
      <cn type="integer">1</cn>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   er_{k}=er_{1}
  </annotation>
 </semantics>
</math>

 will be considered first.</p>

<p>Step 4 Repeat:</p>

<p>If 

<math display="inline" id="Kelly_criterion:67">
 <semantics>
  <mrow>
   <mrow>
    <mi>e</mi>
    <msub>
     <mi>r</mi>
     <mi>k</mi>
    </msub>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mfrac>
     <mi>D</mi>
     <msub>
      <mi>β</mi>
      <mi>k</mi>
     </msub>
    </mfrac>
    <msub>
     <mi>p</mi>
     <mi>k</mi>
    </msub>
   </mrow>
   <mo>></mo>
   <mrow>
    <mi>R</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>S</mi>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <and></and>
    <apply>
     <eq></eq>
     <apply>
      <times></times>
      <ci>e</ci>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>r</ci>
       <ci>k</ci>
      </apply>
     </apply>
     <apply>
      <times></times>
      <apply>
       <divide></divide>
       <ci>D</ci>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>β</ci>
        <ci>k</ci>
       </apply>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>p</ci>
       <ci>k</ci>
      </apply>
     </apply>
    </apply>
    <apply>
     <gt></gt>
     <share href="#.cmml">
     </share>
     <apply>
      <times></times>
      <ci>R</ci>
      <ci>S</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   er_{k}=\frac{D}{\beta_{k}}p_{k}>R(S)
  </annotation>
 </semantics>
</math>

 then insert k-th outcome into the set

<math display="block" id="Kelly_criterion:68">
 <semantics>
  <mrow>
   <mi>S</mi>
   <mo>=</mo>
   <mrow>
    <mi>S</mi>
    <mo>∪</mo>
    <mrow>
     <mo stretchy="false">{</mo>
     <mi>k</mi>
     <mo stretchy="false">}</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>S</ci>
    <apply>
     <union></union>
     <ci>S</ci>
     <set>
      <ci>k</ci>
     </set>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S=S\cup\{k\}
  </annotation>
 </semantics>
</math>

, recalculate 

<math display="inline" id="Kelly_criterion:69">
 <semantics>
  <mrow>
   <mi>R</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>S</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>R</ci>
    <ci>S</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   R(S)
  </annotation>
 </semantics>
</math>

 according to the formula: 

<math display="inline" id="Kelly_criterion:70">
 <semantics>
  <mrow>
   <mrow>
    <mi>R</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>S</mi>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mfrac>
    <mrow>
     <mn>1</mn>
     <mo>-</mo>
     <mrow>
      <mstyle displaystyle="false">
       <msub>
        <mo largeop="true" symmetric="true">∑</mo>
        <mrow>
         <mi>i</mi>
         <mo>∈</mo>
         <mi>S</mi>
        </mrow>
       </msub>
      </mstyle>
      <msub>
       <mi>p</mi>
       <mi>i</mi>
      </msub>
     </mrow>
    </mrow>
    <mrow>
     <mn>1</mn>
     <mo>-</mo>
     <mrow>
      <mstyle displaystyle="false">
       <msub>
        <mo largeop="true" symmetric="true">∑</mo>
        <mrow>
         <mi>i</mi>
         <mo>∈</mo>
         <mi>S</mi>
        </mrow>
       </msub>
      </mstyle>
      <mfrac>
       <msub>
        <mi>β</mi>
        <mi>i</mi>
       </msub>
       <mi>D</mi>
      </mfrac>
     </mrow>
    </mrow>
   </mfrac>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <ci>R</ci>
     <ci>S</ci>
    </apply>
    <apply>
     <divide></divide>
     <apply>
      <minus></minus>
      <cn type="integer">1</cn>
      <apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <sum></sum>
        <apply>
         <in></in>
         <ci>i</ci>
         <ci>S</ci>
        </apply>
       </apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>p</ci>
        <ci>i</ci>
       </apply>
      </apply>
     </apply>
     <apply>
      <minus></minus>
      <cn type="integer">1</cn>
      <apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <sum></sum>
        <apply>
         <in></in>
         <ci>i</ci>
         <ci>S</ci>
        </apply>
       </apply>
       <apply>
        <divide></divide>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>β</ci>
         <ci>i</ci>
        </apply>
        <ci>D</ci>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   R(S)=\frac{1-\sum_{i\in S}{p_{i}}}{1-\sum_{i\in S}\frac{\beta_{i}}{D}}
  </annotation>
 </semantics>
</math>

 and then set 

<math display="inline" id="Kelly_criterion:71">
 <semantics>
  <mrow>
   <mi>k</mi>
   <mo>=</mo>
   <mrow>
    <mi>k</mi>
    <mo>+</mo>
    <mn>1</mn>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>k</ci>
    <apply>
     <plus></plus>
     <ci>k</ci>
     <cn type="integer">1</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   k=k+1
  </annotation>
 </semantics>
</math>

,</p>

<p>Else set 

<math display="inline" id="Kelly_criterion:72">
 <semantics>
  <mrow>
   <msup>
    <mi>S</mi>
    <mi>o</mi>
   </msup>
   <mo>=</mo>
   <mi>S</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>S</ci>
     <ci>o</ci>
    </apply>
    <ci>S</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S^{o}=S
  </annotation>
 </semantics>
</math>

 and then stop the repetition.</p>

<p>If the optimal set 

<math display="inline" id="Kelly_criterion:73">
 <semantics>
  <msup>
   <mi>S</mi>
   <mi>o</mi>
  </msup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <ci>S</ci>
    <ci>o</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S^{o}
  </annotation>
 </semantics>
</math>

 is empty then do not bet at all. If the set 

<math display="inline" id="Kelly_criterion:74">
 <semantics>
  <msup>
   <mi>S</mi>
   <mi>o</mi>
  </msup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <ci>S</ci>
    <ci>o</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S^{o}
  </annotation>
 </semantics>
</math>

 of optimal outcomes is not empty then the optimal fraction 

<math display="inline" id="Kelly_criterion:75">
 <semantics>
  <msubsup>
   <mi>f</mi>
   <mi>k</mi>
   <mi>o</mi>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>f</ci>
     <ci>o</ci>
    </apply>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f^{o}_{k}
  </annotation>
 </semantics>
</math>

 to bet on k-th outcome may be calculated from this formula

<math display="block" id="Kelly_criterion:76">
 <semantics>
  <mrow>
   <msubsup>
    <mi>f</mi>
    <mi>k</mi>
    <mi>o</mi>
   </msubsup>
   <mo>=</mo>
   <mfrac>
    <mrow>
     <mrow>
      <mi>e</mi>
      <msub>
       <mi>r</mi>
       <mi>k</mi>
      </msub>
     </mrow>
     <mo>-</mo>
     <mrow>
      <mi>R</mi>
      <mrow>
       <mo stretchy="false">(</mo>
       <msup>
        <mi>S</mi>
        <mi>o</mi>
       </msup>
       <mo stretchy="false">)</mo>
      </mrow>
     </mrow>
    </mrow>
    <mfrac>
     <mi>D</mi>
     <msub>
      <mi>β</mi>
      <mi>k</mi>
     </msub>
    </mfrac>
   </mfrac>
   <mo>=</mo>
   <mrow>
    <msub>
     <mi>p</mi>
     <mi>k</mi>
    </msub>
    <mo>-</mo>
    <mfrac>
     <mrow>
      <mi>R</mi>
      <mrow>
       <mo stretchy="false">(</mo>
       <msup>
        <mi>S</mi>
        <mi>o</mi>
       </msup>
       <mo stretchy="false">)</mo>
      </mrow>
     </mrow>
     <mfrac>
      <mi>D</mi>
      <msub>
       <mi>β</mi>
       <mi>k</mi>
      </msub>
     </mfrac>
    </mfrac>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <and></and>
    <apply>
     <eq></eq>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>f</ci>
       <ci>o</ci>
      </apply>
      <ci>k</ci>
     </apply>
     <apply>
      <divide></divide>
      <apply>
       <minus></minus>
       <apply>
        <times></times>
        <ci>e</ci>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>r</ci>
         <ci>k</ci>
        </apply>
       </apply>
       <apply>
        <times></times>
        <ci>R</ci>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>S</ci>
         <ci>o</ci>
        </apply>
       </apply>
      </apply>
      <apply>
       <divide></divide>
       <ci>D</ci>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>β</ci>
        <ci>k</ci>
       </apply>
      </apply>
     </apply>
    </apply>
    <apply>
     <eq></eq>
     <share href="#.cmml">
     </share>
     <apply>
      <minus></minus>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>p</ci>
       <ci>k</ci>
      </apply>
      <apply>
       <divide></divide>
       <apply>
        <times></times>
        <ci>R</ci>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>S</ci>
         <ci>o</ci>
        </apply>
       </apply>
       <apply>
        <divide></divide>
        <ci>D</ci>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>β</ci>
         <ci>k</ci>
        </apply>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f^{o}_{k}=\frac{er_{k}-R(S^{o})}{\frac{D}{\beta_{k}}}=p_{k}-\frac{R(S^{o})}{%
\frac{D}{\beta_{k}}}
  </annotation>
 </semantics>
</math>

.</p>

<p>One may prove<a class="footnoteRef" href="#fn19" id="fnref19"><sup>19</sup></a> that</p>

<p>

<math display="block" id="Kelly_criterion:77">
 <semantics>
  <mrow>
   <mrow>
    <mi>R</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <msup>
      <mi>S</mi>
      <mi>o</mi>
     </msup>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mn>1</mn>
    <mo>-</mo>
    <mrow>
     <munder>
      <mo largeop="true" movablelimits="false" symmetric="true">∑</mo>
      <mrow>
       <mi>i</mi>
       <mo>∈</mo>
       <msup>
        <mi>S</mi>
        <mi>o</mi>
       </msup>
      </mrow>
     </munder>
     <msubsup>
      <mi>f</mi>
      <mi>i</mi>
      <mi>o</mi>
     </msubsup>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <ci>R</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>S</ci>
      <ci>o</ci>
     </apply>
    </apply>
    <apply>
     <minus></minus>
     <cn type="integer">1</cn>
     <apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <sum></sum>
       <apply>
        <in></in>
        <ci>i</ci>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>S</ci>
         <ci>o</ci>
        </apply>
       </apply>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>f</ci>
        <ci>o</ci>
       </apply>
       <ci>i</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   R(S^{o})=1-\sum_{i\in S^{o}}{f^{o}_{i}}
  </annotation>
 </semantics>
</math>

 where the right hand-side is the reserve rate. Therefore the requirement 

<math display="inline" id="Kelly_criterion:78">
 <semantics>
  <mrow>
   <mrow>
    <mi>e</mi>
    <msub>
     <mi>r</mi>
     <mi>k</mi>
    </msub>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mfrac>
     <mi>D</mi>
     <msub>
      <mi>β</mi>
      <mi>k</mi>
     </msub>
    </mfrac>
    <msub>
     <mi>p</mi>
     <mi>k</mi>
    </msub>
   </mrow>
   <mo>></mo>
   <mrow>
    <mi>R</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>S</mi>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <and></and>
    <apply>
     <eq></eq>
     <apply>
      <times></times>
      <ci>e</ci>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>r</ci>
       <ci>k</ci>
      </apply>
     </apply>
     <apply>
      <times></times>
      <apply>
       <divide></divide>
       <ci>D</ci>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>β</ci>
        <ci>k</ci>
       </apply>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>p</ci>
       <ci>k</ci>
      </apply>
     </apply>
    </apply>
    <apply>
     <gt></gt>
     <share href="#.cmml">
     </share>
     <apply>
      <times></times>
      <ci>R</ci>
      <ci>S</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   er_{k}=\frac{D}{\beta_{k}}p_{k}>R(S)
  </annotation>
 </semantics>
</math>

 may be interpreted<a class="footnoteRef" href="#fn20" id="fnref20"><sup>20</sup></a> as follows: k-th outcome is included in the set 

<math display="inline" id="Kelly_criterion:79">
 <semantics>
  <msup>
   <mi>S</mi>
   <mi>o</mi>
  </msup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <ci>S</ci>
    <ci>o</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S^{o}
  </annotation>
 </semantics>
</math>

 of optimal outcomes if and only if its expected revenue rate is greater than the reserve rate. The formula for the optimal fraction 

<math display="inline" id="Kelly_criterion:80">
 <semantics>
  <msubsup>
   <mi>f</mi>
   <mi>k</mi>
   <mi>o</mi>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>f</ci>
     <ci>o</ci>
    </apply>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   f^{o}_{k}
  </annotation>
 </semantics>
</math>

 may be interpreted as the excess of the expected revenue rate of k-th horse over the reserve rate divided by the revenue after deduction of the track take when k-th horse wins or as the excess of the probability of k-th horse winning over the reserve rate divided by revenue after deduction of the track take when k-th horse wins. The binary growth exponent is</p>

<p>

<math display="block" id="Kelly_criterion:81">
 <semantics>
  <mrow>
   <mrow>
    <msup>
     <mi>G</mi>
     <mi>o</mi>
    </msup>
    <mo>=</mo>
    <mrow>
     <mrow>
      <munder>
       <mo largeop="true" movablelimits="false" symmetric="true">∑</mo>
       <mrow>
        <mi>i</mi>
        <mo>∈</mo>
        <mi>S</mi>
       </mrow>
      </munder>
      <mrow>
       <msub>
        <mi>p</mi>
        <mi>i</mi>
       </msub>
       <mrow>
        <msub>
         <mi>log</mi>
         <mn>2</mn>
        </msub>
        <mrow>
         <mo stretchy="false">(</mo>
         <mrow>
          <mi>e</mi>
          <msub>
           <mi>r</mi>
           <mi>i</mi>
          </msub>
         </mrow>
         <mo stretchy="false">)</mo>
        </mrow>
       </mrow>
      </mrow>
     </mrow>
     <mo>+</mo>
     <mrow>
      <mrow>
       <mo stretchy="false">(</mo>
       <mrow>
        <mn>1</mn>
        <mo>-</mo>
        <mrow>
         <munder>
          <mo largeop="true" movablelimits="false" symmetric="true">∑</mo>
          <mrow>
           <mi>i</mi>
           <mo>∈</mo>
           <mi>S</mi>
          </mrow>
         </munder>
         <msub>
          <mi>p</mi>
          <mi>i</mi>
         </msub>
        </mrow>
       </mrow>
       <mo stretchy="false">)</mo>
      </mrow>
      <mrow>
       <msub>
        <mi>log</mi>
        <mn>2</mn>
       </msub>
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mi>R</mi>
         <mrow>
          <mo stretchy="false">(</mo>
          <msup>
           <mi>S</mi>
           <mi>o</mi>
          </msup>
          <mo stretchy="false">)</mo>
         </mrow>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
      </mrow>
     </mrow>
    </mrow>
   </mrow>
   <mo>,</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>G</ci>
     <ci>o</ci>
    </apply>
    <apply>
     <plus></plus>
     <apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <sum></sum>
       <apply>
        <in></in>
        <ci>i</ci>
        <ci>S</ci>
       </apply>
      </apply>
      <apply>
       <times></times>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>p</ci>
        <ci>i</ci>
       </apply>
       <apply>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <log></log>
         <cn type="integer">2</cn>
        </apply>
        <apply>
         <times></times>
         <ci>e</ci>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>r</ci>
          <ci>i</ci>
         </apply>
        </apply>
       </apply>
      </apply>
     </apply>
     <apply>
      <times></times>
      <apply>
       <minus></minus>
       <cn type="integer">1</cn>
       <apply>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <sum></sum>
         <apply>
          <in></in>
          <ci>i</ci>
          <ci>S</ci>
         </apply>
        </apply>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>p</ci>
         <ci>i</ci>
        </apply>
       </apply>
      </apply>
      <apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <log></log>
        <cn type="integer">2</cn>
       </apply>
       <apply>
        <times></times>
        <ci>R</ci>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>S</ci>
         <ci>o</ci>
        </apply>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   G^{o}=\sum_{i\in S}{p_{i}\log_{2}{(er_{i})}}+(1-\sum_{i\in S}{p_{i}})\log_{2}{%
(R(S^{o}))},
  </annotation>
 </semantics>
</math>

 and the doubling time is</p>

<p>

<math display="block" id="Kelly_criterion:82">
 <semantics>
  <mrow>
   <mrow>
    <msub>
     <mi>T</mi>
     <mi>d</mi>
    </msub>
    <mo>=</mo>
    <mfrac>
     <mn>1</mn>
     <msup>
      <mi>G</mi>
      <mi>o</mi>
     </msup>
    </mfrac>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>T</ci>
     <ci>d</ci>
    </apply>
    <apply>
     <divide></divide>
     <cn type="integer">1</cn>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>G</ci>
      <ci>o</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   T_{d}=\frac{1}{G^{o}}.
  </annotation>
 </semantics>
</math>

</p>

<p>This method of selection of optimal bets may be applied also when probabilities 

<math display="inline" id="Kelly_criterion:83">
 <semantics>
  <msub>
   <mi>p</mi>
   <mi>k</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>p</ci>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   p_{k}
  </annotation>
 </semantics>
</math>

 are known only for several most promising outcomes, while the remaining outcomes have no chance to win. In this case it must be that 

<math display="inline" id="Kelly_criterion:84">
 <semantics>
  <mrow>
   <mrow>
    <msub>
     <mo largeop="true" symmetric="true">∑</mo>
     <mi>i</mi>
    </msub>
    <msub>
     <mi>p</mi>
     <mi>i</mi>
    </msub>
   </mrow>
   <mo><</mo>
   <mn>1</mn>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <lt></lt>
    <apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <sum></sum>
      <ci>i</ci>
     </apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>p</ci>
      <ci>i</ci>
     </apply>
    </apply>
    <cn type="integer">1</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \sum_{i}{p_{i}}<1
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="Kelly_criterion:85">
 <semantics>
  <mrow>
   <mrow>
    <msub>
     <mo largeop="true" symmetric="true">∑</mo>
     <mi>i</mi>
    </msub>
    <msub>
     <mi>β</mi>
     <mi>i</mi>
    </msub>
   </mrow>
   <mo><</mo>
   <mn>1</mn>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <lt></lt>
    <apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <sum></sum>
      <ci>i</ci>
     </apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>β</ci>
      <ci>i</ci>
     </apply>
    </apply>
    <cn type="integer">1</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \sum_{i}{\beta_{i}}<1
  </annotation>
 </semantics>
</math>

.</p>
<h2 id="application-to-the-stock-market">Application to the stock market</h2>

<p>Consider a market with 

<math display="inline" id="Kelly_criterion:86">
 <semantics>
  <mi>n</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>n</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   n
  </annotation>
 </semantics>
</math>

 correlated stocks 

<math display="inline" id="Kelly_criterion:87">
 <semantics>
  <msub>
   <mi>S</mi>
   <mi>k</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>S</ci>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S_{k}
  </annotation>
 </semantics>
</math>

 with stochastic returns 

<math display="inline" id="Kelly_criterion:88">
 <semantics>
  <msub>
   <mi>r</mi>
   <mi>k</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>r</ci>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   r_{k}
  </annotation>
 </semantics>
</math>

, 

<math display="inline" id="Kelly_criterion:89">
 <semantics>
  <mrow>
   <mi>k</mi>
   <mo>=</mo>
   <mrow>
    <mn>1</mn>
    <mo>,</mo>
    <mi mathvariant="normal">…</mi>
    <mo>,</mo>
    <mi>n</mi>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>k</ci>
    <list>
     <cn type="integer">1</cn>
     <ci>normal-…</ci>
     <ci>n</ci>
    </list>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   k=1,...,n
  </annotation>
 </semantics>
</math>

 and a riskless bond with return 

<math display="inline" id="Kelly_criterion:90">
 <semantics>
  <mi>r</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>r</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   r
  </annotation>
 </semantics>
</math>

. An investor puts a fraction 

<math display="inline" id="Kelly_criterion:91">
 <semantics>
  <msub>
   <mi>u</mi>
   <mi>k</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>u</ci>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   u_{k}
  </annotation>
 </semantics>
</math>

 of his capital in 

<math display="inline" id="Kelly_criterion:92">
 <semantics>
  <msub>
   <mi>S</mi>
   <mi>k</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>S</ci>
    <ci>k</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S_{k}
  </annotation>
 </semantics>
</math>

 and the rest is invested in bond. Without loss of generality, assume that investor's starting capital is equal to 1. According to Kelly criterion one should maximize 

<math display="inline" id="Kelly_criterion:93">
 <semantics>
  <mrow>
   <mi>𝔼</mi>
   <mrow>
    <mo>[</mo>
    <mrow>
     <mi>ln</mi>
     <mrow>
      <mo>(</mo>
      <mrow>
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mn>1</mn>
         <mo>+</mo>
         <mi>r</mi>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
       <mo>+</mo>
       <mrow>
        <munderover>
         <mo largeop="true" movablelimits="false" symmetric="true">∑</mo>
         <mrow>
          <mi>k</mi>
          <mo>=</mo>
          <mn>1</mn>
         </mrow>
         <mi>n</mi>
        </munderover>
        <mrow>
         <msub>
          <mi>u</mi>
          <mi>k</mi>
         </msub>
         <mrow>
          <mo stretchy="false">(</mo>
          <mrow>
           <msub>
            <mi>r</mi>
            <mi>k</mi>
           </msub>
           <mo>-</mo>
           <mi>r</mi>
          </mrow>
          <mo stretchy="false">)</mo>
         </mrow>
        </mrow>
       </mrow>
      </mrow>
      <mo>)</mo>
     </mrow>
    </mrow>
    <mo>]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>𝔼</ci>
    <apply>
     <csymbol cd="latexml">delimited-[]</csymbol>
     <apply>
      <ln></ln>
      <apply>
       <plus></plus>
       <apply>
        <plus></plus>
        <cn type="integer">1</cn>
        <ci>r</ci>
       </apply>
       <apply>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <sum></sum>
          <apply>
           <eq></eq>
           <ci>k</ci>
           <cn type="integer">1</cn>
          </apply>
         </apply>
         <ci>n</ci>
        </apply>
        <apply>
         <times></times>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>u</ci>
          <ci>k</ci>
         </apply>
         <apply>
          <minus></minus>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>r</ci>
           <ci>k</ci>
          </apply>
          <ci>r</ci>
         </apply>
        </apply>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbb{E}\left[\ln\left((1+r)+\sum\limits_{k=1}^{n}u_{k}(r_{k}-r)\right)\right]
  </annotation>
 </semantics>
</math>

<br/>
Expanding it to the Taylor series around 

<math display="inline" id="Kelly_criterion:94">
 <semantics>
  <mrow>
   <mover accent="true">
    <msub>
     <mi>u</mi>
     <mn>0</mn>
    </msub>
    <mo stretchy="false">→</mo>
   </mover>
   <mo>=</mo>
   <mrow>
    <mo stretchy="false">(</mo>
    <mn>0</mn>
    <mo>,</mo>
    <mi mathvariant="normal">…</mi>
    <mo>,</mo>
    <mn>0</mn>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <ci>normal-→</ci>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>u</ci>
      <cn type="integer">0</cn>
     </apply>
    </apply>
    <vector>
     <cn type="integer">0</cn>
     <ci>normal-…</ci>
     <cn type="integer">0</cn>
    </vector>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \vec{u_{0}}=(0,\ldots,0)
  </annotation>
 </semantics>
</math>

 we obtain<br/>


<math display="inline" id="Kelly_criterion:95">
 <semantics>
  <mrow>
   <mi>𝔼</mi>
   <mrow>
    <mo>[</mo>
    <mrow>
     <mrow>
      <mrow>
       <mi>ln</mi>
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mn>1</mn>
         <mo>+</mo>
         <mi>r</mi>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
      </mrow>
      <mo>+</mo>
      <mrow>
       <munderover>
        <mo largeop="true" movablelimits="false" symmetric="true">∑</mo>
        <mrow>
         <mi>k</mi>
         <mo>=</mo>
         <mn>1</mn>
        </mrow>
        <mi>n</mi>
       </munderover>
       <mfrac>
        <mrow>
         <msub>
          <mi>u</mi>
          <mi>k</mi>
         </msub>
         <mrow>
          <mo stretchy="false">(</mo>
          <mrow>
           <msub>
            <mi>r</mi>
            <mi>k</mi>
           </msub>
           <mo>-</mo>
           <mi>r</mi>
          </mrow>
          <mo stretchy="false">)</mo>
         </mrow>
        </mrow>
        <mrow>
         <mn>1</mn>
         <mo>+</mo>
         <mi>r</mi>
        </mrow>
       </mfrac>
      </mrow>
     </mrow>
     <mo>-</mo>
     <mrow>
      <mfrac>
       <mn>1</mn>
       <mn>2</mn>
      </mfrac>
      <mrow>
       <munderover>
        <mo largeop="true" movablelimits="false" symmetric="true">∑</mo>
        <mrow>
         <mi>k</mi>
         <mo>=</mo>
         <mn>1</mn>
        </mrow>
        <mi>n</mi>
       </munderover>
       <mrow>
        <munderover>
         <mo largeop="true" movablelimits="false" symmetric="true">∑</mo>
         <mrow>
          <mi>j</mi>
          <mo>=</mo>
          <mn>1</mn>
         </mrow>
         <mi>n</mi>
        </munderover>
        <mrow>
         <msub>
          <mi>u</mi>
          <mi>k</mi>
         </msub>
         <msub>
          <mi>u</mi>
          <mi>j</mi>
         </msub>
         <mfrac>
          <mrow>
           <mrow>
            <mo stretchy="false">(</mo>
            <mrow>
             <msub>
              <mi>r</mi>
              <mi>k</mi>
             </msub>
             <mo>-</mo>
             <mi>r</mi>
            </mrow>
            <mo stretchy="false">)</mo>
           </mrow>
           <mrow>
            <mo stretchy="false">(</mo>
            <mrow>
             <msub>
              <mi>r</mi>
              <mi>j</mi>
             </msub>
             <mo>-</mo>
             <mi>r</mi>
            </mrow>
            <mo stretchy="false">)</mo>
           </mrow>
          </mrow>
          <msup>
           <mrow>
            <mo stretchy="false">(</mo>
            <mrow>
             <mn>1</mn>
             <mo>+</mo>
             <mi>r</mi>
            </mrow>
            <mo stretchy="false">)</mo>
           </mrow>
           <mn>2</mn>
          </msup>
         </mfrac>
        </mrow>
       </mrow>
      </mrow>
     </mrow>
    </mrow>
    <mo>]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>𝔼</ci>
    <apply>
     <csymbol cd="latexml">delimited-[]</csymbol>
     <apply>
      <minus></minus>
      <apply>
       <plus></plus>
       <apply>
        <ln></ln>
        <apply>
         <plus></plus>
         <cn type="integer">1</cn>
         <ci>r</ci>
        </apply>
       </apply>
       <apply>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <sum></sum>
          <apply>
           <eq></eq>
           <ci>k</ci>
           <cn type="integer">1</cn>
          </apply>
         </apply>
         <ci>n</ci>
        </apply>
        <apply>
         <divide></divide>
         <apply>
          <times></times>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>u</ci>
           <ci>k</ci>
          </apply>
          <apply>
           <minus></minus>
           <apply>
            <csymbol cd="ambiguous">subscript</csymbol>
            <ci>r</ci>
            <ci>k</ci>
           </apply>
           <ci>r</ci>
          </apply>
         </apply>
         <apply>
          <plus></plus>
          <cn type="integer">1</cn>
          <ci>r</ci>
         </apply>
        </apply>
       </apply>
      </apply>
      <apply>
       <times></times>
       <apply>
        <divide></divide>
        <cn type="integer">1</cn>
        <cn type="integer">2</cn>
       </apply>
       <apply>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <sum></sum>
          <apply>
           <eq></eq>
           <ci>k</ci>
           <cn type="integer">1</cn>
          </apply>
         </apply>
         <ci>n</ci>
        </apply>
        <apply>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <sum></sum>
           <apply>
            <eq></eq>
            <ci>j</ci>
            <cn type="integer">1</cn>
           </apply>
          </apply>
          <ci>n</ci>
         </apply>
         <apply>
          <times></times>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>u</ci>
           <ci>k</ci>
          </apply>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>u</ci>
           <ci>j</ci>
          </apply>
          <apply>
           <divide></divide>
           <apply>
            <times></times>
            <apply>
             <minus></minus>
             <apply>
              <csymbol cd="ambiguous">subscript</csymbol>
              <ci>r</ci>
              <ci>k</ci>
             </apply>
             <ci>r</ci>
            </apply>
            <apply>
             <minus></minus>
             <apply>
              <csymbol cd="ambiguous">subscript</csymbol>
              <ci>r</ci>
              <ci>j</ci>
             </apply>
             <ci>r</ci>
            </apply>
           </apply>
           <apply>
            <csymbol cd="ambiguous">superscript</csymbol>
            <apply>
             <plus></plus>
             <cn type="integer">1</cn>
             <ci>r</ci>
            </apply>
            <cn type="integer">2</cn>
           </apply>
          </apply>
         </apply>
        </apply>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbb{E}\left[\ln(1+r)+\sum\limits_{k=1}^{n}\frac{u_{k}(r_{k}-r)}{1+r}-\frac%
{1}{2}\sum\limits_{k=1}^{n}\sum\limits_{j=1}^{n}u_{k}u_{j}\frac{(r_{k}-r)(r_{j%
}-r)}{(1+r)^{2}}\right]
  </annotation>
 </semantics>
</math>

<br/>
Thus we reduce the optimization problem to <a href="quadratic_programming" title="wikilink">quadratic programming</a> and the unconstrained solution is 

<math display="inline" id="Kelly_criterion:96">
 <semantics>
  <mrow>
   <mover accent="true">
    <msup>
     <mi>u</mi>
     <mo>⋆</mo>
    </msup>
    <mo stretchy="false">→</mo>
   </mover>
   <mo>=</mo>
   <mrow>
    <mrow>
     <mo stretchy="false">(</mo>
     <mrow>
      <mn>1</mn>
      <mo>+</mo>
      <mi>r</mi>
     </mrow>
     <mo stretchy="false">)</mo>
    </mrow>
    <msup>
     <mrow>
      <mo stretchy="false">(</mo>
      <mover accent="true">
       <mi mathvariant="normal">Σ</mi>
       <mo>^</mo>
      </mover>
      <mo stretchy="false">)</mo>
     </mrow>
     <mrow>
      <mo>-</mo>
      <mn>1</mn>
     </mrow>
    </msup>
    <mrow>
     <mo stretchy="false">(</mo>
     <mrow>
      <mover accent="true">
       <mover accent="true">
        <mi>r</mi>
        <mo stretchy="false">→</mo>
       </mover>
       <mo>^</mo>
      </mover>
      <mo>-</mo>
      <mi>r</mi>
     </mrow>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <ci>normal-→</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>u</ci>
      <ci>normal-⋆</ci>
     </apply>
    </apply>
    <apply>
     <times></times>
     <apply>
      <plus></plus>
      <cn type="integer">1</cn>
      <ci>r</ci>
     </apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <ci>normal-^</ci>
       <ci>normal-Σ</ci>
      </apply>
      <apply>
       <minus></minus>
       <cn type="integer">1</cn>
      </apply>
     </apply>
     <apply>
      <minus></minus>
      <apply>
       <ci>normal-^</ci>
       <apply>
        <ci>normal-→</ci>
        <ci>r</ci>
       </apply>
      </apply>
      <ci>r</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \vec{u^{\star}}=(1+r)(\widehat{\Sigma})^{-1}(\widehat{\vec{r}}-r)
  </annotation>
 </semantics>
</math>

<br/>
where 

<math display="inline" id="Kelly_criterion:97">
 <semantics>
  <mover accent="true">
   <mover accent="true">
    <mi>r</mi>
    <mo stretchy="false">→</mo>
   </mover>
   <mo>^</mo>
  </mover>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-^</ci>
    <apply>
     <ci>normal-→</ci>
     <ci>r</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \widehat{\vec{r}}
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="Kelly_criterion:98">
 <semantics>
  <mover accent="true">
   <mi mathvariant="normal">Σ</mi>
   <mo>^</mo>
  </mover>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-^</ci>
    <ci>normal-Σ</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \widehat{\Sigma}
  </annotation>
 </semantics>
</math>

 are the vector of means and the matrix of second mixed noncentral moments of the excess returns.<a class="footnoteRef" href="#fn21" id="fnref21"><sup>21</sup></a> There are also numerical algorithms for the fractional Kelly strategies and for the optimal solution under no leverage and no short selling constraints.</p>
<h2 id="see-also">See also</h2>
<ul>
<li><a href="Risk_of_ruin" title="wikilink">Risk of ruin</a></li>
<li><a href="Gambling_and_information_theory" title="wikilink">Gambling and information theory</a></li>
<li><a href="Proebsting's_paradox" title="wikilink">Proebsting's paradox</a></li>
</ul>
<h2 id="references">References</h2>
<h2 id="external-links">External links</h2>

<p><a href="bg:Критерий_на_Кели" title="wikilink">bg:Критерий на Кели</a> <a href="ru:Критерий_Келли" title="wikilink">ru:Критерий Келли</a>"</p>

<p><a href="Category:Decision_theory" title="wikilink">Category:Decision theory</a> <a href="Category:Games_(probability)" title="wikilink">Category:Games (probability)</a> <a href="Category:Information_theory" title="wikilink">Category:Information theory</a> <a class="uri" href="Category:Wagering" title="wikilink">Category:Wagering</a> <a href="Category:Articles_containing_proofs" title="wikilink">Category:Articles containing proofs</a> <a href="Category:1956_introductions" title="wikilink">Category:1956 introductions</a></p>
<section class="footnotes">
<hr/>
<ol>
<li id="fn1"><a href="#fnref1">↩</a></li>
<li id="fn2"><a href="#fnref2">↩</a></li>
<li id="fn3"><a href="#fnref3">↩</a></li>
<li id="fn4"><a href="#fnref4">↩</a></li>
<li id="fn5"><a href="#fnref5">↩</a></li>
<li id="fn6"><a href="#fnref6">↩</a></li>
<li id="fn7"><a href="#fnref7">↩</a></li>
<li id="fn8"><a href="#fnref8">↩</a></li>
<li id="fn9"><a href="#fnref9">↩</a></li>
<li id="fn10"><a href="#fnref10">↩</a></li>
<li id="fn11"></li>
<li id="fn12"><a href="#fnref12">↩</a></li>
<li id="fn13"></li>
<li id="fn14"><a href="#fnref14">↩</a></li>
<li id="fn15"></li>
<li id="fn16"><a href="#fnref16">↩</a></li>
<li id="fn17">Smoczynski, Peter; Tomkins, Dave (2010) "An explicit solution to the problem of optimizing the allocations of a bettor’s wealth when wagering on horse races", Mathematical Scientist", 35 (1), 10-17<a href="#fnref17">↩</a></li>
<li id="fn18"></li>
<li id="fn19"></li>
<li id="fn20"></li>
<li id="fn21"><a href="http://papers.ssrn.com/sol3/papers.cfm?abstract_id=2259133">Nekrasov, Vasily(2013) "Kelly Criterion for Multivariate Portfolios: A Model-Free Approach"</a><a href="#fnref21">↩</a></li>
</ol>
</section>
</body>

