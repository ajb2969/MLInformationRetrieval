<html lang="en">
<head>
<meta charset="utf-8"/>
<title offset="1274">Convolution for optical broad-beam responses in scattering media</title>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG.js" type="text/javascript">
</script>
</head>
<body>
<h1>Convolution for optical broad-beam responses in scattering media</h1>
<hr/>

<p>Photon transport theories, such as the <a href="Monte_Carlo_methods" title="wikilink">Monte Carlo method</a>, are commonly used to model <a href="Monte_Carlo_method_for_photon_transport" title="wikilink">light propagation in tissue</a>. The responses to a <a href="pencil_beam" title="wikilink">pencil beam</a> incident on a scattering medium are referred to as <a href="Green's_function" title="wikilink">Green's functions</a> or <a href="impulse_response" title="wikilink">impulse responses</a>. Photon transport methods can be directly used to compute broad-beam responses by distributing photons over the cross section of the beam. However, <a class="uri" href="convolution" title="wikilink">convolution</a> can be used in certain cases to improve computational efficiency.</p>
<h2 id="general-convolution-formulas">General convolution formulas</h2>

<p>In order for convolution to be used to calculate a broad-beam response, a system must be <a href="time-invariant_system" title="wikilink">time invariant</a>, <a class="uri" href="linear" title="wikilink">linear</a>, and <a href="Translational_symmetry" title="wikilink">translation invariant</a>. Time invariance implies that a photon beam delayed by a given time produces a response shifted by the same delay. Linearity indicates that a given response will increase by the same amount if the input is scaled and obeys the property of <a href="Superposition_principle" title="wikilink">superposition</a>. Translational invariance means that if a beam is shifted to a new location on the tissue surface, its response is also shifted in the same direction by the same distance. Here, only spatial convolution is considered.</p>

<p>Responses from photon transport methods can be physical quantities such as <a href="Absorption_(electromagnetic_radiation)" title="wikilink">absorption</a>, <a class="uri" href="fluence" title="wikilink">fluence</a>, <a class="uri" href="reflectance" title="wikilink">reflectance</a>, or <a class="uri" href="transmittance" title="wikilink">transmittance</a>. Given a specific physical quantity, <em>G(x,y,z)</em>, from a pencil beam in Cartesian space and a collimated light source with beam profile <em>S(x,y)</em>, a broad-beam response can be calculated using the following 2-D convolution formula:</p>

<p>

<math display="block" id="Convolution_for_optical_broad-beam_responses_in_scattering_media:0">
 <semantics>
  <mrow>
   <mi>C</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>x</mi>
    <mo>,</mo>
    <mi>y</mi>
    <mo>,</mo>
    <mi>z</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>=</mo>
   <msubsup>
    <mo largeop="true" symmetric="true">∫</mo>
    <mrow>
     <mo>-</mo>
     <mi mathvariant="normal">∞</mi>
    </mrow>
    <mi mathvariant="normal">∞</mi>
   </msubsup>
   <mpadded width="+5pt">
    <msubsup>
     <mo largeop="true" symmetric="true">∫</mo>
     <mrow>
      <mo>-</mo>
      <mi mathvariant="normal">∞</mi>
     </mrow>
     <mi mathvariant="normal">∞</mi>
    </msubsup>
   </mpadded>
   <mi>G</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>x</mi>
    <mo>-</mo>
    <msup>
     <mi>x</mi>
     <mo>′</mo>
    </msup>
    <mo>,</mo>
    <mi>y</mi>
    <mo>-</mo>
    <msup>
     <mi>y</mi>
     <mo>′</mo>
    </msup>
    <mo>,</mo>
    <mi>z</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mi>S</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <msup>
     <mi>x</mi>
     <mo>′</mo>
    </msup>
    <mo>,</mo>
    <msup>
     <mi>y</mi>
     <mo>′</mo>
    </msup>
    <mo rspace="4.2pt" stretchy="false">)</mo>
   </mrow>
   <mi>d</mi>
   <mpadded width="+1.7pt">
    <msup>
     <mi>x</mi>
     <mo>′</mo>
    </msup>
   </mpadded>
   <mi>d</mi>
   <msup>
    <mi>y</mi>
    <mo>′</mo>
   </msup>
   <mo>.</mo>
   <mrow>
    <mo stretchy="false">(</mo>
    <mn>1</mn>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">C</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">x</csymbol>
     <ci>normal-,</ci>
     <csymbol cd="unknown">y</csymbol>
     <ci>normal-,</ci>
     <csymbol cd="unknown">z</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <int></int>
      <apply>
       <minus></minus>
       <infinity></infinity>
      </apply>
     </apply>
     <infinity></infinity>
    </apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <int></int>
      <apply>
       <minus></minus>
       <infinity></infinity>
      </apply>
     </apply>
     <infinity></infinity>
    </apply>
    <csymbol cd="unknown">G</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">x</csymbol>
     <minus></minus>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>x</ci>
      <ci>normal-′</ci>
     </apply>
     <ci>normal-,</ci>
     <csymbol cd="unknown">y</csymbol>
     <minus></minus>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>y</ci>
      <ci>normal-′</ci>
     </apply>
     <ci>normal-,</ci>
     <csymbol cd="unknown">z</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <csymbol cd="unknown">S</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>x</ci>
      <ci>normal-′</ci>
     </apply>
     <ci>normal-,</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>y</ci>
      <ci>normal-′</ci>
     </apply>
     <ci>normal-)</ci>
    </cerror>
    <csymbol cd="unknown">d</csymbol>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>x</ci>
     <ci>normal-′</ci>
    </apply>
    <csymbol cd="unknown">d</csymbol>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>y</ci>
     <ci>normal-′</ci>
    </apply>
    <ci>normal-.</ci>
    <ci>italic-</ci>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <cn type="integer">1</cn>
     <ci>normal-)</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C(x,y,z)=\int_{-\infty}^{\infty}\int_{-\infty}^{\infty}\ G(x-x^{\prime},y-y^{%
\prime},z)S(x^{\prime},y^{\prime})\,dx^{\prime}\,dy^{\prime}.\qquad(1)
  </annotation>
 </semantics>
</math>

</p>

<p>Similar to 1-D convolution, 2-D convolution is commutative between <em>G</em> and <em>S</em> with a change of variables <small>

<math display="inline" id="Convolution_for_optical_broad-beam_responses_in_scattering_media:1">
 <semantics>
  <mrow>
   <msup>
    <mi>x</mi>
    <mi>′′</mi>
   </msup>
   <mo>=</mo>
   <mrow>
    <mi>x</mi>
    <mo>-</mo>
    <mpadded width="+1.7pt">
     <msup>
      <mi>x</mi>
      <mo>′</mo>
     </msup>
    </mpadded>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>x</ci>
     <ci>′′</ci>
    </apply>
    <apply>
     <minus></minus>
     <ci>x</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>x</ci>
      <ci>normal-′</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   x^{\prime\prime}=x-x^{\prime}\,
  </annotation>
 </semantics>
</math>

</small> and <small>

<math display="inline" id="Convolution_for_optical_broad-beam_responses_in_scattering_media:2">
 <semantics>
  <mrow>
   <msup>
    <mi>y</mi>
    <mi>′′</mi>
   </msup>
   <mo>=</mo>
   <mrow>
    <mi>y</mi>
    <mo>-</mo>
    <mpadded width="+1.7pt">
     <msup>
      <mi>y</mi>
      <mo>′</mo>
     </msup>
    </mpadded>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>y</ci>
     <ci>′′</ci>
    </apply>
    <apply>
     <minus></minus>
     <ci>y</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>y</ci>
      <ci>normal-′</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   y^{\prime\prime}=y-y^{\prime}\,
  </annotation>
 </semantics>
</math>

</small>:</p>

<p>

<math display="block" id="Convolution_for_optical_broad-beam_responses_in_scattering_media:3">
 <semantics>
  <mrow>
   <mi>C</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>x</mi>
    <mo>,</mo>
    <mi>y</mi>
    <mo>,</mo>
    <mi>z</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>=</mo>
   <mpadded width="-1.7pt">
    <msubsup>
     <mo largeop="true" symmetric="true">∫</mo>
     <mrow>
      <mo>-</mo>
      <mi mathvariant="normal">∞</mi>
     </mrow>
     <mi mathvariant="normal">∞</mi>
    </msubsup>
   </mpadded>
   <mpadded width="+5pt">
    <msubsup>
     <mo largeop="true" symmetric="true">∫</mo>
     <mrow>
      <mo>-</mo>
      <mi mathvariant="normal">∞</mi>
     </mrow>
     <mi mathvariant="normal">∞</mi>
    </msubsup>
   </mpadded>
   <mi>G</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <msup>
     <mi>x</mi>
     <mi>′′</mi>
    </msup>
    <mo>,</mo>
    <msup>
     <mi>y</mi>
     <mi>′′</mi>
    </msup>
    <mo>,</mo>
    <mi>z</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mi>S</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>x</mi>
    <mo>-</mo>
    <msup>
     <mi>x</mi>
     <mi>′′</mi>
    </msup>
    <mo>,</mo>
    <mi>y</mi>
    <mo>-</mo>
    <msup>
     <mi>y</mi>
     <mi>′′</mi>
    </msup>
    <mo rspace="4.2pt" stretchy="false">)</mo>
   </mrow>
   <mi>d</mi>
   <mpadded width="+1.7pt">
    <msup>
     <mi>x</mi>
     <mi>′′</mi>
    </msup>
   </mpadded>
   <mi>d</mi>
   <msup>
    <mi>y</mi>
    <mi>′′</mi>
   </msup>
   <mo>.</mo>
   <mrow>
    <mo stretchy="false">(</mo>
    <mn>2</mn>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">C</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">x</csymbol>
     <ci>normal-,</ci>
     <csymbol cd="unknown">y</csymbol>
     <ci>normal-,</ci>
     <csymbol cd="unknown">z</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <int></int>
      <apply>
       <minus></minus>
       <infinity></infinity>
      </apply>
     </apply>
     <infinity></infinity>
    </apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <int></int>
      <apply>
       <minus></minus>
       <infinity></infinity>
      </apply>
     </apply>
     <infinity></infinity>
    </apply>
    <csymbol cd="unknown">G</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>x</ci>
      <ci>′′</ci>
     </apply>
     <ci>normal-,</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>y</ci>
      <ci>′′</ci>
     </apply>
     <ci>normal-,</ci>
     <csymbol cd="unknown">z</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <csymbol cd="unknown">S</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">x</csymbol>
     <minus></minus>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>x</ci>
      <ci>′′</ci>
     </apply>
     <ci>normal-,</ci>
     <csymbol cd="unknown">y</csymbol>
     <minus></minus>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>y</ci>
      <ci>′′</ci>
     </apply>
     <ci>normal-)</ci>
    </cerror>
    <csymbol cd="unknown">d</csymbol>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>x</ci>
     <ci>′′</ci>
    </apply>
    <csymbol cd="unknown">d</csymbol>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>y</ci>
     <ci>′′</ci>
    </apply>
    <ci>normal-.</ci>
    <ci>italic-</ci>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <cn type="integer">2</cn>
     <ci>normal-)</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C(x,y,z)=\int_{-\infty}^{\infty}\!\int_{-\infty}^{\infty}\ G(x^{\prime\prime},%
y^{\prime\prime},z)S(x-x^{\prime\prime},y-y^{\prime\prime})\,dx^{\prime\prime}%
\,dy^{\prime\prime}.\qquad(2)
  </annotation>
 </semantics>
</math>

</p>

<p>Because the broad-beam response 

<math display="inline" id="Convolution_for_optical_broad-beam_responses_in_scattering_media:4">
 <semantics>
  <mrow>
   <mi>C</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>x</mi>
    <mo>,</mo>
    <mi>y</mi>
    <mo>,</mo>
    <mi>z</mi>
    <mo rspace="4.2pt" stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>C</ci>
    <vector>
     <ci>x</ci>
     <ci>y</ci>
     <ci>z</ci>
    </vector>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C(x,y,z)\,
  </annotation>
 </semantics>
</math>

 has cylindrical symmetry, its convolution integrals can be rewritten as:</p>

<p>

<math display="block" id="Convolution_for_optical_broad-beam_responses_in_scattering_media:5">
 <semantics>
  <mrow>
   <mrow>
    <mi>C</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>r</mi>
     <mo>,</mo>
     <mi>z</mi>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mrow>
     <mpadded width="+5pt">
      <msubsup>
       <mo largeop="true" symmetric="true">∫</mo>
       <mn>0</mn>
       <mi mathvariant="normal">∞</mi>
      </msubsup>
     </mpadded>
     <mrow>
      <mi>S</mi>
      <mrow>
       <mo stretchy="false">(</mo>
       <msup>
        <mi>r</mi>
        <mo>′</mo>
       </msup>
       <mo stretchy="false">)</mo>
      </mrow>
      <msup>
       <mi>r</mi>
       <mo>′</mo>
      </msup>
      <mrow>
       <mo>[</mo>
       <mrow>
        <mpadded width="+5pt">
         <msubsup>
          <mo largeop="true" symmetric="true">∫</mo>
          <mn>0</mn>
          <mrow>
           <mn>2</mn>
           <mi>π</mi>
          </mrow>
         </msubsup>
        </mpadded>
        <mrow>
         <mi>G</mi>
         <mrow>
          <mo>(</mo>
          <msqrt>
           <mrow>
            <msup>
             <mi>r</mi>
             <mn>2</mn>
            </msup>
            <mo>+</mo>
            <mpadded width="+1.7pt">
             <msup>
              <mi>r</mi>
              <mo>′</mo>
             </msup>
            </mpadded>
            <mmultiscripts>
             <mo>-</mo>
             <mprescripts></mprescripts>
             <none></none>
             <mn>2</mn>
            </mmultiscripts>
            <mn>2</mn>
            <mi>r</mi>
            <msup>
             <mi>r</mi>
             <mo>′</mo>
            </msup>
            <mi>c</mi>
            <mi>o</mi>
            <mi>s</mi>
            <msup>
             <mi>ϕ</mi>
             <mo>′</mo>
            </msup>
           </mrow>
          </msqrt>
          <mo>,</mo>
          <mi>z</mi>
          <mo rspace="4.2pt">)</mo>
         </mrow>
         <mi>d</mi>
         <msup>
          <mi>ϕ</mi>
          <mo>′</mo>
         </msup>
        </mrow>
       </mrow>
       <mo>]</mo>
      </mrow>
      <mi>d</mi>
      <msup>
       <mi>r</mi>
       <mo>′</mo>
      </msup>
     </mrow>
    </mrow>
    <mrow>
     <mo stretchy="false">(</mo>
     <mn>3</mn>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <ci>C</ci>
     <interval closure="open">
      <ci>r</ci>
      <ci>z</ci>
     </interval>
    </apply>
    <list>
     <apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <int></int>
        <cn type="integer">0</cn>
       </apply>
       <infinity></infinity>
      </apply>
      <apply>
       <times></times>
       <ci>S</ci>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>r</ci>
        <ci>normal-′</ci>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>r</ci>
        <ci>normal-′</ci>
       </apply>
       <apply>
        <csymbol cd="latexml">delimited-[]</csymbol>
        <apply>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <int></int>
           <cn type="integer">0</cn>
          </apply>
          <apply>
           <times></times>
           <cn type="integer">2</cn>
           <ci>π</ci>
          </apply>
         </apply>
         <apply>
          <times></times>
          <ci>G</ci>
          <interval closure="open">
           <apply>
            <root></root>
            <cerror>
             <csymbol cd="ambiguous">fragments</csymbol>
             <apply>
              <csymbol cd="ambiguous">superscript</csymbol>
              <ci>r</ci>
              <cn type="integer">2</cn>
             </apply>
             <plus></plus>
             <apply>
              <csymbol cd="ambiguous">superscript</csymbol>
              <ci>r</ci>
              <ci>normal-′</ci>
             </apply>
             <apply>
              <csymbol cd="ambiguous">superscript</csymbol>
              <minus></minus>
              <cn type="integer">2</cn>
             </apply>
             <cn type="integer">2</cn>
             <csymbol cd="unknown">r</csymbol>
             <apply>
              <csymbol cd="ambiguous">superscript</csymbol>
              <ci>r</ci>
              <ci>normal-′</ci>
             </apply>
             <csymbol cd="unknown">c</csymbol>
             <csymbol cd="unknown">o</csymbol>
             <csymbol cd="unknown">s</csymbol>
             <apply>
              <csymbol cd="ambiguous">superscript</csymbol>
              <ci>ϕ</ci>
              <ci>normal-′</ci>
             </apply>
            </cerror>
           </apply>
           <ci>z</ci>
          </interval>
          <ci>d</ci>
          <apply>
           <csymbol cd="ambiguous">superscript</csymbol>
           <ci>ϕ</ci>
           <ci>normal-′</ci>
          </apply>
         </apply>
        </apply>
       </apply>
       <ci>d</ci>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>r</ci>
        <ci>normal-′</ci>
       </apply>
      </apply>
     </apply>
     <cn type="integer">3</cn>
    </list>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C(r,z)=\int_{0}^{\infty}\ S(r^{\prime})r^{\prime}\left[\int_{0}^{2\pi}\ G\left%
(\sqrt{r^{2}+r^{\prime}\,{}^{2}-2rr^{\prime}cos\phi^{\prime}},z\right)\,d\phi^%
{\prime}\right]dr^{\prime}\qquad(3)
  </annotation>
 </semantics>
</math>

</p>

<p>

<math display="block" id="Convolution_for_optical_broad-beam_responses_in_scattering_media:6">
 <semantics>
  <mrow>
   <mrow>
    <mi>C</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>r</mi>
     <mo>,</mo>
     <mi>z</mi>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mrow>
     <msubsup>
      <mo largeop="true" symmetric="true">∫</mo>
      <mn>0</mn>
      <mi mathvariant="normal">∞</mi>
     </msubsup>
     <mrow>
      <mi>G</mi>
      <mrow>
       <mo stretchy="false">(</mo>
       <msup>
        <mi>r</mi>
        <mi>′′</mi>
       </msup>
       <mo>,</mo>
       <mi>z</mi>
       <mo stretchy="false">)</mo>
      </mrow>
      <msup>
       <mi>r</mi>
       <mi>′′</mi>
      </msup>
      <mrow>
       <mo>[</mo>
       <mrow>
        <msubsup>
         <mo largeop="true" symmetric="true">∫</mo>
         <mn>0</mn>
         <mrow>
          <mn>2</mn>
          <mi>π</mi>
         </mrow>
        </msubsup>
        <mrow>
         <mi>S</mi>
         <mrow>
          <mo>(</mo>
          <msqrt>
           <mrow>
            <msup>
             <mi>r</mi>
             <mn>2</mn>
            </msup>
            <mo>+</mo>
            <mpadded width="+1.7pt">
             <msup>
              <mi>r</mi>
              <mi>′′</mi>
             </msup>
            </mpadded>
            <mmultiscripts>
             <mo>-</mo>
             <mprescripts></mprescripts>
             <none></none>
             <mn>2</mn>
            </mmultiscripts>
            <mn>2</mn>
            <mi>r</mi>
            <msup>
             <mi>r</mi>
             <mi>′′</mi>
            </msup>
            <mi>c</mi>
            <mi>o</mi>
            <mi>s</mi>
            <msup>
             <mi>ϕ</mi>
             <mi>′′</mi>
            </msup>
           </mrow>
          </msqrt>
          <mo rspace="4.2pt">)</mo>
         </mrow>
         <mi>d</mi>
         <msup>
          <mi>ϕ</mi>
          <mi>′′</mi>
         </msup>
        </mrow>
       </mrow>
       <mo>]</mo>
      </mrow>
      <mi>d</mi>
      <msup>
       <mi>r</mi>
       <mi>′′</mi>
      </msup>
     </mrow>
    </mrow>
    <mrow>
     <mo stretchy="false">(</mo>
     <mn>4</mn>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <ci>C</ci>
     <interval closure="open">
      <ci>r</ci>
      <ci>z</ci>
     </interval>
    </apply>
    <list>
     <apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <int></int>
        <cn type="integer">0</cn>
       </apply>
       <infinity></infinity>
      </apply>
      <apply>
       <times></times>
       <ci>G</ci>
       <interval closure="open">
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>r</ci>
         <ci>′′</ci>
        </apply>
        <ci>z</ci>
       </interval>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>r</ci>
        <ci>′′</ci>
       </apply>
       <apply>
        <csymbol cd="latexml">delimited-[]</csymbol>
        <apply>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <int></int>
           <cn type="integer">0</cn>
          </apply>
          <apply>
           <times></times>
           <cn type="integer">2</cn>
           <ci>π</ci>
          </apply>
         </apply>
         <apply>
          <times></times>
          <ci>S</ci>
          <apply>
           <root></root>
           <cerror>
            <csymbol cd="ambiguous">fragments</csymbol>
            <apply>
             <csymbol cd="ambiguous">superscript</csymbol>
             <ci>r</ci>
             <cn type="integer">2</cn>
            </apply>
            <plus></plus>
            <apply>
             <csymbol cd="ambiguous">superscript</csymbol>
             <ci>r</ci>
             <ci>′′</ci>
            </apply>
            <apply>
             <csymbol cd="ambiguous">superscript</csymbol>
             <minus></minus>
             <cn type="integer">2</cn>
            </apply>
            <cn type="integer">2</cn>
            <csymbol cd="unknown">r</csymbol>
            <apply>
             <csymbol cd="ambiguous">superscript</csymbol>
             <ci>r</ci>
             <ci>′′</ci>
            </apply>
            <csymbol cd="unknown">c</csymbol>
            <csymbol cd="unknown">o</csymbol>
            <csymbol cd="unknown">s</csymbol>
            <apply>
             <csymbol cd="ambiguous">superscript</csymbol>
             <ci>ϕ</ci>
             <ci>′′</ci>
            </apply>
           </cerror>
          </apply>
          <ci>d</ci>
          <apply>
           <csymbol cd="ambiguous">superscript</csymbol>
           <ci>ϕ</ci>
           <ci>′′</ci>
          </apply>
         </apply>
        </apply>
       </apply>
       <ci>d</ci>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>r</ci>
        <ci>′′</ci>
       </apply>
      </apply>
     </apply>
     <cn type="integer">4</cn>
    </list>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C(r,z)=\int_{0}^{\infty}G(r^{\prime\prime},z)r^{\prime\prime}\left[\int_{0}^{2%
\pi}S\left(\sqrt{r^{2}+r^{\prime\prime}\,{}^{2}-2rr^{\prime\prime}cos\phi^{%
\prime\prime}}\right)\,d\phi^{\prime\prime}\right]dr^{\prime\prime}\qquad(4)
  </annotation>
 </semantics>
</math>

</p>

<p>where 

<math display="inline" id="Convolution_for_optical_broad-beam_responses_in_scattering_media:7">
 <semantics>
  <mrow>
   <msup>
    <mi>r</mi>
    <mo>′</mo>
   </msup>
   <mo>=</mo>
   <msqrt>
    <mrow>
     <msup>
      <mi>x</mi>
      <mrow>
       <mi mathvariant="normal">′</mi>
       <mn>2</mn>
      </mrow>
     </msup>
     <mo>+</mo>
     <msup>
      <mi>y</mi>
      <mrow>
       <mi mathvariant="normal">′</mi>
       <mn>2</mn>
      </mrow>
     </msup>
    </mrow>
   </msqrt>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>r</ci>
     <ci>normal-′</ci>
    </apply>
    <apply>
     <root></root>
     <apply>
      <plus></plus>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>x</ci>
       <list>
        <ci>normal-′</ci>
        <cn type="integer">2</cn>
       </list>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>y</ci>
       <list>
        <ci>normal-′</ci>
        <cn type="integer">2</cn>
       </list>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   r^{\prime}=\sqrt{x^{\prime 2}+y^{\prime 2}}
  </annotation>
 </semantics>
</math>

. Because the inner integration of Equation 4 is independent of <em>z</em>, it only needs to be calculated once for all depths. Thus this form of the broad-beam response is more computationally advantageous.</p>
<h2 id="common-beam-profiles">Common beam profiles</h2>
<h3 id="gaussian-beam">Gaussian beam</h3>

<p>For a <a href="Gaussian_beam" title="wikilink">Gaussian beam</a>, the intensity profile is given by</p>

<p>

<math display="block" id="Convolution_for_optical_broad-beam_responses_in_scattering_media:8">
 <semantics>
  <mrow>
   <mi>S</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <msup>
     <mi>r</mi>
     <mo>′</mo>
    </msup>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>=</mo>
   <msub>
    <mi>S</mi>
    <mn>0</mn>
   </msub>
   <mi>exp</mi>
   <mrow>
    <mo>[</mo>
    <mo>-</mo>
    <mn>2</mn>
    <msup>
     <mrow>
      <mo>(</mo>
      <mfrac>
       <msup>
        <mi>r</mi>
        <mo>′</mo>
       </msup>
       <mi>R</mi>
      </mfrac>
      <mo>)</mo>
     </mrow>
     <mn>2</mn>
    </msup>
    <mo>]</mo>
   </mrow>
   <mo>.</mo>
   <mrow>
    <mo stretchy="false">(</mo>
    <mn>5</mn>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">S</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>r</ci>
      <ci>normal-′</ci>
     </apply>
     <ci>normal-)</ci>
    </cerror>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>S</ci>
     <cn type="integer">0</cn>
    </apply>
    <exp></exp>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <minus></minus>
     <cn type="integer">2</cn>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <cerror>
       <csymbol cd="ambiguous">fragments</csymbol>
       <ci>normal-(</ci>
       <apply>
        <divide></divide>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>r</ci>
         <ci>normal-′</ci>
        </apply>
        <ci>R</ci>
       </apply>
       <ci>normal-)</ci>
      </cerror>
      <cn type="integer">2</cn>
     </apply>
     <ci>normal-]</ci>
    </cerror>
    <ci>normal-.</ci>
    <ci>italic-</ci>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <cn type="integer">5</cn>
     <ci>normal-)</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S(r^{\prime})=S_{0}\exp\left[-2\left(\frac{r^{\prime}}{R}\right)^{2}\right].%
\qquad(5)
  </annotation>
 </semantics>
</math>

</p>

<p>Here, <em>R</em> denotes the 

<math display="inline" id="Convolution_for_optical_broad-beam_responses_in_scattering_media:9">
 <semantics>
  <mpadded width="+1.7pt">
   <mfrac>
    <mn>1</mn>
    <msup>
     <mi>e</mi>
     <mn>2</mn>
    </msup>
   </mfrac>
  </mpadded>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <divide></divide>
    <cn type="integer">1</cn>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>e</ci>
     <cn type="integer">2</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \tfrac{1}{e^{2}}\,
  </annotation>
 </semantics>
</math>

 radius of the beam, and <em>S</em><sub>0</sub> denotes the intensity at the center of the beam. <em>S</em><sub>0</sub> is related to the total power <em>P</em><sub>0</sub> by</p>

<p>

<math display="block" id="Convolution_for_optical_broad-beam_responses_in_scattering_media:10">
 <semantics>
  <mrow>
   <msub>
    <mi>S</mi>
    <mn>0</mn>
   </msub>
   <mo>=</mo>
   <mfrac>
    <mrow>
     <mn>2</mn>
     <msub>
      <mi>P</mi>
      <mn>0</mn>
     </msub>
    </mrow>
    <mrow>
     <mi>π</mi>
     <msup>
      <mi>R</mi>
      <mn>2</mn>
     </msup>
    </mrow>
   </mfrac>
   <mo>.</mo>
   <mrow>
    <mo stretchy="false">(</mo>
    <mn>6</mn>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>S</ci>
     <cn type="integer">0</cn>
    </apply>
    <eq></eq>
    <apply>
     <divide></divide>
     <apply>
      <times></times>
      <cn type="integer">2</cn>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>P</ci>
       <cn type="integer">0</cn>
      </apply>
     </apply>
     <apply>
      <times></times>
      <ci>π</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>R</ci>
       <cn type="integer">2</cn>
      </apply>
     </apply>
    </apply>
    <ci>normal-.</ci>
    <ci>italic-</ci>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <cn type="integer">6</cn>
     <ci>normal-)</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S_{0}=\frac{2P_{0}}{\pi R^{2}}.\qquad(6)
  </annotation>
 </semantics>
</math>

 Substituting Eq. 5 into Eq. 4, we obtain</p>

<p>

<math display="block" id="Convolution_for_optical_broad-beam_responses_in_scattering_media:11">
 <semantics>
  <mrow>
   <mrow>
    <mi>C</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>r</mi>
     <mo>,</mo>
     <mi>z</mi>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mrow>
     <mn>2</mn>
     <mi>π</mi>
     <mi>S</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mi>r</mi>
      <mo stretchy="false">)</mo>
     </mrow>
     <mrow>
      <msubsup>
       <mo largeop="true" symmetric="true">∫</mo>
       <mn>0</mn>
       <mi mathvariant="normal">∞</mi>
      </msubsup>
      <mrow>
       <mi>G</mi>
       <mrow>
        <mo stretchy="false">(</mo>
        <msup>
         <mi>r</mi>
         <mi>′′</mi>
        </msup>
        <mo>,</mo>
        <mi>z</mi>
        <mo stretchy="false">)</mo>
       </mrow>
       <mrow>
        <mi>exp</mi>
        <mrow>
         <mo>[</mo>
         <mrow>
          <mo>-</mo>
          <mrow>
           <mn>2</mn>
           <msup>
            <mrow>
             <mo>(</mo>
             <mfrac>
              <msup>
               <mi>r</mi>
               <mi>′′</mi>
              </msup>
              <mi>R</mi>
             </mfrac>
             <mo>)</mo>
            </mrow>
            <mn>2</mn>
           </msup>
          </mrow>
         </mrow>
         <mo>]</mo>
        </mrow>
       </mrow>
       <msub>
        <mi>I</mi>
        <mn>0</mn>
       </msub>
       <mrow>
        <mo>(</mo>
        <mfrac>
         <mrow>
          <mn>4</mn>
          <mi>r</mi>
          <msup>
           <mi>r</mi>
           <mi>′′</mi>
          </msup>
         </mrow>
         <msup>
          <mi>R</mi>
          <mn>2</mn>
         </msup>
        </mfrac>
        <mo>)</mo>
       </mrow>
       <mpadded width="+1.7pt">
        <msup>
         <mi>r</mi>
         <mi>′′</mi>
        </msup>
       </mpadded>
       <mi>d</mi>
       <msup>
        <mi>r</mi>
        <mi>′′</mi>
       </msup>
      </mrow>
     </mrow>
    </mrow>
    <mo rspace="22.5pt">,</mo>
    <mrow>
     <mo stretchy="false">(</mo>
     <mn>7</mn>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <ci>C</ci>
     <interval closure="open">
      <ci>r</ci>
      <ci>z</ci>
     </interval>
    </apply>
    <list>
     <apply>
      <times></times>
      <cn type="integer">2</cn>
      <ci>π</ci>
      <ci>S</ci>
      <ci>r</ci>
      <apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <int></int>
         <cn type="integer">0</cn>
        </apply>
        <infinity></infinity>
       </apply>
       <apply>
        <times></times>
        <ci>G</ci>
        <interval closure="open">
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <ci>r</ci>
          <ci>′′</ci>
         </apply>
         <ci>z</ci>
        </interval>
        <apply>
         <exp></exp>
         <apply>
          <minus></minus>
          <apply>
           <times></times>
           <cn type="integer">2</cn>
           <apply>
            <csymbol cd="ambiguous">superscript</csymbol>
            <apply>
             <divide></divide>
             <apply>
              <csymbol cd="ambiguous">superscript</csymbol>
              <ci>r</ci>
              <ci>′′</ci>
             </apply>
             <ci>R</ci>
            </apply>
            <cn type="integer">2</cn>
           </apply>
          </apply>
         </apply>
        </apply>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>I</ci>
         <cn type="integer">0</cn>
        </apply>
        <apply>
         <divide></divide>
         <apply>
          <times></times>
          <cn type="integer">4</cn>
          <ci>r</ci>
          <apply>
           <csymbol cd="ambiguous">superscript</csymbol>
           <ci>r</ci>
           <ci>′′</ci>
          </apply>
         </apply>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <ci>R</ci>
          <cn type="integer">2</cn>
         </apply>
        </apply>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>r</ci>
         <ci>′′</ci>
        </apply>
        <ci>d</ci>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>r</ci>
         <ci>′′</ci>
        </apply>
       </apply>
      </apply>
     </apply>
     <cn type="integer">7</cn>
    </list>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C(r,z)=2\pi S(r)\int_{0}^{\infty}G(r^{\prime\prime},z)\exp\left[-2\left(\frac{%
r^{\prime\prime}}{R}\right)^{2}\right]I_{0}\left(\frac{4rr^{\prime\prime}}{R^{%
2}}\right)r^{\prime\prime}\,dr^{\prime\prime},\qquad(7)
  </annotation>
 </semantics>
</math>

</p>

<p>where <em>I</em><sub>0</sub> is the zeroth-order <a href="modified_Bessel_function" title="wikilink">modified Bessel function</a>.</p>
<h3 id="top-hat-beam">Top-hat beam</h3>

<p>For a <a href="tophat_beam" title="wikilink">top-hat beam</a> of radius <em>R</em>, the source function becomes</p>

<p>

<math display="block" id="Convolution_for_optical_broad-beam_responses_in_scattering_media:12">
 <semantics>
  <mrow>
   <mrow>
    <mi>S</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <msup>
      <mi>r</mi>
      <mo>′</mo>
     </msup>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mrow>
     <mo>{</mo>
     <mtable displaystyle="true">
      <mtr>
       <mtd columnalign="left">
        <mrow>
         <msub>
          <mi>S</mi>
          <mn>0</mn>
         </msub>
         <mo>,</mo>
        </mrow>
       </mtd>
       <mtd columnalign="left">
        <mrow>
         <mrow>
          <mtext>if</mtext>
          <msup>
           <mi>r</mi>
           <mo>′</mo>
          </msup>
         </mrow>
         <mo>≤</mo>
         <mi>R</mi>
        </mrow>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="left">
        <mrow>
         <mn>0</mn>
         <mo>,</mo>
        </mrow>
       </mtd>
       <mtd columnalign="left">
        <mrow>
         <mrow>
          <mtext>if</mtext>
          <msup>
           <mi>r</mi>
           <mo>′</mo>
          </msup>
         </mrow>
         <mo>></mo>
         <mi>R</mi>
        </mrow>
       </mtd>
      </mtr>
     </mtable>
    </mrow>
    <mrow>
     <mo stretchy="false">(</mo>
     <mn>8</mn>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <ci>S</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>r</ci>
      <ci>normal-′</ci>
     </apply>
    </apply>
    <list>
     <apply>
      <csymbol cd="latexml">cases</csymbol>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>S</ci>
       <cn type="integer">0</cn>
      </apply>
      <apply>
       <leq></leq>
       <apply>
        <times></times>
        <mtext>if</mtext>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>r</ci>
         <ci>normal-′</ci>
        </apply>
       </apply>
       <ci>R</ci>
      </apply>
      <cn type="float">0</cn>
      <apply>
       <gt></gt>
       <apply>
        <times></times>
        <mtext>if</mtext>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>r</ci>
         <ci>normal-′</ci>
        </apply>
       </apply>
       <ci>R</ci>
      </apply>
     </apply>
     <cn type="integer">8</cn>
    </list>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S(r^{\prime})=\begin{cases}S_{0},&\text{if }r^{\prime}\leq R\\
\,0,&\text{if }r^{\prime}>R\end{cases}\qquad(8)
  </annotation>
 </semantics>
</math>

</p>

<p>where <em>S</em><sub>0</sub> denotes the intensity inside the beam. <em>S</em><sub>0</sub> is related to the total beam power <em>P</em><sub>0</sub> by</p>

<p>

<math display="block" id="Convolution_for_optical_broad-beam_responses_in_scattering_media:13">
 <semantics>
  <mrow>
   <msub>
    <mi>S</mi>
    <mn>0</mn>
   </msub>
   <mo>=</mo>
   <mfrac>
    <msub>
     <mi>P</mi>
     <mn>0</mn>
    </msub>
    <mrow>
     <mi>π</mi>
     <msup>
      <mi>R</mi>
      <mn>2</mn>
     </msup>
    </mrow>
   </mfrac>
   <mo>.</mo>
   <mrow>
    <mo stretchy="false">(</mo>
    <mn>9</mn>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>S</ci>
     <cn type="integer">0</cn>
    </apply>
    <eq></eq>
    <apply>
     <divide></divide>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>P</ci>
      <cn type="integer">0</cn>
     </apply>
     <apply>
      <times></times>
      <ci>π</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>R</ci>
       <cn type="integer">2</cn>
      </apply>
     </apply>
    </apply>
    <ci>normal-.</ci>
    <ci>italic-</ci>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <cn type="integer">9</cn>
     <ci>normal-)</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S_{0}=\frac{P_{0}}{\pi R^{2}}.\qquad(9)
  </annotation>
 </semantics>
</math>

</p>

<p>Substituting Eq. 8 into Eq. 4, we obtain</p>

<p>

<math display="block" id="Convolution_for_optical_broad-beam_responses_in_scattering_media:14">
 <semantics>
  <mrow>
   <mrow>
    <mi>C</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>r</mi>
     <mo>,</mo>
     <mi>z</mi>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mrow>
     <mn>2</mn>
     <mi>π</mi>
     <msub>
      <mi>S</mi>
      <mn>0</mn>
     </msub>
     <mrow>
      <msubsup>
       <mo largeop="true" symmetric="true">∫</mo>
       <mn>0</mn>
       <mi mathvariant="normal">∞</mi>
      </msubsup>
      <mrow>
       <mi>G</mi>
       <mrow>
        <mo stretchy="false">(</mo>
        <msup>
         <mi>r</mi>
         <mi>′′</mi>
        </msup>
        <mo>,</mo>
        <mi>z</mi>
        <mo stretchy="false">)</mo>
       </mrow>
       <msub>
        <mi>I</mi>
        <mi>ϕ</mi>
       </msub>
       <mrow>
        <mo stretchy="false">(</mo>
        <mi>r</mi>
        <mo>,</mo>
        <msup>
         <mi>r</mi>
         <mi>′′</mi>
        </msup>
        <mo stretchy="false">)</mo>
       </mrow>
       <mpadded width="+1.7pt">
        <msup>
         <mi>r</mi>
         <mi>′′</mi>
        </msup>
       </mpadded>
       <mi>d</mi>
       <msup>
        <mi>r</mi>
        <mi>′′</mi>
       </msup>
      </mrow>
     </mrow>
    </mrow>
    <mo rspace="22.5pt">,</mo>
    <mrow>
     <mo stretchy="false">(</mo>
     <mn>10</mn>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <ci>C</ci>
     <interval closure="open">
      <ci>r</ci>
      <ci>z</ci>
     </interval>
    </apply>
    <list>
     <apply>
      <times></times>
      <cn type="integer">2</cn>
      <ci>π</ci>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>S</ci>
       <cn type="integer">0</cn>
      </apply>
      <apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <int></int>
         <cn type="integer">0</cn>
        </apply>
        <infinity></infinity>
       </apply>
       <apply>
        <times></times>
        <ci>G</ci>
        <interval closure="open">
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <ci>r</ci>
          <ci>′′</ci>
         </apply>
         <ci>z</ci>
        </interval>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>I</ci>
         <ci>ϕ</ci>
        </apply>
        <interval closure="open">
         <ci>r</ci>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <ci>r</ci>
          <ci>′′</ci>
         </apply>
        </interval>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>r</ci>
         <ci>′′</ci>
        </apply>
        <ci>d</ci>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>r</ci>
         <ci>′′</ci>
        </apply>
       </apply>
      </apply>
     </apply>
     <cn type="integer">10</cn>
    </list>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C(r,z)=2\pi S_{0}\int_{0}^{\infty}G(r^{\prime\prime},z)I_{\phi}(r,r^{\prime%
\prime})r^{\prime\prime}\,dr^{\prime\prime},\qquad(10)
  </annotation>
 </semantics>
</math>

 where</p>

<p>

<math display="block" id="Convolution_for_optical_broad-beam_responses_in_scattering_media:15">
 <semantics>
  <mrow>
   <mrow>
    <msub>
     <mi>I</mi>
     <mi>ϕ</mi>
    </msub>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>r</mi>
     <mo>,</mo>
     <msup>
      <mi>r</mi>
      <mi>′′</mi>
     </msup>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mrow>
     <mo>{</mo>
     <mtable displaystyle="true">
      <mtr>
       <mtd columnalign="left">
        <mrow>
         <mn>1</mn>
         <mo>,</mo>
        </mrow>
       </mtd>
       <mtd columnalign="left">
        <mrow>
         <mrow>
          <mrow>
           <mtext>if</mtext>
           <mi>R</mi>
          </mrow>
          <mo>≥</mo>
          <mrow>
           <mi>r</mi>
           <mo>+</mo>
           <msup>
            <mi>r</mi>
            <mi>′′</mi>
           </msup>
          </mrow>
         </mrow>
         <mo>,</mo>
        </mrow>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="left">
        <mrow>
         <mrow>
          <mstyle displaystyle="false">
           <mfrac>
            <mn>1</mn>
            <mi>π</mi>
           </mfrac>
          </mstyle>
          <mrow>
           <msup>
            <mi>cos</mi>
            <mrow>
             <mo>-</mo>
             <mn>1</mn>
            </mrow>
           </msup>
           <mrow>
            <mo>(</mo>
            <mstyle displaystyle="false">
             <mfrac>
              <mrow>
               <mrow>
                <msup>
                 <mi>r</mi>
                 <mn>2</mn>
                </msup>
                <mo>+</mo>
                <msup>
                 <mi>r</mi>
                 <mrow>
                  <mi>′′</mi>
                  <mn>2</mn>
                 </mrow>
                </msup>
               </mrow>
               <mo>-</mo>
               <msup>
                <mi>R</mi>
                <mn>2</mn>
               </msup>
              </mrow>
              <mrow>
               <mn>2</mn>
               <mi>r</mi>
               <msup>
                <mi>r</mi>
                <mi>′′</mi>
               </msup>
              </mrow>
             </mfrac>
            </mstyle>
            <mo>)</mo>
           </mrow>
          </mrow>
         </mrow>
         <mo>,</mo>
        </mrow>
       </mtd>
       <mtd columnalign="left">
        <mrow>
         <mrow>
          <mrow>
           <mtext>if</mtext>
           <mrow>
            <mo>|</mo>
            <mrow>
             <mi>r</mi>
             <mo>-</mo>
             <msup>
              <mi>r</mi>
              <mi>′′</mi>
             </msup>
            </mrow>
            <mo>|</mo>
           </mrow>
          </mrow>
          <mo>≤</mo>
          <mi>R</mi>
          <mo><</mo>
          <mrow>
           <mi>r</mi>
           <mo>+</mo>
           <msup>
            <mi>r</mi>
            <mi>′′</mi>
           </msup>
          </mrow>
         </mrow>
         <mo>,</mo>
        </mrow>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="left">
        <mrow>
         <mn>0</mn>
         <mo>,</mo>
        </mrow>
       </mtd>
       <mtd columnalign="left">
        <mrow>
         <mrow>
          <mrow>
           <mtext>if</mtext>
           <mi>R</mi>
          </mrow>
          <mo><</mo>
          <mrow>
           <mo>|</mo>
           <mrow>
            <mi>r</mi>
            <mo>+</mo>
            <msup>
             <mi>r</mi>
             <mi>′′</mi>
            </msup>
           </mrow>
           <mo>|</mo>
          </mrow>
         </mrow>
         <mo>.</mo>
        </mrow>
       </mtd>
      </mtr>
     </mtable>
    </mrow>
    <mrow>
     <mo stretchy="false">(</mo>
     <mn>11</mn>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>I</ci>
      <ci>ϕ</ci>
     </apply>
     <interval closure="open">
      <ci>r</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>r</ci>
       <ci>′′</ci>
      </apply>
     </interval>
    </apply>
    <list>
     <apply>
      <csymbol cd="latexml">cases</csymbol>
      <cn type="integer">1</cn>
      <apply>
       <geq></geq>
       <apply>
        <times></times>
        <mtext>if</mtext>
        <ci>R</ci>
       </apply>
       <apply>
        <plus></plus>
        <ci>r</ci>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>r</ci>
         <ci>′′</ci>
        </apply>
       </apply>
      </apply>
      <apply>
       <times></times>
       <apply>
        <divide></divide>
        <cn type="integer">1</cn>
        <ci>π</ci>
       </apply>
       <apply>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <cos></cos>
         <apply>
          <minus></minus>
          <cn type="integer">1</cn>
         </apply>
        </apply>
        <apply>
         <divide></divide>
         <apply>
          <minus></minus>
          <apply>
           <plus></plus>
           <apply>
            <csymbol cd="ambiguous">superscript</csymbol>
            <ci>r</ci>
            <cn type="integer">2</cn>
           </apply>
           <apply>
            <csymbol cd="ambiguous">superscript</csymbol>
            <ci>r</ci>
            <list>
             <ci>′′</ci>
             <cn type="integer">2</cn>
            </list>
           </apply>
          </apply>
          <apply>
           <csymbol cd="ambiguous">superscript</csymbol>
           <ci>R</ci>
           <cn type="integer">2</cn>
          </apply>
         </apply>
         <apply>
          <times></times>
          <cn type="integer">2</cn>
          <ci>r</ci>
          <apply>
           <csymbol cd="ambiguous">superscript</csymbol>
           <ci>r</ci>
           <ci>′′</ci>
          </apply>
         </apply>
        </apply>
       </apply>
      </apply>
      <apply>
       <and></and>
       <apply>
        <leq></leq>
        <apply>
         <times></times>
         <mtext>if</mtext>
         <apply>
          <abs></abs>
          <apply>
           <minus></minus>
           <ci>r</ci>
           <apply>
            <csymbol cd="ambiguous">superscript</csymbol>
            <ci>r</ci>
            <ci>′′</ci>
           </apply>
          </apply>
         </apply>
        </apply>
        <ci>R</ci>
       </apply>
       <apply>
        <lt></lt>
        <share href="#.cmml">
        </share>
        <apply>
         <plus></plus>
         <ci>r</ci>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <ci>r</ci>
          <ci>′′</ci>
         </apply>
        </apply>
       </apply>
      </apply>
      <cn type="integer">0</cn>
      <apply>
       <lt></lt>
       <apply>
        <times></times>
        <mtext>if</mtext>
        <ci>R</ci>
       </apply>
       <apply>
        <abs></abs>
        <apply>
         <plus></plus>
         <ci>r</ci>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <ci>r</ci>
          <ci>′′</ci>
         </apply>
        </apply>
       </apply>
      </apply>
     </apply>
     <cn type="integer">11</cn>
    </list>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   I_{\phi}(r,r^{\prime\prime})=\begin{cases}1,&\mbox{if }R\geq r+r^{\prime\prime%
},\\
\tfrac{1}{\pi}\cos^{-1}\left(\tfrac{r^{2}+r^{\prime\prime 2}-R^{2}}{2rr^{%
\prime\prime}}\right),&\mbox{if }\left|r-r^{\prime\prime}\right|\leq R<r+r^{%
\prime\prime},\\
0,&\mbox{if }R<\left|r+r^{\prime\prime}\right|.\end{cases}\qquad(11)
  </annotation>
 </semantics>
</math>

</p>
<h2 id="errors-in-numerical-evaluation">Errors in numerical evaluation</h2>
<h3 id="first-interactions">First interactions</h3>

<p>First photon-tissue interactions always occur on the z axis and hence contribute to the specific absorption or related physical quantities as a <a href="Dirac_delta_function" title="wikilink">Dirac delta function</a>. Errors will result if absorption due to the first interactions is not recorded separately from absorption due to subsequent interactions. The total impulse response can be expressed in two parts:</p>

<p>

<math display="block" id="Convolution_for_optical_broad-beam_responses_in_scattering_media:16">
 <semantics>
  <mrow>
   <mrow>
    <mi>C</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>r</mi>
     <mo>,</mo>
     <mi>z</mi>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mrow>
     <mrow>
      <msub>
       <mi>G</mi>
       <mn>1</mn>
      </msub>
      <mrow>
       <mo stretchy="false">(</mo>
       <mn>0</mn>
       <mo>,</mo>
       <mi>z</mi>
       <mo stretchy="false">)</mo>
      </mrow>
      <mfrac>
       <mrow>
        <mi>δ</mi>
        <mrow>
         <mo stretchy="false">(</mo>
         <mi>r</mi>
         <mo stretchy="false">)</mo>
        </mrow>
       </mrow>
       <mrow>
        <mn>2</mn>
        <mi>π</mi>
        <mi>r</mi>
       </mrow>
      </mfrac>
     </mrow>
     <mo>+</mo>
     <mrow>
      <msub>
       <mi>G</mi>
       <mn>2</mn>
      </msub>
      <mrow>
       <mo stretchy="false">(</mo>
       <mi>r</mi>
       <mo>,</mo>
       <mi>z</mi>
       <mo stretchy="false">)</mo>
      </mrow>
     </mrow>
    </mrow>
    <mo rspace="22.5pt">,</mo>
    <mrow>
     <mo stretchy="false">(</mo>
     <mn>12</mn>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <ci>C</ci>
     <interval closure="open">
      <ci>r</ci>
      <ci>z</ci>
     </interval>
    </apply>
    <list>
     <apply>
      <plus></plus>
      <apply>
       <times></times>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>G</ci>
        <cn type="integer">1</cn>
       </apply>
       <interval closure="open">
        <cn type="integer">0</cn>
        <ci>z</ci>
       </interval>
       <apply>
        <divide></divide>
        <apply>
         <times></times>
         <ci>δ</ci>
         <ci>r</ci>
        </apply>
        <apply>
         <times></times>
         <cn type="integer">2</cn>
         <ci>π</ci>
         <ci>r</ci>
        </apply>
       </apply>
      </apply>
      <apply>
       <times></times>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>G</ci>
        <cn type="integer">2</cn>
       </apply>
       <interval closure="open">
        <ci>r</ci>
        <ci>z</ci>
       </interval>
      </apply>
     </apply>
     <cn type="integer">12</cn>
    </list>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C(r,z)=G_{1}(0,z)\frac{\delta(r)}{2\pi r}+G_{2}(r,z),\qquad(12)
  </annotation>
 </semantics>
</math>

</p>

<p>where the first term results from the first interactions and the second, from subsequent interactions. For a Gaussian beam, we have</p>

<p>

<math display="block" id="Convolution_for_optical_broad-beam_responses_in_scattering_media:17">
 <semantics>
  <mrow>
   <mi>C</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>r</mi>
    <mo>,</mo>
    <mi>z</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>=</mo>
   <msub>
    <mi>G</mi>
    <mn>1</mn>
   </msub>
   <mrow>
    <mo stretchy="false">(</mo>
    <mn>0</mn>
    <mo>,</mo>
    <mi>z</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mi>S</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>r</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>+</mo>
   <mn>2</mn>
   <mi>π</mi>
   <msub>
    <mi>S</mi>
    <mn>0</mn>
   </msub>
   <msubsup>
    <mo largeop="true" symmetric="true">∫</mo>
    <mn>0</mn>
    <mi mathvariant="normal">∞</mi>
   </msubsup>
   <msub>
    <mi>G</mi>
    <mn>2</mn>
   </msub>
   <mrow>
    <mo stretchy="false">(</mo>
    <msup>
     <mi>r</mi>
     <mi>′′</mi>
    </msup>
    <mo>,</mo>
    <mi>z</mi>
    <mo rspace="4.2pt" stretchy="false">)</mo>
   </mrow>
   <mi>e</mi>
   <mi>x</mi>
   <mi>p</mi>
   <mrow>
    <mo>[</mo>
    <mo>-</mo>
    <mn>2</mn>
    <msup>
     <mrow>
      <mo>(</mo>
      <mfrac>
       <mrow>
        <msup>
         <mi>r</mi>
         <mi>′′</mi>
        </msup>
        <mo>-</mo>
        <mi>r</mi>
       </mrow>
       <mi>R</mi>
      </mfrac>
      <mo>)</mo>
     </mrow>
     <mn>2</mn>
    </msup>
    <mo>]</mo>
   </mrow>
   <msub>
    <mi>I</mi>
    <mrow>
     <mn>0</mn>
     <mi>e</mi>
    </mrow>
   </msub>
   <mrow>
    <mo>(</mo>
    <mfrac>
     <mrow>
      <mn>4</mn>
      <mi>r</mi>
      <msup>
       <mi>r</mi>
       <mi>′′</mi>
      </msup>
     </mrow>
     <msup>
      <mi>R</mi>
      <mn>2</mn>
     </msup>
    </mfrac>
    <mo>)</mo>
   </mrow>
   <mpadded width="+1.7pt">
    <msup>
     <mi>r</mi>
     <mi>′′</mi>
    </msup>
   </mpadded>
   <mi>d</mi>
   <msup>
    <mi>r</mi>
    <mi>′′</mi>
   </msup>
   <mo>.</mo>
   <mrow>
    <mo stretchy="false">(</mo>
    <mn>13</mn>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">C</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">r</csymbol>
     <ci>normal-,</ci>
     <csymbol cd="unknown">z</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>G</ci>
     <cn type="integer">1</cn>
    </apply>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <cn type="integer">0</cn>
     <ci>normal-,</ci>
     <csymbol cd="unknown">z</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <csymbol cd="unknown">S</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">r</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <plus></plus>
    <cn type="integer">2</cn>
    <csymbol cd="unknown">π</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>S</ci>
     <cn type="integer">0</cn>
    </apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <int></int>
      <cn type="integer">0</cn>
     </apply>
     <infinity></infinity>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>G</ci>
     <cn type="integer">2</cn>
    </apply>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>r</ci>
      <ci>′′</ci>
     </apply>
     <ci>normal-,</ci>
     <csymbol cd="unknown">z</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <csymbol cd="unknown">e</csymbol>
    <csymbol cd="unknown">x</csymbol>
    <csymbol cd="unknown">p</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-[</ci>
     <minus></minus>
     <cn type="integer">2</cn>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <cerror>
       <csymbol cd="ambiguous">fragments</csymbol>
       <ci>normal-(</ci>
       <apply>
        <divide></divide>
        <apply>
         <minus></minus>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <ci>r</ci>
          <ci>′′</ci>
         </apply>
         <ci>r</ci>
        </apply>
        <ci>R</ci>
       </apply>
       <ci>normal-)</ci>
      </cerror>
      <cn type="integer">2</cn>
     </apply>
     <ci>normal-]</ci>
    </cerror>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>I</ci>
     <apply>
      <times></times>
      <cn type="integer">0</cn>
      <ci>e</ci>
     </apply>
    </apply>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <apply>
      <divide></divide>
      <apply>
       <times></times>
       <cn type="integer">4</cn>
       <ci>r</ci>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>r</ci>
        <ci>′′</ci>
       </apply>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>R</ci>
       <cn type="integer">2</cn>
      </apply>
     </apply>
     <ci>normal-)</ci>
    </cerror>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>r</ci>
     <ci>′′</ci>
    </apply>
    <csymbol cd="unknown">d</csymbol>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>r</ci>
     <ci>′′</ci>
    </apply>
    <ci>normal-.</ci>
    <ci>italic-</ci>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <cn type="integer">13</cn>
     <ci>normal-)</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C(r,z)=G_{1}(0,z)S(r)+2\pi S_{0}\int_{0}^{\infty}G_{2}(r^{\prime\prime},z)\,%
exp\left[-2\left(\frac{r^{\prime\prime}-r}{R}\right)^{2}\right]I_{0e}\left(%
\frac{4rr^{\prime\prime}}{R^{2}}\right)r^{\prime\prime}\,dr^{\prime\prime}.%
\qquad(13)
  </annotation>
 </semantics>
</math>

</p>

<p>For a top-hat beam, we have</p>

<p>

<math display="block" id="Convolution_for_optical_broad-beam_responses_in_scattering_media:18">
 <semantics>
  <mrow>
   <mi>C</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>r</mi>
    <mo>,</mo>
    <mi>z</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>=</mo>
   <msub>
    <mi>G</mi>
    <mn>1</mn>
   </msub>
   <mrow>
    <mo stretchy="false">(</mo>
    <mn>0</mn>
    <mo>,</mo>
    <mi>z</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mi>S</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>r</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>+</mo>
   <mn>2</mn>
   <mi>π</mi>
   <msub>
    <mi>S</mi>
    <mn>0</mn>
   </msub>
   <msubsup>
    <mo largeop="true" symmetric="true">∫</mo>
    <mn>0</mn>
    <mi mathvariant="normal">∞</mi>
   </msubsup>
   <msub>
    <mi>G</mi>
    <mn>2</mn>
   </msub>
   <mrow>
    <mo stretchy="false">(</mo>
    <msup>
     <mi>r</mi>
     <mi>′′</mi>
    </msup>
    <mo>,</mo>
    <mi>z</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <msub>
    <mi>I</mi>
    <mi>ϕ</mi>
   </msub>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>r</mi>
    <mo>,</mo>
    <msup>
     <mi>r</mi>
     <mi>′′</mi>
    </msup>
    <mo stretchy="false">)</mo>
   </mrow>
   <mpadded width="+1.7pt">
    <msup>
     <mi>r</mi>
     <mi>′′</mi>
    </msup>
   </mpadded>
   <mi>d</mi>
   <msup>
    <mi>r</mi>
    <mi>′′</mi>
   </msup>
   <mo>.</mo>
   <mrow>
    <mo stretchy="false">(</mo>
    <mn>14</mn>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">C</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">r</csymbol>
     <ci>normal-,</ci>
     <csymbol cd="unknown">z</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>G</ci>
     <cn type="integer">1</cn>
    </apply>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <cn type="integer">0</cn>
     <ci>normal-,</ci>
     <csymbol cd="unknown">z</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <csymbol cd="unknown">S</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">r</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <plus></plus>
    <cn type="integer">2</cn>
    <csymbol cd="unknown">π</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>S</ci>
     <cn type="integer">0</cn>
    </apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <int></int>
      <cn type="integer">0</cn>
     </apply>
     <infinity></infinity>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>G</ci>
     <cn type="integer">2</cn>
    </apply>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>r</ci>
      <ci>′′</ci>
     </apply>
     <ci>normal-,</ci>
     <csymbol cd="unknown">z</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>I</ci>
     <ci>ϕ</ci>
    </apply>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">r</csymbol>
     <ci>normal-,</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>r</ci>
      <ci>′′</ci>
     </apply>
     <ci>normal-)</ci>
    </cerror>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>r</ci>
     <ci>′′</ci>
    </apply>
    <csymbol cd="unknown">d</csymbol>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>r</ci>
     <ci>′′</ci>
    </apply>
    <ci>normal-.</ci>
    <ci>italic-</ci>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <cn type="integer">14</cn>
     <ci>normal-)</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C(r,z)=G_{1}(0,z)S(r)+2\pi S_{0}\int_{0}^{\infty}G_{2}(r^{\prime\prime},z)I_{%
\phi}(r,r^{\prime\prime})r^{\prime\prime}\,dr^{\prime\prime}.\qquad(14)
  </annotation>
 </semantics>
</math>

</p>
<h3 id="truncation-error">Truncation error</h3>

<p>For a top-hat beam, the upper integration limits may be bounded by <em>r</em><sub>max</sub>, such that <em>r</em> ≤ <em>r</em><sub>max</sub> − <em>R</em>. Thus, the limited grid coverage in the <em>r</em> direction does not affect the convolution. To convolve reliably for physical quantities at <em>r</em> in response to a top-hat beam, we must ensure that <em>r</em><sub>max</sub> in photon transport methods is large enough that <em>r</em> ≤ <em>r</em><sub>max</sub> − <em>R</em> holds. For a Gaussian beam, no simple upper integration limits exist because it theoretically extends to infinity. At <em>r</em> &gt;&gt; <em>R</em>, a Gaussian beam and a top-hat beam of the same <em>R</em> and <em>S</em><sub>0</sub> have comparable convolution results. Therefore, <em>r</em> ≤ <em>r</em><sub>max</sub> − <em>R</em> can be used approximately for Gaussian beams as well.</p>
<h2 id="implementation-of-convolution">Implementation of convolution</h2>

<p>There are two common methods used to implement discrete convolution: the definition of convolution and <a href="fast_Fourier_transform" title="wikilink">fast Fourier transformation</a> (FFT and IFFT) according to the <a href="convolution_theorem" title="wikilink">convolution theorem</a>. To calculate the optical broad-beam response, the impulse response of a pencil beam is convolved with the beam function. As shown by Equation 4, this is a 2-D convolution. To calculate the response of a light beam on a plane perpendicular to the z axis, the beam function (represented by a <em>b × b</em> matrix) is convolved with the impulse response on that plane (represented by an <em>a</em> × <em>a</em> matrix). Normally <em>a</em> is greater than <em>b</em>. The calculation efficiency of these two methods depends largely on <em>b</em>, the size of the light beam.</p>

<p>In direct convolution, the solution matrix is of the size (<em>a</em> + <em>b</em> − 1) × (<em>a</em> + <em>b</em> − 1). The calculation of each of these elements (except those near boundaries) includes <em>b</em> × <em>b</em> multiplications and <em>b</em> × <em>b</em> − 1 additions, so the <a href="analysis_of_algorithms" title="wikilink">time complexity</a> is <a href="big_O_notation" title="wikilink">O</a>[(<em>a</em> + <em>b</em>)<sup>2</sup><em>b</em><sup>2</sup>]. Using the FFT method, the major steps are the FFT and IFFT of (<em>a</em> + <em>b</em> − 1) × (<em>a</em> + <em>b</em> − 1) matrices, so the time complexity is O[(<em>a</em> + <em>b</em>)<sup>2</sup> log(<em>a</em> + <em>b</em>)]. Comparing O[(<em>a</em> + <em>b</em>)<sup>2</sup><em>b</em><sup>2</sup>] and O[(<em>a</em> + <em>b</em>)<sup>2</sup> log(<em>a</em> + <em>b</em>)], it is apparent that direct convolution will be faster if <em>b</em> is much smaller than <em>a</em>, but the FFT method will be faster if <em>b</em> is relatively large.</p>
<h2 id="computational-examples">Computational examples</h2>

<p>The fate of photons can be modeled using a Matlab implementation of the Monte Carlo method (<em>n</em><sub>rel</sub> = 1, <em>μ</em><sub>a</sub> = 0.1, <em>μ</em><sub>s</sub>=100, <em>g</em> = 0.9, 100,000 photons). Using this Matlab model, the fluence of a 3 × 3 × 3 cm<sup>3</sup> region is recorded and the fluence distribution of a broad-beam response is plotted. Figure 1 and Figure 2 show the responses to a pencil beam and a 1-cm top-hat broad-beam, respectively. Direct convolution was used to calculate the broad-beam response in Figure 2. Figure 3 shows the broad-beam response calculated using the FFT method. When the diameter of the light beam is 0.2 cm, direct convolution costs 1.93 seconds, and the FFT method costs 7.35 seconds. When the diameter of the light beam is 2 cm, direct convolution costs 90.1 seconds, and FFT method costs 16.8 seconds. Of course, the absolute computation time depends on the processing speed of the computer being used. These two comparisons were made on the same computer. Although the computation times differ, the plots in Figures 2 and 3 are indistinguishable.</p>
<table>
<tbody>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<h2 id="see-also">See also</h2>
<ul>
<li><a href="Radiative_transfer_equation_and_diffusion_theory_for_photon_transport_in_biological_tissue" title="wikilink">Radiative transfer equation and diffusion theory for photon transport in biological tissue</a></li>
<li><a href="Monte_Carlo_method" title="wikilink">Monte Carlo method</a></li>
<li><a href="Monte_Carlo_method_for_photon_transport" title="wikilink">Monte Carlo method for photon transport</a></li>
</ul>
<h2 id="links-to-other-monte-carlo-resources">Links to other Monte Carlo resources</h2>
<ul>
<li><a href="http://labs.seas.wustl.edu/bme/Wang/mc.html">Optical Imaging Laboratory at Washington University in St. Louis (MCML)</a></li>
<li><a href="http://omlc.ogi.edu/software/mc/">Oregon Medical Laser Center</a></li>
</ul>
<h2 id="references">References</h2>
<ul>
<li>L.-H. Wang and H.-I. Wu. <u>Biomedical Optics: Principles and Imaging.</u> Wiley 2007.</li>
<li>L.-H. Wang, S. L. Jacques, and L.-Q. Zheng, "Monte Carlo modeling of photon transport in multi-layered tissues," Computer Methods and Programs in Biomedicine 47, 131–146 (1995).</li>
<li>L.-H. Wang, S. L. Jacques, and L.-Q. Zheng, "Convolution for responses to a finite diameter photon beam incident on multi-layered tissues," Computer Methods and Programs in Biomedicine 54, 141–150 (1997). <a href="http://labs.seas.wustl.edu/bme/Wang/epub/1997LWCMPBConv.pdf">Download article</a>.</li>
</ul>

<p>"</p>

<p><a href="Category:Scattering_theory" title="wikilink">Category:Scattering theory</a></p>
</body>
</html>
