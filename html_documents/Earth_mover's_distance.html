<html lang="en">
<head>
<meta charset="utf-8"/>
<title offset="1715">Earth mover's distance</title>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG.js" type="text/javascript">
</script>
</head>
<body>
<h1>Earth mover's distance</h1>
<hr/>

<p>In <a href="computer_science" title="wikilink">computer science</a>, the <strong>earth mover's distance (EMD)</strong> is a <a href="metric_(mathematics)" title="wikilink">measure of the distance</a> between two <a href="probability_distribution" title="wikilink">probability distributions</a> over a region <em>D</em>. In mathematics, this is known as the <a href="Wasserstein_metric" title="wikilink">Wasserstein metric</a>. Informally, if the distributions are interpreted as two different ways of piling up a certain amount of dirt over the region <em>D</em>, the EMD is the minimum cost of turning one pile into the other; where the cost is assumed to be amount of dirt moved times the <a class="uri" href="distance" title="wikilink">distance</a> by which it is moved.<a class="footnoteRef" href="#fn1" id="fnref1"><sup>1</sup></a></p>

<p>The above definition is valid only if the two distributions have the same integral (informally, if the two piles have the same amount of dirt), as in normalized <a href="histogram" title="wikilink">histograms</a> or <a href="probability_density_function" title="wikilink">probability density functions</a>. In that case, the EMD is equivalent to the 1st <a href="Wasserstein_metric" title="wikilink">Mallows distance or 1st Wasserstein distance</a> between the two distributions.<a class="footnoteRef" href="#fn2" id="fnref2"><sup>2</sup></a><a class="footnoteRef" href="#fn3" id="fnref3"><sup>3</sup></a></p>
<h2 id="extensions">Extensions</h2>

<p>Some applications may require the comparison of distributions with different total masses. One approach is to allow for a <em><a href="partial_function" title="wikilink">partial match</a></em>, where dirt from the most massive distribution is rearranged to make the least massive, and any leftover "dirt" is discarded at no cost. Under this approach, the EMD is no longer a true distance between distributions.</p>

<p>Another approach is to allow for mass to be created or destroyed, on a global and/or local level, as an alternative to transportation, but with a cost penalty. In that case one must specify a real parameter σ, the ratio between the cost of creating or destroying one unit of "dirt", and the cost of transporting it by a unit distance. This is equivalent to minimizing the sum of the earth moving cost plus σ times the L1 distance between the rearranged pile and the second distribution.</p>

<p>Notationally, if 

<math display="inline" id="Earth_mover's_distance:0">
 <semantics>
  <mrow>
   <mi>π</mi>
   <mo>:</mo>
   <mrow>
    <mi>P</mi>
    <mo>→</mo>
    <mi>Q</mi>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <ci>π</ci>
    <apply>
     <ci>normal-→</ci>
     <ci>P</ci>
     <ci>Q</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \pi:P\to Q
  </annotation>
 </semantics>
</math>

 is a <a href="partial_function" title="wikilink">partial function</a> which is a <a class="uri" href="bijection" title="wikilink">bijection</a> on subsets 

<math display="inline" id="Earth_mover's_distance:1">
 <semantics>
  <mrow>
   <msup>
    <mi>P</mi>
    <mo>′</mo>
   </msup>
   <mo>⊂</mo>
   <mi>P</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <subset></subset>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>P</ci>
     <ci>normal-′</ci>
    </apply>
    <ci>P</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   P^{\prime}\subset P
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="Earth_mover's_distance:2">
 <semantics>
  <mrow>
   <msup>
    <mi>Q</mi>
    <mo>′</mo>
   </msup>
   <mo>⊂</mo>
   <mi>Q</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <subset></subset>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>Q</ci>
     <ci>normal-′</ci>
    </apply>
    <ci>Q</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   Q^{\prime}\subset Q
  </annotation>
 </semantics>
</math>

, then one is interested in the distance function</p>

<p>

<math display="block" id="Earth_mover's_distance:3">
 <semantics>
  <mrow>
   <msub>
    <mrow>
     <mo stretchy="false">|</mo>
     <mrow>
      <mi>P</mi>
      <mo>-</mo>
      <mi>Q</mi>
     </mrow>
     <mo stretchy="false">|</mo>
    </mrow>
    <mi>π</mi>
   </msub>
   <mo>=</mo>
   <mrow>
    <mrow>
     <mo stretchy="false">|</mo>
     <mrow>
      <mi>P</mi>
      <mo>∖</mo>
      <msup>
       <mi>P</mi>
       <mo>′</mo>
      </msup>
     </mrow>
     <mo stretchy="false">|</mo>
    </mrow>
    <mo>+</mo>
    <mrow>
     <mo stretchy="false">|</mo>
     <mrow>
      <mi>Q</mi>
      <mo>∖</mo>
      <msup>
       <mi>Q</mi>
       <mo>′</mo>
      </msup>
     </mrow>
     <mo stretchy="false">|</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <apply>
      <abs></abs>
      <apply>
       <minus></minus>
       <ci>P</ci>
       <ci>Q</ci>
      </apply>
     </apply>
     <ci>π</ci>
    </apply>
    <apply>
     <plus></plus>
     <apply>
      <abs></abs>
      <apply>
       <setdiff></setdiff>
       <ci>P</ci>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>P</ci>
        <ci>normal-′</ci>
       </apply>
      </apply>
     </apply>
     <apply>
      <abs></abs>
      <apply>
       <setdiff></setdiff>
       <ci>Q</ci>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>Q</ci>
        <ci>normal-′</ci>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   |P-Q|_{\pi}=|P\setminus P^{\prime}|+|Q\setminus Q^{\prime}|
  </annotation>
 </semantics>
</math>

 where 

<math display="inline" id="Earth_mover's_distance:4">
 <semantics>
  <mrow>
   <mi>P</mi>
   <mo>∖</mo>
   <msup>
    <mi>P</mi>
    <mo>′</mo>
   </msup>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <setdiff></setdiff>
    <ci>P</ci>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>P</ci>
     <ci>normal-′</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   P\setminus P^{\prime}
  </annotation>
 </semantics>
</math>

 denotes <a href="set_minus" title="wikilink">set minus</a>. Here, 

<math display="inline" id="Earth_mover's_distance:5">
 <semantics>
  <msup>
   <mi>P</mi>
   <mo>′</mo>
  </msup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <ci>P</ci>
    <ci>normal-′</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   P^{\prime}
  </annotation>
 </semantics>
</math>

 would be the portion of the earth that was moved; thus 

<math display="inline" id="Earth_mover's_distance:6">
 <semantics>
  <mrow>
   <mi>P</mi>
   <mo>∖</mo>
   <msup>
    <mi>P</mi>
    <mo>′</mo>
   </msup>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <setdiff></setdiff>
    <ci>P</ci>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>P</ci>
     <ci>normal-′</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   P\setminus P^{\prime}
  </annotation>
 </semantics>
</math>

 would be the portion not moved, and 

<math display="inline" id="Earth_mover's_distance:7">
 <semantics>
  <mrow>
   <mo stretchy="false">|</mo>
   <mrow>
    <mi>P</mi>
    <mo>∖</mo>
    <msup>
     <mi>P</mi>
     <mo>′</mo>
    </msup>
   </mrow>
   <mo stretchy="false">|</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <abs></abs>
    <apply>
     <setdiff></setdiff>
     <ci>P</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>P</ci>
      <ci>normal-′</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   |P\setminus P^{\prime}|
  </annotation>
 </semantics>
</math>

 the size of the pile not moved. By symmetry, one contemplates 

<math display="inline" id="Earth_mover's_distance:8">
 <semantics>
  <mrow>
   <msup>
    <mi>Q</mi>
    <mo>′</mo>
   </msup>
   <mo>⊂</mo>
   <mi>Q</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <subset></subset>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>Q</ci>
     <ci>normal-′</ci>
    </apply>
    <ci>Q</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   Q^{\prime}\subset Q
  </annotation>
 </semantics>
</math>

 as the pile at the destination that 'got there' from <em>P</em>, as compared to the total <em>Q</em> that we <em>want to have there</em>. Formally, this distance indicates how much an <a href="injective_correspondence" title="wikilink">injective correspondence</a> differs from an <a class="uri" href="isomorphism" title="wikilink">isomorphism</a>.</p>
<h2 id="computing-the-emd">Computing the EMD</h2>

<p>If the domain <em>D</em> is discrete, the EMD can be computed by solving an instance <a href="transportation_problem" title="wikilink">transportation problem</a>, which can be solved by the so-called <a href="Hungarian_algorithm" title="wikilink">Hungarian algorithm</a>. In particular, if <em>D</em> is a one-dimensional array of "bins" the EMD can be efficiently computed by scanning the array and keeping track of how much dirt needs to be transported between consecutive bins. For example:</p>
<dl>
<dd>EMD<sub>0</sub> = 0
</dd>
</dl>
<dl>
<dd>EMD<sub>i+1</sub> = ( A<sub>i</sub> + EMD<sub>i</sub> ) - B<sub>i</sub>
</dd>
</dl>
<dl>
<dd>TotalDistance = ∑ | EMD<sub>i</sub> |
</dd>
</dl>
<h2 id="emd-based-similarity-analysis">EMD based similarity analysis</h2>

<p>EMD based Similarity Analysis (EMDSA) is an important and effective tool in many <a href="Multimedia_Information_Retrieval" title="wikilink">multimedia information retrieval</a><a class="footnoteRef" href="#fn4" id="fnref4"><sup>4</sup></a> and <a href="pattern_recognition" title="wikilink">pattern recognition</a><a class="footnoteRef" href="#fn5" id="fnref5"><sup>5</sup></a> applications. However, the computational cost of EMD is super-cubic to the number of the "bins" given an arbitrary "D".</p>
<h2 id="applications">Applications</h2>

<p>An early application of the EMD in computer science was to compare two <a class="uri" href="grayscale" title="wikilink">grayscale</a> images that may differ due to <a class="uri" href="dithering" title="wikilink">dithering</a>, blurring, or local deformations.<a class="footnoteRef" href="#fn6" id="fnref6"><sup>6</sup></a> In this case, the region is the image's domain, and the total amount of light (or ink) is the "dirt" to be rearranged.</p>

<p>The EMD is widely used in <a href="content-based_image_retrieval" title="wikilink">content-based image retrieval</a> to compute distances between the <a href="color_histogram" title="wikilink">color histograms</a> of two <a href="digital_image" title="wikilink">digital images</a>. In this case, the region is the <a href="RGB_color_model" title="wikilink">RGB color cube</a>, and each image pixel is a parcel of "dirt". The same technique can be used for any other quantitative <a class="uri" href="pixel" title="wikilink">pixel</a> attribute, such as <a class="uri" href="luminance" title="wikilink">luminance</a>, <a href="image_gradient" title="wikilink">gradient</a>, <a href="optical_flow" title="wikilink">apparent motion</a> in a <a href="video_frame" title="wikilink">video frame</a>, etc..</p>

<p>More generally, the EMD is used in <a href="pattern_recognition" title="wikilink">pattern recognition</a> to compare generic summaries or surrogates of data records called <a href="signature_(patern_recognition)" title="wikilink">signatures</a>. A typical signature consists of list of pairs ((<em>x</em><sub>1</sub>,<em>m</em><sub>1</sub>), … (<em>x</em><sub><em>n</em></sub>,<em>m</em><sub><em>n</em></sub>)), where each <em>x</em><sub><em>i</em></sub> is a certain "feature" (e.g., color in an image, letter in a text, etc.), and <em>m</em><sub><em>i</em></sub> is "mass" (how many times that feature occurs in the record). Alternatively, <em>x</em><sub><em>i</em></sub> may be the <a class="uri" href="centroid" title="wikilink">centroid</a> of a <a href="cluster_analysis" title="wikilink">data cluster</a>, and <em>m</em><sub><em>i</em></sub> the number of entities in that cluster. To compare two such signatures with the EMD, one must define a distance between features, which is interpreted as the cost of turning a unit mass of one feature into a unit mass of the other. The EMD between two signatures is then the minimum cost of turning one of them into the other.</p>
<h2 id="history">History</h2>

<p>The concept was first introduced by <a href="Gaspard_Monge" title="wikilink">Gaspard Monge</a> in 1781,<a class="footnoteRef" href="#fn7" id="fnref7"><sup>7</sup></a> and anchors the field of <a href="transportation_theory_(mathematics)" title="wikilink">transportation theory</a>. The use of the EMD as a distance measure for monochromatic images was described in 1989 by S. Peleg, M. Werman and H. Rom.<a class="footnoteRef" href="#fn8" id="fnref8"><sup>8</sup></a> The name "earth movers' distance" was proposed by <a href="Jorge_Stolfi" title="wikilink">J. Stolfi</a> in 1994,<a class="footnoteRef" href="#fn9" id="fnref9"><sup>9</sup></a> and was used in print in 1998 by Y. Rubner, C. Tomasi and <a href="Leonidas_J._Guibas" title="wikilink">L. G. Guibas</a>.<a class="footnoteRef" href="#fn10" id="fnref10"><sup>10</sup></a></p>
<h2 id="references">References</h2>
<h2 id="external-links">External links</h2>
<ul>
<li><a href="http://ai.stanford.edu/~rubner/emd/default.htm">C code for the Earth Mover's Distance</a></li>
<li><a href="https://github.com/pdinges/python-emd">Python2 wrapper for the C implementation of the Earth Mover's Distance</a></li>
<li><a href="http://www.seas.upenn.edu/~ofirpele/FastEMD/code/">C++ and Matlab and Java wrappers code for the Earth Mover's Distance, especially efficient for thresholded ground distances</a></li>
<li><a href="http://spatialanalytics.cis.unimelb.edu.au/#generator">Java implementation of a generic generator for evaluating large-scale Earth Mover's Distance based similarity analysis</a></li>
</ul>

<p>"</p>

<p><a href="Category:Statistical_distance_measures" title="wikilink">Category:Statistical distance measures</a></p>
<section class="footnotes">
<hr/>
<ol>
<li id="fn1"><a href="http://homepages.inf.ed.ac.uk/rbf/CVonline/LOCAL_COPIES/RUBNER/emd.htm">Formal definition</a><a href="#fnref1">↩</a></li>
<li id="fn2"><a href="#fnref2">↩</a></li>
<li id="fn3"><a href="#fnref3">↩</a></li>
<li id="fn4"><a href="#fnref4">↩</a></li>
<li id="fn5"><a href="#fnref5">↩</a></li>
<li id="fn6"><a href="#fnref6">↩</a></li>
<li id="fn7"><a href="#fnref7">↩</a></li>
<li id="fn8"></li>
<li id="fn9">J. Stolfi, personal communication to L. J. Guibas, 1994<a href="#fnref9">↩</a></li>
<li id="fn10"><a href="#fnref10">↩</a></li>
</ol>
</section>
</body>
</html>
