<html lang="en">
<head>
<meta charset="utf-8"/>
<title offset="1269">Histogram matching</title>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG.js" type="text/javascript">
</script>
</head>
<body>
<h1>Histogram matching</h1>
<hr/>

<p> <strong>Histogram matching</strong> is a method in <a href="image_processing" title="wikilink">image processing</a> of <a href="color_mapping" title="wikilink">color adjustment</a> of two images using the <a class="uri" href="image" title="wikilink">image</a> <a href="Image_histogram" title="wikilink">histograms</a>.</p>

<p>It is possible to use histogram matching to balance detector responses as a relative detector calibration technique. It can be used to normalize two images, when the images were acquired at the same local illumination (such as shadows) over the same location, but by different sensors, atmospheric conditions or global illumination.</p>
<h2 id="the-algorithm">The algorithm</h2>

<p>Given two images, the reference and the adjusted images, we compute their histograms. Following, we calculate the <a href="cumulative_distribution_function" title="wikilink">cumulative distribution functions</a> of the two images' histograms - 

<math display="inline" id="Histogram_matching:0">
 <semantics>
  <mrow>
   <msub>
    <mi>F</mi>
    <mn>1</mn>
   </msub>
   <mrow>
    <mo stretchy="false">(</mo>
    <mo rspace="4.2pt" stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>F</ci>
     <cn type="integer">1</cn>
    </apply>
    <list></list>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   F_{1}()\,
  </annotation>
 </semantics>
</math>

 for the reference image and 

<math display="inline" id="Histogram_matching:1">
 <semantics>
  <mrow>
   <msub>
    <mi>F</mi>
    <mn>2</mn>
   </msub>
   <mrow>
    <mo stretchy="false">(</mo>
    <mo rspace="4.2pt" stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>F</ci>
     <cn type="integer">2</cn>
    </apply>
    <list></list>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   F_{2}()\,
  </annotation>
 </semantics>
</math>

 for the target image. Then for each gray level 

<math display="inline" id="Histogram_matching:2">
 <semantics>
  <mrow>
   <msub>
    <mi>G</mi>
    <mn>1</mn>
   </msub>
   <mo>∈</mo>
   <mrow>
    <mo stretchy="false">[</mo>
    <mn>0</mn>
    <mo>,</mo>
    <mn>255</mn>
    <mo stretchy="false">]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <in></in>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>G</ci>
     <cn type="integer">1</cn>
    </apply>
    <interval closure="closed">
     <cn type="integer">0</cn>
     <cn type="integer">255</cn>
    </interval>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   G_{1}\in[0,255]
  </annotation>
 </semantics>
</math>

, we find the gray level 

<math display="inline" id="Histogram_matching:3">
 <semantics>
  <mpadded width="+1.7pt">
   <msub>
    <mi>G</mi>
    <mn>2</mn>
   </msub>
  </mpadded>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>G</ci>
    <cn type="integer">2</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   G_{2}\,
  </annotation>
 </semantics>
</math>

 for which 

<math display="inline" id="Histogram_matching:4">
 <semantics>
  <mrow>
   <mrow>
    <msub>
     <mi>F</mi>
     <mn>1</mn>
    </msub>
    <mrow>
     <mo stretchy="false">(</mo>
     <msub>
      <mi>G</mi>
      <mn>1</mn>
     </msub>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <msub>
     <mi>F</mi>
     <mn>2</mn>
    </msub>
    <mrow>
     <mo stretchy="false">(</mo>
     <msub>
      <mi>G</mi>
      <mn>2</mn>
     </msub>
     <mo rspace="4.2pt" stretchy="false">)</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>F</ci>
      <cn type="integer">1</cn>
     </apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>G</ci>
      <cn type="integer">1</cn>
     </apply>
    </apply>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>F</ci>
      <cn type="integer">2</cn>
     </apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>G</ci>
      <cn type="integer">2</cn>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   F_{1}(G_{1})=F_{2}(G_{2})\,
  </annotation>
 </semantics>
</math>


, and this is the result of histogram matching function

<math display="block" id="Histogram_matching:5">
 <semantics>
  <mrow>
   <mrow>
    <mi>M</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <msub>
      <mi>G</mi>
      <mn>1</mn>
     </msub>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mpadded width="+1.7pt">
    <msub>
     <mi>G</mi>
     <mn>2</mn>
    </msub>
   </mpadded>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <ci>M</ci>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>G</ci>
      <cn type="integer">1</cn>
     </apply>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>G</ci>
     <cn type="integer">2</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   M(G_{1})=G_{2}\,
  </annotation>
 </semantics>
</math>

. Finally, we apply the function 

<math display="inline" id="Histogram_matching:6">
 <semantics>
  <mrow>
   <mi>M</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mo rspace="4.2pt" stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>M</ci>
    <list></list>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   M()\,
  </annotation>
 </semantics>
</math>

 on each pixel of the reference image.</p>
<h2 id="multiple-histograms-matching">Multiple Histograms Matching</h2>

<p>The Histogram matching Algorithm can be extended to find a monotonic mapping between two sets of histograms. Given two sets of histograms 

<math display="inline" id="Histogram_matching:7">
 <semantics>
  <mrow>
   <mi>P</mi>
   <mo>=</mo>
   <msubsup>
    <mrow>
     <mo stretchy="false">{</mo>
     <msub>
      <mi>p</mi>
      <mi>i</mi>
     </msub>
     <mo stretchy="false">}</mo>
    </mrow>
    <mrow>
     <mi>i</mi>
     <mo>=</mo>
     <mn>1</mn>
    </mrow>
    <mi>k</mi>
   </msubsup>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>P</ci>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <set>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>p</ci>
        <ci>i</ci>
       </apply>
      </set>
      <apply>
       <eq></eq>
       <ci>i</ci>
       <cn type="integer">1</cn>
      </apply>
     </apply>
     <ci>k</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   P=\{p_{i}\}_{i=1}^{k}
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="Histogram_matching:8">
 <semantics>
  <mrow>
   <mi>Q</mi>
   <mo>=</mo>
   <msubsup>
    <mrow>
     <mo stretchy="false">{</mo>
     <msub>
      <mi>q</mi>
      <mi>i</mi>
     </msub>
     <mo stretchy="false">}</mo>
    </mrow>
    <mrow>
     <mi>i</mi>
     <mo>=</mo>
     <mn>1</mn>
    </mrow>
    <mi>k</mi>
   </msubsup>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>Q</ci>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <set>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>q</ci>
        <ci>i</ci>
       </apply>
      </set>
      <apply>
       <eq></eq>
       <ci>i</ci>
       <cn type="integer">1</cn>
      </apply>
     </apply>
     <ci>k</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   Q=\{q_{i}\}_{i=1}^{k}
  </annotation>
 </semantics>
</math>

, the optimal monotonic color mapping 

<math display="inline" id="Histogram_matching:9">
 <semantics>
  <mi>M</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>M</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   M
  </annotation>
 </semantics>
</math>


 is calculated to minimize the distance between the two sets simultaneously, namely 

<math display="inline" id="Histogram_matching:10">
 <semantics>
  <mrow>
   <mi>m</mi>
   <mi>i</mi>
   <mpadded width="+5pt">
    <msub>
     <mi>n</mi>
     <mi>M</mi>
    </msub>
   </mpadded>
   <mrow>
    <msub>
     <mo largeop="true" symmetric="true">∑</mo>
     <mi>k</mi>
    </msub>
    <mrow>
     <mi>d</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <mi>M</mi>
       <mrow>
        <mo stretchy="false">(</mo>
        <msub>
         <mi>p</mi>
         <mi>k</mi>
        </msub>
        <mo stretchy="false">)</mo>
       </mrow>
      </mrow>
      <mo>,</mo>
      <msub>
       <mi>q</mi>
       <mi>k</mi>
      </msub>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>m</ci>
    <ci>i</ci>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>n</ci>
     <ci>M</ci>
    </apply>
    <apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <sum></sum>
      <ci>k</ci>
     </apply>
     <apply>
      <times></times>
      <ci>d</ci>
      <interval closure="open">
       <apply>
        <times></times>
        <ci>M</ci>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>p</ci>
         <ci>k</ci>
        </apply>
       </apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>q</ci>
        <ci>k</ci>
       </apply>
      </interval>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   min_{M}\ \sum_{k}d(M(p_{k}),q_{k})
  </annotation>
 </semantics>
</math>

 where 

<math display="inline" id="Histogram_matching:11">
 <semantics>
  <mrow>
   <mi>d</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mo>.</mo>
    <mo>,</mo>
    <mo>.</mo>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">d</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <ci>normal-.</ci>
     <ci>normal-,</ci>
     <ci>normal-.</ci>
     <ci>normal-)</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   d(.,.)
  </annotation>
 </semantics>
</math>

 is a distance metric between two histograms. The optimal solution is calculated using <a href="dynamic_programming" title="wikilink">dynamic programming</a> <a class="footnoteRef" href="#fn1" id="fnref1"><sup>1</sup></a></p>
<h2 id="references">References</h2>
<h2 id="see-also">See also</h2>
<ul>
<li><a href="Histogram_equalization" title="wikilink">Histogram equalization</a></li>
<li><a href="Image_histogram" title="wikilink">Image histogram</a></li>
<li><a href="Color_mapping" title="wikilink">Color mapping</a></li>
</ul>

<p>"</p>

<p><a href="Category:Image_processing" title="wikilink">Category:Image processing</a></p>
<section class="footnotes">
<hr/>
<ol>
<li id="fn1"></li>
</ol>
</section>
</body>
</html>
