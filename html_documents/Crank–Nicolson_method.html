<html lang="en">
<head>
<meta charset="utf-8"/>
<title offset="1584">Crank–Nicolson method</title>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG.js" type="text/javascript">
</script>
</head>
<body>
<h1>Crank–Nicolson method</h1>
<hr/>

<p>In <a href="numerical_analysis" title="wikilink">numerical analysis</a>, the <strong>Crank–Nicolson method</strong> is a <a href="finite_difference_method" title="wikilink">finite difference method</a> used for numerically solving the <a href="heat_equation" title="wikilink">heat equation</a> and similar <a href="partial_differential_equations" title="wikilink">partial differential equations</a>.<a class="footnoteRef" href="#fn1" id="fnref1"><sup>1</sup></a> It is a <a href="Big_O_notation" title="wikilink">second-order</a> method in time, it is <a href="Explicit_and_implicit_methods" title="wikilink">implicit</a> in time and can be written as an <a href="implicit_Runge–Kutta_method" title="wikilink">implicit Runge–Kutta method</a>, and it is <a href="Numerical_stability" title="wikilink">numerically stable</a>. The method was developed by <a href="John_Crank" title="wikilink">John Crank</a> and <a href="Phyllis_Nicolson" title="wikilink">Phyllis Nicolson</a> in the mid 20th century.<a class="footnoteRef" href="#fn2" id="fnref2"><sup>2</sup></a></p>

<p>For diffusion equations (and many other equations), it can be shown the Crank–Nicolson method is unconditionally <a href="Numerical_stability" title="wikilink">stable</a>.<a class="footnoteRef" href="#fn3" id="fnref3"><sup>3</sup></a> However, the approximate solutions can still contain (decaying) spurious oscillations if the ratio of time step Δ

<math display="inline" id="Crank–Nicolson_method:0">
 <semantics>
  <mi>t</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>t</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   t
  </annotation>
 </semantics>
</math>

 times the <a href="thermal_diffusivity" title="wikilink">thermal diffusivity</a> to the square of space step, Δ

<math display="inline" id="Crank–Nicolson_method:1">
 <semantics>
  <mi>x</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>x</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   x
  </annotation>
 </semantics>
</math>



<math display="inline" id="Crank–Nicolson_method:2">
 <semantics>
  <msup>
   <mi></mi>
   <mn>2</mn>
  </msup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <cn type="integer">2</cn>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   {}^{2}
  </annotation>
 </semantics>
</math>

, is large (typically larger than 1/2 per <a href="Von_Neumann_stability_analysis" title="wikilink">Von Neumann stability analysis</a>). For this reason, whenever large time steps or high spatial resolution is necessary, the less accurate <a href="backward_Euler_method" title="wikilink">backward Euler method</a> is often used, which is both stable and immune to oscillations.</p>
<h2 id="the-method">The method</h2>
<figure><b>(Figure)</b>
<figcaption>The Crank–Nicolson stencil for a 1D problem.</figcaption>
</figure>

<p>The Crank–Nicolson method is based on the <a href="trapezoidal_rule_(differential_equations)" title="wikilink">trapezoidal rule</a>, giving second-order convergence in time. For example, in one dimension, if the <a href="partial_differential_equation" title="wikilink">partial differential equation</a> is</p>

<p>

<math display="block" id="Crank–Nicolson_method:3">
 <semantics>
  <mrow>
   <mfrac>
    <mrow>
     <mo>∂</mo>
     <mi>u</mi>
    </mrow>
    <mrow>
     <mo>∂</mo>
     <mi>t</mi>
    </mrow>
   </mfrac>
   <mo>=</mo>
   <mrow>
    <mi>F</mi>
    <mrow>
     <mo>(</mo>
     <mi>u</mi>
     <mo rspace="4.2pt">,</mo>
     <mi>x</mi>
     <mo rspace="4.2pt">,</mo>
     <mi>t</mi>
     <mo rspace="4.2pt">,</mo>
     <mfrac>
      <mrow>
       <mo>∂</mo>
       <mi>u</mi>
      </mrow>
      <mrow>
       <mo>∂</mo>
       <mi>x</mi>
      </mrow>
     </mfrac>
     <mo rspace="4.2pt">,</mo>
     <mfrac>
      <mrow>
       <msup>
        <mo>∂</mo>
        <mn>2</mn>
       </msup>
       <mi>u</mi>
      </mrow>
      <mrow>
       <mo>∂</mo>
       <msup>
        <mi>x</mi>
        <mn>2</mn>
       </msup>
      </mrow>
     </mfrac>
     <mo>)</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <divide></divide>
     <apply>
      <partialdiff></partialdiff>
      <ci>u</ci>
     </apply>
     <apply>
      <partialdiff></partialdiff>
      <ci>t</ci>
     </apply>
    </apply>
    <apply>
     <times></times>
     <ci>F</ci>
     <vector>
      <ci>u</ci>
      <ci>x</ci>
      <ci>t</ci>
      <apply>
       <divide></divide>
       <apply>
        <partialdiff></partialdiff>
        <ci>u</ci>
       </apply>
       <apply>
        <partialdiff></partialdiff>
        <ci>x</ci>
       </apply>
      </apply>
      <apply>
       <divide></divide>
       <apply>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <partialdiff></partialdiff>
         <cn type="integer">2</cn>
        </apply>
        <ci>u</ci>
       </apply>
       <apply>
        <partialdiff></partialdiff>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>x</ci>
         <cn type="integer">2</cn>
        </apply>
       </apply>
      </apply>
     </vector>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \frac{\partial u}{\partial t}=F\left(u,\,x,\,t,\,\frac{\partial u}{\partial x}%
,\,\frac{\partial^{2}u}{\partial x^{2}}\right)
  </annotation>
 </semantics>
</math>

</p>

<p>then, letting 

<math display="inline" id="Crank–Nicolson_method:4">
 <semantics>
  <mrow>
   <mrow>
    <mi>u</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mrow>
      <mi>i</mi>
      <mi mathvariant="normal">Δ</mi>
      <mi>x</mi>
     </mrow>
     <mo rspace="4.2pt">,</mo>
     <mrow>
      <mi>n</mi>
      <mi mathvariant="normal">Δ</mi>
      <mi>t</mi>
     </mrow>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mpadded width="+1.7pt">
    <msubsup>
     <mi>u</mi>
     <mi>i</mi>
     <mi>n</mi>
    </msubsup>
   </mpadded>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <ci>u</ci>
     <interval closure="open">
      <apply>
       <times></times>
       <ci>i</ci>
       <ci>normal-Δ</ci>
       <ci>x</ci>
      </apply>
      <apply>
       <times></times>
       <ci>n</ci>
       <ci>normal-Δ</ci>
       <ci>t</ci>
      </apply>
     </interval>
    </apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>u</ci>
      <ci>i</ci>
     </apply>
     <ci>n</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   u(i\Delta x,\,n\Delta t)=u_{i}^{n}\,
  </annotation>
 </semantics>
</math>

, the equation for Crank–Nicolson method is a combination of the <a href="forward_Euler_method" title="wikilink">forward Euler method</a> at 

<math display="inline" id="Crank–Nicolson_method:5">
 <semantics>
  <mi>n</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>n</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   n
  </annotation>
 </semantics>
</math>

 and the <a href="backward_Euler_method" title="wikilink">backward Euler method</a> at <em>n</em> + 1 (note, however, that the method itself is <em>not</em> simply the average of those two methods, as the equation has an implicit dependence on the solution):</p>

<p>

<math display="block" id="Crank–Nicolson_method:6">
 <semantics>
  <mrow>
   <mfrac>
    <mrow>
     <msubsup>
      <mi>u</mi>
      <mi>i</mi>
      <mrow>
       <mi>n</mi>
       <mo>+</mo>
       <mn>1</mn>
      </mrow>
     </msubsup>
     <mo>-</mo>
     <msubsup>
      <mi>u</mi>
      <mi>i</mi>
      <mi>n</mi>
     </msubsup>
    </mrow>
    <mrow>
     <mi mathvariant="normal">Δ</mi>
     <mi>t</mi>
    </mrow>
   </mfrac>
   <mo>=</mo>
   <mrow>
    <mrow>
     <msubsup>
      <mi>F</mi>
      <mi>i</mi>
      <mi>n</mi>
     </msubsup>
     <mrow>
      <mo>(</mo>
      <mi>u</mi>
      <mo rspace="4.2pt">,</mo>
      <mi>x</mi>
      <mo rspace="4.2pt">,</mo>
      <mi>t</mi>
      <mo rspace="4.2pt">,</mo>
      <mfrac>
       <mrow>
        <mo>∂</mo>
        <mi>u</mi>
       </mrow>
       <mrow>
        <mo>∂</mo>
        <mi>x</mi>
       </mrow>
      </mfrac>
      <mo rspace="4.2pt">,</mo>
      <mfrac>
       <mrow>
        <msup>
         <mo>∂</mo>
         <mn>2</mn>
        </msup>
        <mi>u</mi>
       </mrow>
       <mrow>
        <mo>∂</mo>
        <msup>
         <mi>x</mi>
         <mn>2</mn>
        </msup>
       </mrow>
      </mfrac>
      <mo>)</mo>
     </mrow>
    </mrow>
    <mtext>(forward Euler)</mtext>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <divide></divide>
     <apply>
      <minus></minus>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>u</ci>
        <ci>i</ci>
       </apply>
       <apply>
        <plus></plus>
        <ci>n</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>u</ci>
        <ci>i</ci>
       </apply>
       <ci>n</ci>
      </apply>
     </apply>
     <apply>
      <times></times>
      <ci>normal-Δ</ci>
      <ci>t</ci>
     </apply>
    </apply>
    <list>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>F</ci>
        <ci>i</ci>
       </apply>
       <ci>n</ci>
      </apply>
      <vector>
       <ci>u</ci>
       <ci>x</ci>
       <ci>t</ci>
       <apply>
        <divide></divide>
        <apply>
         <partialdiff></partialdiff>
         <ci>u</ci>
        </apply>
        <apply>
         <partialdiff></partialdiff>
         <ci>x</ci>
        </apply>
       </apply>
       <apply>
        <divide></divide>
        <apply>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <partialdiff></partialdiff>
          <cn type="integer">2</cn>
         </apply>
         <ci>u</ci>
        </apply>
        <apply>
         <partialdiff></partialdiff>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <ci>x</ci>
          <cn type="integer">2</cn>
         </apply>
        </apply>
       </apply>
      </vector>
     </apply>
     <mtext>(forward Euler)</mtext>
    </list>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \frac{u_{i}^{n+1}-u_{i}^{n}}{\Delta t}=F_{i}^{n}\left(u,\,x,\,t,\,\frac{%
\partial u}{\partial x},\,\frac{\partial^{2}u}{\partial x^{2}}\right)\qquad%
\mbox{(forward Euler)}
  </annotation>
 </semantics>
</math>

</p>

<p>

<math display="block" id="Crank–Nicolson_method:7">
 <semantics>
  <mrow>
   <mfrac>
    <mrow>
     <msubsup>
      <mi>u</mi>
      <mi>i</mi>
      <mrow>
       <mi>n</mi>
       <mo>+</mo>
       <mn>1</mn>
      </mrow>
     </msubsup>
     <mo>-</mo>
     <msubsup>
      <mi>u</mi>
      <mi>i</mi>
      <mi>n</mi>
     </msubsup>
    </mrow>
    <mrow>
     <mi mathvariant="normal">Δ</mi>
     <mi>t</mi>
    </mrow>
   </mfrac>
   <mo>=</mo>
   <mrow>
    <mrow>
     <msubsup>
      <mi>F</mi>
      <mi>i</mi>
      <mrow>
       <mi>n</mi>
       <mo>+</mo>
       <mn>1</mn>
      </mrow>
     </msubsup>
     <mrow>
      <mo>(</mo>
      <mi>u</mi>
      <mo rspace="4.2pt">,</mo>
      <mi>x</mi>
      <mo rspace="4.2pt">,</mo>
      <mi>t</mi>
      <mo rspace="4.2pt">,</mo>
      <mfrac>
       <mrow>
        <mo>∂</mo>
        <mi>u</mi>
       </mrow>
       <mrow>
        <mo>∂</mo>
        <mi>x</mi>
       </mrow>
      </mfrac>
      <mo rspace="4.2pt">,</mo>
      <mfrac>
       <mrow>
        <msup>
         <mo>∂</mo>
         <mn>2</mn>
        </msup>
        <mi>u</mi>
       </mrow>
       <mrow>
        <mo>∂</mo>
        <msup>
         <mi>x</mi>
         <mn>2</mn>
        </msup>
       </mrow>
      </mfrac>
      <mo>)</mo>
     </mrow>
    </mrow>
    <mtext>(backward Euler)</mtext>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <divide></divide>
     <apply>
      <minus></minus>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>u</ci>
        <ci>i</ci>
       </apply>
       <apply>
        <plus></plus>
        <ci>n</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>u</ci>
        <ci>i</ci>
       </apply>
       <ci>n</ci>
      </apply>
     </apply>
     <apply>
      <times></times>
      <ci>normal-Δ</ci>
      <ci>t</ci>
     </apply>
    </apply>
    <list>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>F</ci>
        <ci>i</ci>
       </apply>
       <apply>
        <plus></plus>
        <ci>n</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
      <vector>
       <ci>u</ci>
       <ci>x</ci>
       <ci>t</ci>
       <apply>
        <divide></divide>
        <apply>
         <partialdiff></partialdiff>
         <ci>u</ci>
        </apply>
        <apply>
         <partialdiff></partialdiff>
         <ci>x</ci>
        </apply>
       </apply>
       <apply>
        <divide></divide>
        <apply>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <partialdiff></partialdiff>
          <cn type="integer">2</cn>
         </apply>
         <ci>u</ci>
        </apply>
        <apply>
         <partialdiff></partialdiff>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <ci>x</ci>
          <cn type="integer">2</cn>
         </apply>
        </apply>
       </apply>
      </vector>
     </apply>
     <mtext>(backward Euler)</mtext>
    </list>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \frac{u_{i}^{n+1}-u_{i}^{n}}{\Delta t}=F_{i}^{n+1}\left(u,\,x,\,t,\,\frac{%
\partial u}{\partial x},\,\frac{\partial^{2}u}{\partial x^{2}}\right)\qquad%
\mbox{(backward Euler)}
  </annotation>
 </semantics>
</math>

</p>

<p>

<math display="block" id="Crank–Nicolson_method:8">
 <semantics>
  <mrow>
   <mrow>
    <mfrac>
     <mrow>
      <msubsup>
       <mi>u</mi>
       <mi>i</mi>
       <mrow>
        <mi>n</mi>
        <mo>+</mo>
        <mn>1</mn>
       </mrow>
      </msubsup>
      <mo>-</mo>
      <msubsup>
       <mi>u</mi>
       <mi>i</mi>
       <mi>n</mi>
      </msubsup>
     </mrow>
     <mrow>
      <mi mathvariant="normal">Δ</mi>
      <mi>t</mi>
     </mrow>
    </mfrac>
    <mo>=</mo>
    <mrow>
     <mrow>
      <mfrac>
       <mn>1</mn>
       <mn>2</mn>
      </mfrac>
      <mrow>
       <mo>[</mo>
       <mrow>
        <mrow>
         <msubsup>
          <mi>F</mi>
          <mi>i</mi>
          <mrow>
           <mi>n</mi>
           <mo>+</mo>
           <mn>1</mn>
          </mrow>
         </msubsup>
         <mrow>
          <mo>(</mo>
          <mi>u</mi>
          <mo rspace="4.2pt">,</mo>
          <mi>x</mi>
          <mo rspace="4.2pt">,</mo>
          <mi>t</mi>
          <mo rspace="4.2pt">,</mo>
          <mfrac>
           <mrow>
            <mo>∂</mo>
            <mi>u</mi>
           </mrow>
           <mrow>
            <mo>∂</mo>
            <mi>x</mi>
           </mrow>
          </mfrac>
          <mo rspace="4.2pt">,</mo>
          <mfrac>
           <mrow>
            <msup>
             <mo>∂</mo>
             <mn>2</mn>
            </msup>
            <mi>u</mi>
           </mrow>
           <mrow>
            <mo>∂</mo>
            <msup>
             <mi>x</mi>
             <mn>2</mn>
            </msup>
           </mrow>
          </mfrac>
          <mo>)</mo>
         </mrow>
        </mrow>
        <mo>+</mo>
        <mrow>
         <msubsup>
          <mi>F</mi>
          <mi>i</mi>
          <mi>n</mi>
         </msubsup>
         <mrow>
          <mo>(</mo>
          <mi>u</mi>
          <mo rspace="4.2pt">,</mo>
          <mi>x</mi>
          <mo rspace="4.2pt">,</mo>
          <mi>t</mi>
          <mo rspace="4.2pt">,</mo>
          <mfrac>
           <mrow>
            <mo>∂</mo>
            <mi>u</mi>
           </mrow>
           <mrow>
            <mo>∂</mo>
            <mi>x</mi>
           </mrow>
          </mfrac>
          <mo rspace="4.2pt">,</mo>
          <mfrac>
           <mrow>
            <msup>
             <mo>∂</mo>
             <mn>2</mn>
            </msup>
            <mi>u</mi>
           </mrow>
           <mrow>
            <mo>∂</mo>
            <msup>
             <mi>x</mi>
             <mn>2</mn>
            </msup>
           </mrow>
          </mfrac>
          <mo>)</mo>
         </mrow>
        </mrow>
       </mrow>
       <mo>]</mo>
      </mrow>
     </mrow>
     <mtext>(Crank–Nicolson)</mtext>
    </mrow>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <divide></divide>
     <apply>
      <minus></minus>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>u</ci>
        <ci>i</ci>
       </apply>
       <apply>
        <plus></plus>
        <ci>n</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>u</ci>
        <ci>i</ci>
       </apply>
       <ci>n</ci>
      </apply>
     </apply>
     <apply>
      <times></times>
      <ci>normal-Δ</ci>
      <ci>t</ci>
     </apply>
    </apply>
    <list>
     <apply>
      <times></times>
      <apply>
       <divide></divide>
       <cn type="integer">1</cn>
       <cn type="integer">2</cn>
      </apply>
      <apply>
       <csymbol cd="latexml">delimited-[]</csymbol>
       <apply>
        <plus></plus>
        <apply>
         <times></times>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>F</ci>
           <ci>i</ci>
          </apply>
          <apply>
           <plus></plus>
           <ci>n</ci>
           <cn type="integer">1</cn>
          </apply>
         </apply>
         <vector>
          <ci>u</ci>
          <ci>x</ci>
          <ci>t</ci>
          <apply>
           <divide></divide>
           <apply>
            <partialdiff></partialdiff>
            <ci>u</ci>
           </apply>
           <apply>
            <partialdiff></partialdiff>
            <ci>x</ci>
           </apply>
          </apply>
          <apply>
           <divide></divide>
           <apply>
            <apply>
             <csymbol cd="ambiguous">superscript</csymbol>
             <partialdiff></partialdiff>
             <cn type="integer">2</cn>
            </apply>
            <ci>u</ci>
           </apply>
           <apply>
            <partialdiff></partialdiff>
            <apply>
             <csymbol cd="ambiguous">superscript</csymbol>
             <ci>x</ci>
             <cn type="integer">2</cn>
            </apply>
           </apply>
          </apply>
         </vector>
        </apply>
        <apply>
         <times></times>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>F</ci>
           <ci>i</ci>
          </apply>
          <ci>n</ci>
         </apply>
         <vector>
          <ci>u</ci>
          <ci>x</ci>
          <ci>t</ci>
          <apply>
           <divide></divide>
           <apply>
            <partialdiff></partialdiff>
            <ci>u</ci>
           </apply>
           <apply>
            <partialdiff></partialdiff>
            <ci>x</ci>
           </apply>
          </apply>
          <apply>
           <divide></divide>
           <apply>
            <apply>
             <csymbol cd="ambiguous">superscript</csymbol>
             <partialdiff></partialdiff>
             <cn type="integer">2</cn>
            </apply>
            <ci>u</ci>
           </apply>
           <apply>
            <partialdiff></partialdiff>
            <apply>
             <csymbol cd="ambiguous">superscript</csymbol>
             <ci>x</ci>
             <cn type="integer">2</cn>
            </apply>
           </apply>
          </apply>
         </vector>
        </apply>
       </apply>
      </apply>
     </apply>
     <mtext>(Crank–Nicolson)</mtext>
    </list>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \frac{u_{i}^{n+1}-u_{i}^{n}}{\Delta t}=\frac{1}{2}\left[F_{i}^{n+1}\left(u,\,x%
,\,t,\,\frac{\partial u}{\partial x},\,\frac{\partial^{2}u}{\partial x^{2}}%
\right)+F_{i}^{n}\left(u,\,x,\,t,\,\frac{\partial u}{\partial x},\,\frac{%
\partial^{2}u}{\partial x^{2}}\right)\right]\qquad\mbox{(Crank--Nicolson)}.
  </annotation>
 </semantics>
</math>

</p>

<p>Note that this is an <em>implicit method</em>: to get the "next" value of <em>u</em> in time, a system of algebraic equations must be solved. If the partial differential equation is nonlinear, the <a href="temporal_discretization" title="wikilink">discretization</a> will also be nonlinear so that advancing in time will involve the solution of a system of nonlinear algebraic equations, though linearizations are possible. In many problems, especially linear diffusion, the algebraic problem is <a class="uri" href="tridiagonal" title="wikilink">tridiagonal</a> and may be efficiently solved with the <a href="tridiagonal_matrix_algorithm" title="wikilink">tridiagonal matrix algorithm</a>, which gives a fast 

<math display="inline" id="Crank–Nicolson_method:9">
 <semantics>
  <mrow>
   <mi class="ltx_font_mathcaligraphic">𝒪</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>n</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>𝒪</ci>
    <ci>n</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathcal{O}(n)
  </annotation>
 </semantics>
</math>

 direct solution as opposed to the usual 

<math display="inline" id="Crank–Nicolson_method:10">
 <semantics>
  <mrow>
   <mi class="ltx_font_mathcaligraphic">𝒪</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <msup>
     <mi>n</mi>
     <mn>3</mn>
    </msup>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <ci>𝒪</ci>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>n</ci>
     <cn type="integer">3</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathcal{O}(n^{3})
  </annotation>
 </semantics>
</math>

 for a full matrix.</p>
<h2 id="example-1d-diffusion">Example: 1D diffusion</h2>

<p>The Crank–Nicolson method is often applied to <a href="Diffusion_equation" title="wikilink">diffusion problems</a>. As an example, for linear diffusion,</p>

<p>

<math display="block" id="Crank–Nicolson_method:11">
 <semantics>
  <mrow>
   <mfrac>
    <mrow>
     <mo>∂</mo>
     <mi>u</mi>
    </mrow>
    <mrow>
     <mo>∂</mo>
     <mi>t</mi>
    </mrow>
   </mfrac>
   <mo>=</mo>
   <mrow>
    <mi>a</mi>
    <mfrac>
     <mrow>
      <msup>
       <mo>∂</mo>
       <mn>2</mn>
      </msup>
      <mi>u</mi>
     </mrow>
     <mrow>
      <mo>∂</mo>
      <msup>
       <mi>x</mi>
       <mn>2</mn>
      </msup>
     </mrow>
    </mfrac>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <divide></divide>
     <apply>
      <partialdiff></partialdiff>
      <ci>u</ci>
     </apply>
     <apply>
      <partialdiff></partialdiff>
      <ci>t</ci>
     </apply>
    </apply>
    <apply>
     <times></times>
     <ci>a</ci>
     <apply>
      <divide></divide>
      <apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <partialdiff></partialdiff>
        <cn type="integer">2</cn>
       </apply>
       <ci>u</ci>
      </apply>
      <apply>
       <partialdiff></partialdiff>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>x</ci>
        <cn type="integer">2</cn>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   {\partial u\over\partial t}=a\frac{\partial^{2}u}{\partial x^{2}}
  </annotation>
 </semantics>
</math>

</p>

<p>applying a <a href="finite_difference" title="wikilink">finite difference</a> spatial discretization for the right hand side, the Crank–Nicolson discretization is then :</p>

<p>

<math display="block" id="Crank–Nicolson_method:12">
 <semantics>
  <mrow>
   <mfrac>
    <mrow>
     <msubsup>
      <mi>u</mi>
      <mi>i</mi>
      <mrow>
       <mi>n</mi>
       <mo>+</mo>
       <mn>1</mn>
      </mrow>
     </msubsup>
     <mo>-</mo>
     <msubsup>
      <mi>u</mi>
      <mi>i</mi>
      <mi>n</mi>
     </msubsup>
    </mrow>
    <mrow>
     <mi mathvariant="normal">Δ</mi>
     <mi>t</mi>
    </mrow>
   </mfrac>
   <mo>=</mo>
   <mrow>
    <mfrac>
     <mi>a</mi>
     <mrow>
      <mn>2</mn>
      <msup>
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mi mathvariant="normal">Δ</mi>
         <mi>x</mi>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
       <mn>2</mn>
      </msup>
     </mrow>
    </mfrac>
    <mrow>
     <mo>(</mo>
     <mrow>
      <mrow>
       <mo stretchy="false">(</mo>
       <mrow>
        <mrow>
         <msubsup>
          <mi>u</mi>
          <mrow>
           <mi>i</mi>
           <mo>+</mo>
           <mn>1</mn>
          </mrow>
          <mrow>
           <mi>n</mi>
           <mo>+</mo>
           <mn>1</mn>
          </mrow>
         </msubsup>
         <mo>-</mo>
         <mrow>
          <mn>2</mn>
          <msubsup>
           <mi>u</mi>
           <mi>i</mi>
           <mrow>
            <mi>n</mi>
            <mo>+</mo>
            <mn>1</mn>
           </mrow>
          </msubsup>
         </mrow>
        </mrow>
        <mo>+</mo>
        <msubsup>
         <mi>u</mi>
         <mrow>
          <mi>i</mi>
          <mo>-</mo>
          <mn>1</mn>
         </mrow>
         <mrow>
          <mi>n</mi>
          <mo>+</mo>
          <mn>1</mn>
         </mrow>
        </msubsup>
       </mrow>
       <mo stretchy="false">)</mo>
      </mrow>
      <mo>+</mo>
      <mrow>
       <mo stretchy="false">(</mo>
       <mrow>
        <mrow>
         <msubsup>
          <mi>u</mi>
          <mrow>
           <mi>i</mi>
           <mo>+</mo>
           <mn>1</mn>
          </mrow>
          <mi>n</mi>
         </msubsup>
         <mo>-</mo>
         <mrow>
          <mn>2</mn>
          <msubsup>
           <mi>u</mi>
           <mi>i</mi>
           <mi>n</mi>
          </msubsup>
         </mrow>
        </mrow>
        <mo>+</mo>
        <msubsup>
         <mi>u</mi>
         <mrow>
          <mi>i</mi>
          <mo>-</mo>
          <mn>1</mn>
         </mrow>
         <mi>n</mi>
        </msubsup>
       </mrow>
       <mo stretchy="false">)</mo>
      </mrow>
     </mrow>
     <mo>)</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <divide></divide>
     <apply>
      <minus></minus>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>u</ci>
        <ci>i</ci>
       </apply>
       <apply>
        <plus></plus>
        <ci>n</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>u</ci>
        <ci>i</ci>
       </apply>
       <ci>n</ci>
      </apply>
     </apply>
     <apply>
      <times></times>
      <ci>normal-Δ</ci>
      <ci>t</ci>
     </apply>
    </apply>
    <apply>
     <times></times>
     <apply>
      <divide></divide>
      <ci>a</ci>
      <apply>
       <times></times>
       <cn type="integer">2</cn>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <times></times>
         <ci>normal-Δ</ci>
         <ci>x</ci>
        </apply>
        <cn type="integer">2</cn>
       </apply>
      </apply>
     </apply>
     <apply>
      <plus></plus>
      <apply>
       <plus></plus>
       <apply>
        <minus></minus>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>u</ci>
          <apply>
           <plus></plus>
           <ci>i</ci>
           <cn type="integer">1</cn>
          </apply>
         </apply>
         <apply>
          <plus></plus>
          <ci>n</ci>
          <cn type="integer">1</cn>
         </apply>
        </apply>
        <apply>
         <times></times>
         <cn type="integer">2</cn>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>u</ci>
           <ci>i</ci>
          </apply>
          <apply>
           <plus></plus>
           <ci>n</ci>
           <cn type="integer">1</cn>
          </apply>
         </apply>
        </apply>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>u</ci>
         <apply>
          <minus></minus>
          <ci>i</ci>
          <cn type="integer">1</cn>
         </apply>
        </apply>
        <apply>
         <plus></plus>
         <ci>n</ci>
         <cn type="integer">1</cn>
        </apply>
       </apply>
      </apply>
      <apply>
       <plus></plus>
       <apply>
        <minus></minus>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>u</ci>
          <apply>
           <plus></plus>
           <ci>i</ci>
           <cn type="integer">1</cn>
          </apply>
         </apply>
         <ci>n</ci>
        </apply>
        <apply>
         <times></times>
         <cn type="integer">2</cn>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>u</ci>
           <ci>i</ci>
          </apply>
          <ci>n</ci>
         </apply>
        </apply>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>u</ci>
         <apply>
          <minus></minus>
          <ci>i</ci>
          <cn type="integer">1</cn>
         </apply>
        </apply>
        <ci>n</ci>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \frac{u_{i}^{n+1}-u_{i}^{n}}{\Delta t}=\frac{a}{2(\Delta x)^{2}}\left((u_{i+1}%
^{n+1}-2u_{i}^{n+1}+u_{i-1}^{n+1})+(u_{i+1}^{n}-2u_{i}^{n}+u_{i-1}^{n})\right)
  </annotation>
 </semantics>
</math>

</p>

<p>or, letting 

<math display="inline" id="Crank–Nicolson_method:13">
 <semantics>
  <mrow>
   <mi>r</mi>
   <mo>=</mo>
   <mfrac>
    <mrow>
     <mi>a</mi>
     <mi mathvariant="normal">Δ</mi>
     <mi>t</mi>
    </mrow>
    <msup>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <mi mathvariant="normal">Δ</mi>
       <mi>x</mi>
      </mrow>
      <mo stretchy="false">)</mo>
     </mrow>
     <mn>2</mn>
    </msup>
   </mfrac>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>r</ci>
    <apply>
     <divide></divide>
     <apply>
      <times></times>
      <ci>a</ci>
      <ci>normal-Δ</ci>
      <ci>t</ci>
     </apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <times></times>
       <ci>normal-Δ</ci>
       <ci>x</ci>
      </apply>
      <cn type="integer">2</cn>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   r=\frac{a\Delta t}{(\Delta x)^{2}}
  </annotation>
 </semantics>
</math>

:</p>

<p>

<math display="block" id="Crank–Nicolson_method:14">
 <semantics>
  <mrow>
   <mrow>
    <mrow>
     <mrow>
      <mo>-</mo>
      <mrow>
       <mi>r</mi>
       <msubsup>
        <mi>u</mi>
        <mrow>
         <mi>i</mi>
         <mo>+</mo>
         <mn>1</mn>
        </mrow>
        <mrow>
         <mi>n</mi>
         <mo>+</mo>
         <mn>1</mn>
        </mrow>
       </msubsup>
      </mrow>
     </mrow>
     <mo>+</mo>
     <mrow>
      <mn>2</mn>
      <mrow>
       <mo stretchy="false">(</mo>
       <mrow>
        <mn>1</mn>
        <mo>+</mo>
        <mi>r</mi>
       </mrow>
       <mo stretchy="false">)</mo>
      </mrow>
      <msubsup>
       <mi>u</mi>
       <mi>i</mi>
       <mrow>
        <mi>n</mi>
        <mo>+</mo>
        <mn>1</mn>
       </mrow>
      </msubsup>
     </mrow>
    </mrow>
    <mo>-</mo>
    <mrow>
     <mi>r</mi>
     <msubsup>
      <mi>u</mi>
      <mrow>
       <mi>i</mi>
       <mo>-</mo>
       <mn>1</mn>
      </mrow>
      <mrow>
       <mi>n</mi>
       <mo>+</mo>
       <mn>1</mn>
      </mrow>
     </msubsup>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mrow>
     <mi>r</mi>
     <msubsup>
      <mi>u</mi>
      <mrow>
       <mi>i</mi>
       <mo>+</mo>
       <mn>1</mn>
      </mrow>
      <mi>n</mi>
     </msubsup>
    </mrow>
    <mo>+</mo>
    <mrow>
     <mn>2</mn>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <mn>1</mn>
       <mo>-</mo>
       <mi>r</mi>
      </mrow>
      <mo stretchy="false">)</mo>
     </mrow>
     <msubsup>
      <mi>u</mi>
      <mi>i</mi>
      <mi>n</mi>
     </msubsup>
    </mrow>
    <mo>+</mo>
    <mrow>
     <mi>r</mi>
     <mpadded width="+1.7pt">
      <msubsup>
       <mi>u</mi>
       <mrow>
        <mi>i</mi>
        <mo>-</mo>
        <mn>1</mn>
       </mrow>
       <mi>n</mi>
      </msubsup>
     </mpadded>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <minus></minus>
     <apply>
      <plus></plus>
      <apply>
       <minus></minus>
       <apply>
        <times></times>
        <ci>r</ci>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>u</ci>
          <apply>
           <plus></plus>
           <ci>i</ci>
           <cn type="integer">1</cn>
          </apply>
         </apply>
         <apply>
          <plus></plus>
          <ci>n</ci>
          <cn type="integer">1</cn>
         </apply>
        </apply>
       </apply>
      </apply>
      <apply>
       <times></times>
       <cn type="integer">2</cn>
       <apply>
        <plus></plus>
        <cn type="integer">1</cn>
        <ci>r</ci>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>u</ci>
         <ci>i</ci>
        </apply>
        <apply>
         <plus></plus>
         <ci>n</ci>
         <cn type="integer">1</cn>
        </apply>
       </apply>
      </apply>
     </apply>
     <apply>
      <times></times>
      <ci>r</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>u</ci>
        <apply>
         <minus></minus>
         <ci>i</ci>
         <cn type="integer">1</cn>
        </apply>
       </apply>
       <apply>
        <plus></plus>
        <ci>n</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
     </apply>
    </apply>
    <apply>
     <plus></plus>
     <apply>
      <times></times>
      <ci>r</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>u</ci>
        <apply>
         <plus></plus>
         <ci>i</ci>
         <cn type="integer">1</cn>
        </apply>
       </apply>
       <ci>n</ci>
      </apply>
     </apply>
     <apply>
      <times></times>
      <cn type="integer">2</cn>
      <apply>
       <minus></minus>
       <cn type="integer">1</cn>
       <ci>r</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>u</ci>
        <ci>i</ci>
       </apply>
       <ci>n</ci>
      </apply>
     </apply>
     <apply>
      <times></times>
      <ci>r</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>u</ci>
        <apply>
         <minus></minus>
         <ci>i</ci>
         <cn type="integer">1</cn>
        </apply>
       </apply>
       <ci>n</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   -ru_{i+1}^{n+1}+2(1+r)u_{i}^{n+1}-ru_{i-1}^{n+1}=ru_{i+1}^{n}+2(1-r)u_{i}^{n}+%
ru_{i-1}^{n}\,
  </annotation>
 </semantics>
</math>

</p>

<p>which is a <a class="uri" href="tridiagonal" title="wikilink">tridiagonal</a> problem, so that 

<math display="inline" id="Crank–Nicolson_method:15">
 <semantics>
  <mpadded width="+1.7pt">
   <msubsup>
    <mi>u</mi>
    <mi>i</mi>
    <mrow>
     <mi>n</mi>
     <mo>+</mo>
     <mn>1</mn>
    </mrow>
   </msubsup>
  </mpadded>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>u</ci>
     <ci>i</ci>
    </apply>
    <apply>
     <plus></plus>
     <ci>n</ci>
     <cn type="integer">1</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   u_{i}^{n+1}\,
  </annotation>
 </semantics>
</math>

 may be efficiently solved by using the <a href="tridiagonal_matrix_algorithm" title="wikilink">tridiagonal matrix algorithm</a> in favor of a much more costly <a href="matrix_inversion" title="wikilink">matrix inversion</a>.</p>

<p>A quasilinear equation, such as (this is a minimalistic example and not general)</p>

<p>

<math display="block" id="Crank–Nicolson_method:16">
 <semantics>
  <mrow>
   <mfrac>
    <mrow>
     <mo>∂</mo>
     <mi>u</mi>
    </mrow>
    <mrow>
     <mo>∂</mo>
     <mi>t</mi>
    </mrow>
   </mfrac>
   <mo>=</mo>
   <mrow>
    <mi>a</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>u</mi>
     <mo stretchy="false">)</mo>
    </mrow>
    <mfrac>
     <mrow>
      <msup>
       <mo>∂</mo>
       <mn>2</mn>
      </msup>
      <mi>u</mi>
     </mrow>
     <mrow>
      <mo>∂</mo>
      <msup>
       <mi>x</mi>
       <mn>2</mn>
      </msup>
     </mrow>
    </mfrac>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <divide></divide>
     <apply>
      <partialdiff></partialdiff>
      <ci>u</ci>
     </apply>
     <apply>
      <partialdiff></partialdiff>
      <ci>t</ci>
     </apply>
    </apply>
    <apply>
     <times></times>
     <ci>a</ci>
     <ci>u</ci>
     <apply>
      <divide></divide>
      <apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <partialdiff></partialdiff>
        <cn type="integer">2</cn>
       </apply>
       <ci>u</ci>
      </apply>
      <apply>
       <partialdiff></partialdiff>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>x</ci>
        <cn type="integer">2</cn>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \frac{\partial u}{\partial t}=a(u)\frac{\partial^{2}u}{\partial x^{2}}
  </annotation>
 </semantics>
</math>

</p>

<p>would lead to a nonlinear system of algebraic equations which could not be easily solved as above; however, it is possible in some cases to linearize the problem by using the old value for 

<math display="inline" id="Crank–Nicolson_method:17">
 <semantics>
  <mi>a</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>a</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   a
  </annotation>
 </semantics>
</math>

, that is 

<math display="inline" id="Crank–Nicolson_method:18">
 <semantics>
  <mrow>
   <msubsup>
    <mi>a</mi>
    <mi>i</mi>
    <mi>n</mi>
   </msubsup>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>u</mi>
    <mo rspace="4.2pt" stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>a</ci>
      <ci>i</ci>
     </apply>
     <ci>n</ci>
    </apply>
    <ci>u</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   a_{i}^{n}(u)\,
  </annotation>
 </semantics>
</math>

 instead of 

<math display="inline" id="Crank–Nicolson_method:19">
 <semantics>
  <mrow>
   <msubsup>
    <mi>a</mi>
    <mi>i</mi>
    <mrow>
     <mi>n</mi>
     <mo>+</mo>
     <mn>1</mn>
    </mrow>
   </msubsup>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>u</mi>
    <mo rspace="4.2pt" stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>a</ci>
      <ci>i</ci>
     </apply>
     <apply>
      <plus></plus>
      <ci>n</ci>
      <cn type="integer">1</cn>
     </apply>
    </apply>
    <ci>u</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   a_{i}^{n+1}(u)\,
  </annotation>
 </semantics>
</math>

. Other times, it may be possible to estimate 

<math display="inline" id="Crank–Nicolson_method:20">
 <semantics>
  <mrow>
   <msubsup>
    <mi>a</mi>
    <mi>i</mi>
    <mrow>
     <mi>n</mi>
     <mo>+</mo>
     <mn>1</mn>
    </mrow>
   </msubsup>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>u</mi>
    <mo rspace="4.2pt" stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>a</ci>
      <ci>i</ci>
     </apply>
     <apply>
      <plus></plus>
      <ci>n</ci>
      <cn type="integer">1</cn>
     </apply>
    </apply>
    <ci>u</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   a_{i}^{n+1}(u)\,
  </annotation>
 </semantics>
</math>

 using an explicit method and maintain stability.</p>
<h2 id="example-1d-diffusion-with-advection-for-steady-flow-with-multiple-channel-connections">Example: 1D diffusion with advection for steady flow, with multiple channel connections</h2>

<p>This is a solution usually employed for many purposes when there is a contamination problem in streams or rivers under steady flow conditions but information is given in one dimension only. Often the problem can be simplified into a 1-dimensional problem and still yield useful information.</p>

<p>Here we model the concentration of a solute contaminant in water. This problem is composed of three parts: the known diffusion equation (

<math display="inline" id="Crank–Nicolson_method:21">
 <semantics>
  <msub>
   <mi>D</mi>
   <mi>x</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>D</ci>
    <ci>x</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   D_{x}
  </annotation>
 </semantics>
</math>

 chosen as constant), an advective component (which means the system is evolving in space due to a velocity field), which we choose to be a constant <em>Ux</em>, and a lateral interaction between longitudinal channels (k).</p>

<p>where <em>C</em> is the concentration of the contaminant and subscripts <em>N</em> and <em>M</em> correspond to <em>previous</em> and <em>next</em> channel.</p>

<p>The Crank–Nicolson method (where <em>i</em> represents position and <em>j</em> time) transforms each component of the PDE into the following:</p>

<p>{\Delta t}|<mtpl><eqref>2<eqref></eqref></eqref></mtpl>}}</p>

<p>Now we create the following constants to simplify the algebra:</p>

<p>

<math display="block" id="Crank–Nicolson_method:22">
 <semantics>
  <mrow>
   <mi>λ</mi>
   <mo>=</mo>
   <mfrac>
    <mrow>
     <msub>
      <mi>D</mi>
      <mi>x</mi>
     </msub>
     <mi mathvariant="normal">Δ</mi>
     <mi>t</mi>
    </mrow>
    <mrow>
     <mn>2</mn>
     <mi mathvariant="normal">Δ</mi>
     <msup>
      <mi>x</mi>
      <mn>2</mn>
     </msup>
    </mrow>
   </mfrac>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>λ</ci>
    <apply>
     <divide></divide>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>D</ci>
       <ci>x</ci>
      </apply>
      <ci>normal-Δ</ci>
      <ci>t</ci>
     </apply>
     <apply>
      <times></times>
      <cn type="integer">2</cn>
      <ci>normal-Δ</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>x</ci>
       <cn type="integer">2</cn>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \lambda=\frac{D_{x}\Delta t}{2\Delta x^{2}}
  </annotation>
 </semantics>
</math>

</p>

<p>

<math display="block" id="Crank–Nicolson_method:23">
 <semantics>
  <mrow>
   <mi>α</mi>
   <mo>=</mo>
   <mfrac>
    <mrow>
     <msub>
      <mi>U</mi>
      <mi>x</mi>
     </msub>
     <mi mathvariant="normal">Δ</mi>
     <mi>t</mi>
    </mrow>
    <mrow>
     <mn>4</mn>
     <mi mathvariant="normal">Δ</mi>
     <mi>x</mi>
    </mrow>
   </mfrac>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>α</ci>
    <apply>
     <divide></divide>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>U</ci>
       <ci>x</ci>
      </apply>
      <ci>normal-Δ</ci>
      <ci>t</ci>
     </apply>
     <apply>
      <times></times>
      <cn type="integer">4</cn>
      <ci>normal-Δ</ci>
      <ci>x</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \alpha=\frac{U_{x}\Delta t}{4\Delta x}
  </annotation>
 </semantics>
</math>

</p>

<p>

<math display="block" id="Crank–Nicolson_method:24">
 <semantics>
  <mrow>
   <mi>β</mi>
   <mo>=</mo>
   <mfrac>
    <mrow>
     <mi>k</mi>
     <mi mathvariant="normal">Δ</mi>
     <mi>t</mi>
    </mrow>
    <mn>2</mn>
   </mfrac>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>β</ci>
    <apply>
     <divide></divide>
     <apply>
      <times></times>
      <ci>k</ci>
      <ci>normal-Δ</ci>
      <ci>t</ci>
     </apply>
     <cn type="integer">2</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \beta=\frac{k\Delta t}{2}
  </annotation>
 </semantics>
</math>

</p>

<p>and substitute (), (), (), (), (), (), <em>α</em>, <em>β</em> and <em>λ</em> into (). We then put the <em>new time</em> terms on the left (<em>j</em> + 1) and the <em>present time</em> terms on the right (<em>j</em>) to get:</p>

<p>

<math display="block" id="Crank–Nicolson_method:25">
 <semantics>
  <mrow>
   <mrow>
    <mrow>
     <mrow>
      <mrow>
       <mrow>
        <mo>-</mo>
        <mrow>
         <mi>β</mi>
         <msubsup>
          <mi>C</mi>
          <mrow>
           <mi>N</mi>
           <mi>i</mi>
          </mrow>
          <mrow>
           <mi>j</mi>
           <mo>+</mo>
           <mn>1</mn>
          </mrow>
         </msubsup>
        </mrow>
       </mrow>
       <mo>-</mo>
       <mrow>
        <mrow>
         <mo stretchy="false">(</mo>
         <mrow>
          <mi>λ</mi>
          <mo>+</mo>
          <mi>α</mi>
         </mrow>
         <mo stretchy="false">)</mo>
        </mrow>
        <msubsup>
         <mi>C</mi>
         <mrow>
          <mi>i</mi>
          <mo>-</mo>
          <mn>1</mn>
         </mrow>
         <mrow>
          <mi>j</mi>
          <mo>+</mo>
          <mn>1</mn>
         </mrow>
        </msubsup>
       </mrow>
      </mrow>
      <mo>+</mo>
      <mrow>
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mn>1</mn>
         <mo>+</mo>
         <mrow>
          <mn>2</mn>
          <mi>λ</mi>
         </mrow>
         <mo>+</mo>
         <mrow>
          <mn>2</mn>
          <mi>β</mi>
         </mrow>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
       <msubsup>
        <mi>C</mi>
        <mi>i</mi>
        <mrow>
         <mi>j</mi>
         <mo>+</mo>
         <mn>1</mn>
        </mrow>
       </msubsup>
      </mrow>
     </mrow>
     <mo>-</mo>
     <mrow>
      <mrow>
       <mo stretchy="false">(</mo>
       <mrow>
        <mi>λ</mi>
        <mo>-</mo>
        <mi>α</mi>
       </mrow>
       <mo stretchy="false">)</mo>
      </mrow>
      <msubsup>
       <mi>C</mi>
       <mrow>
        <mi>i</mi>
        <mo>+</mo>
        <mn>1</mn>
       </mrow>
       <mrow>
        <mi>j</mi>
        <mo>+</mo>
        <mn>1</mn>
       </mrow>
      </msubsup>
     </mrow>
     <mo>-</mo>
     <mrow>
      <mi>β</mi>
      <msubsup>
       <mi>C</mi>
       <mrow>
        <mi>M</mi>
        <mi>i</mi>
       </mrow>
       <mrow>
        <mi>j</mi>
        <mo>+</mo>
        <mn>1</mn>
       </mrow>
      </msubsup>
     </mrow>
    </mrow>
    <mo>=</mo>
    <mrow>
     <mrow>
      <mi>β</mi>
      <msubsup>
       <mi>C</mi>
       <mrow>
        <mi>N</mi>
        <mi>i</mi>
       </mrow>
       <mi>j</mi>
      </msubsup>
     </mrow>
     <mo>+</mo>
     <mrow>
      <mrow>
       <mo stretchy="false">(</mo>
       <mrow>
        <mi>λ</mi>
        <mo>+</mo>
        <mi>α</mi>
       </mrow>
       <mo stretchy="false">)</mo>
      </mrow>
      <msubsup>
       <mi>C</mi>
       <mrow>
        <mi>i</mi>
        <mo>-</mo>
        <mn>1</mn>
       </mrow>
       <mi>j</mi>
      </msubsup>
     </mrow>
     <mo>+</mo>
     <mrow>
      <mrow>
       <mo stretchy="false">(</mo>
       <mrow>
        <mn>1</mn>
        <mo>-</mo>
        <mrow>
         <mn>2</mn>
         <mi>λ</mi>
        </mrow>
        <mo>-</mo>
        <mrow>
         <mn>2</mn>
         <mi>β</mi>
        </mrow>
       </mrow>
       <mo stretchy="false">)</mo>
      </mrow>
      <msubsup>
       <mi>C</mi>
       <mi>i</mi>
       <mi>j</mi>
      </msubsup>
     </mrow>
     <mo>+</mo>
     <mrow>
      <mrow>
       <mo stretchy="false">(</mo>
       <mrow>
        <mi>λ</mi>
        <mo>-</mo>
        <mi>α</mi>
       </mrow>
       <mo stretchy="false">)</mo>
      </mrow>
      <msubsup>
       <mi>C</mi>
       <mrow>
        <mi>i</mi>
        <mo>+</mo>
        <mn>1</mn>
       </mrow>
       <mi>j</mi>
      </msubsup>
     </mrow>
     <mo>+</mo>
     <mrow>
      <mi>β</mi>
      <msubsup>
       <mi>C</mi>
       <mrow>
        <mi>M</mi>
        <mi>i</mi>
       </mrow>
       <mi>j</mi>
      </msubsup>
     </mrow>
    </mrow>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <minus></minus>
     <apply>
      <plus></plus>
      <apply>
       <minus></minus>
       <apply>
        <minus></minus>
        <apply>
         <times></times>
         <ci>β</ci>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>C</ci>
           <apply>
            <times></times>
            <ci>N</ci>
            <ci>i</ci>
           </apply>
          </apply>
          <apply>
           <plus></plus>
           <ci>j</ci>
           <cn type="integer">1</cn>
          </apply>
         </apply>
        </apply>
       </apply>
       <apply>
        <times></times>
        <apply>
         <plus></plus>
         <ci>λ</ci>
         <ci>α</ci>
        </apply>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>C</ci>
          <apply>
           <minus></minus>
           <ci>i</ci>
           <cn type="integer">1</cn>
          </apply>
         </apply>
         <apply>
          <plus></plus>
          <ci>j</ci>
          <cn type="integer">1</cn>
         </apply>
        </apply>
       </apply>
      </apply>
      <apply>
       <times></times>
       <apply>
        <plus></plus>
        <cn type="integer">1</cn>
        <apply>
         <times></times>
         <cn type="integer">2</cn>
         <ci>λ</ci>
        </apply>
        <apply>
         <times></times>
         <cn type="integer">2</cn>
         <ci>β</ci>
        </apply>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>C</ci>
         <ci>i</ci>
        </apply>
        <apply>
         <plus></plus>
         <ci>j</ci>
         <cn type="integer">1</cn>
        </apply>
       </apply>
      </apply>
     </apply>
     <apply>
      <times></times>
      <apply>
       <minus></minus>
       <ci>λ</ci>
       <ci>α</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <apply>
         <plus></plus>
         <ci>i</ci>
         <cn type="integer">1</cn>
        </apply>
       </apply>
       <apply>
        <plus></plus>
        <ci>j</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
     </apply>
     <apply>
      <times></times>
      <ci>β</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <apply>
         <times></times>
         <ci>M</ci>
         <ci>i</ci>
        </apply>
       </apply>
       <apply>
        <plus></plus>
        <ci>j</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
     </apply>
    </apply>
    <apply>
     <plus></plus>
     <apply>
      <times></times>
      <ci>β</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <apply>
         <times></times>
         <ci>N</ci>
         <ci>i</ci>
        </apply>
       </apply>
       <ci>j</ci>
      </apply>
     </apply>
     <apply>
      <times></times>
      <apply>
       <plus></plus>
       <ci>λ</ci>
       <ci>α</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <apply>
         <minus></minus>
         <ci>i</ci>
         <cn type="integer">1</cn>
        </apply>
       </apply>
       <ci>j</ci>
      </apply>
     </apply>
     <apply>
      <times></times>
      <apply>
       <minus></minus>
       <cn type="integer">1</cn>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>λ</ci>
       </apply>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>β</ci>
       </apply>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <ci>i</ci>
       </apply>
       <ci>j</ci>
      </apply>
     </apply>
     <apply>
      <times></times>
      <apply>
       <minus></minus>
       <ci>λ</ci>
       <ci>α</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <apply>
         <plus></plus>
         <ci>i</ci>
         <cn type="integer">1</cn>
        </apply>
       </apply>
       <ci>j</ci>
      </apply>
     </apply>
     <apply>
      <times></times>
      <ci>β</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <apply>
         <times></times>
         <ci>M</ci>
         <ci>i</ci>
        </apply>
       </apply>
       <ci>j</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   -\beta C_{Ni}^{j+1}-(\lambda+\alpha)C_{i-1}^{j+1}+(1+2\lambda+2\beta)C_{i}^{j+%
1}-(\lambda-\alpha)C_{i+1}^{j+1}-\beta C_{Mi}^{j+1}=\beta C_{Ni}^{j}+(\lambda+%
\alpha)C_{i-1}^{j}+(1-2\lambda-2\beta)C_{i}^{j}+(\lambda-\alpha)C_{i+1}^{j}+%
\beta C_{Mi}^{j}.
  </annotation>
 </semantics>
</math>

</p>

<p>To model the <em>first</em> channel, we realize that it can only be in contact with the following channel (<em>M</em>), so the expression is simplified to:</p>

<p>

<math display="block" id="Crank–Nicolson_method:26">
 <semantics>
  <mrow>
   <mrow>
    <mrow>
     <mrow>
      <mrow>
       <mo>-</mo>
       <mrow>
        <mrow>
         <mo stretchy="false">(</mo>
         <mrow>
          <mi>λ</mi>
          <mo>+</mo>
          <mi>α</mi>
         </mrow>
         <mo stretchy="false">)</mo>
        </mrow>
        <msubsup>
         <mi>C</mi>
         <mrow>
          <mi>i</mi>
          <mo>-</mo>
          <mn>1</mn>
         </mrow>
         <mrow>
          <mi>j</mi>
          <mo>+</mo>
          <mn>1</mn>
         </mrow>
        </msubsup>
       </mrow>
      </mrow>
      <mo>+</mo>
      <mrow>
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mn>1</mn>
         <mo>+</mo>
         <mrow>
          <mn>2</mn>
          <mi>λ</mi>
         </mrow>
         <mo>+</mo>
         <mi>β</mi>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
       <msubsup>
        <mi>C</mi>
        <mi>i</mi>
        <mrow>
         <mi>j</mi>
         <mo>+</mo>
         <mn>1</mn>
        </mrow>
       </msubsup>
      </mrow>
     </mrow>
     <mo>-</mo>
     <mrow>
      <mrow>
       <mo stretchy="false">(</mo>
       <mrow>
        <mi>λ</mi>
        <mo>-</mo>
        <mi>α</mi>
       </mrow>
       <mo stretchy="false">)</mo>
      </mrow>
      <msubsup>
       <mi>C</mi>
       <mrow>
        <mi>i</mi>
        <mo>+</mo>
        <mn>1</mn>
       </mrow>
       <mrow>
        <mi>j</mi>
        <mo>+</mo>
        <mn>1</mn>
       </mrow>
      </msubsup>
     </mrow>
     <mo>-</mo>
     <mrow>
      <mi>β</mi>
      <msubsup>
       <mi>C</mi>
       <mrow>
        <mi>M</mi>
        <mi>i</mi>
       </mrow>
       <mrow>
        <mi>j</mi>
        <mo>+</mo>
        <mn>1</mn>
       </mrow>
      </msubsup>
     </mrow>
    </mrow>
    <mo>=</mo>
    <mrow>
     <mrow>
      <mo>+</mo>
      <mrow>
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mi>λ</mi>
         <mo>+</mo>
         <mi>α</mi>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
       <msubsup>
        <mi>C</mi>
        <mrow>
         <mi>i</mi>
         <mo>-</mo>
         <mn>1</mn>
        </mrow>
        <mi>j</mi>
       </msubsup>
      </mrow>
     </mrow>
     <mo>+</mo>
     <mrow>
      <mrow>
       <mo stretchy="false">(</mo>
       <mrow>
        <mn>1</mn>
        <mo>-</mo>
        <mrow>
         <mn>2</mn>
         <mi>λ</mi>
        </mrow>
        <mo>-</mo>
        <mi>β</mi>
       </mrow>
       <mo stretchy="false">)</mo>
      </mrow>
      <msubsup>
       <mi>C</mi>
       <mi>i</mi>
       <mi>j</mi>
      </msubsup>
     </mrow>
     <mo>+</mo>
     <mrow>
      <mrow>
       <mo stretchy="false">(</mo>
       <mrow>
        <mi>λ</mi>
        <mo>-</mo>
        <mi>α</mi>
       </mrow>
       <mo stretchy="false">)</mo>
      </mrow>
      <msubsup>
       <mi>C</mi>
       <mrow>
        <mi>i</mi>
        <mo>+</mo>
        <mn>1</mn>
       </mrow>
       <mi>j</mi>
      </msubsup>
     </mrow>
     <mo>+</mo>
     <mrow>
      <mi>β</mi>
      <msubsup>
       <mi>C</mi>
       <mrow>
        <mi>M</mi>
        <mi>i</mi>
       </mrow>
       <mi>j</mi>
      </msubsup>
     </mrow>
    </mrow>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <minus></minus>
     <apply>
      <plus></plus>
      <apply>
       <minus></minus>
       <apply>
        <times></times>
        <apply>
         <plus></plus>
         <ci>λ</ci>
         <ci>α</ci>
        </apply>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>C</ci>
          <apply>
           <minus></minus>
           <ci>i</ci>
           <cn type="integer">1</cn>
          </apply>
         </apply>
         <apply>
          <plus></plus>
          <ci>j</ci>
          <cn type="integer">1</cn>
         </apply>
        </apply>
       </apply>
      </apply>
      <apply>
       <times></times>
       <apply>
        <plus></plus>
        <cn type="integer">1</cn>
        <apply>
         <times></times>
         <cn type="integer">2</cn>
         <ci>λ</ci>
        </apply>
        <ci>β</ci>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>C</ci>
         <ci>i</ci>
        </apply>
        <apply>
         <plus></plus>
         <ci>j</ci>
         <cn type="integer">1</cn>
        </apply>
       </apply>
      </apply>
     </apply>
     <apply>
      <times></times>
      <apply>
       <minus></minus>
       <ci>λ</ci>
       <ci>α</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <apply>
         <plus></plus>
         <ci>i</ci>
         <cn type="integer">1</cn>
        </apply>
       </apply>
       <apply>
        <plus></plus>
        <ci>j</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
     </apply>
     <apply>
      <times></times>
      <ci>β</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <apply>
         <times></times>
         <ci>M</ci>
         <ci>i</ci>
        </apply>
       </apply>
       <apply>
        <plus></plus>
        <ci>j</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
     </apply>
    </apply>
    <apply>
     <plus></plus>
     <apply>
      <plus></plus>
      <apply>
       <times></times>
       <apply>
        <plus></plus>
        <ci>λ</ci>
        <ci>α</ci>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>C</ci>
         <apply>
          <minus></minus>
          <ci>i</ci>
          <cn type="integer">1</cn>
         </apply>
        </apply>
        <ci>j</ci>
       </apply>
      </apply>
     </apply>
     <apply>
      <times></times>
      <apply>
       <minus></minus>
       <cn type="integer">1</cn>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>λ</ci>
       </apply>
       <ci>β</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <ci>i</ci>
       </apply>
       <ci>j</ci>
      </apply>
     </apply>
     <apply>
      <times></times>
      <apply>
       <minus></minus>
       <ci>λ</ci>
       <ci>α</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <apply>
         <plus></plus>
         <ci>i</ci>
         <cn type="integer">1</cn>
        </apply>
       </apply>
       <ci>j</ci>
      </apply>
     </apply>
     <apply>
      <times></times>
      <ci>β</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <apply>
         <times></times>
         <ci>M</ci>
         <ci>i</ci>
        </apply>
       </apply>
       <ci>j</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   -(\lambda+\alpha)C_{i-1}^{j+1}+(1+2\lambda+\beta)C_{i}^{j+1}-(\lambda-\alpha)C%
_{i+1}^{j+1}-\beta C_{Mi}^{j+1}=+(\lambda+\alpha)C_{i-1}^{j}+(1-2\lambda-\beta%
)C_{i}^{j}+(\lambda-\alpha)C_{i+1}^{j}+\beta C_{Mi}^{j}.
  </annotation>
 </semantics>
</math>

</p>

<p>In the same way, to model the <em>last</em> channel, we realize that it can only be in contact with the previous channel (<em>N</em>), so the expression is simplified to:</p>

<p>

<math display="block" id="Crank–Nicolson_method:27">
 <semantics>
  <mrow>
   <mrow>
    <mrow>
     <mrow>
      <mrow>
       <mrow>
        <mo>-</mo>
        <mrow>
         <mi>β</mi>
         <msubsup>
          <mi>C</mi>
          <mrow>
           <mi>N</mi>
           <mi>i</mi>
          </mrow>
          <mrow>
           <mi>j</mi>
           <mo>+</mo>
           <mn>1</mn>
          </mrow>
         </msubsup>
        </mrow>
       </mrow>
       <mo>-</mo>
       <mrow>
        <mrow>
         <mo stretchy="false">(</mo>
         <mrow>
          <mi>λ</mi>
          <mo>+</mo>
          <mi>α</mi>
         </mrow>
         <mo stretchy="false">)</mo>
        </mrow>
        <msubsup>
         <mi>C</mi>
         <mrow>
          <mi>i</mi>
          <mo>-</mo>
          <mn>1</mn>
         </mrow>
         <mrow>
          <mi>j</mi>
          <mo>+</mo>
          <mn>1</mn>
         </mrow>
        </msubsup>
       </mrow>
      </mrow>
      <mo>+</mo>
      <mrow>
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mn>1</mn>
         <mo>+</mo>
         <mrow>
          <mn>2</mn>
          <mi>λ</mi>
         </mrow>
         <mo>+</mo>
         <mi>β</mi>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
       <msubsup>
        <mi>C</mi>
        <mi>i</mi>
        <mrow>
         <mi>j</mi>
         <mo>+</mo>
         <mn>1</mn>
        </mrow>
       </msubsup>
      </mrow>
     </mrow>
     <mo>-</mo>
     <mrow>
      <mrow>
       <mo stretchy="false">(</mo>
       <mrow>
        <mi>λ</mi>
        <mo>-</mo>
        <mi>α</mi>
       </mrow>
       <mo stretchy="false">)</mo>
      </mrow>
      <msubsup>
       <mi>C</mi>
       <mrow>
        <mi>i</mi>
        <mo>+</mo>
        <mn>1</mn>
       </mrow>
       <mrow>
        <mi>j</mi>
        <mo>+</mo>
        <mn>1</mn>
       </mrow>
      </msubsup>
     </mrow>
    </mrow>
    <mo>=</mo>
    <mrow>
     <mrow>
      <mi>β</mi>
      <msubsup>
       <mi>C</mi>
       <mrow>
        <mi>N</mi>
        <mi>i</mi>
       </mrow>
       <mi>j</mi>
      </msubsup>
     </mrow>
     <mo>+</mo>
     <mrow>
      <mrow>
       <mo stretchy="false">(</mo>
       <mrow>
        <mi>λ</mi>
        <mo>+</mo>
        <mi>α</mi>
       </mrow>
       <mo stretchy="false">)</mo>
      </mrow>
      <msubsup>
       <mi>C</mi>
       <mrow>
        <mi>i</mi>
        <mo>-</mo>
        <mn>1</mn>
       </mrow>
       <mi>j</mi>
      </msubsup>
     </mrow>
     <mo>+</mo>
     <mrow>
      <mrow>
       <mo stretchy="false">(</mo>
       <mrow>
        <mn>1</mn>
        <mo>-</mo>
        <mrow>
         <mn>2</mn>
         <mi>λ</mi>
        </mrow>
        <mo>-</mo>
        <mi>β</mi>
       </mrow>
       <mo stretchy="false">)</mo>
      </mrow>
      <msubsup>
       <mi>C</mi>
       <mi>i</mi>
       <mi>j</mi>
      </msubsup>
     </mrow>
     <mo>+</mo>
     <mrow>
      <mrow>
       <mo stretchy="false">(</mo>
       <mrow>
        <mi>λ</mi>
        <mo>-</mo>
        <mi>α</mi>
       </mrow>
       <mo stretchy="false">)</mo>
      </mrow>
      <msubsup>
       <mi>C</mi>
       <mrow>
        <mi>i</mi>
        <mo>+</mo>
        <mn>1</mn>
       </mrow>
       <mi>j</mi>
      </msubsup>
     </mrow>
    </mrow>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <minus></minus>
     <apply>
      <plus></plus>
      <apply>
       <minus></minus>
       <apply>
        <minus></minus>
        <apply>
         <times></times>
         <ci>β</ci>
         <apply>
          <csymbol cd="ambiguous">superscript</csymbol>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>C</ci>
           <apply>
            <times></times>
            <ci>N</ci>
            <ci>i</ci>
           </apply>
          </apply>
          <apply>
           <plus></plus>
           <ci>j</ci>
           <cn type="integer">1</cn>
          </apply>
         </apply>
        </apply>
       </apply>
       <apply>
        <times></times>
        <apply>
         <plus></plus>
         <ci>λ</ci>
         <ci>α</ci>
        </apply>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>C</ci>
          <apply>
           <minus></minus>
           <ci>i</ci>
           <cn type="integer">1</cn>
          </apply>
         </apply>
         <apply>
          <plus></plus>
          <ci>j</ci>
          <cn type="integer">1</cn>
         </apply>
        </apply>
       </apply>
      </apply>
      <apply>
       <times></times>
       <apply>
        <plus></plus>
        <cn type="integer">1</cn>
        <apply>
         <times></times>
         <cn type="integer">2</cn>
         <ci>λ</ci>
        </apply>
        <ci>β</ci>
       </apply>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>C</ci>
         <ci>i</ci>
        </apply>
        <apply>
         <plus></plus>
         <ci>j</ci>
         <cn type="integer">1</cn>
        </apply>
       </apply>
      </apply>
     </apply>
     <apply>
      <times></times>
      <apply>
       <minus></minus>
       <ci>λ</ci>
       <ci>α</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <apply>
         <plus></plus>
         <ci>i</ci>
         <cn type="integer">1</cn>
        </apply>
       </apply>
       <apply>
        <plus></plus>
        <ci>j</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
     </apply>
    </apply>
    <apply>
     <plus></plus>
     <apply>
      <times></times>
      <ci>β</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <apply>
         <times></times>
         <ci>N</ci>
         <ci>i</ci>
        </apply>
       </apply>
       <ci>j</ci>
      </apply>
     </apply>
     <apply>
      <times></times>
      <apply>
       <plus></plus>
       <ci>λ</ci>
       <ci>α</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <apply>
         <minus></minus>
         <ci>i</ci>
         <cn type="integer">1</cn>
        </apply>
       </apply>
       <ci>j</ci>
      </apply>
     </apply>
     <apply>
      <times></times>
      <apply>
       <minus></minus>
       <cn type="integer">1</cn>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>λ</ci>
       </apply>
       <ci>β</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <ci>i</ci>
       </apply>
       <ci>j</ci>
      </apply>
     </apply>
     <apply>
      <times></times>
      <apply>
       <minus></minus>
       <ci>λ</ci>
       <ci>α</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <apply>
         <plus></plus>
         <ci>i</ci>
         <cn type="integer">1</cn>
        </apply>
       </apply>
       <ci>j</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   -\beta C_{Ni}^{j+1}-(\lambda+\alpha)C_{i-1}^{j+1}+(1+2\lambda+\beta)C_{i}^{j+1%
}-(\lambda-\alpha)C_{i+1}^{j+1}=\beta C_{Ni}^{j}+(\lambda+\alpha)C_{i-1}^{j}+(%
1-2\lambda-\beta)C_{i}^{j}+(\lambda-\alpha)C_{i+1}^{j}.
  </annotation>
 </semantics>
</math>

</p>

<p>To solve this linear system of equations we must now see that boundary conditions must be given first to the beginning of the channels:</p>

<p>

<math display="inline" id="Crank–Nicolson_method:28">
 <semantics>
  <msubsup>
   <mi>C</mi>
   <mn>0</mn>
   <mi>j</mi>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>C</ci>
     <cn type="integer">0</cn>
    </apply>
    <ci>j</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C_{0}^{j}
  </annotation>
 </semantics>
</math>

: initial condition for the channel at present time step<br/>


<math display="inline" id="Crank–Nicolson_method:29">
 <semantics>
  <msubsup>
   <mi>C</mi>
   <mn>0</mn>
   <mrow>
    <mi>j</mi>
    <mo>+</mo>
    <mn>1</mn>
   </mrow>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>C</ci>
     <cn type="integer">0</cn>
    </apply>
    <apply>
     <plus></plus>
     <ci>j</ci>
     <cn type="integer">1</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C_{0}^{j+1}
  </annotation>
 </semantics>
</math>

: initial condition for the channel at next time step<br/>


<math display="inline" id="Crank–Nicolson_method:30">
 <semantics>
  <msubsup>
   <mi>C</mi>
   <mrow>
    <mi>N</mi>
    <mn>0</mn>
   </mrow>
   <mi>j</mi>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>C</ci>
     <apply>
      <times></times>
      <ci>N</ci>
      <cn type="integer">0</cn>
     </apply>
    </apply>
    <ci>j</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C_{N0}^{j}
  </annotation>
 </semantics>
</math>

: initial condition for the previous channel to the one analyzed at present time step<br/>


<math display="inline" id="Crank–Nicolson_method:31">
 <semantics>
  <msubsup>
   <mi>C</mi>
   <mrow>
    <mi>M</mi>
    <mn>0</mn>
   </mrow>
   <mi>j</mi>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>C</ci>
     <apply>
      <times></times>
      <ci>M</ci>
      <cn type="integer">0</cn>
     </apply>
    </apply>
    <ci>j</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C_{M0}^{j}
  </annotation>
 </semantics>
</math>

: initial condition for the next channel to the one analyzed at present time step.</p>

<p>For the last cell of the channels (<em>z</em>) the most convenient condition becomes an adiabatic one, so</p>

<p>

<math display="block" id="Crank–Nicolson_method:32">
 <semantics>
  <mrow>
   <msub>
    <mfrac>
     <mrow>
      <mo>∂</mo>
      <mi>C</mi>
     </mrow>
     <mrow>
      <mo>∂</mo>
      <mi>x</mi>
     </mrow>
    </mfrac>
    <mrow>
     <mi>x</mi>
     <mo>=</mo>
     <mi>z</mi>
    </mrow>
   </msub>
   <mo>=</mo>
   <mfrac>
    <mrow>
     <mo stretchy="false">(</mo>
     <mrow>
      <msub>
       <mi>C</mi>
       <mrow>
        <mi>i</mi>
        <mo>+</mo>
        <mn>1</mn>
       </mrow>
      </msub>
      <mo>-</mo>
      <msub>
       <mi>C</mi>
       <mrow>
        <mi>i</mi>
        <mo>-</mo>
        <mn>1</mn>
       </mrow>
      </msub>
     </mrow>
     <mo stretchy="false">)</mo>
    </mrow>
    <mrow>
     <mn>2</mn>
     <mi mathvariant="normal">Δ</mi>
     <mi>x</mi>
    </mrow>
   </mfrac>
   <mo>=</mo>
   <mn>0.</mn>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <and></and>
    <apply>
     <eq></eq>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <apply>
       <divide></divide>
       <apply>
        <partialdiff></partialdiff>
        <ci>C</ci>
       </apply>
       <apply>
        <partialdiff></partialdiff>
        <ci>x</ci>
       </apply>
      </apply>
      <apply>
       <eq></eq>
       <ci>x</ci>
       <ci>z</ci>
      </apply>
     </apply>
     <apply>
      <divide></divide>
      <apply>
       <minus></minus>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <apply>
         <plus></plus>
         <ci>i</ci>
         <cn type="integer">1</cn>
        </apply>
       </apply>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <apply>
         <minus></minus>
         <ci>i</ci>
         <cn type="integer">1</cn>
        </apply>
       </apply>
      </apply>
      <apply>
       <times></times>
       <cn type="integer">2</cn>
       <ci>normal-Δ</ci>
       <ci>x</ci>
      </apply>
     </apply>
    </apply>
    <apply>
     <eq></eq>
     <share href="#.cmml">
     </share>
     <cn type="float">0.</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \frac{\partial C}{\partial x}_{x=z}=\frac{(C_{i+1}-C_{i-1})}{2\Delta x}=0.
  </annotation>
 </semantics>
</math>

</p>

<p>This condition is satisfied if and only if (regardless of a null value)</p>

<p>

<math display="block" id="Crank–Nicolson_method:33">
 <semantics>
  <mrow>
   <mrow>
    <msubsup>
     <mi>C</mi>
     <mrow>
      <mi>i</mi>
      <mo>+</mo>
      <mn>1</mn>
     </mrow>
     <mrow>
      <mi>j</mi>
      <mo>+</mo>
      <mn>1</mn>
     </mrow>
    </msubsup>
    <mo>=</mo>
    <msubsup>
     <mi>C</mi>
     <mrow>
      <mi>i</mi>
      <mo>-</mo>
      <mn>1</mn>
     </mrow>
     <mrow>
      <mi>j</mi>
      <mo>+</mo>
      <mn>1</mn>
     </mrow>
    </msubsup>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>C</ci>
      <apply>
       <plus></plus>
       <ci>i</ci>
       <cn type="integer">1</cn>
      </apply>
     </apply>
     <apply>
      <plus></plus>
      <ci>j</ci>
      <cn type="integer">1</cn>
     </apply>
    </apply>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>C</ci>
      <apply>
       <minus></minus>
       <ci>i</ci>
       <cn type="integer">1</cn>
      </apply>
     </apply>
     <apply>
      <plus></plus>
      <ci>j</ci>
      <cn type="integer">1</cn>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   C_{i+1}^{j+1}=C_{i-1}^{j+1}.\,
  </annotation>
 </semantics>
</math>

</p>

<p>Let us solve this problem (in a matrix form) for the case of 3 channels and 5 nodes (including the initial boundary condition). We express this as a linear system problem:</p>

<p>

<math display="block" id="Crank–Nicolson_method:34">
 <semantics>
  <mrow>
   <mrow>
    <mrow>
     <mo>[</mo>
     <mtable displaystyle="true">
      <mtr>
       <mtd columnalign="center">
        <mrow>
         <mi>A</mi>
         <mi>A</mi>
        </mrow>
       </mtd>
      </mtr>
     </mtable>
     <mo>]</mo>
    </mrow>
    <mrow>
     <mo>[</mo>
     <mtable displaystyle="true">
      <mtr>
       <mtd columnalign="center">
        <msup>
         <mi>C</mi>
         <mrow>
          <mi>j</mi>
          <mo>+</mo>
          <mn>1</mn>
         </mrow>
        </msup>
       </mtd>
      </mtr>
     </mtable>
     <mo>]</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mrow>
     <mrow>
      <mo stretchy="false">[</mo>
      <mrow>
       <mi>B</mi>
       <mi>B</mi>
      </mrow>
      <mo stretchy="false">]</mo>
     </mrow>
     <mrow>
      <mo stretchy="false">[</mo>
      <msup>
       <mi>C</mi>
       <mi>j</mi>
      </msup>
      <mo stretchy="false">]</mo>
     </mrow>
    </mrow>
    <mo>+</mo>
    <mrow>
     <mo stretchy="false">[</mo>
     <mi>d</mi>
     <mo stretchy="false">]</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <matrix>
      <matrixrow>
       <apply>
        <times></times>
        <ci>A</ci>
        <ci>A</ci>
       </apply>
      </matrixrow>
     </matrix>
     <matrix>
      <matrixrow>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>C</ci>
        <apply>
         <plus></plus>
         <ci>j</ci>
         <cn type="integer">1</cn>
        </apply>
       </apply>
      </matrixrow>
     </matrix>
    </apply>
    <apply>
     <plus></plus>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="latexml">delimited-[]</csymbol>
       <apply>
        <times></times>
        <ci>B</ci>
        <ci>B</ci>
       </apply>
      </apply>
      <apply>
       <csymbol cd="latexml">delimited-[]</csymbol>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <ci>C</ci>
        <ci>j</ci>
       </apply>
      </apply>
     </apply>
     <apply>
      <csymbol cd="latexml">delimited-[]</csymbol>
      <ci>d</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \begin{bmatrix}AA\end{bmatrix}\begin{bmatrix}C^{j+1}\end{bmatrix}=[BB][C^{j}]+%
[d]
  </annotation>
 </semantics>
</math>

</p>

<p>where</p>

<p>

<math display="block" id="Crank–Nicolson_method:35">
 <semantics>
  <mrow>
   <msup>
    <mi>𝐂</mi>
    <mrow>
     <mi>𝐣</mi>
     <mo>+</mo>
     <mn>𝟏</mn>
    </mrow>
   </msup>
   <mo>=</mo>
   <mrow>
    <mo>[</mo>
    <mtable displaystyle="true">
     <mtr>
      <mtd columnalign="center">
       <msubsup>
        <mi>C</mi>
        <mn>11</mn>
        <mrow>
         <mi>j</mi>
         <mo>+</mo>
         <mn>1</mn>
        </mrow>
       </msubsup>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <msubsup>
        <mi>C</mi>
        <mn>12</mn>
        <mrow>
         <mi>j</mi>
         <mo>+</mo>
         <mn>1</mn>
        </mrow>
       </msubsup>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <msubsup>
        <mi>C</mi>
        <mn>13</mn>
        <mrow>
         <mi>j</mi>
         <mo>+</mo>
         <mn>1</mn>
        </mrow>
       </msubsup>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <msubsup>
        <mi>C</mi>
        <mn>14</mn>
        <mrow>
         <mi>j</mi>
         <mo>+</mo>
         <mn>1</mn>
        </mrow>
       </msubsup>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <msubsup>
        <mi>C</mi>
        <mn>21</mn>
        <mrow>
         <mi>j</mi>
         <mo>+</mo>
         <mn>1</mn>
        </mrow>
       </msubsup>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <msubsup>
        <mi>C</mi>
        <mn>22</mn>
        <mrow>
         <mi>j</mi>
         <mo>+</mo>
         <mn>1</mn>
        </mrow>
       </msubsup>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <msubsup>
        <mi>C</mi>
        <mn>23</mn>
        <mrow>
         <mi>j</mi>
         <mo>+</mo>
         <mn>1</mn>
        </mrow>
       </msubsup>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <msubsup>
        <mi>C</mi>
        <mn>24</mn>
        <mrow>
         <mi>j</mi>
         <mo>+</mo>
         <mn>1</mn>
        </mrow>
       </msubsup>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <msubsup>
        <mi>C</mi>
        <mn>31</mn>
        <mrow>
         <mi>j</mi>
         <mo>+</mo>
         <mn>1</mn>
        </mrow>
       </msubsup>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <msubsup>
        <mi>C</mi>
        <mn>32</mn>
        <mrow>
         <mi>j</mi>
         <mo>+</mo>
         <mn>1</mn>
        </mrow>
       </msubsup>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <msubsup>
        <mi>C</mi>
        <mn>33</mn>
        <mrow>
         <mi>j</mi>
         <mo>+</mo>
         <mn>1</mn>
        </mrow>
       </msubsup>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <msubsup>
        <mi>C</mi>
        <mn>34</mn>
        <mrow>
         <mi>j</mi>
         <mo>+</mo>
         <mn>1</mn>
        </mrow>
       </msubsup>
      </mtd>
     </mtr>
    </mtable>
    <mo>]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>𝐂</ci>
     <apply>
      <plus></plus>
      <ci>𝐣</ci>
      <cn type="integer">1</cn>
     </apply>
    </apply>
    <matrix>
     <matrixrow>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <cn type="integer">11</cn>
       </apply>
       <apply>
        <plus></plus>
        <ci>j</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
     </matrixrow>
     <matrixrow>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <cn type="integer">12</cn>
       </apply>
       <apply>
        <plus></plus>
        <ci>j</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
     </matrixrow>
     <matrixrow>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <cn type="integer">13</cn>
       </apply>
       <apply>
        <plus></plus>
        <ci>j</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
     </matrixrow>
     <matrixrow>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <cn type="integer">14</cn>
       </apply>
       <apply>
        <plus></plus>
        <ci>j</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
     </matrixrow>
     <matrixrow>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <cn type="integer">21</cn>
       </apply>
       <apply>
        <plus></plus>
        <ci>j</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
     </matrixrow>
     <matrixrow>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <cn type="integer">22</cn>
       </apply>
       <apply>
        <plus></plus>
        <ci>j</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
     </matrixrow>
     <matrixrow>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <cn type="integer">23</cn>
       </apply>
       <apply>
        <plus></plus>
        <ci>j</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
     </matrixrow>
     <matrixrow>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <cn type="integer">24</cn>
       </apply>
       <apply>
        <plus></plus>
        <ci>j</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
     </matrixrow>
     <matrixrow>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <cn type="integer">31</cn>
       </apply>
       <apply>
        <plus></plus>
        <ci>j</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
     </matrixrow>
     <matrixrow>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <cn type="integer">32</cn>
       </apply>
       <apply>
        <plus></plus>
        <ci>j</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
     </matrixrow>
     <matrixrow>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <cn type="integer">33</cn>
       </apply>
       <apply>
        <plus></plus>
        <ci>j</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
     </matrixrow>
     <matrixrow>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <cn type="integer">34</cn>
       </apply>
       <apply>
        <plus></plus>
        <ci>j</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
     </matrixrow>
    </matrix>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{C^{j+1}}=\begin{bmatrix}C_{11}^{j+1}\\
C_{12}^{j+1}\\
C_{13}^{j+1}\\
C_{14}^{j+1}\\
C_{21}^{j+1}\\
C_{22}^{j+1}\\
C_{23}^{j+1}\\
C_{24}^{j+1}\\
C_{31}^{j+1}\\
C_{32}^{j+1}\\
C_{33}^{j+1}\\
C_{34}^{j+1}\end{bmatrix}
  </annotation>
 </semantics>
</math>

   and   

<math display="inline" id="Crank–Nicolson_method:36">
 <semantics>
  <mrow>
   <mrow>
    <msup>
     <mi>𝐂</mi>
     <mi>𝐣</mi>
    </msup>
    <mo>=</mo>
    <mrow>
     <mo>[</mo>
     <mtable>
      <mtr>
       <mtd columnalign="center">
        <msubsup>
         <mi>C</mi>
         <mn>11</mn>
         <mi>j</mi>
        </msubsup>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <msubsup>
         <mi>C</mi>
         <mn>12</mn>
         <mi>j</mi>
        </msubsup>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <msubsup>
         <mi>C</mi>
         <mn>13</mn>
         <mi>j</mi>
        </msubsup>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <msubsup>
         <mi>C</mi>
         <mn>14</mn>
         <mi>j</mi>
        </msubsup>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <msubsup>
         <mi>C</mi>
         <mn>21</mn>
         <mi>j</mi>
        </msubsup>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <msubsup>
         <mi>C</mi>
         <mn>22</mn>
         <mi>j</mi>
        </msubsup>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <msubsup>
         <mi>C</mi>
         <mn>23</mn>
         <mi>j</mi>
        </msubsup>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <msubsup>
         <mi>C</mi>
         <mn>24</mn>
         <mi>j</mi>
        </msubsup>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <msubsup>
         <mi>C</mi>
         <mn>31</mn>
         <mi>j</mi>
        </msubsup>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <msubsup>
         <mi>C</mi>
         <mn>32</mn>
         <mi>j</mi>
        </msubsup>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <msubsup>
         <mi>C</mi>
         <mn>33</mn>
         <mi>j</mi>
        </msubsup>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <msubsup>
         <mi>C</mi>
         <mn>34</mn>
         <mi>j</mi>
        </msubsup>
       </mtd>
      </mtr>
     </mtable>
     <mo>]</mo>
    </mrow>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <ci>𝐂</ci>
     <ci>𝐣</ci>
    </apply>
    <matrix>
     <matrixrow>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <cn type="integer">11</cn>
       </apply>
       <ci>j</ci>
      </apply>
     </matrixrow>
     <matrixrow>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <cn type="integer">12</cn>
       </apply>
       <ci>j</ci>
      </apply>
     </matrixrow>
     <matrixrow>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <cn type="integer">13</cn>
       </apply>
       <ci>j</ci>
      </apply>
     </matrixrow>
     <matrixrow>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <cn type="integer">14</cn>
       </apply>
       <ci>j</ci>
      </apply>
     </matrixrow>
     <matrixrow>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <cn type="integer">21</cn>
       </apply>
       <ci>j</ci>
      </apply>
     </matrixrow>
     <matrixrow>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <cn type="integer">22</cn>
       </apply>
       <ci>j</ci>
      </apply>
     </matrixrow>
     <matrixrow>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <cn type="integer">23</cn>
       </apply>
       <ci>j</ci>
      </apply>
     </matrixrow>
     <matrixrow>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <cn type="integer">24</cn>
       </apply>
       <ci>j</ci>
      </apply>
     </matrixrow>
     <matrixrow>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <cn type="integer">31</cn>
       </apply>
       <ci>j</ci>
      </apply>
     </matrixrow>
     <matrixrow>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <cn type="integer">32</cn>
       </apply>
       <ci>j</ci>
      </apply>
     </matrixrow>
     <matrixrow>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <cn type="integer">33</cn>
       </apply>
       <ci>j</ci>
      </apply>
     </matrixrow>
     <matrixrow>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>C</ci>
        <cn type="integer">34</cn>
       </apply>
       <ci>j</ci>
      </apply>
     </matrixrow>
    </matrix>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{C^{j}}=\begin{bmatrix}C_{11}^{j}\\
C_{12}^{j}\\
C_{13}^{j}\\
C_{14}^{j}\\
C_{21}^{j}\\
C_{22}^{j}\\
C_{23}^{j}\\
C_{24}^{j}\\
C_{31}^{j}\\
C_{32}^{j}\\
C_{33}^{j}\\
C_{34}^{j}\end{bmatrix}.
  </annotation>
 </semantics>
</math>

</p>

<p>Now we must realize that <em>AA</em> and <em>BB</em> should be arrays made of four different subarrays (remember that only three channels are considered for this example but it covers the main part discussed above).</p>

<p>

<math display="block" id="Crank–Nicolson_method:37">
 <semantics>
  <mrow>
   <mi>𝐀𝐀</mi>
   <mo>=</mo>
   <mrow>
    <mo>[</mo>
    <mtable displaystyle="true">
     <mtr>
      <mtd columnalign="center">
       <mrow>
        <mi>A</mi>
        <mi>A</mi>
        <mn>1</mn>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mi>A</mi>
        <mi>A</mi>
        <mn>3</mn>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <mrow>
        <mi>A</mi>
        <mi>A</mi>
        <mn>3</mn>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mi>A</mi>
        <mi>A</mi>
        <mn>2</mn>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mi>A</mi>
        <mi>A</mi>
        <mn>3</mn>
       </mrow>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mi>A</mi>
        <mi>A</mi>
        <mn>3</mn>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mi>A</mi>
        <mi>A</mi>
        <mn>1</mn>
       </mrow>
      </mtd>
     </mtr>
    </mtable>
    <mo>]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>𝐀𝐀</ci>
    <matrix>
     <matrixrow>
      <apply>
       <times></times>
       <ci>A</ci>
       <ci>A</ci>
       <cn type="integer">1</cn>
      </apply>
      <apply>
       <times></times>
       <ci>A</ci>
       <ci>A</ci>
       <cn type="integer">3</cn>
      </apply>
      <cn type="integer">0</cn>
     </matrixrow>
     <matrixrow>
      <apply>
       <times></times>
       <ci>A</ci>
       <ci>A</ci>
       <cn type="integer">3</cn>
      </apply>
      <apply>
       <times></times>
       <ci>A</ci>
       <ci>A</ci>
       <cn type="integer">2</cn>
      </apply>
      <apply>
       <times></times>
       <ci>A</ci>
       <ci>A</ci>
       <cn type="integer">3</cn>
      </apply>
     </matrixrow>
     <matrixrow>
      <cn type="integer">0</cn>
      <apply>
       <times></times>
       <ci>A</ci>
       <ci>A</ci>
       <cn type="integer">3</cn>
      </apply>
      <apply>
       <times></times>
       <ci>A</ci>
       <ci>A</ci>
       <cn type="integer">1</cn>
      </apply>
     </matrixrow>
    </matrix>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{AA}=\begin{bmatrix}AA1&AA3&0\\
AA3&AA2&AA3\\
0&AA3&AA1\end{bmatrix}
  </annotation>
 </semantics>
</math>

   and  </p>

<p>

<math display="block" id="Crank–Nicolson_method:38">
 <semantics>
  <mrow>
   <mi>𝐁𝐁</mi>
   <mo>=</mo>
   <mrow>
    <mo>[</mo>
    <mtable displaystyle="true">
     <mtr>
      <mtd columnalign="center">
       <mrow>
        <mi>B</mi>
        <mi>B</mi>
        <mn>1</mn>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo>-</mo>
        <mrow>
         <mi>A</mi>
         <mi>A</mi>
         <mn>3</mn>
        </mrow>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <mrow>
        <mo>-</mo>
        <mrow>
         <mi>A</mi>
         <mi>A</mi>
         <mn>3</mn>
        </mrow>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mi>B</mi>
        <mi>B</mi>
        <mn>2</mn>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo>-</mo>
        <mrow>
         <mi>A</mi>
         <mi>A</mi>
         <mn>3</mn>
        </mrow>
       </mrow>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo>-</mo>
        <mrow>
         <mi>A</mi>
         <mi>A</mi>
         <mn>3</mn>
        </mrow>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mi>B</mi>
        <mi>B</mi>
        <mn>1</mn>
       </mrow>
      </mtd>
     </mtr>
    </mtable>
    <mo>]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>𝐁𝐁</ci>
    <matrix>
     <matrixrow>
      <apply>
       <times></times>
       <ci>B</ci>
       <ci>B</ci>
       <cn type="integer">1</cn>
      </apply>
      <apply>
       <minus></minus>
       <apply>
        <times></times>
        <ci>A</ci>
        <ci>A</ci>
        <cn type="integer">3</cn>
       </apply>
      </apply>
      <cn type="integer">0</cn>
     </matrixrow>
     <matrixrow>
      <apply>
       <minus></minus>
       <apply>
        <times></times>
        <ci>A</ci>
        <ci>A</ci>
        <cn type="integer">3</cn>
       </apply>
      </apply>
      <apply>
       <times></times>
       <ci>B</ci>
       <ci>B</ci>
       <cn type="integer">2</cn>
      </apply>
      <apply>
       <minus></minus>
       <apply>
        <times></times>
        <ci>A</ci>
        <ci>A</ci>
        <cn type="integer">3</cn>
       </apply>
      </apply>
     </matrixrow>
     <matrixrow>
      <cn type="integer">0</cn>
      <apply>
       <minus></minus>
       <apply>
        <times></times>
        <ci>A</ci>
        <ci>A</ci>
        <cn type="integer">3</cn>
       </apply>
      </apply>
      <apply>
       <times></times>
       <ci>B</ci>
       <ci>B</ci>
       <cn type="integer">1</cn>
      </apply>
     </matrixrow>
    </matrix>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{BB}=\begin{bmatrix}BB1&-AA3&0\\
-AA3&BB2&-AA3\\
0&-AA3&BB1\end{bmatrix}
  </annotation>
 </semantics>
</math>

  </p>

<p>where the elements mentioned above correspond to the next arrays and an additional 4x4 full of zeros. Please note that the sizes of AA and BB are 12x12:</p>

<p>

<math display="block" id="Crank–Nicolson_method:39">
 <semantics>
  <mrow>
   <mi>𝐀𝐀𝟏</mi>
   <mo>=</mo>
   <mrow>
    <mo>[</mo>
    <mtable displaystyle="true">
     <mtr>
      <mtd columnalign="center">
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mn>1</mn>
         <mo>+</mo>
         <mrow>
          <mn>2</mn>
          <mi>λ</mi>
         </mrow>
         <mo>+</mo>
         <mi>β</mi>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo>-</mo>
        <mrow>
         <mo stretchy="false">(</mo>
         <mrow>
          <mi>λ</mi>
          <mo>-</mo>
          <mi>α</mi>
         </mrow>
         <mo stretchy="false">)</mo>
        </mrow>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <mrow>
        <mo>-</mo>
        <mrow>
         <mo stretchy="false">(</mo>
         <mrow>
          <mi>λ</mi>
          <mo>+</mo>
          <mi>α</mi>
         </mrow>
         <mo stretchy="false">)</mo>
        </mrow>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mn>1</mn>
         <mo>+</mo>
         <mrow>
          <mn>2</mn>
          <mi>λ</mi>
         </mrow>
         <mo>+</mo>
         <mi>β</mi>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo>-</mo>
        <mrow>
         <mo stretchy="false">(</mo>
         <mrow>
          <mi>λ</mi>
          <mo>-</mo>
          <mi>α</mi>
         </mrow>
         <mo stretchy="false">)</mo>
        </mrow>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo>-</mo>
        <mrow>
         <mo stretchy="false">(</mo>
         <mrow>
          <mi>λ</mi>
          <mo>+</mo>
          <mi>α</mi>
         </mrow>
         <mo stretchy="false">)</mo>
        </mrow>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mn>1</mn>
         <mo>+</mo>
         <mrow>
          <mn>2</mn>
          <mi>λ</mi>
         </mrow>
         <mo>+</mo>
         <mi>β</mi>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo>-</mo>
        <mrow>
         <mo stretchy="false">(</mo>
         <mrow>
          <mi>λ</mi>
          <mo>-</mo>
          <mi>α</mi>
         </mrow>
         <mo stretchy="false">)</mo>
        </mrow>
       </mrow>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo>-</mo>
        <mrow>
         <mn>2</mn>
         <mi>λ</mi>
        </mrow>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mn>1</mn>
         <mo>+</mo>
         <mrow>
          <mn>2</mn>
          <mi>λ</mi>
         </mrow>
         <mo>+</mo>
         <mi>β</mi>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
      </mtd>
     </mtr>
    </mtable>
    <mo>]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>𝐀𝐀𝟏</ci>
    <matrix>
     <matrixrow>
      <apply>
       <plus></plus>
       <cn type="integer">1</cn>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>λ</ci>
       </apply>
       <ci>β</ci>
      </apply>
      <apply>
       <minus></minus>
       <apply>
        <minus></minus>
        <ci>λ</ci>
        <ci>α</ci>
       </apply>
      </apply>
      <cn type="integer">0</cn>
      <cn type="integer">0</cn>
     </matrixrow>
     <matrixrow>
      <apply>
       <minus></minus>
       <apply>
        <plus></plus>
        <ci>λ</ci>
        <ci>α</ci>
       </apply>
      </apply>
      <apply>
       <plus></plus>
       <cn type="integer">1</cn>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>λ</ci>
       </apply>
       <ci>β</ci>
      </apply>
      <apply>
       <minus></minus>
       <apply>
        <minus></minus>
        <ci>λ</ci>
        <ci>α</ci>
       </apply>
      </apply>
      <cn type="integer">0</cn>
     </matrixrow>
     <matrixrow>
      <cn type="integer">0</cn>
      <apply>
       <minus></minus>
       <apply>
        <plus></plus>
        <ci>λ</ci>
        <ci>α</ci>
       </apply>
      </apply>
      <apply>
       <plus></plus>
       <cn type="integer">1</cn>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>λ</ci>
       </apply>
       <ci>β</ci>
      </apply>
      <apply>
       <minus></minus>
       <apply>
        <minus></minus>
        <ci>λ</ci>
        <ci>α</ci>
       </apply>
      </apply>
     </matrixrow>
     <matrixrow>
      <cn type="integer">0</cn>
      <cn type="integer">0</cn>
      <apply>
       <minus></minus>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>λ</ci>
       </apply>
      </apply>
      <apply>
       <plus></plus>
       <cn type="integer">1</cn>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>λ</ci>
       </apply>
       <ci>β</ci>
      </apply>
     </matrixrow>
    </matrix>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{AA1}=\begin{bmatrix}(1+2\lambda+\beta)&-(\lambda-\alpha)&0&0\\
-(\lambda+\alpha)&(1+2\lambda+\beta)&-(\lambda-\alpha)&0\\
0&-(\lambda+\alpha)&(1+2\lambda+\beta)&-(\lambda-\alpha)\\
0&0&-2\lambda&(1+2\lambda+\beta)\end{bmatrix}
  </annotation>
 </semantics>
</math>

   , </p>

<p>

<math display="block" id="Crank–Nicolson_method:40">
 <semantics>
  <mrow>
   <mi>𝐀𝐀𝟐</mi>
   <mo>=</mo>
   <mrow>
    <mo>[</mo>
    <mtable displaystyle="true">
     <mtr>
      <mtd columnalign="center">
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mn>1</mn>
         <mo>+</mo>
         <mrow>
          <mn>2</mn>
          <mi>λ</mi>
         </mrow>
         <mo>+</mo>
         <mrow>
          <mn>2</mn>
          <mi>β</mi>
         </mrow>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo>-</mo>
        <mrow>
         <mo stretchy="false">(</mo>
         <mrow>
          <mi>λ</mi>
          <mo>-</mo>
          <mi>α</mi>
         </mrow>
         <mo stretchy="false">)</mo>
        </mrow>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <mrow>
        <mo>-</mo>
        <mrow>
         <mo stretchy="false">(</mo>
         <mrow>
          <mi>λ</mi>
          <mo>+</mo>
          <mi>α</mi>
         </mrow>
         <mo stretchy="false">)</mo>
        </mrow>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mn>1</mn>
         <mo>+</mo>
         <mrow>
          <mn>2</mn>
          <mi>λ</mi>
         </mrow>
         <mo>+</mo>
         <mrow>
          <mn>2</mn>
          <mi>β</mi>
         </mrow>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo>-</mo>
        <mrow>
         <mo stretchy="false">(</mo>
         <mrow>
          <mi>λ</mi>
          <mo>-</mo>
          <mi>α</mi>
         </mrow>
         <mo stretchy="false">)</mo>
        </mrow>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo>-</mo>
        <mrow>
         <mo stretchy="false">(</mo>
         <mrow>
          <mi>λ</mi>
          <mo>+</mo>
          <mi>α</mi>
         </mrow>
         <mo stretchy="false">)</mo>
        </mrow>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mn>1</mn>
         <mo>+</mo>
         <mrow>
          <mn>2</mn>
          <mi>λ</mi>
         </mrow>
         <mo>+</mo>
         <mrow>
          <mn>2</mn>
          <mi>β</mi>
         </mrow>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo>-</mo>
        <mrow>
         <mo stretchy="false">(</mo>
         <mrow>
          <mi>λ</mi>
          <mo>-</mo>
          <mi>α</mi>
         </mrow>
         <mo stretchy="false">)</mo>
        </mrow>
       </mrow>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo>-</mo>
        <mrow>
         <mn>2</mn>
         <mi>λ</mi>
        </mrow>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mn>1</mn>
         <mo>+</mo>
         <mrow>
          <mn>2</mn>
          <mi>λ</mi>
         </mrow>
         <mo>+</mo>
         <mrow>
          <mn>2</mn>
          <mi>β</mi>
         </mrow>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
      </mtd>
     </mtr>
    </mtable>
    <mo>]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>𝐀𝐀𝟐</ci>
    <matrix>
     <matrixrow>
      <apply>
       <plus></plus>
       <cn type="integer">1</cn>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>λ</ci>
       </apply>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>β</ci>
       </apply>
      </apply>
      <apply>
       <minus></minus>
       <apply>
        <minus></minus>
        <ci>λ</ci>
        <ci>α</ci>
       </apply>
      </apply>
      <cn type="integer">0</cn>
      <cn type="integer">0</cn>
     </matrixrow>
     <matrixrow>
      <apply>
       <minus></minus>
       <apply>
        <plus></plus>
        <ci>λ</ci>
        <ci>α</ci>
       </apply>
      </apply>
      <apply>
       <plus></plus>
       <cn type="integer">1</cn>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>λ</ci>
       </apply>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>β</ci>
       </apply>
      </apply>
      <apply>
       <minus></minus>
       <apply>
        <minus></minus>
        <ci>λ</ci>
        <ci>α</ci>
       </apply>
      </apply>
      <cn type="integer">0</cn>
     </matrixrow>
     <matrixrow>
      <cn type="integer">0</cn>
      <apply>
       <minus></minus>
       <apply>
        <plus></plus>
        <ci>λ</ci>
        <ci>α</ci>
       </apply>
      </apply>
      <apply>
       <plus></plus>
       <cn type="integer">1</cn>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>λ</ci>
       </apply>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>β</ci>
       </apply>
      </apply>
      <apply>
       <minus></minus>
       <apply>
        <minus></minus>
        <ci>λ</ci>
        <ci>α</ci>
       </apply>
      </apply>
     </matrixrow>
     <matrixrow>
      <cn type="integer">0</cn>
      <cn type="integer">0</cn>
      <apply>
       <minus></minus>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>λ</ci>
       </apply>
      </apply>
      <apply>
       <plus></plus>
       <cn type="integer">1</cn>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>λ</ci>
       </apply>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>β</ci>
       </apply>
      </apply>
     </matrixrow>
    </matrix>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{AA2}=\begin{bmatrix}(1+2\lambda+2\beta)&-(\lambda-\alpha)&0&0\\
-(\lambda+\alpha)&(1+2\lambda+2\beta)&-(\lambda-\alpha)&0\\
0&-(\lambda+\alpha)&(1+2\lambda+2\beta)&-(\lambda-\alpha)\\
0&0&-2\lambda&(1+2\lambda+2\beta)\end{bmatrix}
  </annotation>
 </semantics>
</math>

   , </p>

<p>

<math display="block" id="Crank–Nicolson_method:41">
 <semantics>
  <mrow>
   <mi>𝐀𝐀𝟑</mi>
   <mo>=</mo>
   <mrow>
    <mo>[</mo>
    <mtable displaystyle="true">
     <mtr>
      <mtd columnalign="center">
       <mrow>
        <mo>-</mo>
        <mi>β</mi>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo>-</mo>
        <mi>β</mi>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo>-</mo>
        <mi>β</mi>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo>-</mo>
        <mi>β</mi>
       </mrow>
      </mtd>
     </mtr>
    </mtable>
    <mo>]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>𝐀𝐀𝟑</ci>
    <matrix>
     <matrixrow>
      <apply>
       <minus></minus>
       <ci>β</ci>
      </apply>
      <cn type="integer">0</cn>
      <cn type="integer">0</cn>
      <cn type="integer">0</cn>
     </matrixrow>
     <matrixrow>
      <cn type="integer">0</cn>
      <apply>
       <minus></minus>
       <ci>β</ci>
      </apply>
      <cn type="integer">0</cn>
      <cn type="integer">0</cn>
     </matrixrow>
     <matrixrow>
      <cn type="integer">0</cn>
      <cn type="integer">0</cn>
      <apply>
       <minus></minus>
       <ci>β</ci>
      </apply>
      <cn type="integer">0</cn>
     </matrixrow>
     <matrixrow>
      <cn type="integer">0</cn>
      <cn type="integer">0</cn>
      <cn type="integer">0</cn>
      <apply>
       <minus></minus>
       <ci>β</ci>
      </apply>
     </matrixrow>
    </matrix>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{AA3}=\begin{bmatrix}-\beta&0&0&0\\
0&-\beta&0&0\\
0&0&-\beta&0\\
0&0&0&-\beta\end{bmatrix}
  </annotation>
 </semantics>
</math>

   , </p>

<p>

<math display="block" id="Crank–Nicolson_method:42">
 <semantics>
  <mrow>
   <mi>𝐁𝐁𝟏</mi>
   <mo>=</mo>
   <mrow>
    <mo>[</mo>
    <mtable displaystyle="true">
     <mtr>
      <mtd columnalign="center">
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mn>1</mn>
         <mo>-</mo>
         <mrow>
          <mn>2</mn>
          <mi>λ</mi>
         </mrow>
         <mo>-</mo>
         <mi>β</mi>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mi>λ</mi>
         <mo>-</mo>
         <mi>α</mi>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mi>λ</mi>
         <mo>+</mo>
         <mi>α</mi>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mn>1</mn>
         <mo>-</mo>
         <mrow>
          <mn>2</mn>
          <mi>λ</mi>
         </mrow>
         <mo>-</mo>
         <mi>β</mi>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mi>λ</mi>
         <mo>-</mo>
         <mi>α</mi>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mi>λ</mi>
         <mo>+</mo>
         <mi>α</mi>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mn>1</mn>
         <mo>-</mo>
         <mrow>
          <mn>2</mn>
          <mi>λ</mi>
         </mrow>
         <mo>-</mo>
         <mi>β</mi>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mi>λ</mi>
         <mo>-</mo>
         <mi>α</mi>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
      </mtd>
     </mtr>
     <mtr>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
      <mtd columnalign="center">
       <mn>0</mn>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mn>2</mn>
        <mi>λ</mi>
       </mrow>
      </mtd>
      <mtd columnalign="center">
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mn>1</mn>
         <mo>-</mo>
         <mrow>
          <mn>2</mn>
          <mi>λ</mi>
         </mrow>
         <mo>-</mo>
         <mi>β</mi>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
      </mtd>
     </mtr>
    </mtable>
    <mo>]</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>𝐁𝐁𝟏</ci>
    <matrix>
     <matrixrow>
      <apply>
       <minus></minus>
       <cn type="integer">1</cn>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>λ</ci>
       </apply>
       <ci>β</ci>
      </apply>
      <apply>
       <minus></minus>
       <ci>λ</ci>
       <ci>α</ci>
      </apply>
      <cn type="integer">0</cn>
      <cn type="integer">0</cn>
     </matrixrow>
     <matrixrow>
      <apply>
       <plus></plus>
       <ci>λ</ci>
       <ci>α</ci>
      </apply>
      <apply>
       <minus></minus>
       <cn type="integer">1</cn>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>λ</ci>
       </apply>
       <ci>β</ci>
      </apply>
      <apply>
       <minus></minus>
       <ci>λ</ci>
       <ci>α</ci>
      </apply>
      <cn type="integer">0</cn>
     </matrixrow>
     <matrixrow>
      <cn type="integer">0</cn>
      <apply>
       <plus></plus>
       <ci>λ</ci>
       <ci>α</ci>
      </apply>
      <apply>
       <minus></minus>
       <cn type="integer">1</cn>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>λ</ci>
       </apply>
       <ci>β</ci>
      </apply>
      <apply>
       <minus></minus>
       <ci>λ</ci>
       <ci>α</ci>
      </apply>
     </matrixrow>
     <matrixrow>
      <cn type="integer">0</cn>
      <cn type="integer">0</cn>
      <apply>
       <times></times>
       <cn type="integer">2</cn>
       <ci>λ</ci>
      </apply>
      <apply>
       <minus></minus>
       <cn type="integer">1</cn>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>λ</ci>
       </apply>
       <ci>β</ci>
      </apply>
     </matrixrow>
    </matrix>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{BB1}=\begin{bmatrix}(1-2\lambda-\beta)&(\lambda-\alpha)&0&0\\
(\lambda+\alpha)&(1-2\lambda-\beta)&(\lambda-\alpha)&0\\
0&(\lambda+\alpha)&(1-2\lambda-\beta)&(\lambda-\alpha)\\
0&0&2\lambda&(1-2\lambda-\beta)\end{bmatrix}
  </annotation>
 </semantics>
</math>

   &amp;  </p>

<p>

<math display="block" id="Crank–Nicolson_method:43">
 <semantics>
  <mrow>
   <mrow>
    <mi>𝐁𝐁𝟐</mi>
    <mo>=</mo>
    <mrow>
     <mo>[</mo>
     <mtable displaystyle="true">
      <mtr>
       <mtd columnalign="center">
        <mrow>
         <mo stretchy="false">(</mo>
         <mrow>
          <mn>1</mn>
          <mo>-</mo>
          <mrow>
           <mn>2</mn>
           <mi>λ</mi>
          </mrow>
          <mo>-</mo>
          <mrow>
           <mn>2</mn>
           <mi>β</mi>
          </mrow>
         </mrow>
         <mo stretchy="false">)</mo>
        </mrow>
       </mtd>
       <mtd columnalign="center">
        <mrow>
         <mo stretchy="false">(</mo>
         <mrow>
          <mi>λ</mi>
          <mo>-</mo>
          <mi>α</mi>
         </mrow>
         <mo stretchy="false">)</mo>
        </mrow>
       </mtd>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <mrow>
         <mo stretchy="false">(</mo>
         <mrow>
          <mi>λ</mi>
          <mo>+</mo>
          <mi>α</mi>
         </mrow>
         <mo stretchy="false">)</mo>
        </mrow>
       </mtd>
       <mtd columnalign="center">
        <mrow>
         <mo stretchy="false">(</mo>
         <mrow>
          <mn>1</mn>
          <mo>-</mo>
          <mrow>
           <mn>2</mn>
           <mi>λ</mi>
          </mrow>
          <mo>-</mo>
          <mrow>
           <mn>2</mn>
           <mi>β</mi>
          </mrow>
         </mrow>
         <mo stretchy="false">)</mo>
        </mrow>
       </mtd>
       <mtd columnalign="center">
        <mrow>
         <mo stretchy="false">(</mo>
         <mrow>
          <mi>λ</mi>
          <mo>-</mo>
          <mi>α</mi>
         </mrow>
         <mo stretchy="false">)</mo>
        </mrow>
       </mtd>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
       <mtd columnalign="center">
        <mrow>
         <mo stretchy="false">(</mo>
         <mrow>
          <mi>λ</mi>
          <mo>+</mo>
          <mi>α</mi>
         </mrow>
         <mo stretchy="false">)</mo>
        </mrow>
       </mtd>
       <mtd columnalign="center">
        <mrow>
         <mo stretchy="false">(</mo>
         <mrow>
          <mn>1</mn>
          <mo>-</mo>
          <mrow>
           <mn>2</mn>
           <mi>λ</mi>
          </mrow>
          <mo>-</mo>
          <mrow>
           <mn>2</mn>
           <mi>β</mi>
          </mrow>
         </mrow>
         <mo stretchy="false">)</mo>
        </mrow>
       </mtd>
       <mtd columnalign="center">
        <mrow>
         <mo stretchy="false">(</mo>
         <mrow>
          <mi>λ</mi>
          <mo>-</mo>
          <mi>α</mi>
         </mrow>
         <mo stretchy="false">)</mo>
        </mrow>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
       <mtd columnalign="center">
        <mrow>
         <mn>2</mn>
         <mi>λ</mi>
        </mrow>
       </mtd>
       <mtd columnalign="center">
        <mrow>
         <mo stretchy="false">(</mo>
         <mrow>
          <mn>1</mn>
          <mo>-</mo>
          <mrow>
           <mn>2</mn>
           <mi>λ</mi>
          </mrow>
          <mo>-</mo>
          <mrow>
           <mn>2</mn>
           <mi>β</mi>
          </mrow>
         </mrow>
         <mo stretchy="false">)</mo>
        </mrow>
       </mtd>
      </mtr>
     </mtable>
     <mo>]</mo>
    </mrow>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>𝐁𝐁𝟐</ci>
    <matrix>
     <matrixrow>
      <apply>
       <minus></minus>
       <cn type="integer">1</cn>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>λ</ci>
       </apply>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>β</ci>
       </apply>
      </apply>
      <apply>
       <minus></minus>
       <ci>λ</ci>
       <ci>α</ci>
      </apply>
      <cn type="integer">0</cn>
      <cn type="integer">0</cn>
     </matrixrow>
     <matrixrow>
      <apply>
       <plus></plus>
       <ci>λ</ci>
       <ci>α</ci>
      </apply>
      <apply>
       <minus></minus>
       <cn type="integer">1</cn>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>λ</ci>
       </apply>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>β</ci>
       </apply>
      </apply>
      <apply>
       <minus></minus>
       <ci>λ</ci>
       <ci>α</ci>
      </apply>
      <cn type="integer">0</cn>
     </matrixrow>
     <matrixrow>
      <cn type="integer">0</cn>
      <apply>
       <plus></plus>
       <ci>λ</ci>
       <ci>α</ci>
      </apply>
      <apply>
       <minus></minus>
       <cn type="integer">1</cn>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>λ</ci>
       </apply>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>β</ci>
       </apply>
      </apply>
      <apply>
       <minus></minus>
       <ci>λ</ci>
       <ci>α</ci>
      </apply>
     </matrixrow>
     <matrixrow>
      <cn type="integer">0</cn>
      <cn type="integer">0</cn>
      <apply>
       <times></times>
       <cn type="integer">2</cn>
       <ci>λ</ci>
      </apply>
      <apply>
       <minus></minus>
       <cn type="integer">1</cn>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>λ</ci>
       </apply>
       <apply>
        <times></times>
        <cn type="integer">2</cn>
        <ci>β</ci>
       </apply>
      </apply>
     </matrixrow>
    </matrix>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{BB2}=\begin{bmatrix}(1-2\lambda-2\beta)&(\lambda-\alpha)&0&0\\
(\lambda+\alpha)&(1-2\lambda-2\beta)&(\lambda-\alpha)&0\\
0&(\lambda+\alpha)&(1-2\lambda-2\beta)&(\lambda-\alpha)\\
0&0&2\lambda&(1-2\lambda-2\beta)\end{bmatrix}.
  </annotation>
 </semantics>
</math>

</p>

<p>The <em>d</em> vector here is used to hold the boundary conditions. In this example it is a 12x1 vector:</p>

<p>

<math display="block" id="Crank–Nicolson_method:44">
 <semantics>
  <mrow>
   <mrow>
    <mi>𝐝</mi>
    <mo>=</mo>
    <mrow>
     <mo>[</mo>
     <mtable displaystyle="true">
      <mtr>
       <mtd columnalign="center">
        <mrow>
         <mrow>
          <mo stretchy="false">(</mo>
          <mrow>
           <mi>λ</mi>
           <mo>+</mo>
           <mi>α</mi>
          </mrow>
          <mo stretchy="false">)</mo>
         </mrow>
         <mrow>
          <mo stretchy="false">(</mo>
          <mrow>
           <msubsup>
            <mi>C</mi>
            <mn>10</mn>
            <mrow>
             <mi>j</mi>
             <mo>+</mo>
             <mn>1</mn>
            </mrow>
           </msubsup>
           <mo>+</mo>
           <msubsup>
            <mi>C</mi>
            <mn>10</mn>
            <mi>j</mi>
           </msubsup>
          </mrow>
          <mo stretchy="false">)</mo>
         </mrow>
        </mrow>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <mrow>
         <mrow>
          <mo stretchy="false">(</mo>
          <mrow>
           <mi>λ</mi>
           <mo>+</mo>
           <mi>α</mi>
          </mrow>
          <mo stretchy="false">)</mo>
         </mrow>
         <mrow>
          <mo stretchy="false">(</mo>
          <mrow>
           <msubsup>
            <mi>C</mi>
            <mn>20</mn>
            <mrow>
             <mi>j</mi>
             <mo>+</mo>
             <mn>1</mn>
            </mrow>
           </msubsup>
           <mo>+</mo>
           <msubsup>
            <mi>C</mi>
            <mn>20</mn>
            <mi>j</mi>
           </msubsup>
          </mrow>
          <mo stretchy="false">)</mo>
         </mrow>
        </mrow>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <mrow>
         <mrow>
          <mo stretchy="false">(</mo>
          <mrow>
           <mi>λ</mi>
           <mo>+</mo>
           <mi>α</mi>
          </mrow>
          <mo stretchy="false">)</mo>
         </mrow>
         <mrow>
          <mo stretchy="false">(</mo>
          <mrow>
           <msubsup>
            <mi>C</mi>
            <mn>30</mn>
            <mrow>
             <mi>j</mi>
             <mo>+</mo>
             <mn>1</mn>
            </mrow>
           </msubsup>
           <mo>+</mo>
           <msubsup>
            <mi>C</mi>
            <mn>30</mn>
            <mi>j</mi>
           </msubsup>
          </mrow>
          <mo stretchy="false">)</mo>
         </mrow>
        </mrow>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
      </mtr>
      <mtr>
       <mtd columnalign="center">
        <mn>0</mn>
       </mtd>
      </mtr>
     </mtable>
     <mo>]</mo>
    </mrow>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>𝐝</ci>
    <matrix>
     <matrixrow>
      <apply>
       <times></times>
       <apply>
        <plus></plus>
        <ci>λ</ci>
        <ci>α</ci>
       </apply>
       <apply>
        <plus></plus>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>C</ci>
          <cn type="integer">10</cn>
         </apply>
         <apply>
          <plus></plus>
          <ci>j</ci>
          <cn type="integer">1</cn>
         </apply>
        </apply>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>C</ci>
          <cn type="integer">10</cn>
         </apply>
         <ci>j</ci>
        </apply>
       </apply>
      </apply>
     </matrixrow>
     <matrixrow>
      <cn type="integer">0</cn>
     </matrixrow>
     <matrixrow>
      <cn type="integer">0</cn>
     </matrixrow>
     <matrixrow>
      <cn type="integer">0</cn>
     </matrixrow>
     <matrixrow>
      <apply>
       <times></times>
       <apply>
        <plus></plus>
        <ci>λ</ci>
        <ci>α</ci>
       </apply>
       <apply>
        <plus></plus>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>C</ci>
          <cn type="integer">20</cn>
         </apply>
         <apply>
          <plus></plus>
          <ci>j</ci>
          <cn type="integer">1</cn>
         </apply>
        </apply>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>C</ci>
          <cn type="integer">20</cn>
         </apply>
         <ci>j</ci>
        </apply>
       </apply>
      </apply>
     </matrixrow>
     <matrixrow>
      <cn type="integer">0</cn>
     </matrixrow>
     <matrixrow>
      <cn type="integer">0</cn>
     </matrixrow>
     <matrixrow>
      <cn type="integer">0</cn>
     </matrixrow>
     <matrixrow>
      <apply>
       <times></times>
       <apply>
        <plus></plus>
        <ci>λ</ci>
        <ci>α</ci>
       </apply>
       <apply>
        <plus></plus>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>C</ci>
          <cn type="integer">30</cn>
         </apply>
         <apply>
          <plus></plus>
          <ci>j</ci>
          <cn type="integer">1</cn>
         </apply>
        </apply>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>C</ci>
          <cn type="integer">30</cn>
         </apply>
         <ci>j</ci>
        </apply>
       </apply>
      </apply>
     </matrixrow>
     <matrixrow>
      <cn type="integer">0</cn>
     </matrixrow>
     <matrixrow>
      <cn type="integer">0</cn>
     </matrixrow>
     <matrixrow>
      <cn type="integer">0</cn>
     </matrixrow>
    </matrix>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mathbf{d}=\begin{bmatrix}(\lambda+\alpha)(C_{10}^{j+1}+C_{10}^{j})\\
0\\
0\\
0\\
(\lambda+\alpha)(C_{20}^{j+1}+C_{20}^{j})\\
0\\
0\\
0\\
(\lambda+\alpha)(C_{30}^{j+1}+C_{30}^{j})\\
0\\
0\\
0\end{bmatrix}.
  </annotation>
 </semantics>
</math>

</p>

<p>To find the concentration at any time, one must iterate the following equation:</p>

<p>

<math display="block" id="Crank–Nicolson_method:45">
 <semantics>
  <mrow>
   <mrow>
    <mrow>
     <mo>[</mo>
     <mtable displaystyle="true">
      <mtr>
       <mtd columnalign="center">
        <msup>
         <mi>C</mi>
         <mrow>
          <mi>j</mi>
          <mo>+</mo>
          <mn>1</mn>
         </mrow>
        </msup>
       </mtd>
      </mtr>
     </mtable>
     <mo>]</mo>
    </mrow>
    <mo>=</mo>
    <mrow>
     <mrow>
      <mo>[</mo>
      <mtable displaystyle="true">
       <mtr>
        <mtd columnalign="center">
         <mrow>
          <mi>A</mi>
          <msup>
           <mi>A</mi>
           <mrow>
            <mo>-</mo>
            <mn>1</mn>
           </mrow>
          </msup>
         </mrow>
        </mtd>
       </mtr>
      </mtable>
      <mo>]</mo>
     </mrow>
     <mrow>
      <mo stretchy="false">(</mo>
      <mrow>
       <mrow>
        <mrow>
         <mo stretchy="false">[</mo>
         <mrow>
          <mi>B</mi>
          <mi>B</mi>
         </mrow>
         <mo stretchy="false">]</mo>
        </mrow>
        <mrow>
         <mo stretchy="false">[</mo>
         <msup>
          <mi>C</mi>
          <mi>j</mi>
         </msup>
         <mo stretchy="false">]</mo>
        </mrow>
       </mrow>
       <mo>+</mo>
       <mrow>
        <mo stretchy="false">[</mo>
        <mi>d</mi>
        <mo stretchy="false">]</mo>
       </mrow>
      </mrow>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <matrix>
     <matrixrow>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>C</ci>
       <apply>
        <plus></plus>
        <ci>j</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
     </matrixrow>
    </matrix>
    <apply>
     <times></times>
     <matrix>
      <matrixrow>
       <apply>
        <times></times>
        <ci>A</ci>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>A</ci>
         <apply>
          <minus></minus>
          <cn type="integer">1</cn>
         </apply>
        </apply>
       </apply>
      </matrixrow>
     </matrix>
     <apply>
      <plus></plus>
      <apply>
       <times></times>
       <apply>
        <csymbol cd="latexml">delimited-[]</csymbol>
        <apply>
         <times></times>
         <ci>B</ci>
         <ci>B</ci>
        </apply>
       </apply>
       <apply>
        <csymbol cd="latexml">delimited-[]</csymbol>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>C</ci>
         <ci>j</ci>
        </apply>
       </apply>
      </apply>
      <apply>
       <csymbol cd="latexml">delimited-[]</csymbol>
       <ci>d</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \begin{bmatrix}C^{j+1}\end{bmatrix}=\begin{bmatrix}AA^{-1}\end{bmatrix}([BB][C%
^{j}]+[d]).
  </annotation>
 </semantics>
</math>

</p>
<h2 id="example-2d-diffusion">Example: 2D diffusion</h2>

<p>When extending into two dimensions on a uniform <a href="Cartesian_grid" title="wikilink">Cartesian grid</a>, the derivation is similar and the results may lead to a system of <a href="Banded_matrix" title="wikilink">band-diagonal</a> equations rather than <a href="Tridiagonal_matrix" title="wikilink">tridiagonal</a> ones. The two-dimensional heat equation</p>

<p>

<math display="block" id="Crank–Nicolson_method:46">
 <semantics>
  <mrow>
   <mfrac>
    <mrow>
     <mo>∂</mo>
     <mi>u</mi>
    </mrow>
    <mrow>
     <mo>∂</mo>
     <mi>t</mi>
    </mrow>
   </mfrac>
   <mo>=</mo>
   <mrow>
    <mi>a</mi>
    <mrow>
     <mo>(</mo>
     <mrow>
      <mfrac>
       <mrow>
        <msup>
         <mo>∂</mo>
         <mn>2</mn>
        </msup>
        <mi>u</mi>
       </mrow>
       <mrow>
        <mo>∂</mo>
        <msup>
         <mi>x</mi>
         <mn>2</mn>
        </msup>
       </mrow>
      </mfrac>
      <mo>+</mo>
      <mfrac>
       <mrow>
        <msup>
         <mo>∂</mo>
         <mn>2</mn>
        </msup>
        <mi>u</mi>
       </mrow>
       <mrow>
        <mo>∂</mo>
        <msup>
         <mi>y</mi>
         <mn>2</mn>
        </msup>
       </mrow>
      </mfrac>
     </mrow>
     <mo>)</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <divide></divide>
     <apply>
      <partialdiff></partialdiff>
      <ci>u</ci>
     </apply>
     <apply>
      <partialdiff></partialdiff>
      <ci>t</ci>
     </apply>
    </apply>
    <apply>
     <times></times>
     <ci>a</ci>
     <apply>
      <plus></plus>
      <apply>
       <divide></divide>
       <apply>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <partialdiff></partialdiff>
         <cn type="integer">2</cn>
        </apply>
        <ci>u</ci>
       </apply>
       <apply>
        <partialdiff></partialdiff>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>x</ci>
         <cn type="integer">2</cn>
        </apply>
       </apply>
      </apply>
      <apply>
       <divide></divide>
       <apply>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <partialdiff></partialdiff>
         <cn type="integer">2</cn>
        </apply>
        <ci>u</ci>
       </apply>
       <apply>
        <partialdiff></partialdiff>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>y</ci>
         <cn type="integer">2</cn>
        </apply>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \frac{\partial u}{\partial t}=a\left(\frac{\partial^{2}u}{\partial x^{2}}+%
\frac{\partial^{2}u}{\partial y^{2}}\right)
  </annotation>
 </semantics>
</math>

</p>

<p>can be solved with the Crank–Nicolson discretization of</p>

<p>

<math display="inline" id="Crank–Nicolson_method:47">
 <semantics>
  <msubsup>
   <mi>u</mi>
   <mrow>
    <mi>i</mi>
    <mo>,</mo>
    <mi>j</mi>
   </mrow>
   <mrow>
    <mi>n</mi>
    <mo>+</mo>
    <mn>1</mn>
   </mrow>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>u</ci>
     <list>
      <ci>i</ci>
      <ci>j</ci>
     </list>
    </apply>
    <apply>
     <plus></plus>
     <ci>n</ci>
     <cn type="integer">1</cn>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \displaystyle u_{i,j}^{n+1}
  </annotation>
 </semantics>
</math>


</p>

<p>assuming that a square grid is used so that 

<math display="inline" id="Crank–Nicolson_method:48">
 <semantics>
  <mrow>
   <mrow>
    <mi mathvariant="normal">Δ</mi>
    <mi>x</mi>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mi mathvariant="normal">Δ</mi>
    <mi>y</mi>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <ci>normal-Δ</ci>
     <ci>x</ci>
    </apply>
    <apply>
     <times></times>
     <ci>normal-Δ</ci>
     <ci>y</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \Delta x=\Delta y
  </annotation>
 </semantics>
</math>

. This equation can be simplified somewhat by rearranging terms and using the <a href="Courant_number" title="wikilink">CFL number</a></p>

<p>

<math display="block" id="Crank–Nicolson_method:49">
 <semantics>
  <mrow>
   <mrow>
    <mi>μ</mi>
    <mo>=</mo>
    <mfrac>
     <mrow>
      <mi>a</mi>
      <mi mathvariant="normal">Δ</mi>
      <mi>t</mi>
     </mrow>
     <msup>
      <mrow>
       <mo stretchy="false">(</mo>
       <mrow>
        <mi mathvariant="normal">Δ</mi>
        <mi>x</mi>
       </mrow>
       <mo stretchy="false">)</mo>
      </mrow>
      <mn>2</mn>
     </msup>
    </mfrac>
   </mrow>
   <mo>.</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>μ</ci>
    <apply>
     <divide></divide>
     <apply>
      <times></times>
      <ci>a</ci>
      <ci>normal-Δ</ci>
      <ci>t</ci>
     </apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <times></times>
       <ci>normal-Δ</ci>
       <ci>x</ci>
      </apply>
      <cn type="integer">2</cn>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \mu=\frac{a\Delta t}{(\Delta x)^{2}}.
  </annotation>
 </semantics>
</math>

</p>

<p>For the Crank–Nicolson numerical scheme, a low <a href="Courant_number" title="wikilink">CFL number</a> is not required for stability, however it is required for numerical accuracy. We can now write the scheme as:</p>

<p>

<math display="inline" id="Crank–Nicolson_method:50">
 <semantics>
  <mrow>
   <mrow>
    <mrow>
     <mo stretchy="false">(</mo>
     <mrow>
      <mn>1</mn>
      <mo>+</mo>
      <mrow>
       <mn>2</mn>
       <mi>μ</mi>
      </mrow>
     </mrow>
     <mo stretchy="false">)</mo>
    </mrow>
    <msubsup>
     <mi>u</mi>
     <mrow>
      <mi>i</mi>
      <mo>,</mo>
      <mi>j</mi>
     </mrow>
     <mrow>
      <mi>n</mi>
      <mo>+</mo>
      <mn>1</mn>
     </mrow>
    </msubsup>
   </mrow>
   <mo>-</mo>
   <mrow>
    <mstyle displaystyle="true">
     <mfrac>
      <mi>μ</mi>
      <mn>2</mn>
     </mfrac>
    </mstyle>
    <mrow>
     <mo>(</mo>
     <mrow>
      <msubsup>
       <mi>u</mi>
       <mrow>
        <mrow>
         <mi>i</mi>
         <mo>+</mo>
         <mn>1</mn>
        </mrow>
        <mo>,</mo>
        <mi>j</mi>
       </mrow>
       <mrow>
        <mi>n</mi>
        <mo>+</mo>
        <mn>1</mn>
       </mrow>
      </msubsup>
      <mo>+</mo>
      <msubsup>
       <mi>u</mi>
       <mrow>
        <mrow>
         <mi>i</mi>
         <mo>-</mo>
         <mn>1</mn>
        </mrow>
        <mo>,</mo>
        <mi>j</mi>
       </mrow>
       <mrow>
        <mi>n</mi>
        <mo>+</mo>
        <mn>1</mn>
       </mrow>
      </msubsup>
      <mo>+</mo>
      <msubsup>
       <mi>u</mi>
       <mrow>
        <mi>i</mi>
        <mo>,</mo>
        <mrow>
         <mi>j</mi>
         <mo>+</mo>
         <mn>1</mn>
        </mrow>
       </mrow>
       <mrow>
        <mi>n</mi>
        <mo>+</mo>
        <mn>1</mn>
       </mrow>
      </msubsup>
      <mo>+</mo>
      <msubsup>
       <mi>u</mi>
       <mrow>
        <mi>i</mi>
        <mo>,</mo>
        <mrow>
         <mi>j</mi>
         <mo>-</mo>
         <mn>1</mn>
        </mrow>
       </mrow>
       <mrow>
        <mi>n</mi>
        <mo>+</mo>
        <mn>1</mn>
       </mrow>
      </msubsup>
     </mrow>
     <mo>)</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <minus></minus>
    <apply>
     <times></times>
     <apply>
      <plus></plus>
      <cn type="integer">1</cn>
      <apply>
       <times></times>
       <cn type="integer">2</cn>
       <ci>μ</ci>
      </apply>
     </apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>u</ci>
       <list>
        <ci>i</ci>
        <ci>j</ci>
       </list>
      </apply>
      <apply>
       <plus></plus>
       <ci>n</ci>
       <cn type="integer">1</cn>
      </apply>
     </apply>
    </apply>
    <apply>
     <times></times>
     <apply>
      <divide></divide>
      <ci>μ</ci>
      <cn type="integer">2</cn>
     </apply>
     <apply>
      <plus></plus>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>u</ci>
        <list>
         <apply>
          <plus></plus>
          <ci>i</ci>
          <cn type="integer">1</cn>
         </apply>
         <ci>j</ci>
        </list>
       </apply>
       <apply>
        <plus></plus>
        <ci>n</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>u</ci>
        <list>
         <apply>
          <minus></minus>
          <ci>i</ci>
          <cn type="integer">1</cn>
         </apply>
         <ci>j</ci>
        </list>
       </apply>
       <apply>
        <plus></plus>
        <ci>n</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>u</ci>
        <list>
         <ci>i</ci>
         <apply>
          <plus></plus>
          <ci>j</ci>
          <cn type="integer">1</cn>
         </apply>
        </list>
       </apply>
       <apply>
        <plus></plus>
        <ci>n</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>u</ci>
        <list>
         <ci>i</ci>
         <apply>
          <minus></minus>
          <ci>j</ci>
          <cn type="integer">1</cn>
         </apply>
        </list>
       </apply>
       <apply>
        <plus></plus>
        <ci>n</ci>
        <cn type="integer">1</cn>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \displaystyle(1+2\mu)u_{i,j}^{n+1}-\frac{\mu}{2}\left(u_{i+1,j}^{n+1}+u_{i-1,j%
}^{n+1}+u_{i,j+1}^{n+1}+u_{i,j-1}^{n+1}\right)
  </annotation>
 </semantics>
</math>


</p>
<h2 id="application-in-financial-mathematics">Application in financial mathematics</h2>

<p>Because a number of other phenomena can be <a href="Mathematical_model" title="wikilink">modeled</a> with the <a href="heat_equation" title="wikilink">heat equation</a> (often called the diffusion equation in <a href="financial_mathematics" title="wikilink">financial mathematics</a>), the Crank–Nicolson method has been applied to those areas as well.<a class="footnoteRef" href="#fn4" id="fnref4"><sup>4</sup></a> Particularly, the <a class="uri" href="Black–Scholes" title="wikilink">Black–Scholes</a> option pricing model's <a href="differential_equation" title="wikilink">differential equation</a> can be transformed into the heat equation, and thus <a href="numerical_methods" title="wikilink">numerical solutions</a> for <a href="Valuation_of_options" title="wikilink">option pricing</a> can be obtained with the Crank–Nicolson method.</p>

<p>The importance of this for finance, is that option pricing problems, when extended beyond the standard assumptions (e.g. incorporating changing dividends), cannot be solved in closed form, but can be solved using this method. Note however, that for non-smooth final conditions (which happen for most financial instruments), the Crank–Nicolson method is not satisfactory as numerical oscillations are not damped. For <a href="vanilla_option" title="wikilink">vanilla options</a>, this results in oscillation in the <a href="Greeks_(finance)#Gamma" title="wikilink">gamma value</a> around the <a href="strike_price" title="wikilink">strike price</a>. Therefore, special damping initialization steps are necessary (e.g., fully implicit finite difference method).</p>
<h2 id="see-also">See also</h2>
<ul>
<li><a href="Financial_mathematics" title="wikilink">Financial mathematics</a></li>
<li><a href="Trapezoidal_rule_(differential_equations)" title="wikilink">Trapezoidal rule (differential equations)</a></li>
</ul>
<h2 id="references">References</h2>
<references>
</references>
<h2 id="external-links">External links</h2>
<ul>
<li><a href="http://math.fullerton.edu/mathews/n2003/CrankNicolsonMod.html">Module for Parabolic P.D.E.'s</a></li>
<li><a href="http://www3.nd.edu/~dbalsara/Numerical-PDE-Course/">Numerical PDE Techniques for Scientists and Engineers</a>, open access Lectures and Codes for Numerical PDEs</li>
<li><a href="http://scicomp.stackexchange.com/questions/7399/how-to-discretize-the-advection-equation-using-the-crank-nicolson-methods">An example of how to apply and implement the Crank-Nicolson method for the Advection equation</a></li>
</ul>

<p>"</p>

<p><a href="Category:Mathematical_finance" title="wikilink">Category:Mathematical finance</a> <a href="Category:Numerical_differential_equations" title="wikilink">Category:Numerical differential equations</a> <a href="Category:Finite_differences" title="wikilink">Category:Finite differences</a></p>
<section class="footnotes">
<hr/>
<ol>
<li id="fn1"><a href="#fnref1">↩</a></li>
<li id="fn2">.<a href="#fnref2">↩</a></li>
<li id="fn3">. Example 3.3.2 shows that Crank–Nicolson is unconditionally stable when applied to 

<math display="inline" id="Crank–Nicolson_method:51">
 <semantics>
  <mrow>
   <msub>
    <mi>u</mi>
    <mi>t</mi>
   </msub>
   <mo>=</mo>
   <mrow>
    <mi>a</mi>
    <msub>
     <mi>u</mi>
     <mrow>
      <mi>x</mi>
      <mi>x</mi>
     </mrow>
    </msub>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>u</ci>
     <ci>t</ci>
    </apply>
    <apply>
     <times></times>
     <ci>a</ci>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>u</ci>
      <apply>
       <times></times>
       <ci>x</ci>
       <ci>x</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   u_{t}=au_{xx}
  </annotation>
 </semantics>
</math>

.<a href="#fnref3">↩</a></li>
<li id="fn4"><a href="#fnref4">↩</a></li>
</ol>
</section>
</body>
</html>
