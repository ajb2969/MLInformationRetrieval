<html lang="en">
<head>
<meta charset="utf-8"/>
<title offset="869">Needham–Schroeder protocol</title>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG.js" type="text/javascript">
</script>
</head>
<body>
<h1>Needham–Schroeder protocol</h1>
<hr/>

<p>The term <strong>Needham–Schroeder protocol</strong> can refer to one of the two key transport protocols intended for use over an insecure network, both proposed by <a href="Roger_Needham" title="wikilink">Roger Needham</a> and <a href="Michael_Schroeder" title="wikilink">Michael Schroeder</a>.<a class="footnoteRef" href="#fn1" id="fnref1"><sup>1</sup></a> These are:</p>
<ul>
<li>The <em>Needham–Schroeder Symmetric Key Protocol</em> is based on a <a href="Symmetric-key_algorithm" title="wikilink">symmetric encryption algorithm</a>. It forms the basis for the <a href="Kerberos_(protocol)" title="wikilink">Kerberos</a> protocol. This protocol aims to establish a <a href="session_key" title="wikilink">session key</a> between two parties on a network, typically to protect further communication.</li>
<li>The <em>Needham–Schroeder Public-Key Protocol</em>, based on <a href="public-key_cryptography" title="wikilink">public-key cryptography</a>. This protocol is intended to provide mutual <a class="uri" href="authentication" title="wikilink">authentication</a> between two parties communicating on a network, but in its proposed form is insecure.</li>
</ul>
<h2 id="the-symmetric-protocol">The symmetric protocol</h2>

<p>Here, <a href="Alice_and_Bob" title="wikilink">Alice</a> (A) initiates the communication to Bob (B). S is a server trusted by both parties. In the communication:</p>
<ul>
<li>A and B are identities of Alice and Bob respectively</li>
<li>K<sub>AS</sub> is a symmetric key known only to A and S</li>
<li>K<sub>BS</sub> is a symmetric key known only to B and S</li>
<li>N<sub>A</sub> and N<sub>B</sub> are <a href="cryptographic_nonce" title="wikilink">nonces</a> generated by A and B respectively</li>
<li>K<sub>AB</sub> is a symmetric, generated key, which will be the <a href="session_key" title="wikilink">session key</a> of the session between A and B</li>
</ul>

<p>The protocol can be specified as follows in <a href="security_protocol_notation" title="wikilink">security protocol notation</a>:</p>

<p>

<math display="inline" id="Needham–Schroeder_protocol:0">
 <semantics>
  <mrow>
   <mrow>
    <mi>A</mi>
    <mo>→</mo>
    <mi>S</mi>
   </mrow>
   <mo>:</mo>
   <mrow>
    <mi>A</mi>
    <mo>,</mo>
    <mi>B</mi>
    <mo>,</mo>
    <msub>
     <mi>N</mi>
     <mi>A</mi>
    </msub>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <apply>
     <ci>normal-→</ci>
     <ci>A</ci>
     <ci>S</ci>
    </apply>
    <list>
     <ci>A</ci>
     <ci>B</ci>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>N</ci>
      <ci>A</ci>
     </apply>
    </list>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A\rightarrow S:\left.A,B,N_{A}\right.
  </annotation>
 </semantics>
</math>

</p>
<dl>
<dd>Alice sends a message to the server identifying herself and Bob, telling the server she wants to communicate with Bob.
</dd>
</dl>

<p>

<math display="inline" id="Needham–Schroeder_protocol:1">
 <semantics>
  <mrow>
   <mrow>
    <mi>S</mi>
    <mo>→</mo>
    <mi>A</mi>
   </mrow>
   <mo>:</mo>
   <msub>
    <mrow>
     <mo stretchy="false">{</mo>
     <msub>
      <mi>N</mi>
      <mi>A</mi>
     </msub>
     <mo>,</mo>
     <msub>
      <mi>K</mi>
      <mrow>
       <mi>A</mi>
       <mi>B</mi>
      </mrow>
     </msub>
     <mo>,</mo>
     <mi>B</mi>
     <mo>,</mo>
     <msub>
      <mrow>
       <mo stretchy="false">{</mo>
       <msub>
        <mi>K</mi>
        <mrow>
         <mi>A</mi>
         <mi>B</mi>
        </mrow>
       </msub>
       <mo>,</mo>
       <mi>A</mi>
       <mo stretchy="false">}</mo>
      </mrow>
      <msub>
       <mi>K</mi>
       <mrow>
        <mi>B</mi>
        <mi>S</mi>
       </mrow>
      </msub>
     </msub>
     <mo stretchy="false">}</mo>
    </mrow>
    <msub>
     <mi>K</mi>
     <mrow>
      <mi>A</mi>
      <mi>S</mi>
     </mrow>
    </msub>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <apply>
     <ci>normal-→</ci>
     <ci>S</ci>
     <ci>A</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <set>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>N</ci>
       <ci>A</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>K</ci>
       <apply>
        <times></times>
        <ci>A</ci>
        <ci>B</ci>
       </apply>
      </apply>
      <ci>B</ci>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <set>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>K</ci>
         <apply>
          <times></times>
          <ci>A</ci>
          <ci>B</ci>
         </apply>
        </apply>
        <ci>A</ci>
       </set>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>K</ci>
        <apply>
         <times></times>
         <ci>B</ci>
         <ci>S</ci>
        </apply>
       </apply>
      </apply>
     </set>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>K</ci>
      <apply>
       <times></times>
       <ci>A</ci>
       <ci>S</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S\rightarrow A:\{N_{A},K_{AB},B,\{K_{AB},A\}_{K_{BS}}\}_{K_{AS}}
  </annotation>
 </semantics>
</math>

</p>
<dl>
<dd>The server generates 

<math display="inline" id="Needham–Schroeder_protocol:2">
 <semantics>
  <msub>
   <mi>K</mi>
   <mrow>
    <mi>A</mi>
    <mi>B</mi>
   </mrow>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>K</ci>
    <apply>
     <times></times>
     <ci>A</ci>
     <ci>B</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   {K_{AB}}
  </annotation>
 </semantics>
</math>

 and sends back to Alice a copy encrypted under 

<math display="inline" id="Needham–Schroeder_protocol:3">
 <semantics>
  <msub>
   <mi>K</mi>
   <mrow>
    <mi>B</mi>
    <mi>S</mi>
   </mrow>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>K</ci>
    <apply>
     <times></times>
     <ci>B</ci>
     <ci>S</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   {K_{BS}}
  </annotation>
 </semantics>
</math>

 for Alice to forward to Bob and also a copy for Alice. Since Alice may be requesting keys for several different people, the nonce assures Alice that the message is fresh and that the server is replying to that particular message and the inclusion of Bob's name tells Alice who she is to share this key with.
</dd>
</dl>

<p>

<math display="inline" id="Needham–Schroeder_protocol:4">
 <semantics>
  <mrow>
   <mrow>
    <mi>A</mi>
    <mo>→</mo>
    <mi>B</mi>
   </mrow>
   <mo>:</mo>
   <msub>
    <mrow>
     <mo stretchy="false">{</mo>
     <msub>
      <mi>K</mi>
      <mrow>
       <mi>A</mi>
       <mi>B</mi>
      </mrow>
     </msub>
     <mo>,</mo>
     <mi>A</mi>
     <mo stretchy="false">}</mo>
    </mrow>
    <msub>
     <mi>K</mi>
     <mrow>
      <mi>B</mi>
      <mi>S</mi>
     </mrow>
    </msub>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <apply>
     <ci>normal-→</ci>
     <ci>A</ci>
     <ci>B</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <set>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>K</ci>
       <apply>
        <times></times>
        <ci>A</ci>
        <ci>B</ci>
       </apply>
      </apply>
      <ci>A</ci>
     </set>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>K</ci>
      <apply>
       <times></times>
       <ci>B</ci>
       <ci>S</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A\rightarrow B:\{K_{AB},A\}_{K_{BS}}
  </annotation>
 </semantics>
</math>

</p>
<dl>
<dd>Alice forwards the key to Bob who can decrypt it with the key he shares with the server, thus authenticating the data.
</dd>
</dl>

<p>

<math display="inline" id="Needham–Schroeder_protocol:5">
 <semantics>
  <mrow>
   <mrow>
    <mi>B</mi>
    <mo>→</mo>
    <mi>A</mi>
   </mrow>
   <mo>:</mo>
   <msub>
    <mrow>
     <mo stretchy="false">{</mo>
     <msub>
      <mi>N</mi>
      <mi>B</mi>
     </msub>
     <mo stretchy="false">}</mo>
    </mrow>
    <msub>
     <mi>K</mi>
     <mrow>
      <mi>A</mi>
      <mi>B</mi>
     </mrow>
    </msub>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <apply>
     <ci>normal-→</ci>
     <ci>B</ci>
     <ci>A</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <set>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>N</ci>
       <ci>B</ci>
      </apply>
     </set>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>K</ci>
      <apply>
       <times></times>
       <ci>A</ci>
       <ci>B</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B\rightarrow A:\{N_{B}\}_{K_{AB}}
  </annotation>
 </semantics>
</math>

</p>
<dl>
<dd>Bob sends Alice a nonce encrypted under 

<math display="inline" id="Needham–Schroeder_protocol:6">
 <semantics>
  <msub>
   <mi>K</mi>
   <mrow>
    <mi>A</mi>
    <mi>B</mi>
   </mrow>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>K</ci>
    <apply>
     <times></times>
     <ci>A</ci>
     <ci>B</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   {K_{AB}}
  </annotation>
 </semantics>
</math>

 to show that he has the key.
</dd>
</dl>

<p>

<math display="inline" id="Needham–Schroeder_protocol:7">
 <semantics>
  <mrow>
   <mrow>
    <mi>A</mi>
    <mo>→</mo>
    <mi>B</mi>
   </mrow>
   <mo>:</mo>
   <msub>
    <mrow>
     <mo stretchy="false">{</mo>
     <mrow>
      <msub>
       <mi>N</mi>
       <mi>B</mi>
      </msub>
      <mo>-</mo>
      <mn>1</mn>
     </mrow>
     <mo stretchy="false">}</mo>
    </mrow>
    <msub>
     <mi>K</mi>
     <mrow>
      <mi>A</mi>
      <mi>B</mi>
     </mrow>
    </msub>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <apply>
     <ci>normal-→</ci>
     <ci>A</ci>
     <ci>B</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <set>
      <apply>
       <minus></minus>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>N</ci>
        <ci>B</ci>
       </apply>
       <cn type="integer">1</cn>
      </apply>
     </set>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>K</ci>
      <apply>
       <times></times>
       <ci>A</ci>
       <ci>B</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A\rightarrow B:\{N_{B}-1\}_{K_{AB}}
  </annotation>
 </semantics>
</math>

</p>
<dl>
<dd>Alice performs a simple operation on the nonce, re-encrypts it and sends it back verifying that she is still alive and that she holds the key.
</dd>
</dl>
<h3 id="attacks-on-the-protocol">Attacks on the protocol</h3>

<p>The protocol is vulnerable to a <a href="replay_attack" title="wikilink">replay attack</a> (as identified by <a href="Dorothy_E._Denning" title="wikilink">Denning</a> and Sacco<a class="footnoteRef" href="#fn2" id="fnref2"><sup>2</sup></a>). If an attacker uses an older, compromised value for K<sub>AB</sub>, he can then replay the message 

<math display="inline" id="Needham–Schroeder_protocol:8">
 <semantics>
  <msub>
   <mrow>
    <mo stretchy="false">{</mo>
    <msub>
     <mi>K</mi>
     <mrow>
      <mi>A</mi>
      <mi>B</mi>
     </mrow>
    </msub>
    <mo>,</mo>
    <mi>A</mi>
    <mo stretchy="false">}</mo>
   </mrow>
   <msub>
    <mi>K</mi>
    <mrow>
     <mi>B</mi>
     <mi>S</mi>
    </mrow>
   </msub>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <set>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>K</ci>
      <apply>
       <times></times>
       <ci>A</ci>
       <ci>B</ci>
      </apply>
     </apply>
     <ci>A</ci>
    </set>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>K</ci>
     <apply>
      <times></times>
      <ci>B</ci>
      <ci>S</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \{K_{AB},A\}_{K_{BS}}
  </annotation>
 </semantics>
</math>

 to Bob, who will accept it, being unable to tell that the key is not fresh.</p>
<h3 id="fixing-the-attack">Fixing the attack</h3>

<p>This flaw is fixed in the <a href="Kerberos_protocol" title="wikilink">Kerberos protocol</a> by the inclusion of a <a class="uri" href="timestamp" title="wikilink">timestamp</a>. It can also be fixed with the use of nonces as described below.<a class="footnoteRef" href="#fn3" id="fnref3"><sup>3</sup></a> At the beginning of the protocol:</p>
<dl>
<dd><dl>
<dd>

<math display="inline" id="Needham–Schroeder_protocol:9">
 <semantics>
  <mrow>
   <mrow>
    <mi>A</mi>
    <mo>→</mo>
    <mi>B</mi>
   </mrow>
   <mo>:</mo>
   <mi>A</mi>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <apply>
     <ci>normal-→</ci>
     <ci>A</ci>
     <ci>B</ci>
    </apply>
    <ci>A</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A\rightarrow B:A
  </annotation>
 </semantics>
</math>


</dd>
</dl>
</dd>
</dl>
<dl>
<dd>Alice sends to Bob a request.
</dd>
</dl>
<dl>
<dd><dl>
<dd>

<math display="inline" id="Needham–Schroeder_protocol:10">
 <semantics>
  <mrow>
   <mrow>
    <mi>B</mi>
    <mo>→</mo>
    <mi>A</mi>
   </mrow>
   <mo>:</mo>
   <msub>
    <mrow>
     <mo stretchy="false">{</mo>
     <mi>A</mi>
     <mo>,</mo>
     <msubsup>
      <mi>𝐍</mi>
      <mi>𝐁</mi>
      <mo>′</mo>
     </msubsup>
     <mo stretchy="false">}</mo>
    </mrow>
    <msub>
     <mi>K</mi>
     <mrow>
      <mi>B</mi>
      <mi>S</mi>
     </mrow>
    </msub>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <apply>
     <ci>normal-→</ci>
     <ci>B</ci>
     <ci>A</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <set>
      <ci>A</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>𝐍</ci>
        <ci>𝐁</ci>
       </apply>
       <ci>normal-′</ci>
      </apply>
     </set>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>K</ci>
      <apply>
       <times></times>
       <ci>B</ci>
       <ci>S</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B\rightarrow A:\{A,\mathbf{N_{B}^{\prime}}\}_{K_{BS}}
  </annotation>
 </semantics>
</math>


</dd>
</dl>
</dd>
</dl>
<dl>
<dd>Bob responds with a nonce encrypted under his key with the Server.
</dd>
</dl>
<dl>
<dd><dl>
<dd>

<math display="inline" id="Needham–Schroeder_protocol:11">
 <semantics>
  <mrow>
   <mrow>
    <mi>A</mi>
    <mo>→</mo>
    <mi>S</mi>
   </mrow>
   <mo>:</mo>
   <mrow>
    <mi>A</mi>
    <mo>,</mo>
    <mi>B</mi>
    <mo>,</mo>
    <msub>
     <mi>N</mi>
     <mi>A</mi>
    </msub>
    <mo>,</mo>
    <msub>
     <mrow>
      <mo stretchy="false">{</mo>
      <mi>A</mi>
      <mo>,</mo>
      <msubsup>
       <mi>𝐍</mi>
       <mi>𝐁</mi>
       <mo>′</mo>
      </msubsup>
      <mo stretchy="false">}</mo>
     </mrow>
     <msub>
      <mi>K</mi>
      <mrow>
       <mi>B</mi>
       <mi>S</mi>
      </mrow>
     </msub>
    </msub>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <apply>
     <ci>normal-→</ci>
     <ci>A</ci>
     <ci>S</ci>
    </apply>
    <list>
     <ci>A</ci>
     <ci>B</ci>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>N</ci>
      <ci>A</ci>
     </apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <set>
       <ci>A</ci>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>𝐍</ci>
         <ci>𝐁</ci>
        </apply>
        <ci>normal-′</ci>
       </apply>
      </set>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>K</ci>
       <apply>
        <times></times>
        <ci>B</ci>
        <ci>S</ci>
       </apply>
      </apply>
     </apply>
    </list>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A\rightarrow S:\left.A,B,N_{A},\{A,\mathbf{N_{B}^{\prime}}\}_{K_{BS}}\right.
  </annotation>
 </semantics>
</math>


</dd>
</dl>
</dd>
</dl>
<dl>
<dd>Alice sends a message to the server identifying herself and Bob, telling the server she wants to communicate with Bob.
</dd>
</dl>
<dl>
<dd><dl>
<dd>

<math display="inline" id="Needham–Schroeder_protocol:12">
 <semantics>
  <mrow>
   <mrow>
    <mi>S</mi>
    <mo>→</mo>
    <mi>A</mi>
   </mrow>
   <mo>:</mo>
   <msub>
    <mrow>
     <mo stretchy="false">{</mo>
     <msub>
      <mi>N</mi>
      <mi>A</mi>
     </msub>
     <mo>,</mo>
     <msub>
      <mi>K</mi>
      <mrow>
       <mi>A</mi>
       <mi>B</mi>
      </mrow>
     </msub>
     <mo>,</mo>
     <mi>B</mi>
     <mo>,</mo>
     <msub>
      <mrow>
       <mo stretchy="false">{</mo>
       <msub>
        <mi>K</mi>
        <mrow>
         <mi>A</mi>
         <mi>B</mi>
        </mrow>
       </msub>
       <mo>,</mo>
       <mi>A</mi>
       <mo>,</mo>
       <msubsup>
        <mi>𝐍</mi>
        <mi>𝐁</mi>
        <mo>′</mo>
       </msubsup>
       <mo stretchy="false">}</mo>
      </mrow>
      <msub>
       <mi>K</mi>
       <mrow>
        <mi>B</mi>
        <mi>S</mi>
       </mrow>
      </msub>
     </msub>
     <mo stretchy="false">}</mo>
    </mrow>
    <msub>
     <mi>K</mi>
     <mrow>
      <mi>A</mi>
      <mi>S</mi>
     </mrow>
    </msub>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <apply>
     <ci>normal-→</ci>
     <ci>S</ci>
     <ci>A</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <set>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>N</ci>
       <ci>A</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>K</ci>
       <apply>
        <times></times>
        <ci>A</ci>
        <ci>B</ci>
       </apply>
      </apply>
      <ci>B</ci>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <set>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>K</ci>
         <apply>
          <times></times>
          <ci>A</ci>
          <ci>B</ci>
         </apply>
        </apply>
        <ci>A</ci>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <apply>
          <csymbol cd="ambiguous">subscript</csymbol>
          <ci>𝐍</ci>
          <ci>𝐁</ci>
         </apply>
         <ci>normal-′</ci>
        </apply>
       </set>
       <apply>
        <csymbol cd="ambiguous">subscript</csymbol>
        <ci>K</ci>
        <apply>
         <times></times>
         <ci>B</ci>
         <ci>S</ci>
        </apply>
       </apply>
      </apply>
     </set>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>K</ci>
      <apply>
       <times></times>
       <ci>A</ci>
       <ci>S</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S\rightarrow A:\{N_{A},K_{AB},B,\{K_{AB},A,\mathbf{N_{B}^{\prime}}\}_{K_{BS}}%
\}_{K_{AS}}
  </annotation>
 </semantics>
</math>


</dd>
</dl>
</dd>
</dl>
<dl>
<dd>Note the inclusion of the nonce.
</dd>
</dl>

<p>The protocol then continues as described through the final three steps as described in the original protocol <a href="#The_symmetric_protocol" title="wikilink">above</a>. Note that 

<math display="inline" id="Needham–Schroeder_protocol:13">
 <semantics>
  <msubsup>
   <mi>N</mi>
   <mi>B</mi>
   <mo>′</mo>
  </msubsup>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">superscript</csymbol>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>N</ci>
     <ci>B</ci>
    </apply>
    <ci>normal-′</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   N_{B}^{\prime}
  </annotation>
 </semantics>
</math>

 is a different nonce from 

<math display="inline" id="Needham–Schroeder_protocol:14">
 <semantics>
  <msub>
   <mi>N</mi>
   <mi>B</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>N</ci>
    <ci>B</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   N_{B}
  </annotation>
 </semantics>
</math>

.The inclusion of this new nonce prevents the replaying of a compromised version of 

<math display="inline" id="Needham–Schroeder_protocol:15">
 <semantics>
  <msub>
   <mrow>
    <mo stretchy="false">{</mo>
    <msub>
     <mi>K</mi>
     <mrow>
      <mi>A</mi>
      <mi>B</mi>
     </mrow>
    </msub>
    <mo>,</mo>
    <mi>A</mi>
    <mo stretchy="false">}</mo>
   </mrow>
   <msub>
    <mi>K</mi>
    <mrow>
     <mi>B</mi>
     <mi>S</mi>
    </mrow>
   </msub>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <set>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>K</ci>
      <apply>
       <times></times>
       <ci>A</ci>
       <ci>B</ci>
      </apply>
     </apply>
     <ci>A</ci>
    </set>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>K</ci>
     <apply>
      <times></times>
      <ci>B</ci>
      <ci>S</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \{K_{AB},A\}_{K_{BS}}
  </annotation>
 </semantics>
</math>

 since such a message would need to be of the form 

<math display="inline" id="Needham–Schroeder_protocol:16">
 <semantics>
  <msub>
   <mrow>
    <mo stretchy="false">{</mo>
    <msub>
     <mi>K</mi>
     <mrow>
      <mi>A</mi>
      <mi>B</mi>
     </mrow>
    </msub>
    <mo>,</mo>
    <mi>A</mi>
    <mo>,</mo>
    <msubsup>
     <mi>𝐍</mi>
     <mi>𝐁</mi>
     <mo>′</mo>
    </msubsup>
    <mo stretchy="false">}</mo>
   </mrow>
   <msub>
    <mi>K</mi>
    <mrow>
     <mi>B</mi>
     <mi>S</mi>
    </mrow>
   </msub>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <set>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>K</ci>
      <apply>
       <times></times>
       <ci>A</ci>
       <ci>B</ci>
      </apply>
     </apply>
     <ci>A</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>𝐍</ci>
       <ci>𝐁</ci>
      </apply>
      <ci>normal-′</ci>
     </apply>
    </set>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>K</ci>
     <apply>
      <times></times>
      <ci>B</ci>
      <ci>S</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \{K_{AB},A,\mathbf{N_{B}^{\prime}}\}_{K_{BS}}
  </annotation>
 </semantics>
</math>

 which the attacker can't forge since she does not have 

<math display="inline" id="Needham–Schroeder_protocol:17">
 <semantics>
  <msub>
   <mi>K</mi>
   <mrow>
    <mi>B</mi>
    <mi>S</mi>
   </mrow>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>K</ci>
    <apply>
     <times></times>
     <ci>B</ci>
     <ci>S</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   K_{BS}
  </annotation>
 </semantics>
</math>

.</p>
<h2 id="the-public-key-protocol">The public-key protocol</h2>

<p>This assumes the use of a <a href="public-key_cryptography" title="wikilink">public-key encryption algorithm</a>.</p>

<p>Here, Alice (A) and Bob (B) use a trusted server (S) to distribute public keys on request. These keys are:</p>
<ul>
<li>K<sub>PA</sub> and K<sub>SA</sub>, respectively public and private halves of an encryption key-pair belonging to A (S stands for "secret key" here)</li>
<li>K<sub>PB</sub> and K<sub>SB</sub>, similar belonging to B</li>
<li>K<sub>PS</sub> and K<sub>SS</sub>, similar belonging to S. (Note this has the property that K<sub>SS</sub> is used to <em>encrypt</em> and K<sub>PS</sub> to <em>decrypt</em>).</li>
</ul>

<p>The protocol runs as follows:</p>

<p>

<math display="inline" id="Needham–Schroeder_protocol:18">
 <semantics>
  <mrow>
   <mrow>
    <mi>A</mi>
    <mo>→</mo>
    <mi>S</mi>
   </mrow>
   <mo>:</mo>
   <mrow>
    <mi>A</mi>
    <mo>,</mo>
    <mi>B</mi>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <apply>
     <ci>normal-→</ci>
     <ci>A</ci>
     <ci>S</ci>
    </apply>
    <list>
     <ci>A</ci>
     <ci>B</ci>
    </list>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A\rightarrow S:\left.A,B\right.
  </annotation>
 </semantics>
</math>

</p>
<dl>
<dd>A requests B's public keys from S
</dd>
</dl>

<p>

<math display="inline" id="Needham–Schroeder_protocol:19">
 <semantics>
  <mrow>
   <mrow>
    <mi>S</mi>
    <mo>→</mo>
    <mi>A</mi>
   </mrow>
   <mo>:</mo>
   <msub>
    <mrow>
     <mo stretchy="false">{</mo>
     <msub>
      <mi>K</mi>
      <mrow>
       <mi>P</mi>
       <mi>B</mi>
      </mrow>
     </msub>
     <mo>,</mo>
     <mi>B</mi>
     <mo stretchy="false">}</mo>
    </mrow>
    <msub>
     <mi>K</mi>
     <mrow>
      <mi>S</mi>
      <mi>S</mi>
     </mrow>
    </msub>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <apply>
     <ci>normal-→</ci>
     <ci>S</ci>
     <ci>A</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <set>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>K</ci>
       <apply>
        <times></times>
        <ci>P</ci>
        <ci>B</ci>
       </apply>
      </apply>
      <ci>B</ci>
     </set>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>K</ci>
      <apply>
       <times></times>
       <ci>S</ci>
       <ci>S</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S\rightarrow A:\{K_{PB},B\}_{K_{SS}}
  </annotation>
 </semantics>
</math>

</p>
<dl>
<dd>S responds with public key K<sub>PB</sub> alongside B's identity, signed by the server for authentication purposes.
</dd>
</dl>

<p>

<math display="inline" id="Needham–Schroeder_protocol:20">
 <semantics>
  <mrow>
   <mrow>
    <mi>B</mi>
    <mo>→</mo>
    <mi>S</mi>
   </mrow>
   <mo>:</mo>
   <mrow>
    <mi>B</mi>
    <mo>,</mo>
    <mi>A</mi>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <apply>
     <ci>normal-→</ci>
     <ci>B</ci>
     <ci>S</ci>
    </apply>
    <list>
     <ci>B</ci>
     <ci>A</ci>
    </list>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B\rightarrow S:\left.B,A\right.
  </annotation>
 </semantics>
</math>

</p>
<dl>
<dd>B requests A's public keys.
</dd>
</dl>

<p>

<math display="inline" id="Needham–Schroeder_protocol:21">
 <semantics>
  <mrow>
   <mrow>
    <mi>S</mi>
    <mo>→</mo>
    <mi>B</mi>
   </mrow>
   <mo>:</mo>
   <msub>
    <mrow>
     <mo stretchy="false">{</mo>
     <msub>
      <mi>K</mi>
      <mrow>
       <mi>P</mi>
       <mi>A</mi>
      </mrow>
     </msub>
     <mo>,</mo>
     <mi>A</mi>
     <mo stretchy="false">}</mo>
    </mrow>
    <msub>
     <mi>K</mi>
     <mrow>
      <mi>S</mi>
      <mi>S</mi>
     </mrow>
    </msub>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <apply>
     <ci>normal-→</ci>
     <ci>S</ci>
     <ci>B</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <set>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>K</ci>
       <apply>
        <times></times>
        <ci>P</ci>
        <ci>A</ci>
       </apply>
      </apply>
      <ci>A</ci>
     </set>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>K</ci>
      <apply>
       <times></times>
       <ci>S</ci>
       <ci>S</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   S\rightarrow B:\{K_{PA},A\}_{K_{SS}}
  </annotation>
 </semantics>
</math>

</p>
<dl>
<dd>Server responds.
</dd>
</dl>

<p>

<math display="inline" id="Needham–Schroeder_protocol:22">
 <semantics>
  <mrow>
   <mrow>
    <mi>A</mi>
    <mo>→</mo>
    <mi>B</mi>
   </mrow>
   <mo>:</mo>
   <msub>
    <mrow>
     <mo stretchy="false">{</mo>
     <msub>
      <mi>N</mi>
      <mi>A</mi>
     </msub>
     <mo>,</mo>
     <mi>A</mi>
     <mo stretchy="false">}</mo>
    </mrow>
    <msub>
     <mi>K</mi>
     <mrow>
      <mi>P</mi>
      <mi>B</mi>
     </mrow>
    </msub>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <apply>
     <ci>normal-→</ci>
     <ci>A</ci>
     <ci>B</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <set>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>N</ci>
       <ci>A</ci>
      </apply>
      <ci>A</ci>
     </set>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>K</ci>
      <apply>
       <times></times>
       <ci>P</ci>
       <ci>B</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A\rightarrow B:\{N_{A},A\}_{K_{PB}}
  </annotation>
 </semantics>
</math>

</p>
<dl>
<dd>A chooses a random N<sub>A</sub> and sends it to B.
</dd>
</dl>

<p>

<math display="inline" id="Needham–Schroeder_protocol:23">
 <semantics>
  <mrow>
   <mrow>
    <mi>B</mi>
    <mo>→</mo>
    <mi>A</mi>
   </mrow>
   <mo>:</mo>
   <msub>
    <mrow>
     <mo stretchy="false">{</mo>
     <msub>
      <mi>N</mi>
      <mi>A</mi>
     </msub>
     <mo>,</mo>
     <msub>
      <mi>N</mi>
      <mi>B</mi>
     </msub>
     <mo stretchy="false">}</mo>
    </mrow>
    <msub>
     <mi>K</mi>
     <mrow>
      <mi>P</mi>
      <mi>A</mi>
     </mrow>
    </msub>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <apply>
     <ci>normal-→</ci>
     <ci>B</ci>
     <ci>A</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <set>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>N</ci>
       <ci>A</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>N</ci>
       <ci>B</ci>
      </apply>
     </set>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>K</ci>
      <apply>
       <times></times>
       <ci>P</ci>
       <ci>A</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B\rightarrow A:\{N_{A},N_{B}\}_{K_{PA}}
  </annotation>
 </semantics>
</math>

</p>
<dl>
<dd>B chooses a random N<sub>B</sub>, and sends it to A along with N<sub>A</sub> to prove ability to decrypt with K<sub>SB</sub>.
</dd>
</dl>

<p>

<math display="inline" id="Needham–Schroeder_protocol:24">
 <semantics>
  <mrow>
   <mrow>
    <mi>A</mi>
    <mo>→</mo>
    <mi>B</mi>
   </mrow>
   <mo>:</mo>
   <msub>
    <mrow>
     <mo stretchy="false">{</mo>
     <msub>
      <mi>N</mi>
      <mi>B</mi>
     </msub>
     <mo stretchy="false">}</mo>
    </mrow>
    <msub>
     <mi>K</mi>
     <mrow>
      <mi>P</mi>
      <mi>B</mi>
     </mrow>
    </msub>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <apply>
     <ci>normal-→</ci>
     <ci>A</ci>
     <ci>B</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <set>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>N</ci>
       <ci>B</ci>
      </apply>
     </set>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>K</ci>
      <apply>
       <times></times>
       <ci>P</ci>
       <ci>B</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A\rightarrow B:\{N_{B}\}_{K_{PB}}
  </annotation>
 </semantics>
</math>

</p>
<dl>
<dd>A confirms N<sub>B</sub> to B, to prove ability to decrypt with K<sub>SA</sub>
</dd>
</dl>

<p>At the end of the protocol, A and B know each other's identities, and know both N<sub>A</sub> and N<sub>B</sub>. These nonces are not known to eavesdroppers.</p>
<h3 id="an-attack-on-the-protocol">An attack on the protocol</h3>

<p>Unfortunately, this protocol is vulnerable to a <a href="man-in-the-middle_attack" title="wikilink">man-in-the-middle attack</a>. If an impostor can persuade A to initiate a session with him, he can relay the messages to B and convince B that he is communicating with A.</p>

<p>Ignoring the traffic to and from S, which is unchanged, the attack runs as follows:</p>

<p>

<math display="inline" id="Needham–Schroeder_protocol:25">
 <semantics>
  <mrow>
   <mrow>
    <mi>A</mi>
    <mo>→</mo>
    <mi>I</mi>
   </mrow>
   <mo>:</mo>
   <msub>
    <mrow>
     <mo stretchy="false">{</mo>
     <msub>
      <mi>N</mi>
      <mi>A</mi>
     </msub>
     <mo>,</mo>
     <mi>A</mi>
     <mo stretchy="false">}</mo>
    </mrow>
    <msub>
     <mi>K</mi>
     <mrow>
      <mi>P</mi>
      <mi>I</mi>
     </mrow>
    </msub>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <apply>
     <ci>normal-→</ci>
     <ci>A</ci>
     <ci>I</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <set>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>N</ci>
       <ci>A</ci>
      </apply>
      <ci>A</ci>
     </set>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>K</ci>
      <apply>
       <times></times>
       <ci>P</ci>
       <ci>I</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A\rightarrow I:\{N_{A},A\}_{K_{PI}}
  </annotation>
 </semantics>
</math>

</p>
<dl>
<dd>A sends N<sub>A</sub> to I, who decrypts the message with K<sub>SI</sub>
</dd>
</dl>

<p>

<math display="inline" id="Needham–Schroeder_protocol:26">
 <semantics>
  <mrow>
   <mrow>
    <mi>I</mi>
    <mo>→</mo>
    <mi>B</mi>
   </mrow>
   <mo>:</mo>
   <msub>
    <mrow>
     <mo stretchy="false">{</mo>
     <msub>
      <mi>N</mi>
      <mi>A</mi>
     </msub>
     <mo>,</mo>
     <mi>A</mi>
     <mo stretchy="false">}</mo>
    </mrow>
    <msub>
     <mi>K</mi>
     <mrow>
      <mi>P</mi>
      <mi>B</mi>
     </mrow>
    </msub>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <apply>
     <ci>normal-→</ci>
     <ci>I</ci>
     <ci>B</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <set>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>N</ci>
       <ci>A</ci>
      </apply>
      <ci>A</ci>
     </set>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>K</ci>
      <apply>
       <times></times>
       <ci>P</ci>
       <ci>B</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   I\rightarrow B:\{N_{A},A\}_{K_{PB}}
  </annotation>
 </semantics>
</math>

</p>
<dl>
<dd>I relays the message to B, pretending that A is communicating
</dd>
</dl>

<p>

<math display="inline" id="Needham–Schroeder_protocol:27">
 <semantics>
  <mrow>
   <mrow>
    <mi>B</mi>
    <mo>→</mo>
    <mi>I</mi>
   </mrow>
   <mo>:</mo>
   <msub>
    <mrow>
     <mo stretchy="false">{</mo>
     <msub>
      <mi>N</mi>
      <mi>A</mi>
     </msub>
     <mo>,</mo>
     <msub>
      <mi>N</mi>
      <mi>B</mi>
     </msub>
     <mo stretchy="false">}</mo>
    </mrow>
    <msub>
     <mi>K</mi>
     <mrow>
      <mi>P</mi>
      <mi>A</mi>
     </mrow>
    </msub>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <apply>
     <ci>normal-→</ci>
     <ci>B</ci>
     <ci>I</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <set>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>N</ci>
       <ci>A</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>N</ci>
       <ci>B</ci>
      </apply>
     </set>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>K</ci>
      <apply>
       <times></times>
       <ci>P</ci>
       <ci>A</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B\rightarrow I:\{N_{A},N_{B}\}_{K_{PA}}
  </annotation>
 </semantics>
</math>

</p>
<dl>
<dd>B sends N<sub>B</sub>
</dd>
</dl>

<p>

<math display="inline" id="Needham–Schroeder_protocol:28">
 <semantics>
  <mrow>
   <mrow>
    <mi>I</mi>
    <mo>→</mo>
    <mi>A</mi>
   </mrow>
   <mo>:</mo>
   <msub>
    <mrow>
     <mo stretchy="false">{</mo>
     <msub>
      <mi>N</mi>
      <mi>A</mi>
     </msub>
     <mo>,</mo>
     <msub>
      <mi>N</mi>
      <mi>B</mi>
     </msub>
     <mo stretchy="false">}</mo>
    </mrow>
    <msub>
     <mi>K</mi>
     <mrow>
      <mi>P</mi>
      <mi>A</mi>
     </mrow>
    </msub>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <apply>
     <ci>normal-→</ci>
     <ci>I</ci>
     <ci>A</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <set>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>N</ci>
       <ci>A</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>N</ci>
       <ci>B</ci>
      </apply>
     </set>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>K</ci>
      <apply>
       <times></times>
       <ci>P</ci>
       <ci>A</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   I\rightarrow A:\{N_{A},N_{B}\}_{K_{PA}}
  </annotation>
 </semantics>
</math>

</p>
<dl>
<dd>I relays it to A
</dd>
</dl>

<p>

<math display="inline" id="Needham–Schroeder_protocol:29">
 <semantics>
  <mrow>
   <mrow>
    <mi>A</mi>
    <mo>→</mo>
    <mi>I</mi>
   </mrow>
   <mo>:</mo>
   <msub>
    <mrow>
     <mo stretchy="false">{</mo>
     <msub>
      <mi>N</mi>
      <mi>B</mi>
     </msub>
     <mo stretchy="false">}</mo>
    </mrow>
    <msub>
     <mi>K</mi>
     <mrow>
      <mi>P</mi>
      <mi>I</mi>
     </mrow>
    </msub>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <apply>
     <ci>normal-→</ci>
     <ci>A</ci>
     <ci>I</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <set>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>N</ci>
       <ci>B</ci>
      </apply>
     </set>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>K</ci>
      <apply>
       <times></times>
       <ci>P</ci>
       <ci>I</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   A\rightarrow I:\{N_{B}\}_{K_{PI}}
  </annotation>
 </semantics>
</math>

</p>
<dl>
<dd>A decrypts N<sub>B</sub> and confirms it to I, who learns it
</dd>
</dl>

<p>

<math display="inline" id="Needham–Schroeder_protocol:30">
 <semantics>
  <mrow>
   <mrow>
    <mi>I</mi>
    <mo>→</mo>
    <mi>B</mi>
   </mrow>
   <mo>:</mo>
   <msub>
    <mrow>
     <mo stretchy="false">{</mo>
     <msub>
      <mi>N</mi>
      <mi>B</mi>
     </msub>
     <mo stretchy="false">}</mo>
    </mrow>
    <msub>
     <mi>K</mi>
     <mrow>
      <mi>P</mi>
      <mi>B</mi>
     </mrow>
    </msub>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <apply>
     <ci>normal-→</ci>
     <ci>I</ci>
     <ci>B</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <set>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>N</ci>
       <ci>B</ci>
      </apply>
     </set>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>K</ci>
      <apply>
       <times></times>
       <ci>P</ci>
       <ci>B</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   I\rightarrow B:\{N_{B}\}_{K_{PB}}
  </annotation>
 </semantics>
</math>

</p>
<dl>
<dd>I re-encrypts N<sub>B</sub>, and convinces B that he's decrypted it
</dd>
</dl>

<p>At the end of the attack, B falsely believes that A is communicating with him, and that N<sub>A</sub> and N<sub>B</sub> are known only to A and B.</p>
<h3 id="fixing-the-man-in-the-middle-attack">Fixing the man-in-the-middle attack</h3>

<p>The attack was first described in a 1995 paper by Gavin Lowe.<a class="footnoteRef" href="#fn4" id="fnref4"><sup>4</sup></a> The paper also describes a fixed version of the scheme, referred to as the <strong>Needham–Schroeder–Lowe protocol</strong>. The fix involves the modification of message six, that is we replace:</p>

<p>

<math display="inline" id="Needham–Schroeder_protocol:31">
 <semantics>
  <mrow>
   <mrow>
    <mi>B</mi>
    <mo>→</mo>
    <mi>A</mi>
   </mrow>
   <mo>:</mo>
   <msub>
    <mrow>
     <mo stretchy="false">{</mo>
     <msub>
      <mi>N</mi>
      <mi>A</mi>
     </msub>
     <mo>,</mo>
     <msub>
      <mi>N</mi>
      <mi>B</mi>
     </msub>
     <mo stretchy="false">}</mo>
    </mrow>
    <msub>
     <mi>K</mi>
     <mrow>
      <mi>P</mi>
      <mi>A</mi>
     </mrow>
    </msub>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <apply>
     <ci>normal-→</ci>
     <ci>B</ci>
     <ci>A</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <set>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>N</ci>
       <ci>A</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>N</ci>
       <ci>B</ci>
      </apply>
     </set>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>K</ci>
      <apply>
       <times></times>
       <ci>P</ci>
       <ci>A</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B\rightarrow A:\{N_{A},N_{B}\}_{K_{PA}}
  </annotation>
 </semantics>
</math>

</p>

<p>with the fixed version:</p>

<p>

<math display="inline" id="Needham–Schroeder_protocol:32">
 <semantics>
  <mrow>
   <mrow>
    <mi>B</mi>
    <mo>→</mo>
    <mi>A</mi>
   </mrow>
   <mo>:</mo>
   <msub>
    <mrow>
     <mo stretchy="false">{</mo>
     <msub>
      <mi>N</mi>
      <mi>A</mi>
     </msub>
     <mo>,</mo>
     <msub>
      <mi>N</mi>
      <mi>B</mi>
     </msub>
     <mo>,</mo>
     <mi>B</mi>
     <mo stretchy="false">}</mo>
    </mrow>
    <msub>
     <mi>K</mi>
     <mrow>
      <mi>P</mi>
      <mi>A</mi>
     </mrow>
    </msub>
   </msub>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <apply>
     <ci>normal-→</ci>
     <ci>B</ci>
     <ci>A</ci>
    </apply>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <set>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>N</ci>
       <ci>A</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>N</ci>
       <ci>B</ci>
      </apply>
      <ci>B</ci>
     </set>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>K</ci>
      <apply>
       <times></times>
       <ci>P</ci>
       <ci>A</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   B\rightarrow A:\{N_{A},N_{B},B\}_{K_{PA}}
  </annotation>
 </semantics>
</math>

</p>
<h2 id="see-also">See also</h2>
<ul>
<li><a href="Kerberos_(protocol)" title="wikilink">Kerberos</a></li>
<li><a href="Otway–Rees_protocol" title="wikilink">Otway–Rees protocol</a></li>
<li><a href="Yahalom_(protocol)" title="wikilink">Yahalom</a></li>
<li><a href="Wide_Mouth_Frog_protocol" title="wikilink">Wide Mouth Frog protocol</a></li>
<li><a href="Neuman–Stubblebine_protocol" title="wikilink">Neuman–Stubblebine protocol</a></li>
</ul>
<h2 id="references">References</h2>
<h2 id="external-links">External links</h2>
<ul>
<li><a class="uri" href="http://www.lsv.ens-cachan.fr/spore/nspk.html">http://www.lsv.ens-cachan.fr/spore/nspk.html</a> - description of the Public-key protocol</li>
<li><a class="uri" href="http://www.lsv.ens-cachan.fr/spore/nssk.html">http://www.lsv.ens-cachan.fr/spore/nssk.html</a> - the Symmetric-key protocol</li>
<li><a class="uri" href="http://www.lsv.ens-cachan.fr/spore/nspkLowe.html">http://www.lsv.ens-cachan.fr/spore/nspkLowe.html</a> - the public-key protocol amended by Lowe</li>
</ul>

<p>"</p>

<p><a href="Category:Authentication_protocols" title="wikilink">Category:Authentication protocols</a> <a href="Category:Key_transport_protocols" title="wikilink">Category:Key transport protocols</a> <a href="Category:Symmetric-key_cryptography" title="wikilink">Category:Symmetric-key cryptography</a> <a href="Category:Computer_access_control_protocols" title="wikilink">Category:Computer access control protocols</a></p>
<section class="footnotes">
<hr/>
<ol>
<li id="fn1"><a href="#fnref1">↩</a></li>
<li id="fn2"><a href="#fnref2">↩</a></li>
<li id="fn3"><a href="#fnref3">↩</a></li>
<li id="fn4"><a href="#fnref4">↩</a></li>
</ol>
</section>
</body>
</html>
