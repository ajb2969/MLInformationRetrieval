<html lang="en">
<head>
<meta charset="utf-8"/>
<title offset="1531">KeeLoq</title>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG.js" type="text/javascript">
</script>
</head>
<body>
<h1>KeeLoq</h1>
<hr/>

<p><strong>KeeLoq</strong> is a proprietary hardware-dedicated <a href="block_cipher" title="wikilink">block cipher</a> that uses a <a href="NLFSR" title="wikilink">non-linear feedback shift register</a> (NLFSR). The uni-directional command transfer protocol was designed by Frederick Bruwer of Nanoteq (Pty) Ltd., the cryptographic algorithm was created by Gideon Kuhn, and the silicon implementation was by Willem Smit at Nanoteq Pty Ltd (<a href="South_Africa" title="wikilink">South Africa</a>) in the mid-1980s. KeeLoq was sold to <a href="Microchip_Technology" title="wikilink">Microchip Technology Inc</a> in 1995 for $10 million.<a class="footnoteRef" href="#fn1" id="fnref1"><sup>1</sup></a> It is used in "<a href="Hopping_code" title="wikilink">code hopping</a>" encoders and decoders such as NTQ105/106/115/125D/129D and HCS101/2XX/3XX/4XX/5XX. KeeLoq is or was used in many <a href="Remote_keyless_system" title="wikilink">remote keyless entry systems</a> by such companies as <a class="uri" href="Chrysler" title="wikilink">Chrysler</a>, <a class="uri" href="Daewoo" title="wikilink">Daewoo</a>, <a class="uri" href="Fiat" title="wikilink">Fiat</a>, <a href="General_Motors" title="wikilink">GM</a>, <a class="uri" href="Honda" title="wikilink">Honda</a>, <a class="uri" href="Toyota" title="wikilink">Toyota</a>, <a class="uri" href="Volvo" title="wikilink">Volvo</a>, <a href="Volkswagen_Group" title="wikilink">Volkswagen Group</a>, Clifford, Shurlok, <a class="uri" href="Jaguar" title="wikilink">Jaguar</a>, etc.<a class="footnoteRef" href="#fn2" id="fnref2"><sup>2</sup></a></p>
<h2 id="description">Description</h2>

<p> KeeLoq "code hopping" encoders encrypt a 0-filled 32-bit block with KeeLoq cipher to produce a 32-bit "<a href="hopping_code" title="wikilink">hopping code</a>". A 32-bit <a href="initialization_vector" title="wikilink">initialization vector</a> is linearly added (<a href="XOR" title="wikilink">XORed</a>) to the 32 <a href="least_significant_bit" title="wikilink">least significant bits</a> of the <a href="key_(cryptography)" title="wikilink">key</a> prior to <a class="uri" href="encryption" title="wikilink">encryption</a> and after <a class="uri" href="decryption" title="wikilink">decryption</a>.</p>

<p>KeeLoq cipher accepts 64-bit keys and encrypts 32-bit blocks by executing its single-bit NLFSR for 528 rounds. The NLFSR feedback function is <code>0x3A5C742E</code> or</p>

<p>

<math display="block" id="KeeLoq:0">
 <semantics>
  <mrow>
   <mrow>
    <mi>F</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>a</mi>
     <mo>,</mo>
     <mi>b</mi>
     <mo>,</mo>
     <mi>c</mi>
     <mo>,</mo>
     <mi>d</mi>
     <mo>,</mo>
     <mi>e</mi>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mi>d</mi>
    <mo>⊕</mo>
    <mi>e</mi>
    <mo>⊕</mo>
    <mrow>
     <mi>a</mi>
     <mi>c</mi>
    </mrow>
    <mo>⊕</mo>
    <mrow>
     <mi>a</mi>
     <mi>e</mi>
    </mrow>
    <mo>⊕</mo>
    <mrow>
     <mi>b</mi>
     <mi>c</mi>
    </mrow>
    <mo>⊕</mo>
    <mrow>
     <mi>b</mi>
     <mi>e</mi>
    </mrow>
    <mo>⊕</mo>
    <mrow>
     <mi>c</mi>
     <mi>d</mi>
    </mrow>
    <mo>⊕</mo>
    <mrow>
     <mi>d</mi>
     <mi>e</mi>
    </mrow>
    <mo>⊕</mo>
    <mrow>
     <mi>a</mi>
     <mi>d</mi>
     <mi>e</mi>
    </mrow>
    <mo>⊕</mo>
    <mrow>
     <mi>a</mi>
     <mi>c</mi>
     <mi>e</mi>
    </mrow>
    <mo>⊕</mo>
    <mrow>
     <mi>a</mi>
     <mi>b</mi>
     <mi>d</mi>
    </mrow>
    <mo>⊕</mo>
    <mrow>
     <mi>a</mi>
     <mi>b</mi>
     <mi>c</mi>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <ci>F</ci>
     <vector>
      <ci>a</ci>
      <ci>b</ci>
      <ci>c</ci>
      <ci>d</ci>
      <ci>e</ci>
     </vector>
    </apply>
    <apply>
     <csymbol cd="latexml">direct-sum</csymbol>
     <ci>d</ci>
     <ci>e</ci>
     <apply>
      <times></times>
      <ci>a</ci>
      <ci>c</ci>
     </apply>
     <apply>
      <times></times>
      <ci>a</ci>
      <ci>e</ci>
     </apply>
     <apply>
      <times></times>
      <ci>b</ci>
      <ci>c</ci>
     </apply>
     <apply>
      <times></times>
      <ci>b</ci>
      <ci>e</ci>
     </apply>
     <apply>
      <times></times>
      <ci>c</ci>
      <ci>d</ci>
     </apply>
     <apply>
      <times></times>
      <ci>d</ci>
      <ci>e</ci>
     </apply>
     <apply>
      <times></times>
      <ci>a</ci>
      <ci>d</ci>
      <ci>e</ci>
     </apply>
     <apply>
      <times></times>
      <ci>a</ci>
      <ci>c</ci>
      <ci>e</ci>
     </apply>
     <apply>
      <times></times>
      <ci>a</ci>
      <ci>b</ci>
      <ci>d</ci>
     </apply>
     <apply>
      <times></times>
      <ci>a</ci>
      <ci>b</ci>
      <ci>c</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   F(a,b,c,d,e)=d\oplus e\oplus ac\oplus ae\oplus bc\oplus be\oplus cd\oplus de%
\oplus ade\oplus ace\oplus abd\oplus abc
  </annotation>
 </semantics>
</math>

 KeeLoq uses bits 1, 9, 20, 26 and 31 of the NLFSR state as its inputs during encryption and bits 0, 8, 19, 25 and 30 during decryption. Its output is linearly combined (XORed) with two of the bits of the NLFSR state (bits 0 and 16 on encryption and bits 31 and 15 on decryption) and with a key bit (bit 0 of the key state on encryption and bit 15 of the key state on decryption) and is fed back into the NLFSR state on every round.</p>
<h2 id="attacks">Attacks</h2>
<h3 id="replay-attack">Replay attack</h3>

<p>For simplicity, individual "code hopping" implementations do not use <a href="cryptographic_nonce" title="wikilink">cryptographic nonces</a> and <a href="clock_drift" title="wikilink">clock drift</a> excludes the possibility of using <a class="uri" href="timestamping" title="wikilink">timestamping</a>. This makes the protocol inherently vulnerable to <a href="replay_attack" title="wikilink">replay attacks</a>: For example, by jamming the channel while intercepting the code, a thief can obtain a code that may still be usable at a later stage.<a class="footnoteRef" href="#fn3" id="fnref3"><sup>3</sup></a> This sort of "code grabber,"<a class="footnoteRef" href="#fn4" id="fnref4"><sup>4</sup></a> while theoretically interesting, does not appear to be widely used by car thieves.<a class="footnoteRef" href="#fn5" id="fnref5"><sup>5</sup></a></p>
<h3 id="cryptanalysis">Cryptanalysis</h3>

<p> KeeLoq was first <a href="cryptanalysis" title="wikilink">cryptanalyzed</a> by Andrey Bogdanov using sliding techniques and efficient <a href="linear_approximation" title="wikilink">linear approximations</a>. <a href="Nicolas_Courtois" title="wikilink">Nicolas Courtois</a> attacked KeeLoq using sliding and algebraic methods. The attacks by Bogdanov and Courtois do not pose any threat to the actual implementations that seem to be much more vulnerable to simple <a href="brute_force_attack" title="wikilink">brute-force</a> of the <a href="key_space_(cryptography)" title="wikilink">key space</a> that is reduced in all the code-hopping implementations of the <a class="uri" href="cipher" title="wikilink">cipher</a> known to date. Some KeeLoq "code grabbers" use <a href="Field-programmable_gate_array" title="wikilink">FPGA</a>-based devices to break KeeLoq-based keys by brute force within about two weeks due to the reduced key length in the real world implementations.</p>

<p>In 2007, researchers in the <a class="uri" href="COSIC" title="wikilink">COSIC</a> group at the university at <a class="uri" href="Leuven" title="wikilink">Leuven</a>, <a class="uri" href="Belgium" title="wikilink">Belgium</a>, (K.U.Leuven) in cooperation with colleagues from <a class="uri" href="Israel" title="wikilink">Israel</a> found a new attack against the system.<a class="footnoteRef" href="#fn6" id="fnref6"><sup>6</sup></a> Using the details of the algorithm that were leaked in 2006, the researchers started to analyze the weaknesses. After determining the part of the key common to cars of a specific model, the unique bits of the key can be cracked with only sniffed communication between the key and the car.</p>

<p>Microchip introduced in 1996<a class="footnoteRef" href="#fn7" id="fnref7"><sup>7</sup></a> a version of KeeLoq ICs which use a 60-bit seed. If a 60-bit seed is being used, an attacker would require approximately 100 days of processing on a dedicated parallel <a href="brute_force_attack" title="wikilink">brute force attacking</a> machine before the system is broken.<a class="footnoteRef" href="#fn8" id="fnref8"><sup>8</sup></a></p>
<h3 id="side-channel-attacks">Side-channel attacks</h3>

<p>In March 2008, researchers from the Chair for Embedded Security of <a href="Ruhr_University_Bochum" title="wikilink">Ruhr University Bochum</a>, Germany, presented a <a href="Cryptanalysis#Partial_breaks" title="wikilink">complete break</a> of remote keyless entry systems based on the KeeLoq RFID technology.<a class="footnoteRef" href="#fn9" id="fnref9"><sup>9</sup></a><a class="footnoteRef" href="#fn10" id="fnref10"><sup>10</sup></a> Their attack works on all known car and building access control systems that rely on the KeeLoq cipher.</p>

<p>The attack by the Bochum team allows recovering the secret cryptographic <a href="key_(cryptography)" title="wikilink">keys</a> embedded in both the receiver and the remote control. It is based on measuring the electric power consumption of a device during an encryption. Applying what is called <a href="Side_channel_attack" title="wikilink">side-channel analysis</a> methods to the power traces, the researchers can extract the manufacturer key from the receivers, which can be regarded as a master key for generating valid keys for the remote controls of one particular manufacturer. Unlike the cryptanalytic attack described above which requires about 65536 chosen plaintext-ciphertext pairs and days of calculation on a PC to recover the key, the side-channel attack can also be applied to the so-called KeeLoq Code Hopping mode of operation (a.k.a. <a href="rolling_code" title="wikilink">rolling code</a>) that is widely used for keyless entry systems (cars, garages, buildings, etc.).</p>

<p>The most devastating practical consequence of the side-channel analysis is an attack in which an attacker, having previously learned the system's master key, can clone any legitimate encoder by intercepting only two messages from this encoder from a distance of up to . Another attack allows one to reset the internal counter of the receiver (garage door, car door, etc.) which makes it impossible for a legitimate user to open the door.</p>
<h2 id="references">References</h2>
<h2 id="external-links">External links</h2>
<ul>
<li>

<p></p></li>
<li><a href="http://cryptolib.com/ciphers/keeloq">C source code by Ruptor</a> </li>
<li>

<p><a href="http://books.google.com/books?id=siMz55bNnu4C">1</a>.</p></li>
<li><a href="http://eprint.iacr.org/2007/062">N.T. Courtois and G.V. Bard, 'Algebraic and Slide Attacks on KeeLoq'</a></li>
<li></li>
<li><a href="http://eprint.iacr.org/2008/058">Physical Cryptanalysis of KeeLoq code-hopping applications</a></li>
</ul>

<p>"</p>

<p><a href="Category:Block_ciphers" title="wikilink">Category:Block ciphers</a> <a href="Category:Broken_block_ciphers" title="wikilink">Category:Broken block ciphers</a> <a href="Category:Automotive_technology_tradenames" title="wikilink">Category:Automotive technology tradenames</a> <a href="Category:Radio_electronics" title="wikilink">Category:Radio electronics</a> <a href="Category:Vehicle_security_systems" title="wikilink">Category:Vehicle security systems</a> <a href="Category:Microchip_Technology_hardware" title="wikilink">Category:Microchip Technology hardware</a></p>
<section class="footnotes">
<hr/>
<ol>
<li id="fn1"><a href="#fnref1">↩</a></li>
<li id="fn2">Some evidence that <a class="uri" href="Chrysler" title="wikilink">Chrysler</a> indeed uses KeeLoq can be found in <a href="http://www.archive.org/details/tps_episode_04">(this video)</a>.<a href="#fnref2">↩</a></li>
<li id="fn3"><a href="http://people.scs.carleton.ca/~barbeau/Honours/Spencer_Whyte.pdf">Analysis of RF Remote Security Using Software Defined Radio</a><a href="#fnref3">↩</a></li>
<li id="fn4"><a class="uri" href="http://www.microchip.com/stellent/idcplg?IdcService=SS_GET_PAGE&amp;nodeId">http://www.microchip.com/stellent/idcplg?IdcService=SS_GET_PAGE&amp;nodeId;</a>;=2075&amp;param;=en001022#P108_5361 stating, "It is a simple matter to build a circuit to record such transmissions for reply at the later time. Such a system is known as a code or key grabber."<a href="#fnref4">↩</a></li>
<li id="fn5"><a class="uri" href="http://www.snopes.com/autos/techno/lockcode.asp">http://www.snopes.com/autos/techno/lockcode.asp</a><a href="#fnref5">↩</a></li>
<li id="fn6"><a href="http://www.cosic.esat.kuleuven.be/keeloq/">How To Steal Cars — A Practical Attack on KeeLoq</a><a href="#fnref6">↩</a></li>
<li id="fn7">(Will be in Web archive backup later): <a href="http://ww1.microchip.com/downloads/pr_archive/en/en013239.pdf">a Microchip press release on Dec 11, 1996</a> Quote: "...HCS410 KEELOQ Code Hopping Transponder and Encoder..."<a href="#fnref7">↩</a></li>
<li id="fn8"><a href="#fnref8">↩</a></li>
<li id="fn9"><a href="http://www.crypto.rub.de/keeloq">A complete break of the KeeLoq access control system</a><a href="#fnref9">↩</a></li>
<li id="fn10"><a href="#fnref10">↩</a></li>
</ol>
</section>
</body>
</html>
