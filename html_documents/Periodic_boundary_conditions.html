<html lang="en">
<head>
<meta charset="utf-8"/>
<title offset="688">Periodic boundary conditions</title>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG.js" type="text/javascript">
</script>
</head>
<body>
<h1>Periodic boundary conditions</h1>
<style>
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
<style>
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
</body></html>
<body>
<hr/>

<p> <strong>Periodic boundary conditions</strong> (PBCs) are a set of <a href="boundary_condition" title="wikilink">boundary conditions</a> which are often chosen for approximating a large (infinite) system by using a small part called a <em>unit cell</em>. PBCs are often used in <a href="computer_simulation" title="wikilink">computer simulations</a> and <a href="mathematical_model" title="wikilink">mathematical models</a>. The <a class="uri" href="topology" title="wikilink">topology</a> of two-dimensional PBC is equal to that of a <em>world map</em> of some video games; the geometry of the unit cell satisfies perfect two-dimensional tiling, and when an object passes through one side of the unit cell, it re-appears on the opposite side with the same velocity. In topological terms, the space made by two-dimensional PBCs can be thought of as being mapped onto a <a class="uri" href="torus" title="wikilink">torus</a> (<a href="Compactification_(mathematics)" title="wikilink">compactification</a>). The large systems approximated by PBCs consist of an infinite number of unit cells. In computer simulations, one of these is the original simulation box, and others are copies called <em>images</em>. During the simulation, only the properties of the original simulation box need to be recorded and propagated. The <em>minimum-image convention</em> is a common form of PBC particle bookkeeping in which each individual particle in the simulation interacts with the closest image of the remaining particles in the system.</p>

<p>One example of periodic boundary conditions can be defined according to smooth real functions 

<math display="inline" id="Periodic_boundary_conditions:0">
 <semantics>
  <mrow>
   <mi>ϕ</mi>
   <mo>:</mo>
   <mrow>
    <msup>
     <mi>ℝ</mi>
     <mi>n</mi>
    </msup>
    <mo>→</mo>
    <mi>ℝ</mi>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <ci>normal-:</ci>
    <ci>ϕ</ci>
    <apply>
     <ci>normal-→</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>ℝ</ci>
      <ci>n</ci>
     </apply>
     <ci>ℝ</ci>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \phi:\mathbb{R}^{n}\to\mathbb{R}
  </annotation>
 </semantics>
</math>

 by</p>

<p>

<math display="block" id="Periodic_boundary_conditions:1">
 <semantics>
  <mrow>
   <mrow>
    <mrow>
     <mfrac>
      <msup>
       <mo>∂</mo>
       <mi>m</mi>
      </msup>
      <mrow>
       <mo>∂</mo>
       <msubsup>
        <mi>x</mi>
        <mn>1</mn>
        <mi>m</mi>
       </msubsup>
      </mrow>
     </mfrac>
     <mi>ϕ</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <msub>
       <mi>a</mi>
       <mn>1</mn>
      </msub>
      <mo>,</mo>
      <msub>
       <mi>x</mi>
       <mn>2</mn>
      </msub>
      <mo>,</mo>
      <mi mathvariant="normal">…</mi>
      <mo>,</mo>
      <msub>
       <mi>x</mi>
       <mi>n</mi>
      </msub>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
    <mo>=</mo>
    <mrow>
     <mfrac>
      <msup>
       <mo>∂</mo>
       <mi>m</mi>
      </msup>
      <mrow>
       <mo>∂</mo>
       <msubsup>
        <mi>x</mi>
        <mn>1</mn>
        <mi>m</mi>
       </msubsup>
      </mrow>
     </mfrac>
     <mi>ϕ</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <msub>
       <mi>b</mi>
       <mn>1</mn>
      </msub>
      <mo>,</mo>
      <msub>
       <mi>x</mi>
       <mn>2</mn>
      </msub>
      <mo>,</mo>
      <mi mathvariant="normal">…</mi>
      <mo>,</mo>
      <msub>
       <mi>x</mi>
       <mi>n</mi>
      </msub>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
   </mrow>
   <mo>,</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <apply>
      <divide></divide>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <partialdiff></partialdiff>
       <ci>m</ci>
      </apply>
      <apply>
       <partialdiff></partialdiff>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>x</ci>
         <cn type="integer">1</cn>
        </apply>
        <ci>m</ci>
       </apply>
      </apply>
     </apply>
     <ci>ϕ</ci>
     <vector>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>a</ci>
       <cn type="integer">1</cn>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>x</ci>
       <cn type="integer">2</cn>
      </apply>
      <ci>normal-…</ci>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>x</ci>
       <ci>n</ci>
      </apply>
     </vector>
    </apply>
    <apply>
     <times></times>
     <apply>
      <divide></divide>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <partialdiff></partialdiff>
       <ci>m</ci>
      </apply>
      <apply>
       <partialdiff></partialdiff>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>x</ci>
         <cn type="integer">1</cn>
        </apply>
        <ci>m</ci>
       </apply>
      </apply>
     </apply>
     <ci>ϕ</ci>
     <vector>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>b</ci>
       <cn type="integer">1</cn>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>x</ci>
       <cn type="integer">2</cn>
      </apply>
      <ci>normal-…</ci>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>x</ci>
       <ci>n</ci>
      </apply>
     </vector>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \frac{\partial^{m}}{\partial x_{1}^{m}}\phi(a_{1},x_{2},...,x_{n})=\frac{%
\partial^{m}}{\partial x_{1}^{m}}\phi(b_{1},x_{2},...,x_{n}),
  </annotation>
 </semantics>
</math>

</p>

<p>

<math display="block" id="Periodic_boundary_conditions:2">
 <semantics>
  <mrow>
   <mrow>
    <mrow>
     <mfrac>
      <msup>
       <mo>∂</mo>
       <mi>m</mi>
      </msup>
      <mrow>
       <mo>∂</mo>
       <msubsup>
        <mi>x</mi>
        <mn>2</mn>
        <mi>m</mi>
       </msubsup>
      </mrow>
     </mfrac>
     <mi>ϕ</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <msub>
       <mi>x</mi>
       <mn>1</mn>
      </msub>
      <mo>,</mo>
      <msub>
       <mi>a</mi>
       <mn>2</mn>
      </msub>
      <mo>,</mo>
      <mi mathvariant="normal">…</mi>
      <mo>,</mo>
      <msub>
       <mi>x</mi>
       <mi>n</mi>
      </msub>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
    <mo>=</mo>
    <mrow>
     <mfrac>
      <msup>
       <mo>∂</mo>
       <mi>m</mi>
      </msup>
      <mrow>
       <mo>∂</mo>
       <msubsup>
        <mi>x</mi>
        <mn>2</mn>
        <mi>m</mi>
       </msubsup>
      </mrow>
     </mfrac>
     <mi>ϕ</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <msub>
       <mi>x</mi>
       <mn>1</mn>
      </msub>
      <mo>,</mo>
      <msub>
       <mi>b</mi>
       <mn>2</mn>
      </msub>
      <mo>,</mo>
      <mi mathvariant="normal">…</mi>
      <mo>,</mo>
      <msub>
       <mi>x</mi>
       <mi>n</mi>
      </msub>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
   </mrow>
   <mo>,</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <apply>
      <divide></divide>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <partialdiff></partialdiff>
       <ci>m</ci>
      </apply>
      <apply>
       <partialdiff></partialdiff>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>x</ci>
         <cn type="integer">2</cn>
        </apply>
        <ci>m</ci>
       </apply>
      </apply>
     </apply>
     <ci>ϕ</ci>
     <vector>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>x</ci>
       <cn type="integer">1</cn>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>a</ci>
       <cn type="integer">2</cn>
      </apply>
      <ci>normal-…</ci>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>x</ci>
       <ci>n</ci>
      </apply>
     </vector>
    </apply>
    <apply>
     <times></times>
     <apply>
      <divide></divide>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <partialdiff></partialdiff>
       <ci>m</ci>
      </apply>
      <apply>
       <partialdiff></partialdiff>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>x</ci>
         <cn type="integer">2</cn>
        </apply>
        <ci>m</ci>
       </apply>
      </apply>
     </apply>
     <ci>ϕ</ci>
     <vector>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>x</ci>
       <cn type="integer">1</cn>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>b</ci>
       <cn type="integer">2</cn>
      </apply>
      <ci>normal-…</ci>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>x</ci>
       <ci>n</ci>
      </apply>
     </vector>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \frac{\partial^{m}}{\partial x_{2}^{m}}\phi(x_{1},a_{2},...,x_{n})=\frac{%
\partial^{m}}{\partial x_{2}^{m}}\phi(x_{1},b_{2},...,x_{n}),
  </annotation>
 </semantics>
</math>

</p>

<p>

<math display="block" id="Periodic_boundary_conditions:3">
 <semantics>
  <mrow>
   <mi mathvariant="normal">…</mi>
   <mo>,</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <ci>normal-…</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   ...,
  </annotation>
 </semantics>
</math>

</p>

<p>

<math display="block" id="Periodic_boundary_conditions:4">
 <semantics>
  <mrow>
   <mrow>
    <mfrac>
     <msup>
      <mo>∂</mo>
      <mi>m</mi>
     </msup>
     <mrow>
      <mo>∂</mo>
      <msubsup>
       <mi>x</mi>
       <mi>n</mi>
       <mi>m</mi>
      </msubsup>
     </mrow>
    </mfrac>
    <mi>ϕ</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <msub>
      <mi>x</mi>
      <mn>1</mn>
     </msub>
     <mo>,</mo>
     <msub>
      <mi>x</mi>
      <mn>2</mn>
     </msub>
     <mo>,</mo>
     <mi mathvariant="normal">…</mi>
     <mo>,</mo>
     <msub>
      <mi>a</mi>
      <mi>n</mi>
     </msub>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mfrac>
     <msup>
      <mo>∂</mo>
      <mi>m</mi>
     </msup>
     <mrow>
      <mo>∂</mo>
      <msubsup>
       <mi>x</mi>
       <mi>n</mi>
       <mi>m</mi>
      </msubsup>
     </mrow>
    </mfrac>
    <mi>ϕ</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <msub>
      <mi>x</mi>
      <mn>1</mn>
     </msub>
     <mo>,</mo>
     <msub>
      <mi>x</mi>
      <mn>2</mn>
     </msub>
     <mo>,</mo>
     <mi mathvariant="normal">…</mi>
     <mo>,</mo>
     <msub>
      <mi>b</mi>
      <mi>n</mi>
     </msub>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <apply>
      <divide></divide>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <partialdiff></partialdiff>
       <ci>m</ci>
      </apply>
      <apply>
       <partialdiff></partialdiff>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>x</ci>
         <ci>n</ci>
        </apply>
        <ci>m</ci>
       </apply>
      </apply>
     </apply>
     <ci>ϕ</ci>
     <vector>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>x</ci>
       <cn type="integer">1</cn>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>x</ci>
       <cn type="integer">2</cn>
      </apply>
      <ci>normal-…</ci>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>a</ci>
       <ci>n</ci>
      </apply>
     </vector>
    </apply>
    <apply>
     <times></times>
     <apply>
      <divide></divide>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <partialdiff></partialdiff>
       <ci>m</ci>
      </apply>
      <apply>
       <partialdiff></partialdiff>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">subscript</csymbol>
         <ci>x</ci>
         <ci>n</ci>
        </apply>
        <ci>m</ci>
       </apply>
      </apply>
     </apply>
     <ci>ϕ</ci>
     <vector>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>x</ci>
       <cn type="integer">1</cn>
      </apply>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>x</ci>
       <cn type="integer">2</cn>
      </apply>
      <ci>normal-…</ci>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>b</ci>
       <ci>n</ci>
      </apply>
     </vector>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \frac{\partial^{m}}{\partial x_{n}^{m}}\phi(x_{1},x_{2},...,a_{n})=\frac{%
\partial^{m}}{\partial x_{n}^{m}}\phi(x_{1},x_{2},...,b_{n})
  </annotation>
 </semantics>
</math>

 for all m = 0, 1, 2, ... and for constants 

<math display="inline" id="Periodic_boundary_conditions:5">
 <semantics>
  <msub>
   <mi>a</mi>
   <mi>i</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>a</ci>
    <ci>i</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   a_{i}
  </annotation>
 </semantics>
</math>

 and 

<math display="inline" id="Periodic_boundary_conditions:6">
 <semantics>
  <msub>
   <mi>b</mi>
   <mi>i</mi>
  </msub>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <csymbol cd="ambiguous">subscript</csymbol>
    <ci>b</ci>
    <ci>i</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   b_{i}
  </annotation>
 </semantics>
</math>

.</p>

<p>In <a href="molecular_dynamics" title="wikilink">molecular dynamics</a> simulation, PBC are usually applied to calculate bulk gasses, liquids, crystals or mixtures. A common application uses PBC to simulate solvated <a href="macromolecule" title="wikilink">macromolecules</a> in a bath of <a href="water_model" title="wikilink">explicit solvent</a>. <a href="Born-von_Karman_boundary_condition" title="wikilink">Born-von Karman boundary conditions</a> are periodic boundary conditions for a special system.</p>
<h2 id="pbc-requirements-and-artifacts">PBC requirements and artifacts</h2>

<p>Three-dimensional PBCs are useful for approximating the behavior of macro-scale systems of gases, liquids, and solids. Three-dimensional PBCs can also be used to simulate planar surfaces, in which case two-dimensional PBCs are often more suitable. Two-dimensional PBCs for planar surfaces are also called <em>slab boundary conditions</em>; in this case, PBCs are used for two Cartesian coordinates (e.g., x and y), and the third coordinate (z) extends to infinity.</p>

<p>PBCs can be used in conjunction with <a href="Ewald_summation" title="wikilink">Ewald summation</a> methods (e.g., the particle mesh Ewald method) to calculate <a href="Coulomb's_law" title="wikilink">electrostatic</a> forces in the system. However, PBCs also introduce correlational artifacts that do not respect the translational invariance of the system,<a class="footnoteRef" href="#fn1" id="fnref1"><sup>1</sup></a> and requires constraints on the composition and size of the simulation box.</p>

<p>In simulations of solid systems, the <a href="strain_(materials_science)" title="wikilink">strain</a> field arising from any inhomogeneity in the system will be artificially truncated and modified by the periodic boundary. Similarly, the wavelength of sound or shock waves and <a href="phonon" title="wikilink">phonons</a> in the system is limited by the box size.</p>

<p>In simulations containing ionic (Coulomb) interactions, the net <a href="electrostatic_charge" title="wikilink">electrostatic charge</a> of the system must be zero to avoid summing to an infinite charge when PBCs are applied. In some applications it is appropriate to obtain neutrality by adding <a href="ion" title="wikilink">ions</a> such as <a class="uri" href="sodium" title="wikilink">sodium</a> or <a class="uri" href="chloride" title="wikilink">chloride</a> (as <a href="counterion" title="wikilink">counterions</a>) in appropriate numbers if the molecules of interest are charged. Sometimes ions are even added to a system in which the molecules of interest are neutral, to approximate the <a href="ionic_strength" title="wikilink">ionic strength</a> of the solution in which the molecules naturally appear. Maintenance of the minimum-image convention also generally requires that a spherical cutoff radius for nonbonded forces be at most half the length of one side of a cubic box. Even in electrostatically neutral systems, a net <a href="Dipoles#Molecular_dipoles" title="wikilink">dipole moment</a> of the unit cell can introduce a spurious bulk-surface energy, equivalent to <a class="uri" href="pyroelectricity" title="wikilink">pyroelectricity</a> in <a href="ferroelectricity" title="wikilink">polar crystals</a>.</p>

<p>The size of the simulation box must also be large enough to prevent periodic artifacts from occurring due to the unphysical topology of the simulation. In a box that is too small, a macromolecule may interact with its own image in a neighboring box, which is functionally equivalent to a molecule's "head" interacting with its own "tail". This produces highly unphysical dynamics in most macromolecules, although the magnitude of the consequences and thus the appropriate box size relative to the size of the macromolecules depends on the intended length of the simulation, the desired accuracy, and the anticipated dynamics. For example, simulations of <a href="protein_folding" title="wikilink">protein folding</a> that begin from the <a href="native_state" title="wikilink">native state</a> may undergo smaller fluctuations, and therefore may not require as large a box, as simulations that begin from a <a href="random_coil" title="wikilink">random coil</a> conformation. However, the effects of <a href="solvation_shell" title="wikilink">solvation shells</a> on the observed dynamics – in simulation or in experiment – are not well understood. A common recommendation based on simulations of <a class="uri" href="DNA" title="wikilink">DNA</a> is to require at least 1 nm of solvent around the molecules of interest in every dimension.<a class="footnoteRef" href="#fn2" id="fnref2"><sup>2</sup></a></p>
<h2 id="practical-implementation-continuity-and-the-minimum-image-convention">Practical implementation: continuity and the minimum image convention</h2>

<p>To implement a PBC algorithm, at least two steps are needed.</p>

<p>First, an object which has passed through one face of the simulation box should re-enter the box through the opposite face. This is a simple operation which can be described with the following code, where x_size is the length of the box in one direction (assuming an orthogonal unit cell centered on the origin) and x is the position of the particle in the same direction:</p>
<div class="sourceCode"><pre class="sourceCode fortran"><code class="sourceCode fortran"><span class="kw">if</span> (periodic_x) <span class="kw">then</span>
  <span class="kw">if</span> (x <span class="kw">&lt;</span>  <span class="kw">-</span>x_size <span class="kw">*</span> <span class="fl">0.5</span>) x <span class="kw">=</span> x <span class="kw">+</span> x_size
  <span class="kw">if</span> (x <span class="kw">&gt;=</span>  x_size <span class="kw">*</span> <span class="fl">0.5</span>) x <span class="kw">=</span> x <span class="kw">-</span> x_size
<span class="kw">end if</span></code></pre></div>

<p>Second, every distance between objects should obey the minimum image criterion. This can be implemented according to the following code (in the case of a one-dimensional system where dx is the distance between object i and object j):</p>
<div class="sourceCode"><pre class="sourceCode fortran"><code class="sourceCode fortran"><span class="kw">if</span> (periodicx) <span class="kw">then</span>
  dx <span class="kw">=</span> x(j) <span class="kw">-</span> x(i)
  <span class="kw">if</span> (dx <span class="kw">&gt;</span>   xsize<span class="kw">/</span><span class="fl">2.0</span>) dx <span class="kw">=</span> dx <span class="kw">-</span> xsize
  <span class="kw">if</span> (dx <span class="kw">&lt;=</span> <span class="kw">-</span>xsize<span class="kw">/</span><span class="fl">2.0</span>) dx <span class="kw">=</span> dx <span class="kw">+</span> xsize
<span class="kw">endif</span></code></pre></div>

<p>For three-dimensional PBCs, both operations should be repeated in all 3 dimensions.</p>

<p>These operations can be written in a much more compact form for <a class="uri" href="orthorhombic" title="wikilink">orthorhombic</a> cells if the origin is shifted to a corner of the box. Then we have, in one dimension, for positions and distances respectively:</p>
<div class="sourceCode"><pre class="sourceCode fortran"><code class="sourceCode fortran"><span class="co">! After x(i) update without regard to PBC:</span>
x(i) <span class="kw">=</span> x(i) <span class="kw">-</span> <span class="kw">floor</span>(x(i) <span class="kw">/</span> x_size) <span class="kw">*</span> x_size  <span class="co">! For a box with the origin at the lower left vertex</span>
<span class="co">! Works for x's lying in any image.</span>
dx <span class="kw">=</span> x(j) <span class="kw">-</span> x(i)
dx <span class="kw">=</span> dx <span class="kw">-</span> <span class="kw">nint</span>(dx <span class="kw">/</span> x_size) <span class="kw">*</span> x_size</code></pre></div>

<p>For non-orthorhombic cells the situation is more complicated.<a class="footnoteRef" href="#fn3" id="fnref3"><sup>3</sup></a></p>

<p>In simulations of ionic systems more complicated operations may be needed to handle the long-range Coulomb interactions spanning several box images.</p>
<h2 id="unit-cell-geometries">Unit cell geometries</h2>

<p>PBC requires the unit cell to be a shape that will tile perfectly into a three-dimensional crystal. Thus, a <a class="uri" href="spherical" title="wikilink">spherical</a> or <a class="uri" href="elliptical" title="wikilink">elliptical</a> droplet cannot be used. A <a class="uri" href="cube" title="wikilink">cube</a> or <a href="rectangular_prism" title="wikilink">rectangular prism</a> is the most intuitive and common choice, but can be computationally expensive due to unnecessary amounts of <a class="uri" href="solvent" title="wikilink">solvent</a> molecules in the corners, distant from the central macromolecules. A common alternative that requires less volume is the <a href="truncated_octahedron" title="wikilink">truncated octahedron</a>.</p>
<h2 id="conserved-properties">Conserved properties</h2>

<p>Under periodic boundary conditions, the linear <a class="uri" href="momentum" title="wikilink">momentum</a> of the system is conserved. <a href="Angular_momentum" title="wikilink">Angular momentum</a> is not conserved. Conventional explanation of this fact is based on <a href="Noether's_theorem" title="wikilink">Noether's theorem</a>. The theorem states that conservation of angular momentum follows from rotational invariance of <a class="uri" href="Lagrangian" title="wikilink">Lagrangian</a>. However in a paper <a class="footnoteRef" href="#fn4" id="fnref4"><sup>4</sup></a> it is shown that this approach is not consistent. It fails to explain the absence of conservation of angular momentum of a single particle moving in a periodic cell. Lagrangian of the particle is constant and therefore rotationally invariant, while angular momentum of the particle is not conserved. This contradiction is caused by the fact that Noether's theorem is usually formulated for closed systems. The periodic cell exchanges mass momentum, angular momentum, and energy with the neighboring cells.</p>

<p>When applied to the <a href="microcanonical_ensemble" title="wikilink">microcanonical ensemble</a> (constant particle number, volume, and energy, abbreviated NVE), using PBC rather than reflecting walls slightly alters the sampling of the simulation due to the conservation of total linear <a class="uri" href="momentum" title="wikilink">momentum</a> and the position of the center of mass; this ensemble has been termed the "<a href="molecular_dynamics" title="wikilink">molecular dynamics</a> ensemble"<a class="footnoteRef" href="#fn5" id="fnref5"><sup>5</sup></a> or the NVEPG ensemble.<a class="footnoteRef" href="#fn6" id="fnref6"><sup>6</sup></a> These additional conserved quantities introduce minor artifacts related to the <a href="statistical_mechanics" title="wikilink">statistical mechanical</a> definition of <a class="uri" href="temperature" title="wikilink">temperature</a>, the departure of the velocity distributions from a <a href="Boltzmann_distribution" title="wikilink">Boltzmann distribution</a>, and violations of equipartition for systems containing particles with heterogeneous <a href="mass" title="wikilink">masses</a>. The simplest of these effects is that a system of <em>N</em> particles will behave, in the molecular dynamics ensemble, as a system of <em>N-1</em> particles. These artifacts have quantifiable consequences for small toy systems containing only perfectly hard particles; they have not been studied in depth for standard biomolecular simulations, but given the size of such systems, the effects will be largely negligible.<a class="footnoteRef" href="#fn7" id="fnref7"><sup>7</sup></a></p>
<h2 id="notes">Notes</h2>
<references>
</references>
<h2 id="see-also">See also</h2>
<ul>
<li><a href="Helical_boundary_conditions" title="wikilink">Helical boundary conditions</a></li>
<li><a href="Molecular_modeling" title="wikilink">Molecular modeling</a></li>
<li><a href="List_of_software_for_molecular_mechanics_modeling" title="wikilink">Software for molecular mechanics modeling</a></li>
</ul>
<h2 id="references">References</h2>
<ul>
<li>Schlick T. (2002). <em>Molecular Modeling and Simulation: An Interdisciplinary Guide.</em> Interdisciplinary Applied Mathematics series, vol. 21. Springer: New York, NY, USA. ISBN 0-387-95404-X. See esp. pp272–6.</li>
<li>Rapaport DC. (2004). <em>The Art of Molecular Dynamics Simulation.</em> 2nd ed. Cambridge University Press. ISBN 0-521-82568-7. See esp. pp15–20.</li>
<li>Kuzkin V.A. (2014). <a href="http://onlinelibrary.wiley.com/doi/10.1002/zamm.201400045/abstract">On angular momentum balance in particle systems with periodic boundary conditions</a>, <em>ZAMM</em>, 2014, DOI: 10.1002/zamm.201400045.</li>
</ul>

<p>"</p>

<p><a href="Category:Molecular_dynamics" title="wikilink">Category:Molecular dynamics</a> <a href="Category:Boundary_conditions" title="wikilink">Category:Boundary conditions</a></p>
<section class="footnotes">
<hr/>
<ol>
<li id="fn1">Cheatham TE, Miller JH, Fox T, Darden PA, Kollman PA. (1995). Molecular Dynamics Simulations on Solvated Biomolecular Systems: The Particle Mesh Ewald Method Leads to Stable Trajectories of DNA, RNA, and Proteins. <em>J Am Chem Soc</em> 117:4193.<a href="#fnref1">↩</a></li>
<li id="fn2">de Souza ON, Ornstein RL. (1997). Effect of periodic box size on aqueous molecular dynamics simulation of a DNA dodecamer with particle-mesh Ewald method. <em>Biophys J</em> 72(6):2395-7. PMID 9168016<a href="#fnref2">↩</a></li>
<li id="fn3"><a href="http://www.tcm.phy.cam.ac.uk/~mdt26/talks/zoltan/min_image_slides.ps.gz">Minimum image convention in non-cubic simulation cells</a><a href="#fnref3">↩</a></li>
<li id="fn4">Kuzkin V.A. (2014). <a href="http://onlinelibrary.wiley.com/doi/10.1002/zamm.201400045/abstract">On angular momentum balance in particle systems with periodic boundary conditions</a>, ZAMM, 2014, DOI: 10.1002/zamm.201400045.<a href="#fnref4">↩</a></li>
<li id="fn5">Erpenbeck JJ, Wood WW. (1977). <em>Statistical Mechanics, Part B: Time-dependent Processes</em>, Modern Theoretical Chemistry Vol 6. ed. Berne BJ. Plenum, New York, USA. See pp1-40.<a href="#fnref5">↩</a></li>
<li id="fn6">Shirts RB, Burt SR, Johnson AM. (2006). Periodic boundary condition induced breakdown of the equipartition principle and other kinetic effects of finite sample size in classical hard-sphere molecular dynamics simulation. <em>J Chem Phys</em> 125(16):164102. PMID 17092058<a href="#fnref6">↩</a></li>
<li id="fn7"></li>
</ol>
</section>
</body>

