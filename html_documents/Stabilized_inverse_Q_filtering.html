<html lang="en">
<head>
<meta charset="utf-8"/>
<title offset="1729">Stabilized inverse Q filtering</title>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG.js" type="text/javascript">
</script>
</head>
<body>
<h1>Stabilized inverse Q filtering</h1>
<hr/>

<p><strong>Stabilized inverse Q filtering</strong> is a data processing technology for enhancing the resolution of reflection seismology images where the stability of the method used is considered. Q is the <a href="anelastic_attenuation_factor" title="wikilink">anelastic attenuation factor</a> or the seismic quality factor, a measure of the energy loss as the seismic wave moves. To obtain a solution when we make computations with a seismic model we always have to consider the problem of instability and try to obtain a stabilized solution for <a href="seismic_inverse_Q_filtering" title="wikilink">seismic inverse Q filtering</a>.</p>
<h2 id="basics">Basics</h2>

<p>When a wave propagates through subsurface materials both energy dissipation and velocity dispersion takes place. Inverse Q filtering is a method to restore the energy loss due to energy dissipation (amplitude compensation) and to correct the time-shift of the data due to velocity dispersion.</p>

<p>Wang has written an excellent book on the subject of inverse Q filtering, [<a class="uri" href="http://www.google.no/books?id=IpwAjT-F_TgC&amp;lpg">http://www.google.no/books?id=IpwAjT-F_TgC&amp;lpg;</a>;=PR5&amp;ots;=JfclmZipPM&amp;dq;=wang%20seismic%20inverse%20q%20filtering&amp;lr;&amp;hl;=no&amp;pg;=PP1#v=onepage&amp;q;=wang%20seismic%20inverse%20q%20filtering&amp;f;=false Seismic inverse Q filtering (2008)], and discuss the subject of stabilizing the method. He writes: “The phase-only inverse Q filter mentioned above is unconditionally stable. However, if including the accompanying amplitude compensation in the inverse Q filter, stability is a major issue of concern in implementation.”<a class="footnoteRef" href="#fn1" id="fnref1"><sup>1</sup></a></p>

<p>Hale (1981)<a class="footnoteRef" href="#fn2" id="fnref2"><sup>2</sup></a> found that the inverse Q filter overcompensated the amplitudes for the later events in a seismic trace. Therefore, in order to obtain reasonable amplitude, the amplitude spectrum of the computed filter has to be clipped at some maximum gain to prevent undue amplitude at later times. On basis of this concept Wang proposed a stabilized inverse Q filtering approach that was able to compensate simultaneously for both attenuation and dispersion.”<a class="footnoteRef" href="#fn3" id="fnref3"><sup>3</sup></a> The unclipped version of Wang’s solution is presented in the wikipedia article <a href="seismic_inverse_Q_filtering" title="wikilink">seismic inverse Q filtering</a>. The solution is based on the theory of wavefield downward continuation. In this outline here I will compute on a clipped version by introducing low-pass filtering. Both Hale and Wang introduced low-passfiltering as a method for stabilization.</p>
<h2 id="calculations">Calculations</h2>

<p>We have the equation for seismic inverse Q filtering from Wang:</p>

<p>

<math display="block" id="Stabilized_inverse_Q_filtering:0">
 <semantics>
  <mrow>
   <mi>U</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>t</mi>
    <mo>+</mo>
    <mo>△</mo>
    <mi>t</mi>
    <mo>,</mo>
    <mi>w</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>=</mo>
   <mi>U</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>t</mi>
    <mo>,</mo>
    <mi>w</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mi>exp</mi>
   <mrow>
    <mo maxsize="210%" minsize="210%">(</mo>
    <mo stretchy="false">|</mo>
    <mfrac>
     <mi>w</mi>
     <msub>
      <mi>w</mi>
      <mi>r</mi>
     </msub>
    </mfrac>
    <msup>
     <mo stretchy="false">|</mo>
     <mrow>
      <mo>-</mo>
      <mi>γ</mi>
     </mrow>
    </msup>
    <mfrac>
     <mrow>
      <mrow>
       <mo stretchy="false">|</mo>
       <mi>w</mi>
       <mo stretchy="false">|</mo>
      </mrow>
      <mo>△</mo>
      <mi>t</mi>
     </mrow>
     <mrow>
      <mn>2</mn>
      <mi>Q</mi>
      <mrow>
       <mo stretchy="false">(</mo>
       <mi>w</mi>
       <mo stretchy="false">)</mo>
      </mrow>
     </mrow>
    </mfrac>
    <mo maxsize="210%" minsize="210%">)</mo>
   </mrow>
   <mi>exp</mi>
   <mrow>
    <mo maxsize="210%" minsize="210%">(</mo>
    <mi>i</mi>
    <mo stretchy="false">|</mo>
    <mfrac>
     <mi>w</mi>
     <msub>
      <mi>w</mi>
      <mi>r</mi>
     </msub>
    </mfrac>
    <msup>
     <mo stretchy="false">|</mo>
     <mrow>
      <mo>-</mo>
      <mi>γ</mi>
     </mrow>
    </msup>
    <mi>w</mi>
    <mo>△</mo>
    <mi>t</mi>
    <mo maxsize="210%" minsize="210%">)</mo>
   </mrow>
   <mrow>
    <mo stretchy="false">(</mo>
    <mn>1</mn>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">U</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">t</csymbol>
     <plus></plus>
     <ci>normal-△</ci>
     <csymbol cd="unknown">t</csymbol>
     <ci>normal-,</ci>
     <csymbol cd="unknown">w</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <eq></eq>
    <csymbol cd="unknown">U</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">t</csymbol>
     <ci>normal-,</ci>
     <csymbol cd="unknown">w</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <exp></exp>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <ci>normal-|</ci>
     <apply>
      <divide></divide>
      <ci>w</ci>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>w</ci>
       <ci>r</ci>
      </apply>
     </apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>normal-|</ci>
      <apply>
       <minus></minus>
       <ci>γ</ci>
      </apply>
     </apply>
     <apply>
      <divide></divide>
      <apply>
       <ci>normal-△</ci>
       <apply>
        <abs></abs>
        <ci>w</ci>
       </apply>
       <ci>t</ci>
      </apply>
      <apply>
       <times></times>
       <cn type="integer">2</cn>
       <ci>Q</ci>
       <ci>w</ci>
      </apply>
     </apply>
     <ci>normal-)</ci>
    </cerror>
    <exp></exp>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">i</csymbol>
     <ci>normal-|</ci>
     <apply>
      <divide></divide>
      <ci>w</ci>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>w</ci>
       <ci>r</ci>
      </apply>
     </apply>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>normal-|</ci>
      <apply>
       <minus></minus>
       <ci>γ</ci>
      </apply>
     </apply>
     <csymbol cd="unknown">w</csymbol>
     <ci>normal-△</ci>
     <csymbol cd="unknown">t</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <ci></ci>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <cn type="integer">1</cn>
     <ci>normal-)</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   U(t+\bigtriangleup t,w)=U(t,w)\exp\bigg(|\frac{w}{w_{r}}|^{-\gamma}\frac{|w|%
\bigtriangleup t}{2Q(w)}\bigg)\exp\bigg(i|\frac{w}{w_{r}}|^{-\gamma}w%
\bigtriangleup t\bigg)\quad(1)
  </annotation>
 </semantics>
</math>

</p>

<p>

<math display="block" id="Stabilized_inverse_Q_filtering:1">
 <semantics>
  <mrow>
   <mi>γ</mi>
   <mo>=</mo>
   <msup>
    <mrow>
     <mo stretchy="false">(</mo>
     <mrow>
      <mi>π</mi>
      <msub>
       <mi>Q</mi>
       <mi>r</mi>
      </msub>
     </mrow>
     <mo stretchy="false">)</mo>
    </mrow>
    <mrow>
     <mo>-</mo>
     <mn>1</mn>
    </mrow>
   </msup>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <ci>γ</ci>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <times></times>
      <ci>π</ci>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>Q</ci>
       <ci>r</ci>
      </apply>
     </apply>
     <apply>
      <minus></minus>
      <cn type="integer">1</cn>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \gamma=(\pi Q_{r})^{-1}
  </annotation>
 </semantics>
</math>

</p>

<p>Time is denoted τ, frequency is w and i is the imaginary unit. Q<sub>r</sub> and w<sub>r</sub> are reference values representing damping and frequency for a certain frequency. To demonstrate stability we can simply bypass using a reference frequency and get a more simple equation:</p>

<p>

<math display="block" id="Stabilized_inverse_Q_filtering:2">
 <semantics>
  <mrow>
   <mi>U</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>t</mi>
    <mo>+</mo>
    <mo>△</mo>
    <mi>t</mi>
    <mo>,</mo>
    <mi>w</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>=</mo>
   <mi>U</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>t</mi>
    <mo>,</mo>
    <mi>w</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mi>exp</mi>
   <mrow>
    <mo maxsize="210%" minsize="210%">(</mo>
    <mfrac>
     <mrow>
      <mrow>
       <mo stretchy="false">|</mo>
       <mi>w</mi>
       <mo stretchy="false">|</mo>
      </mrow>
      <mo>△</mo>
      <mi>t</mi>
     </mrow>
     <mrow>
      <mn>2</mn>
      <mi>Q</mi>
      <mrow>
       <mo stretchy="false">(</mo>
       <mi>w</mi>
       <mo stretchy="false">)</mo>
      </mrow>
     </mrow>
    </mfrac>
    <mo maxsize="210%" minsize="210%">)</mo>
   </mrow>
   <mi>exp</mi>
   <mrow>
    <mo maxsize="210%" minsize="210%">(</mo>
    <mi>i</mi>
    <mi>w</mi>
    <mo>△</mo>
    <mi>t</mi>
    <mo maxsize="210%" minsize="210%">)</mo>
   </mrow>
   <mrow>
    <mo stretchy="false">(</mo>
    <mn>2</mn>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">U</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">t</csymbol>
     <plus></plus>
     <ci>normal-△</ci>
     <csymbol cd="unknown">t</csymbol>
     <ci>normal-,</ci>
     <csymbol cd="unknown">w</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <eq></eq>
    <csymbol cd="unknown">U</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">t</csymbol>
     <ci>normal-,</ci>
     <csymbol cd="unknown">w</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <exp></exp>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <apply>
      <divide></divide>
      <apply>
       <ci>normal-△</ci>
       <apply>
        <abs></abs>
        <ci>w</ci>
       </apply>
       <ci>t</ci>
      </apply>
      <apply>
       <times></times>
       <cn type="integer">2</cn>
       <ci>Q</ci>
       <ci>w</ci>
      </apply>
     </apply>
     <ci>normal-)</ci>
    </cerror>
    <exp></exp>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">i</csymbol>
     <csymbol cd="unknown">w</csymbol>
     <ci>normal-△</ci>
     <csymbol cd="unknown">t</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <ci></ci>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <cn type="integer">2</cn>
     <ci>normal-)</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   U(t+\bigtriangleup t,w)=U(t,w)\exp\bigg(\frac{|w|\bigtriangleup t}{2Q(w)}\bigg%
)\exp\bigg(iw\bigtriangleup t\bigg)\quad(2)
  </annotation>
 </semantics>
</math>

</p>

<p>The sum of these plane waves gives the time-domain seismic signal,</p>

<p>

<math display="block" id="Stabilized_inverse_Q_filtering:3">
 <semantics>
  <mrow>
   <mi>U</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>t</mi>
    <mo>+</mo>
    <mo>△</mo>
    <mi>t</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mo>=</mo>
   <msubsup>
    <mo largeop="true" symmetric="true">∫</mo>
    <mn>0</mn>
    <mi mathvariant="normal">∞</mi>
   </msubsup>
   <mi>U</mi>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>t</mi>
    <mo>+</mo>
    <mo>△</mo>
    <mi>t</mi>
    <mo>,</mo>
    <mi>w</mi>
    <mo stretchy="false">)</mo>
   </mrow>
   <mi>d</mi>
   <mi>w</mi>
   <mo>.</mo>
   <mrow>
    <mo stretchy="false">(</mo>
    <mn>2.</mn>
    <mi>b</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <cerror>
    <csymbol cd="ambiguous">fragments</csymbol>
    <csymbol cd="unknown">U</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">t</csymbol>
     <plus></plus>
     <ci>normal-△</ci>
     <csymbol cd="unknown">t</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <eq></eq>
    <apply>
     <csymbol cd="ambiguous">superscript</csymbol>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <int></int>
      <cn type="integer">0</cn>
     </apply>
     <infinity></infinity>
    </apply>
    <csymbol cd="unknown">U</csymbol>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <csymbol cd="unknown">t</csymbol>
     <plus></plus>
     <ci>normal-△</ci>
     <csymbol cd="unknown">t</csymbol>
     <ci>normal-,</ci>
     <csymbol cd="unknown">w</csymbol>
     <ci>normal-)</ci>
    </cerror>
    <csymbol cd="unknown">d</csymbol>
    <csymbol cd="unknown">w</csymbol>
    <ci>normal-.</ci>
    <ci></ci>
    <cerror>
     <csymbol cd="ambiguous">fragments</csymbol>
     <ci>normal-(</ci>
     <cn type="float">2.</cn>
     <csymbol cd="unknown">b</csymbol>
     <ci>normal-)</ci>
    </cerror>
   </cerror>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   U(t+\bigtriangleup t)=\int_{0}^{\infty}U(t+\bigtriangleup t,w)dw.\quad(2.b)
  </annotation>
 </semantics>
</math>

</p>

<p>On figure 1 is presented the solution of (2/2.b) for a seismic model for different Q-values, which clearly indicates the numerical instability. Number on top of figure 1 corresponds with the Q number, 1=Q1, 2=Q2 etc. The results are close to the results presented in Wang’s book (each trace is scaled individually, so artefacts are stronger on trace 5 than on trace 4). However, Wang also considered phase compensation. Computations here are for amplitude only inversion since the phase compensation is unnecessary to demonstrate instability because it is always stable.</p>

<p><a class="uri" href="File:Qfilter3.png|Figure">File:Qfilter3.png|Figure</a> 1. Inverse Qfiltered traces Q1=400,Q2=200,Q3=100,Q4=50,Q5=25</p>
<h2 id="low-passfiltering-and-inverse-q-filtering">Low-passfiltering and inverse Q-filtering</h2>

<p>In practice, the artefacts caused by numerical instability can be suppressed by a low-pass filter. Hale wrote that the unclipped IQF of a seismogram amplified the Nyquist frequency by a factor 7x10<sup>6</sup> when we had the ratio t/Q=10 and concluded that for typical seismograms with lengths longer than 1000 samples and Q value around 100, data is seldom pure enough to warrant the use of unclipped IQF. Wang introduced a cutoff frequency to set up a criterion for the stabilization by a mathematical formula. However, considering Hales’ article it could be sufficient to simply remove the Nyquist frequency. That means to let the frequency close to Nyquist frequency be the cutoff frequency. On fig.2 we see a seismic model giving us benchmark data for inverse Q-filtering (red graph). We will see that IQF of this model will amplify the Nyquist frequency by a factor little less than 5x10<sup>6</sup>.</p>

<p><a class="uri" href="File:Qfilter4.png|Figure">File:Qfilter4.png|Figure</a> 2. Seismic benchmark data model. Green graph is undamped and red graph is damped impulse response Q=50</p>

<p>Figure 3 is the amplitude-only inverse Q filtered trace of figure 2 for Q=50 (trace 4). The result clearly indicates the numerical instability. Artefacts are seen through the whole trace.</p>

<p><a class="uri" href="File:Trace6.png|Fig.3">File:Trace6.png|Fig.3</a>. Model from fig.2. with applied invers Q-filter Q=50.</p>

<p>We will try to remove the artefacts by applying a low-pass filter on the trace of figure 3. We used MATLABS signal processing tool and created a low-passfilter (Zero-phase IIR-filter) on fig.4 with cutoff frequency at 120 Hz. The amplitude response of the filter is in blue and the phase in green.</p>

<p><a class="uri" href="File:Low-pass">File:Low-pass</a> filter 2.png |Fig.4. Low-pass filter</p>

<p>The result of filtering trace on fig.3 with the low-passfilter of fig.4 is shown on fig.5. All artefacts are removed and we are left with the impulse response that can be compared with the original model on fig.2.</p>

<p><a class="uri" href="File:Qfilter6.png|Figure">File:Qfilter6.png|Figure</a> 5. Filtered impulserespons where all unstable energy are removed.</p>
<h2 id="frequency-response">Frequency-response</h2>

<p>A study of the frequency response of the trace of figure 3 (unclipped) and figure 5 (clipped) will give more insight into the filtering process. Figure 6 shows the magnitude of the frequency response as a function of digital frequency before filtering. This representation gives a good picture of what happens around the Nyquist frequency when filtering with the low-pass filter is done. Unstable energy is accumulated close to the Nyquistfrequency. After filtering the unstable energy around the Nyquist-frequency is completely removed, and fig.7 give the frequency response of the impulse response of fig.5.</p>

<p><a class="uri" href="File:Qfilter7.png|Figure">File:Qfilter7.png|Figure</a> 6. Frequency-response with digital frequency before filtering.</p>

<p><a class="uri" href="File:Qfilter8.png|Figure">File:Qfilter8.png|Figure</a> 7. Frequency-response with digital frequency after filtering.</p>
<h2 id="notes">Notes</h2>
<h2 id="references">References</h2>
<ul>
<li></li>
</ul>
<h2 id="external-links">External links</h2>
<ul>
<li><a href="http://bki.no/forsking/blad.asp?odd=http://bki.net/ricc/xtra/stabilized_inverse_q_filtering.html">Stabilized inverse Q filtering</a> by Knut Sørsdal</li>
</ul>

<p>"</p>

<p><a href="Category:Articles_created_via_the_Article_Wizard" title="wikilink">Category:Articles created via the Article Wizard</a> <a href="Category:Seismology_measurement" title="wikilink">Category:Seismology measurement</a> <a class="uri" href="Category:Geophysics" title="wikilink">Category:Geophysics</a></p>
<section class="footnotes">
<hr/>
<ol>
<li id="fn1">Wang 2008 p.64<a href="#fnref1">↩</a></li>
<li id="fn2">Hale, D, 1981 Q-adaptive deconvolution: SEP report 30. p.140<a href="#fnref2">↩</a></li>
<li id="fn3">Wang 2008 p.66<a href="#fnref3">↩</a></li>
</ol>
</section>
</body>
</html>
