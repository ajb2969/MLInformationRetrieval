<html lang="en">
<head>
<meta charset="utf-8"/>
<title offset="1772">Umbrella sampling</title>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG.js" type="text/javascript">
</script>
</head>
<body>
<h1>Umbrella sampling</h1>
<hr/>
<figure><b>(Figure)</b>
<figcaption>In an energy landscape with a potential barrier separating two regions of configuration space (bottom sketch), Monte Carlo sampling may be unable to sample the system over a sufficient range of configurations to accurately calculate thermodynamic data, compared to a favourable energy structure (top plot).</figcaption>
</figure>

<p><strong>Umbrella sampling</strong> is a technique in <a href="computational_physics" title="wikilink">computational physics</a> and <a class="uri" href="chemistry" title="wikilink">chemistry</a>, used to improve <a href="Sampling_(statistics)" title="wikilink">sampling</a> of a system (or different systems) where <a class="uri" href="ergodicity" title="wikilink">ergodicity</a> is hindered by the form of the system's <a href="energy_landscape" title="wikilink">energy landscape</a>. It was first suggested by Torrie and Valleau in 1977 [<a href="http://www.sciencedirect.com/science?_ob=ArticleURL&amp;_udi=B6WHY-4DDR2HH-3V&amp;_user=126524&amp;_coverDate=02%2F28%2F1977&amp;_rdoc=1&amp;_fmt">http://www.sciencedirect.com/science?_ob=ArticleURL&amp;_udi=B6WHY-4DDR2HH-3V&amp;_user=126524&amp;_coverDate=02%2F28%2F1977&amp;_rdoc=1&amp;_fmt</a>=&amp;_orig=search&amp;_sort=d&amp;view;=c&amp;_acct=C000010360&amp;_version=1&amp;_urlVersion=0&amp;_userid=126524&amp;md5;=950772b2b4de26ad320fd672ec611557]. It is related to <a href="Importance_sampling" title="wikilink">Importance sampling</a> in statistics (actually it is importance sampling, applied in a particular physical situation).</p>

<p>Systems in which an energy barrier separates two regions of configuration space may suffer from poor sampling. In <a href="Metropolis_Monte_Carlo" title="wikilink">Metropolis Monte Carlo</a> runs, the low probability of overcoming the potential barrier can leave inaccessible configurations poorly sampled – or even entirely unsampled – by the simulation. An easily visualised example occurs with a solid at its melting point: considering the state of the system with an <a href="order_parameter" title="wikilink">order parameter</a> <em>Q</em>, both liquid (low <em>Q</em>) and solid (high <em>Q</em>) phases are low in energy, but are separated by a <a href="Thermodynamic_free_energy" title="wikilink">free energy</a> barrier at intermediate values of <em>Q</em>. This prevents the simulation from adequately sampling both phases.</p>

<p>Umbrella sampling is a means of "bridging the gap" in this situation. The standard Boltzmann weighting for Monte Carlo sampling is replaced by a potential chosen to cancel the influence of the energy barrier present. The <a href="Markov_chain" title="wikilink">Markov chain</a> generated has a distribution given by:</p>

<p>

<math display="block" id="Umbrella_sampling:0">
 <semantics>
  <mrow>
   <mrow>
    <mrow>
     <mi>π</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <msup>
       <mi>𝐫</mi>
       <mi>N</mi>
      </msup>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
    <mo>=</mo>
    <mfrac>
     <mrow>
      <mi>w</mi>
      <mrow>
       <mo stretchy="false">(</mo>
       <msup>
        <mtext>𝐫</mtext>
        <mi>N</mi>
       </msup>
       <mo stretchy="false">)</mo>
      </mrow>
      <mrow>
       <mi>exp</mi>
       <mrow>
        <mo stretchy="false">(</mo>
        <mrow>
         <mo>-</mo>
         <mrow>
          <mrow>
           <mrow>
            <mi>U</mi>
            <mrow>
             <mo stretchy="false">(</mo>
             <msup>
              <mi>𝐫</mi>
              <mi>N</mi>
             </msup>
             <mo stretchy="false">)</mo>
            </mrow>
           </mrow>
           <mo>/</mo>
           <msub>
            <mi>k</mi>
            <mi>B</mi>
           </msub>
          </mrow>
          <mi>T</mi>
         </mrow>
        </mrow>
        <mo stretchy="false">)</mo>
       </mrow>
      </mrow>
     </mrow>
     <mrow>
      <mo largeop="true" symmetric="true">∫</mo>
      <mrow>
       <mi>w</mi>
       <mrow>
        <mo stretchy="false">(</mo>
        <mmultiscripts>
         <mi>𝐫</mi>
         <none></none>
         <mo>′</mo>
         <none></none>
         <mi>N</mi>
        </mmultiscripts>
        <mo stretchy="false">)</mo>
       </mrow>
       <mrow>
        <mi>exp</mi>
        <mrow>
         <mo stretchy="false">(</mo>
         <mrow>
          <mo>-</mo>
          <mrow>
           <mrow>
            <mrow>
             <mi>U</mi>
             <mrow>
              <mo stretchy="false">(</mo>
              <mmultiscripts>
               <mi>𝐫</mi>
               <none></none>
               <mo>′</mo>
               <none></none>
               <mi>N</mi>
              </mmultiscripts>
              <mo stretchy="false">)</mo>
             </mrow>
            </mrow>
            <mo>/</mo>
            <msub>
             <mi>k</mi>
             <mi>B</mi>
            </msub>
           </mrow>
           <mi>T</mi>
          </mrow>
         </mrow>
         <mo stretchy="false">)</mo>
        </mrow>
       </mrow>
       <mi>d</mi>
       <mmultiscripts>
        <mi>𝐫</mi>
        <none></none>
        <mo>′</mo>
        <none></none>
        <mi>N</mi>
       </mmultiscripts>
      </mrow>
     </mrow>
    </mfrac>
   </mrow>
   <mo>,</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <ci>π</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>𝐫</ci>
      <ci>N</ci>
     </apply>
    </apply>
    <apply>
     <divide></divide>
     <apply>
      <times></times>
      <ci>w</ci>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <mtext>r</mtext>
       <ci>N</ci>
      </apply>
      <apply>
       <exp></exp>
       <apply>
        <minus></minus>
        <apply>
         <times></times>
         <apply>
          <divide></divide>
          <apply>
           <times></times>
           <ci>U</ci>
           <apply>
            <csymbol cd="ambiguous">superscript</csymbol>
            <ci>𝐫</ci>
            <ci>N</ci>
           </apply>
          </apply>
          <apply>
           <csymbol cd="ambiguous">subscript</csymbol>
           <ci>k</ci>
           <ci>B</ci>
          </apply>
         </apply>
         <ci>T</ci>
        </apply>
       </apply>
      </apply>
     </apply>
     <apply>
      <int></int>
      <apply>
       <times></times>
       <ci>w</ci>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>𝐫</ci>
         <ci>normal-′</ci>
        </apply>
        <ci>N</ci>
       </apply>
       <apply>
        <exp></exp>
        <apply>
         <minus></minus>
         <apply>
          <times></times>
          <apply>
           <divide></divide>
           <apply>
            <times></times>
            <ci>U</ci>
            <apply>
             <csymbol cd="ambiguous">superscript</csymbol>
             <apply>
              <csymbol cd="ambiguous">superscript</csymbol>
              <ci>𝐫</ci>
              <ci>normal-′</ci>
             </apply>
             <ci>N</ci>
            </apply>
           </apply>
           <apply>
            <csymbol cd="ambiguous">subscript</csymbol>
            <ci>k</ci>
            <ci>B</ci>
           </apply>
          </apply>
          <ci>T</ci>
         </apply>
        </apply>
       </apply>
       <ci>d</ci>
       <apply>
        <csymbol cd="ambiguous">superscript</csymbol>
        <apply>
         <csymbol cd="ambiguous">superscript</csymbol>
         <ci>𝐫</ci>
         <ci>normal-′</ci>
        </apply>
        <ci>N</ci>
       </apply>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \pi(\mathbf{r}^{N})=\frac{w(\textbf{r}^{N})\exp{(-U(\mathbf{r}^{N}})/k_{B}T)}{%
\int{w(\mathbf{r^{\prime}}^{N})\exp{(-U(\mathbf{r^{\prime}}^{N}})/k_{B}T)}d%
\mathbf{r^{\prime}}^{N}},
  </annotation>
 </semantics>
</math>

</p>

<p>with <em>w</em>(<strong>r</strong><sup><em>N</em></sup>) a function chosen to promote configurations that would otherwise be inaccessible to a Boltzmann-weighted Monte Carlo run. In the example above, <em>w</em> may be chosen such that <em>w</em> = <em>w</em>(<em>Q</em>), taking high values at intermediate <em>Q</em> and low values at low/high <em>Q</em>, facilitating barrier crossing.</p>

<p>Values for a thermodynamic property <em>A</em> deduced from a sampling run performed in this manner can be transformed into canonical-ensemble values by applying the formula:</p>

<p>

<math display="block" id="Umbrella_sampling:1">
 <semantics>
  <mrow>
   <mrow>
    <mrow>
     <mo stretchy="false">⟨</mo>
     <mi>A</mi>
     <mo stretchy="false">⟩</mo>
    </mrow>
    <mo>=</mo>
    <mfrac>
     <msub>
      <mrow>
       <mo stretchy="false">⟨</mo>
       <mrow>
        <mi>A</mi>
        <mo>/</mo>
        <mi>w</mi>
       </mrow>
       <mo stretchy="false">⟩</mo>
      </mrow>
      <mi>π</mi>
     </msub>
     <msub>
      <mrow>
       <mo stretchy="false">⟨</mo>
       <mrow>
        <mn>1</mn>
        <mo>/</mo>
        <mi>w</mi>
       </mrow>
       <mo stretchy="false">⟩</mo>
      </mrow>
      <mi>π</mi>
     </msub>
    </mfrac>
   </mrow>
   <mo>,</mo>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <csymbol cd="latexml">delimited-⟨⟩</csymbol>
     <ci>A</ci>
    </apply>
    <apply>
     <divide></divide>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <apply>
       <csymbol cd="latexml">delimited-⟨⟩</csymbol>
       <apply>
        <divide></divide>
        <ci>A</ci>
        <ci>w</ci>
       </apply>
      </apply>
      <ci>π</ci>
     </apply>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <apply>
       <csymbol cd="latexml">delimited-⟨⟩</csymbol>
       <apply>
        <divide></divide>
        <cn type="integer">1</cn>
        <ci>w</ci>
       </apply>
      </apply>
      <ci>π</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \langle A\rangle=\frac{\langle A/w\rangle_{\pi}}{\langle 1/w\rangle_{\pi}},
  </annotation>
 </semantics>
</math>

</p>

<p>with the <em>

<math display="inline" id="Umbrella_sampling:2">
 <semantics>
  <mi>π</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>π</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   \pi
  </annotation>
 </semantics>
</math>

</em> subscript indicating values from the umbrella-sampled simulation.</p>

<p>The effect of introducing the weighting function <em>w</em>(<strong>r</strong><sup><em>N</em></sup>) is equivalent to adding a biasing potential <em>V</em>(<strong>r</strong><sup><em>N</em></sup>) to the potential energy of the system.</p>
<dl>
<dd><em>

<math display="inline" id="Umbrella_sampling:3">
 <semantics>
  <mrow>
   <mrow>
    <mi>V</mi>
    <mrow>
     <mo stretchy="false">(</mo>
     <msup>
      <mi>𝐫</mi>
      <mi>N</mi>
     </msup>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mo>-</mo>
    <mrow>
     <msub>
      <mi>k</mi>
      <mi>B</mi>
     </msub>
     <mi>T</mi>
     <mrow>
      <mi>ln</mi>
      <mi>w</mi>
     </mrow>
     <mrow>
      <mo stretchy="false">(</mo>
      <msup>
       <mi>𝐫</mi>
       <mi>N</mi>
      </msup>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <ci>V</ci>
     <apply>
      <csymbol cd="ambiguous">superscript</csymbol>
      <ci>𝐫</ci>
      <ci>N</ci>
     </apply>
    </apply>
    <apply>
     <minus></minus>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>k</ci>
       <ci>B</ci>
      </apply>
      <ci>T</ci>
      <apply>
       <ln></ln>
       <ci>w</ci>
      </apply>
      <apply>
       <csymbol cd="ambiguous">superscript</csymbol>
       <ci>𝐫</ci>
       <ci>N</ci>
      </apply>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   V(\mathbf{r}^{N})=-k_{B}T\ln w(\mathbf{r}^{N})
  </annotation>
 </semantics>
</math>


</em>
</dd>
</dl>

<p>If the biasing potential is strictly a function of a reaction coordinate or order parameter <em>

<math display="inline" id="Umbrella_sampling:4">
 <semantics>
  <mi>Q</mi>
  <annotation-xml encoding="MathML-Content">
   <ci>Q</ci>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   Q
  </annotation>
 </semantics>
</math>

</em>, then the (unbiased) free energy profile on the reaction coordinate can be calculated by subtracting the biasing potential from the biased free energy profile.</p>

<p>

<math display="block" id="Umbrella_sampling:5">
 <semantics>
  <mrow>
   <mrow>
    <msub>
     <mi>F</mi>
     <mn>0</mn>
    </msub>
    <mrow>
     <mo stretchy="false">(</mo>
     <mi>Q</mi>
     <mo stretchy="false">)</mo>
    </mrow>
   </mrow>
   <mo>=</mo>
   <mrow>
    <mrow>
     <msub>
      <mi>F</mi>
      <mi>π</mi>
     </msub>
     <mrow>
      <mo stretchy="false">(</mo>
      <mi>Q</mi>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
    <mo>-</mo>
    <mrow>
     <mi>V</mi>
     <mrow>
      <mo stretchy="false">(</mo>
      <mi>Q</mi>
      <mo stretchy="false">)</mo>
     </mrow>
    </mrow>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <eq></eq>
    <apply>
     <times></times>
     <apply>
      <csymbol cd="ambiguous">subscript</csymbol>
      <ci>F</ci>
      <cn type="integer">0</cn>
     </apply>
     <ci>Q</ci>
    </apply>
    <apply>
     <minus></minus>
     <apply>
      <times></times>
      <apply>
       <csymbol cd="ambiguous">subscript</csymbol>
       <ci>F</ci>
       <ci>π</ci>
      </apply>
      <ci>Q</ci>
     </apply>
     <apply>
      <times></times>
      <ci>V</ci>
      <ci>Q</ci>
     </apply>
    </apply>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   F_{0}(Q)=F_{\pi}(Q)-V(Q)
  </annotation>
 </semantics>
</math>

</p>

<p>where <em>

<math display="inline" id="Umbrella_sampling:6">
 <semantics>
  <mrow>
   <msub>
    <mi>F</mi>
    <mn>0</mn>
   </msub>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>Q</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>F</ci>
     <cn type="integer">0</cn>
    </apply>
    <ci>Q</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   F_{0}(Q)
  </annotation>
 </semantics>
</math>

</em> is the free energy profile of the unbiased system and <em>

<math display="inline" id="Umbrella_sampling:7">
 <semantics>
  <mrow>
   <msub>
    <mi>F</mi>
    <mi>π</mi>
   </msub>
   <mrow>
    <mo stretchy="false">(</mo>
    <mi>Q</mi>
    <mo stretchy="false">)</mo>
   </mrow>
  </mrow>
  <annotation-xml encoding="MathML-Content">
   <apply>
    <times></times>
    <apply>
     <csymbol cd="ambiguous">subscript</csymbol>
     <ci>F</ci>
     <ci>π</ci>
    </apply>
    <ci>Q</ci>
   </apply>
  </annotation-xml>
  <annotation encoding="application/x-tex">
   F_{\pi}(Q)
  </annotation>
 </semantics>
</math>

</em> is the free energy profile calculated for the biased, umbrella-sampled system.</p>

<p>Series of umbrella sampling simulations can be analyzed using the weighted histogram analysis method (WHAM)<a class="footnoteRef" href="#fn1" id="fnref1"><sup>1</sup></a> or its generalization.<a class="footnoteRef" href="#fn2" id="fnref2"><sup>2</sup></a></p>

<p>Subtleties exist in deciding the most computationally efficient way to apply the umbrella sampling method, as described in Frenkel &amp; Smit's book <em>Understanding Molecular Simulation</em>.</p>

<p>Alternatives to umbrella sampling for computing <a href="Potential_of_mean_force" title="wikilink">potentials of mean force</a> or <a href="reaction_rate" title="wikilink">reaction rates</a> are <a href="free_energy_perturbation" title="wikilink">free energy perturbation</a> and <a href="transition_path_sampling#Transition_interface_sampling" title="wikilink">transition interface sampling</a>. A further alternative which functions in full non-equilibrium is <a href="transition_path_sampling#Stochastic_process_rare_event_sampling" title="wikilink">S-PRES</a>.</p>
<h2 id="references">References</h2>

<p>"</p>

<p><a href="Category:Monte_Carlo_methods" title="wikilink">Category:Monte Carlo methods</a> <a href="Category:Molecular_dynamics" title="wikilink">Category:Molecular dynamics</a> <a href="Category:Computational_chemistry" title="wikilink">Category:Computational chemistry</a> <a href="Category:Theoretical_chemistry" title="wikilink">Category:Theoretical chemistry</a></p>
<section class="footnotes">
<hr/>
<ol>
<li id="fn1"><a href="#fnref1">↩</a></li>
<li id="fn2"><a href="#fnref2">↩</a></li>
</ol>
</section>
</body>
</html>
